{"version":3,"sources":["webpack:///scripts.bundle.js","webpack:///./~/script-loader/addScript.js","webpack:///./~/bragi-browser/dist/bragi.min.js?3933","webpack:///./~/jio/dist/jio-latest.js?7802","webpack:///./~/loglevel/dist/loglevel.min.js?e525","webpack:///./~/rsvp/dist/rsvp-2.0.4.js?425d","webpack:///./~/bragi-browser/dist/bragi.min.js","webpack:///./~/jio/dist/jio-latest.js","webpack:///./~/loglevel/dist/loglevel.min.js","webpack:///./~/rsvp/dist/rsvp-2.0.4.js"],"names":["webpackJsonp","226","module","exports","src","execScript","eval","call","519","__webpack_require__","520","521","522","722","723","724","725","988"],"mappings":"AAAAA,cAAc,EAAE,IAEVC,IACA,SAAUC,EAAQC,GCCxBD,EAAAC,QAAA,SAAAC,GACA,mBAAAC,YACAA,WAAAD,GAEAE,KAAAC,KAAA,KAAAH,KDWMI,IACA,SAAUN,EAAQC,EAASM,GEpBjCA,EAAA,KAAAA,EAAA,OF0BMC,IACA,SAAUR,EAAQC,EAASM,GG3BjCA,EAAA,KAAAA,EAAA,OHiCME,IACA,SAAUT,EAAQC,EAASM,GIlCjCA,EAAA,KAAAA,EAAA,OJwCMG,IACA,SAAUV,EAAQC,EAASM,GKzCjCA,EAAA,KAAAA,EAAA,OL+CMI,IACA,SAAUX,EAAQC,GMhDxBD,EAAAC,QAAA,2qwBNsDMW,IACA,SAAUZ,EAAQC,GOvDxBD,EAAAC,QAAA;EP6DMY,IACA,SAAUb,EAAQC,GQ9DxBD,EAAAC,QAAA,s2ERoEMa,IACA,SAAUd,EAAQC,GSrExBD,EAAAC,QAAA,gh4BT2EMc,IACA,SAAUf,EAAQC,EAASM,GAEjCA,EAAoB,KACpBA,EAAoB,KACpBA,EAAoB,KACpBP,EAAOC,QAAUM,EAAoB,QAKlC","file":"scripts.bundle.js","sourcesContent":["webpackJsonp([2,3],{\n\n/***/ 226:\n/***/ (function(module, exports) {\n\n/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nmodule.exports = function(src) {\r\n\tif (typeof execScript !== \"undefined\")\r\n\t\texecScript(src);\r\n\telse\r\n\t\teval.call(null, src);\r\n}\r\n\n\n/***/ }),\n\n/***/ 519:\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(226)(__webpack_require__(722))\n\n/***/ }),\n\n/***/ 520:\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(226)(__webpack_require__(723))\n\n/***/ }),\n\n/***/ 521:\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(226)(__webpack_require__(724))\n\n/***/ }),\n\n/***/ 522:\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(226)(__webpack_require__(725))\n\n/***/ }),\n\n/***/ 722:\n/***/ (function(module, exports) {\n\nmodule.exports = \"(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\\\"function\\\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\\\"Cannot find module '\\\"+o+\\\"'\\\");throw f.code=\\\"MODULE_NOT_FOUND\\\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\\\"function\\\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var util=require(\\\"util\\\");var canLog=require(\\\"./bragi/canLog\\\");var Transports=require(\\\"./bragi/transports/Transports\\\");var transports=require(\\\"./bragi/transports\\\");var STYLES=require(\\\"./bragi/styles\\\");var SYMBOLS=require(\\\"./bragi/symbols\\\");(function(root,factory){if(typeof define===\\\"function\\\"&&define.amd){define([\\\"exports\\\"],function(exports){root=factory(root,exports);return root})}else if(typeof exports!==\\\"undefined\\\"){factory(root,exports);module.exports=factory()}else{root.logger=factory(root,{})}})(this,function(root,logger){var LOGGER={util:{},canLog:canLog};LOGGER.util.__stack=function(){var stack=null;try{var orig=Error.prepareStackTrace;Error.prepareStackTrace=function(_,stack){return stack};var err=new Error;Error.captureStackTrace(err,arguments.callee);stack=err.stack;Error.prepareStackTrace=orig}catch(e){}return stack};LOGGER.util.colors=STYLES.colors;LOGGER.util.symbols=SYMBOLS;LOGGER.options={groupsEnabled:true,groupsDisabled:[],storeStackTrace:false};LOGGER.transports=new Transports;var _defaultTransports=[new transports.Console({showMeta:true,showStackTrace:false})];for(var i=0;i<_defaultTransports.length;i++){LOGGER.transports.add(_defaultTransports[i])}LOGGER.transportClasses=transports;LOGGER.addGroup=function addGroup(group){var groupsEnabled=LOGGER.options.groupsEnabled;if(groupsEnabled===true||groupsEnabled===false){LOGGER.options.groupsEnabled=groupsEnabled=[]}var i=0,len=groupsEnabled.length;for(i=0;i<len;i++){if(groupsEnabled[i].toString()===group.toString()){return LOGGER}}groupsEnabled.push(group);return LOGGER};LOGGER.removeGroup=function removeGroup(group){var groupsEnabled=LOGGER.options.groupsEnabled;if(groupsEnabled===true||groupsEnabled===false){LOGGER.options.groupsEnabled=groupsEnabled=[]}var i=0,len=groupsEnabled.length;var groupsEnabledWithoutGroup=[];for(i=0;i<len;i++){if(groupsEnabled[i].toString()!==group.toString()){groupsEnabledWithoutGroup.push(groupsEnabled[i])}}LOGGER.options.groupsEnabled=groupsEnabledWithoutGroup;return LOGGER};LOGGER.util.print=function print(message,color){color=color?color:\\\"black\\\";return LOGGER.util.colors[color]+message+LOGGER.util.colors.reset};LOGGER.log=function loggerLog(group,message){var groupsEnabled,groupsDisabled,currentTransport;var transportFuncsToCall=[];for(var transport in LOGGER.transports._transports){currentTransport=LOGGER.transports._transports[transport];groupsEnabled=LOGGER.options.groupsEnabled;groupsDisabled=LOGGER.options.groupsDisabled;if(currentTransport.groupsEnabled!==undefined){groupsEnabled=currentTransport.groupsEnabled}if(currentTransport.groupsDisabled!==undefined){groupsDisabled=currentTransport.groupsDisabled}if(canLog(group,groupsEnabled,groupsDisabled)){transportFuncsToCall.push(currentTransport)}}if(transportFuncsToCall.length<1){if(!LOGGER.options.storeAllHistory){return false}}var extraArgs=Array.prototype.slice.call(arguments,2);var loggedObject={};var caller=null;if(LOGGER.options.storeStackTrace){caller=\\\"global scope\\\";if(loggerLog.caller&&loggerLog.caller.name){caller=loggerLog.caller.name}else if((loggerLog.caller+\\\"\\\").indexOf(\\\"function ()\\\")===0){caller=\\\"anonymous function\\\"}}loggedObject.properties={};loggedObject.originalArgs=[];for(var i=0;i<extraArgs.length;i++){if(!(extraArgs[i]instanceof Array)&&typeof extraArgs[i]===\\\"object\\\"){for(var key in extraArgs[i]){loggedObject.properties[key]=extraArgs[i][key]}}else{loggedObject.properties[\\\"_argument\\\"+i]=extraArgs[i]}loggedObject.originalArgs.push(extraArgs[i])}loggedObject.meta={caller:caller,date:(new Date).toJSON()};loggedObject.unixTimestamp=(new Date).getTime()/1e3;var stack=false;if(LOGGER.options.storeStackTrace){stack=LOGGER.util.__stack();if(stack){var stackLength=stack.length;var trace=[];for(i=1;i<stack.length;i++){trace.push(stack[i]+\\\"\\\")}loggedObject.meta.file=stack[1].getFileName();loggedObject.meta.line=stack[1].getLineNumber();loggedObject.meta.column=stack[1].getColumnNumber();loggedObject.meta.trace=trace}}loggedObject.group=group;loggedObject.message=message;for(i=0,len=transportFuncsToCall.length;i<len;i++){transportFuncsToCall[i].log.call(transportFuncsToCall[i],loggedObject)}};if(!(typeof define===\\\"function\\\"&&define.amd)){window.BRAGI=LOGGER}return LOGGER})},{\\\"./bragi/canLog\\\":2,\\\"./bragi/styles\\\":3,\\\"./bragi/symbols\\\":4,\\\"./bragi/transports\\\":5,\\\"./bragi/transports/Transports\\\":8,util:13}],2:[function(require,module,exports){function canLog(group,groupsEnabled,groupsDisabled){if(groupsEnabled===undefined){groupsEnabled=true}var i,len;var canLogIt=true;if(groupsEnabled===true){canLogIt=true}else if(groupsEnabled===false||groupsEnabled===null){canLogIt=false}else if(groupsEnabled instanceof Array){canLogIt=false;for(i=0,len=groupsEnabled.length;i<len;i++){if(groupsEnabled[i]instanceof RegExp){if(groupsEnabled[i].test(group)){canLogIt=true;break}}else if(group.indexOf(groupsEnabled[i])===0){canLogIt=true;break}}}if(group.indexOf(\\\"error\\\")===0||group.indexOf(\\\"warn\\\")===0){canLogIt=true}if(groupsDisabled&&groupsDisabled instanceof Array){for(i=0,len=groupsDisabled.length;i<len;i++){if(groupsDisabled[i]instanceof RegExp){if(groupsDisabled[i].test(group)){canLogIt=false;break}}else if(group.indexOf(groupsDisabled[i])===0){canLogIt=false;break}}}return canLogIt}module.exports=canLog},{}],3:[function(require,module,exports){module.exports={colors:{white:\\\"\\u001b[37m\\\",grey:\\\"\\u001b[90m\\\",gray:\\\"\\u001b[90m\\\",black:\\\"\\u001b[30m\\\",blue:\\\"\\u001b[34m\\\",cyan:\\\"\\u001b[36m\\\",green:\\\"\\u001b[32m\\\",magenta:\\\"\\u001b[35m\\\",red:\\\"\\u001b[31m\\\",yellow:\\\"\\u001b[33m\\\",reset:\\\"\\u001b[0m\\\"},styles:{blink:\\\"\\u001b[49;5;8m\\\",underline:\\\"\\u001b[4m\\\",bold:\\\"\\u001b[1m\\\"},backgrounds:{white:\\\"\\u001b[47m\\\",black:\\\"\\u001b[40m\\\",blue:\\\"\\u001b[44m\\\",cyan:\\\"\\u001b[46m\\\",green:\\\"\\u001b[42m\\\",magenta:\\\"\\u001b[45m\\\",red:\\\"\\u001b[41m\\\",yellow:\\\"\\u001b[43m\\\"}}},{}],4:[function(require,module,exports){var STYLES=require(\\\"./styles\\\");module.exports={success:STYLES.colors.green+\\\"✔︎ \\\"+STYLES.colors.reset,error:STYLES.colors.red+\\\"✘ \\\"+STYLES.colors.reset,warn:STYLES.colors.yellow+\\\"⚑ \\\"+STYLES.colors.reset,arrow:\\\"➤ \\\",star:\\\"☆ \\\",box:STYLES.colors.yellow+\\\"☐ \\\"+STYLES.colors.reset,boxSuccess:STYLES.colors.green+\\\"☑︎ \\\"+STYLES.colors.reset,boxError:STYLES.colors.red+\\\"☒ \\\"+STYLES.colors.reset,circle:\\\"◯ \\\",circleFilled:\\\"◉ \\\",asterisk:\\\"✢\\\",floral:\\\"❧\\\",snowflake:\\\"❄︎\\\",fourDiamond:\\\"❖\\\",spade:\\\"♠︎\\\",club:\\\"♣︎\\\",heart:\\\"♥︎\\\",diamond:\\\"♦︎\\\",queen:\\\"♛\\\",rook:\\\"♜\\\",pawn:\\\"♟\\\",atom:\\\"⚛\\\"}},{\\\"./styles\\\":3}],5:[function(require,module,exports){var files=require(\\\"./transports/index\\\");var transports={};for(var file in files){transports[file]=files[file]}module.exports=transports},{\\\"./transports/index\\\":9}],6:[function(require,module,exports){var STYLES=require(\\\"../styles\\\");var SYMBOLS=require(\\\"../symbols\\\");if(window.console&&window.console.log){if(typeof window.console.log!==\\\"function\\\"){window.console.log=function(){}}}else{window.console={};window.console.log=function(){}}GROUP_COLORS=[[\\\"#3182bd\\\",\\\"#ffffff\\\",\\\"#225588\\\"],[\\\"#f38630\\\",\\\"#ffffff\\\"],[\\\"#e0e4cc\\\",\\\"#000000\\\",\\\"#c8cbb6\\\"],[\\\"#8c510a\\\",\\\"#ffffff\\\"],[\\\"#35978f\\\",\\\"#ffffff\\\",\\\"#13756d\\\"],[\\\"#c51b7d\\\",\\\"#ffffff\\\"],[\\\"#c6dbef\\\",\\\"#000000\\\"],[\\\"#af8dc3\\\",\\\"#000000\\\"],[\\\"#543005\\\",\\\"#ffffff\\\",\\\"#321002\\\"],[\\\"#7fbf7b\\\",\\\"#000000\\\"],[\\\"#dfc27d\\\",\\\"#000000\\\",\\\"#bda05b\\\"],[\\\"#f5f5f5\\\",\\\"#000000\\\"],[\\\"#e9a3c9\\\",\\\"#000000\\\"],[\\\"#59323C\\\",\\\"#ffffff\\\"],[\\\"#66c2a5\\\",\\\"#000000\\\"],[\\\"#f6e8c3\\\",\\\"#000000\\\"],[\\\"#606060\\\",\\\"#f0f0f0\\\"],[\\\"#8c510a\\\",\\\"#ffffff\\\"],[\\\"#80cdc1\\\",\\\"#000000\\\"],[\\\"#542788\\\",\\\"#ffffff\\\"],[\\\"#FB8AFE\\\",\\\"#343434\\\"],[\\\"#003c30\\\",\\\"#ffffff\\\"],[\\\"#e6f598\\\",\\\"#000000\\\"],[\\\"#c7eae5\\\",\\\"#000000\\\"],[\\\"#000000\\\",\\\"#f0f0f0\\\"],[\\\"#C3FF0E\\\",\\\"#343434\\\"]];OVERFLOW_SYMBOLS=[\\\"asterisk\\\",\\\"floral\\\",\\\"snowflake\\\",\\\"fourDiamond\\\",\\\"spade\\\",\\\"club\\\",\\\"heart\\\",\\\"diamond\\\",\\\"queen\\\",\\\"rook\\\",\\\"pawn\\\",\\\"atom\\\"];var BASE_CSS=\\\"padding: 2px; margin:2px; line-height: 1.8em;\\\";var META_STYLE=BASE_CSS+\\\"font-size:0.9em; color: #cdcdcd; padding-left:30px;\\\";function TransportConsole(options){options=options||{};this.groupsEnabled=options.groupsEnabled;this.groupsDisabled=options.groupsDisabled;this.addLineBreak=options.addLineBreak!==undefined?options.addLineBreak:false;this.showMeta=options.showMeta!==undefined?options.showMeta:false;this.showStackTrace=options.showStackTrace!==undefined?options.showStackTrace:true;this.showColors=options.showColors===undefined?true:options.showColor;this._foundColors=[];this._colorDict={error:BASE_CSS+\\\"background: #ff0000; color: #ffffff; font-style: bold; border: 4px solid #cc0000;\\\",warn:BASE_CSS+\\\"padding: 2px; background: #ffff00; color: #343434; font-style: bold; border: 4px solid #cccc00;\\\"};this.curSymbolIndex=0;return this}TransportConsole.prototype.getColor=function getColor(group){var color=\\\"\\\";var baseColor=\\\"\\\";var curSymbol;var cssString=\\\"\\\";group=group.split(\\\":\\\")[0];if(this._colorDict[group]){return this._colorDict[group]}if(this._foundColors.length>=GROUP_COLORS.length){color=GROUP_COLORS[this._foundColors.length%GROUP_COLORS.length];baseColor=color;cssString+=\\\"font-style: italic;\\\"}else{color=GROUP_COLORS[this._foundColors.length]}var borderColor=color[2];if(!color[2]){borderColor=\\\"#\\\";for(var i=1;i<color[0].length;i++){borderColor+=Math.max(0,parseInt(color[0][i],16)-2).toString(16)}}cssString+=BASE_CSS+\\\"background: \\\"+color[0]+\\\";\\\"+\\\"border: 1px solid \\\"+borderColor+\\\";\\\"+\\\"color: \\\"+color[1]+\\\";\\\";this._foundColors.push(color);this._colorDict[group]=cssString;return cssString};TransportConsole.prototype.name=\\\"Console\\\";TransportConsole.prototype.log=function transportConsoleLog(loggedObject){var consoleMessage=\\\"\\\";if(this.showColors){consoleMessage+=\\\"%c\\\"}consoleMessage+=\\\"[ \\\"+loggedObject.group+\\\" \\\"+\\\" ] \\t\\\";consoleMessage+=loggedObject.message+\\\" \\t\\\";if(this.addLineBreak){consoleMessage+=\\\"\\\\n\\\"}var toLogArray=[];toLogArray.push(consoleMessage);if(this.showColors){toLogArray.push(this.getColor(loggedObject.group))}toLogArray=toLogArray.concat(loggedObject.originalArgs);console.log.apply(console,toLogArray);var metaConsoleMessage=\\\"\\\";var metaLogArray=[];if(this.showMeta){if(this.showColors){metaConsoleMessage+=\\\"%c\\\"}metaConsoleMessage+=(new Date).toJSON()+\\\" \\t \\t \\\";if(loggedObject.meta.caller){metaConsoleMessage+=\\\"caller: \\\"+loggedObject.meta.caller+\\\" \\t \\t \\\"}if(loggedObject.meta.file&&loggedObject.meta.line){metaConsoleMessage+=loggedObject.meta.file+\\\":\\\"+loggedObject.meta.line+\\\":\\\"+loggedObject.meta.column+\\\"\\\"}}if(this.showMeta&&this.showStackTrace&&loggedObject.meta.trace){metaConsoleMessage+=\\\"\\\\n\\\"+\\\"(Stack Trace)\\\"+\\\"\\\\n\\\";for(i=0;i<loggedObject.meta.trace.length;i++){metaConsoleMessage+=\\\"\\t\\\"+loggedObject.meta.trace[i]+\\\"\\\\n\\\"}}if(this.showMeta&&this.showColors){metaLogArray.push(metaConsoleMessage);metaLogArray.push(META_STYLE)}if(metaLogArray.length>0){console.log.apply(console,metaLogArray)}return this};module.exports=TransportConsole},{\\\"../styles\\\":3,\\\"../symbols\\\":4}],7:[function(require,module,exports){function TransportHistory(options){options=options||{};this.groupsEnabled=options.groupsEnabled;this.groupsDisabled=options.groupsDisabled;this.storeEverything=false;if(options.storeEverything===true){this.storeEverything=true;this.groupsEnabled=true}this.historySize=options.historySize!==undefined?options.historySize:200;this.history={};return this}TransportHistory.prototype.name=\\\"History\\\";TransportHistory.prototype.log=function transportHistoryLog(loggedObject){var group=loggedObject.group.split(\\\":\\\")[0];if(this.history[group]===undefined){this.history[group]=[]}this.history[group].push(loggedObject);if(this.historySize>0&&this.history[group].length>this.historySize){this.history[group].shift()}return this};module.exports=TransportHistory},{}],8:[function(require,module,exports){function Transports(){this._transports={};this._transportCount={};return this}Transports.prototype.get=function get(transportName){var returnedTransportObjects=new Array;for(var key in this._transports){if(key.toLowerCase().indexOf(transportName.toLowerCase())>-1){returnedTransportObjects.push(this._transports[key])}}returnedTransportObjects.property=function transportProperty(keyOrObject,value){var i=0;var len=this.length;if(typeof keyOrObject===\\\"string\\\"&&value===undefined){var vals=[];for(i=0;i<len;i++){vals.push(this[i][keyOrObject])}return vals}else if(typeof keyOrObject===\\\"string\\\"&&value!==undefined){for(i=0;i<len;i++){this[i][keyOrObject]=value}}else if(typeof keyOrObject===\\\"object\\\"){for(i=0;i<len;i++){for(var keyName in keyOrObject){this[i][keyName]=keyOrObject[keyName]}}}return this};return returnedTransportObjects};Transports.prototype.add=function add(transport){if(this._transportCount[transport.name]===undefined){this._transportCount[transport.name]=1;this._transports[transport.name]=transport}else{this._transportCount[transport.name]+=1;this._transports[transport.name+\\\"\\\"+(this._transportCount[transport.name]-1)]=transport}return this};Transports.prototype.remove=function remove(transportName,index){transportName=transportName;if(transportName.name){transportName=transportName.name}for(var key in this._transports){if(index!==undefined){if(transportName+\\\"\\\"+index===key){delete this._transports[key]}}else{if(key.indexOf(transportName)>-1){delete this._transports[key]}}}return this};Transports.prototype.empty=function empty(){for(var key in this._transports){delete this._transports[key]}return this};module.exports=Transports},{}],9:[function(require,module,exports){module.exports.Console=require(\\\"./Console\\\");module.exports.History=require(\\\"./History\\\")},{\\\"./Console\\\":6,\\\"./History\\\":7}],10:[function(require,module,exports){if(typeof Object.create===\\\"function\\\"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],11:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!==\\\"undefined\\\"&&window.setImmediate;var canPost=typeof window!==\\\"undefined\\\"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener(\\\"message\\\",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data===\\\"process-tick\\\"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage(\\\"process-tick\\\",\\\"*\\\")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title=\\\"browser\\\";process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error(\\\"process.binding is not supported\\\")};process.cwd=function(){return\\\"/\\\"};process.chdir=function(dir){throw new Error(\\\"process.chdir is not supported\\\")}},{}],12:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg===\\\"object\\\"&&typeof arg.copy===\\\"function\\\"&&typeof arg.fill===\\\"function\\\"&&typeof arg.readUInt8===\\\"function\\\"}},{}],13:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(\\\" \\\")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x===\\\"%%\\\")return\\\"%\\\";if(i>=len)return x;switch(x){case\\\"%s\\\":return String(args[i++]);case\\\"%d\\\":return Number(args[i++]);case\\\"%j\\\":try{return JSON.stringify(args[i++])}catch(_){return\\\"[Circular]\\\"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=\\\" \\\"+x}else{str+=\\\" \\\"+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||\\\"\\\";set=set.toUpperCase();if(!debugs[set]){if(new RegExp(\\\"\\\\\\\\b\\\"+set+\\\"\\\\\\\\b\\\",\\\"i\\\").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error(\\\"%s %d: %s\\\",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:\\\"cyan\\\",number:\\\"yellow\\\",\\\"boolean\\\":\\\"yellow\\\",undefined:\\\"grey\\\",\\\"null\\\":\\\"bold\\\",string:\\\"green\\\",date:\\\"magenta\\\",regexp:\\\"red\\\"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return\\\"\\u001b[\\\"+inspect.colors[style][0]+\\\"m\\\"+str+\\\"\\u001b[\\\"+inspect.colors[style][1]+\\\"m\\\"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf(\\\"message\\\")>=0||keys.indexOf(\\\"description\\\")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?\\\": \\\"+value.name:\\\"\\\";return ctx.stylize(\\\"[Function\\\"+name+\\\"]\\\",\\\"special\\\")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),\\\"regexp\\\")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),\\\"date\\\")}if(isError(value)){return formatError(value)}}var base=\\\"\\\",array=false,braces=[\\\"{\\\",\\\"}\\\"];if(isArray(value)){array=true;braces=[\\\"[\\\",\\\"]\\\"]}if(isFunction(value)){var n=value.name?\\\": \\\"+value.name:\\\"\\\";base=\\\" [Function\\\"+n+\\\"]\\\"}if(isRegExp(value)){base=\\\" \\\"+RegExp.prototype.toString.call(value)}if(isDate(value)){base=\\\" \\\"+Date.prototype.toUTCString.call(value)}if(isError(value)){base=\\\" \\\"+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),\\\"regexp\\\")}else{return ctx.stylize(\\\"[Object]\\\",\\\"special\\\")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize(\\\"undefined\\\",\\\"undefined\\\");if(isString(value)){var simple=\\\"'\\\"+JSON.stringify(value).replace(/^\\\"|\\\"$/g,\\\"\\\").replace(/'/g,\\\"\\\\\\\\'\\\").replace(/\\\\\\\\\\\"/g,'\\\"')+\\\"'\\\";return ctx.stylize(simple,\\\"string\\\")}if(isNumber(value))return ctx.stylize(\\\"\\\"+value,\\\"number\\\");if(isBoolean(value))return ctx.stylize(\\\"\\\"+value,\\\"boolean\\\");if(isNull(value))return ctx.stylize(\\\"null\\\",\\\"null\\\")}function formatError(value){return\\\"[\\\"+Error.prototype.toString.call(value)+\\\"]\\\"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push(\\\"\\\")}}keys.forEach(function(key){if(!key.match(/^\\\\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize(\\\"[Getter/Setter]\\\",\\\"special\\\")}else{str=ctx.stylize(\\\"[Getter]\\\",\\\"special\\\")}}else{if(desc.set){str=ctx.stylize(\\\"[Setter]\\\",\\\"special\\\")}}if(!hasOwnProperty(visibleKeys,key)){name=\\\"[\\\"+key+\\\"]\\\"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf(\\\"\\\\n\\\")>-1){if(array){str=str.split(\\\"\\\\n\\\").map(function(line){return\\\"  \\\"+line}).join(\\\"\\\\n\\\").substr(2)}else{str=\\\"\\\\n\\\"+str.split(\\\"\\\\n\\\").map(function(line){return\\\"   \\\"+line}).join(\\\"\\\\n\\\")}}}else{str=ctx.stylize(\\\"[Circular]\\\",\\\"special\\\")}}if(isUndefined(name)){if(array&&key.match(/^\\\\d+$/)){return str}name=JSON.stringify(\\\"\\\"+key);if(name.match(/^\\\"([a-zA-Z_][a-zA-Z_0-9]*)\\\"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,\\\"name\\\")}else{name=name.replace(/'/g,\\\"\\\\\\\\'\\\").replace(/\\\\\\\\\\\"/g,'\\\"').replace(/(^\\\"|\\\"$)/g,\\\"'\\\");name=ctx.stylize(name,\\\"string\\\")}}return name+\\\": \\\"+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf(\\\"\\\\n\\\")>=0)numLinesEst++;return prev+cur.replace(/\\\\u001b\\\\[\\\\d\\\\d?m/g,\\\"\\\").length+1},0);if(length>60){return braces[0]+(base===\\\"\\\"?\\\"\\\":base+\\\"\\\\n \\\")+\\\" \\\"+output.join(\\\",\\\\n  \\\")+\\\" \\\"+braces[1]}return braces[0]+base+\\\" \\\"+output.join(\\\", \\\")+\\\" \\\"+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg===\\\"boolean\\\"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg===\\\"number\\\"}exports.isNumber=isNumber;function isString(arg){return typeof arg===\\\"string\\\"}exports.isString=isString;function isSymbol(arg){return typeof arg===\\\"symbol\\\"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)===\\\"[object RegExp]\\\"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg===\\\"object\\\"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)===\\\"[object Date]\\\"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)===\\\"[object Error]\\\"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg===\\\"function\\\"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg===\\\"boolean\\\"||typeof arg===\\\"number\\\"||typeof arg===\\\"string\\\"||typeof arg===\\\"symbol\\\"||typeof arg===\\\"undefined\\\"}exports.isPrimitive=isPrimitive;exports.isBuffer=require(\\\"./support/isBuffer\\\");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?\\\"0\\\"+n.toString(10):n.toString(10)}var months=[\\\"Jan\\\",\\\"Feb\\\",\\\"Mar\\\",\\\"Apr\\\",\\\"May\\\",\\\"Jun\\\",\\\"Jul\\\",\\\"Aug\\\",\\\"Sep\\\",\\\"Oct\\\",\\\"Nov\\\",\\\"Dec\\\"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(\\\":\\\");return[d.getDate(),months[d.getMonth()],time].join(\\\" \\\")}exports.log=function(){console.log(\\\"%s - %s\\\",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require(\\\"inherits\\\");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require(\\\"_process\\\"),typeof global!==\\\"undefined\\\"?global:typeof self!==\\\"undefined\\\"?self:typeof window!==\\\"undefined\\\"?window:{})},{\\\"./support/isBuffer\\\":12,_process:11,inherits:10}]},{},[1]);\"\n\n/***/ }),\n\n/***/ 723:\n/***/ (function(module, exports) {\n\nmodule.exports = \"/*! URI.js v1.12.0 http://medialize.github.com/URI.js/ */\\n/* build contains: IPv6.js, punycode.js, SecondLevelDomains.js, URI.js, URI.fragmentQuery.js */\\n(function(e,k){\\\"object\\\"===typeof exports?module.exports=k():\\\"function\\\"===typeof define&&define.amd?define(k):e.IPv6=k(e)})(this,function(e){var k=e&&e.IPv6;return{best:function(e){e=e.toLowerCase().split(\\\":\\\");var k=e.length,d=8;\\\"\\\"===e[0]&&\\\"\\\"===e[1]&&\\\"\\\"===e[2]?(e.shift(),e.shift()):\\\"\\\"===e[0]&&\\\"\\\"===e[1]?e.shift():\\\"\\\"===e[k-1]&&\\\"\\\"===e[k-2]&&e.pop();k=e.length;-1!==e[k-1].indexOf(\\\".\\\")&&(d=7);var g;for(g=0;g<k&&\\\"\\\"!==e[g];g++);if(g<d)for(e.splice(g,1,\\\"0000\\\");e.length<d;)e.splice(g,0,\\\"0000\\\");for(g=0;g<d;g++){for(var k=\\ne[g].split(\\\"\\\"),q=0;3>q;q++)if(\\\"0\\\"===k[0]&&1<k.length)k.splice(0,1);else break;e[g]=k.join(\\\"\\\")}var k=-1,l=q=0,r=-1,z=!1;for(g=0;g<d;g++)z?\\\"0\\\"===e[g]?l+=1:(z=!1,l>q&&(k=r,q=l)):\\\"0\\\"==e[g]&&(z=!0,r=g,l=1);l>q&&(k=r,q=l);1<q&&e.splice(k,q,\\\"\\\");k=e.length;d=\\\"\\\";\\\"\\\"===e[0]&&(beststr=\\\":\\\");for(g=0;g<k;g++){d+=e[g];if(g===k-1)break;d+=\\\":\\\"}\\\"\\\"===e[k-1]&&(d+=\\\":\\\");return d},noConflict:function(){e.IPv6===this&&(e.IPv6=k);return this}}});\\n(function(e){function k(a){throw RangeError(p[a]);}function u(a,b){for(var c=a.length;c--;)a[c]=b(a[c]);return a}function m(a,b){return u(a.split(h),b).join(\\\".\\\")}function d(a){for(var b=[],c=0,d=a.length,h,p;c<d;)h=a.charCodeAt(c++),55296<=h&&56319>=h&&c<d?(p=a.charCodeAt(c++),56320==(p&64512)?b.push(((h&1023)<<10)+(p&1023)+65536):(b.push(h),c--)):b.push(h);return b}function g(a){return u(a,function(a){var b=\\\"\\\";65535<a&&(a-=65536,b+=x(a>>>10&1023|55296),a=56320|a&1023);return b+=x(a)}).join(\\\"\\\")}function q(a,\\nb){return a+22+75*(26>a)-((0!=b)<<5)}function l(a,b,c){var d=0;a=c?A(a/H):a>>1;for(a+=A(a/b);a>n*y>>1;d+=s)a=A(a/n);return A(d+(n+1)*a/(a+I))}function r(b){var c=[],d=b.length,h,p=0,e=F,f=G,n,x,q,t,m;n=b.lastIndexOf(a);0>n&&(n=0);for(x=0;x<n;++x)128<=b.charCodeAt(x)&&k(\\\"not-basic\\\"),c.push(b.charCodeAt(x));for(n=0<n?n+1:0;n<d;){x=p;h=1;for(q=s;;q+=s){n>=d&&k(\\\"invalid-input\\\");t=b.charCodeAt(n++);t=10>t-48?t-22:26>t-65?t-65:26>t-97?t-97:s;(t>=s||t>A((w-p)/h))&&k(\\\"overflow\\\");p+=t*h;m=q<=f?v:q>=f+y?y:\\nq-f;if(t<m)break;t=s-m;h>A(w/t)&&k(\\\"overflow\\\");h*=t}h=c.length+1;f=l(p-x,h,0==x);A(p/h)>w-e&&k(\\\"overflow\\\");e+=A(p/h);p%=h;c.splice(p++,0,e)}return g(c)}function z(b){var c,h,p,e,f,n,g,m,r,t=[],B,u,z;b=d(b);B=b.length;c=F;h=0;f=G;for(n=0;n<B;++n)r=b[n],128>r&&t.push(x(r));for((p=e=t.length)&&t.push(a);p<B;){g=w;for(n=0;n<B;++n)r=b[n],r>=c&&r<g&&(g=r);u=p+1;g-c>A((w-h)/u)&&k(\\\"overflow\\\");h+=(g-c)*u;c=g;for(n=0;n<B;++n)if(r=b[n],r<c&&++h>w&&k(\\\"overflow\\\"),r==c){m=h;for(g=s;;g+=s){r=g<=f?v:g>=f+y?y:g-f;\\nif(m<r)break;z=m-r;m=s-r;t.push(x(q(r+z%m,0)));m=A(z/m)}t.push(x(q(m,0)));f=l(h,u,p==e);h=0;++p}++h;++c}return t.join(\\\"\\\")}var D=\\\"object\\\"==typeof exports&&exports,E=\\\"object\\\"==typeof module&&module&&module.exports==D&&module,C=\\\"object\\\"==typeof global&&global;if(C.global===C||C.window===C)e=C;var f,w=2147483647,s=36,v=1,y=26,I=38,H=700,G=72,F=128,a=\\\"-\\\",b=/^xn--/,c=/[^ -~]/,h=/\\\\x2E|\\\\u3002|\\\\uFF0E|\\\\uFF61/g,p={overflow:\\\"Overflow: input needs wider integers to process\\\",\\\"not-basic\\\":\\\"Illegal input >= 0x80 (not a basic code point)\\\",\\n\\\"invalid-input\\\":\\\"Invalid input\\\"},n=s-v,A=Math.floor,x=String.fromCharCode,B;f={version:\\\"1.2.3\\\",ucs2:{decode:d,encode:g},decode:r,encode:z,toASCII:function(a){return m(a,function(a){return c.test(a)?\\\"xn--\\\"+z(a):a})},toUnicode:function(a){return m(a,function(a){return b.test(a)?r(a.slice(4).toLowerCase()):a})}};if(\\\"function\\\"==typeof define&&\\\"object\\\"==typeof define.amd&&define.amd)define(function(){return f});else if(D&&!D.nodeType)if(E)E.exports=f;else for(B in f)f.hasOwnProperty(B)&&(D[B]=f[B]);else e.punycode=\\nf})(this);\\n(function(e,k){\\\"object\\\"===typeof exports?module.exports=k():\\\"function\\\"===typeof define&&define.amd?define(k):e.SecondLevelDomains=k(e)})(this,function(e){var k=e&&e.SecondLevelDomains,u=Object.prototype.hasOwnProperty,m={list:{ac:\\\"com|gov|mil|net|org\\\",ae:\\\"ac|co|gov|mil|name|net|org|pro|sch\\\",af:\\\"com|edu|gov|net|org\\\",al:\\\"com|edu|gov|mil|net|org\\\",ao:\\\"co|ed|gv|it|og|pb\\\",ar:\\\"com|edu|gob|gov|int|mil|net|org|tur\\\",at:\\\"ac|co|gv|or\\\",au:\\\"asn|com|csiro|edu|gov|id|net|org\\\",ba:\\\"co|com|edu|gov|mil|net|org|rs|unbi|unmo|unsa|untz|unze\\\",bb:\\\"biz|co|com|edu|gov|info|net|org|store|tv\\\",\\nbh:\\\"biz|cc|com|edu|gov|info|net|org\\\",bn:\\\"com|edu|gov|net|org\\\",bo:\\\"com|edu|gob|gov|int|mil|net|org|tv\\\",br:\\\"adm|adv|agr|am|arq|art|ato|b|bio|blog|bmd|cim|cng|cnt|com|coop|ecn|edu|eng|esp|etc|eti|far|flog|fm|fnd|fot|fst|g12|ggf|gov|imb|ind|inf|jor|jus|lel|mat|med|mil|mus|net|nom|not|ntr|odo|org|ppg|pro|psc|psi|qsl|rec|slg|srv|tmp|trd|tur|tv|vet|vlog|wiki|zlg\\\",bs:\\\"com|edu|gov|net|org\\\",bz:\\\"du|et|om|ov|rg\\\",ca:\\\"ab|bc|mb|nb|nf|nl|ns|nt|nu|on|pe|qc|sk|yk\\\",ck:\\\"biz|co|edu|gen|gov|info|net|org\\\",cn:\\\"ac|ah|bj|com|cq|edu|fj|gd|gov|gs|gx|gz|ha|hb|he|hi|hl|hn|jl|js|jx|ln|mil|net|nm|nx|org|qh|sc|sd|sh|sn|sx|tj|tw|xj|xz|yn|zj\\\",\\nco:\\\"com|edu|gov|mil|net|nom|org\\\",cr:\\\"ac|c|co|ed|fi|go|or|sa\\\",cy:\\\"ac|biz|com|ekloges|gov|ltd|name|net|org|parliament|press|pro|tm\\\",\\\"do\\\":\\\"art|com|edu|gob|gov|mil|net|org|sld|web\\\",dz:\\\"art|asso|com|edu|gov|net|org|pol\\\",ec:\\\"com|edu|fin|gov|info|med|mil|net|org|pro\\\",eg:\\\"com|edu|eun|gov|mil|name|net|org|sci\\\",er:\\\"com|edu|gov|ind|mil|net|org|rochest|w\\\",es:\\\"com|edu|gob|nom|org\\\",et:\\\"biz|com|edu|gov|info|name|net|org\\\",fj:\\\"ac|biz|com|info|mil|name|net|org|pro\\\",fk:\\\"ac|co|gov|net|nom|org\\\",fr:\\\"asso|com|f|gouv|nom|prd|presse|tm\\\",\\ngg:\\\"co|net|org\\\",gh:\\\"com|edu|gov|mil|org\\\",gn:\\\"ac|com|gov|net|org\\\",gr:\\\"com|edu|gov|mil|net|org\\\",gt:\\\"com|edu|gob|ind|mil|net|org\\\",gu:\\\"com|edu|gov|net|org\\\",hk:\\\"com|edu|gov|idv|net|org\\\",id:\\\"ac|co|go|mil|net|or|sch|web\\\",il:\\\"ac|co|gov|idf|k12|muni|net|org\\\",\\\"in\\\":\\\"ac|co|edu|ernet|firm|gen|gov|i|ind|mil|net|nic|org|res\\\",iq:\\\"com|edu|gov|i|mil|net|org\\\",ir:\\\"ac|co|dnssec|gov|i|id|net|org|sch\\\",it:\\\"edu|gov\\\",je:\\\"co|net|org\\\",jo:\\\"com|edu|gov|mil|name|net|org|sch\\\",jp:\\\"ac|ad|co|ed|go|gr|lg|ne|or\\\",ke:\\\"ac|co|go|info|me|mobi|ne|or|sc\\\",\\nkh:\\\"com|edu|gov|mil|net|org|per\\\",ki:\\\"biz|com|de|edu|gov|info|mob|net|org|tel\\\",km:\\\"asso|com|coop|edu|gouv|k|medecin|mil|nom|notaires|pharmaciens|presse|tm|veterinaire\\\",kn:\\\"edu|gov|net|org\\\",kr:\\\"ac|busan|chungbuk|chungnam|co|daegu|daejeon|es|gangwon|go|gwangju|gyeongbuk|gyeonggi|gyeongnam|hs|incheon|jeju|jeonbuk|jeonnam|k|kg|mil|ms|ne|or|pe|re|sc|seoul|ulsan\\\",kw:\\\"com|edu|gov|net|org\\\",ky:\\\"com|edu|gov|net|org\\\",kz:\\\"com|edu|gov|mil|net|org\\\",lb:\\\"com|edu|gov|net|org\\\",lk:\\\"assn|com|edu|gov|grp|hotel|int|ltd|net|ngo|org|sch|soc|web\\\",\\nlr:\\\"com|edu|gov|net|org\\\",lv:\\\"asn|com|conf|edu|gov|id|mil|net|org\\\",ly:\\\"com|edu|gov|id|med|net|org|plc|sch\\\",ma:\\\"ac|co|gov|m|net|org|press\\\",mc:\\\"asso|tm\\\",me:\\\"ac|co|edu|gov|its|net|org|priv\\\",mg:\\\"com|edu|gov|mil|nom|org|prd|tm\\\",mk:\\\"com|edu|gov|inf|name|net|org|pro\\\",ml:\\\"com|edu|gov|net|org|presse\\\",mn:\\\"edu|gov|org\\\",mo:\\\"com|edu|gov|net|org\\\",mt:\\\"com|edu|gov|net|org\\\",mv:\\\"aero|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro\\\",mw:\\\"ac|co|com|coop|edu|gov|int|museum|net|org\\\",mx:\\\"com|edu|gob|net|org\\\",my:\\\"com|edu|gov|mil|name|net|org|sch\\\",\\nnf:\\\"arts|com|firm|info|net|other|per|rec|store|web\\\",ng:\\\"biz|com|edu|gov|mil|mobi|name|net|org|sch\\\",ni:\\\"ac|co|com|edu|gob|mil|net|nom|org\\\",np:\\\"com|edu|gov|mil|net|org\\\",nr:\\\"biz|com|edu|gov|info|net|org\\\",om:\\\"ac|biz|co|com|edu|gov|med|mil|museum|net|org|pro|sch\\\",pe:\\\"com|edu|gob|mil|net|nom|org|sld\\\",ph:\\\"com|edu|gov|i|mil|net|ngo|org\\\",pk:\\\"biz|com|edu|fam|gob|gok|gon|gop|gos|gov|net|org|web\\\",pl:\\\"art|bialystok|biz|com|edu|gda|gdansk|gorzow|gov|info|katowice|krakow|lodz|lublin|mil|net|ngo|olsztyn|org|poznan|pwr|radom|slupsk|szczecin|torun|warszawa|waw|wroc|wroclaw|zgora\\\",\\npr:\\\"ac|biz|com|edu|est|gov|info|isla|name|net|org|pro|prof\\\",ps:\\\"com|edu|gov|net|org|plo|sec\\\",pw:\\\"belau|co|ed|go|ne|or\\\",ro:\\\"arts|com|firm|info|nom|nt|org|rec|store|tm|www\\\",rs:\\\"ac|co|edu|gov|in|org\\\",sb:\\\"com|edu|gov|net|org\\\",sc:\\\"com|edu|gov|net|org\\\",sh:\\\"co|com|edu|gov|net|nom|org\\\",sl:\\\"com|edu|gov|net|org\\\",st:\\\"co|com|consulado|edu|embaixada|gov|mil|net|org|principe|saotome|store\\\",sv:\\\"com|edu|gob|org|red\\\",sz:\\\"ac|co|org\\\",tr:\\\"av|bbs|bel|biz|com|dr|edu|gen|gov|info|k12|name|net|org|pol|tel|tsk|tv|web\\\",tt:\\\"aero|biz|cat|co|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel\\\",\\ntw:\\\"club|com|ebiz|edu|game|gov|idv|mil|net|org\\\",mu:\\\"ac|co|com|gov|net|or|org\\\",mz:\\\"ac|co|edu|gov|org\\\",na:\\\"co|com\\\",nz:\\\"ac|co|cri|geek|gen|govt|health|iwi|maori|mil|net|org|parliament|school\\\",pa:\\\"abo|ac|com|edu|gob|ing|med|net|nom|org|sld\\\",pt:\\\"com|edu|gov|int|net|nome|org|publ\\\",py:\\\"com|edu|gov|mil|net|org\\\",qa:\\\"com|edu|gov|mil|net|org\\\",re:\\\"asso|com|nom\\\",ru:\\\"ac|adygeya|altai|amur|arkhangelsk|astrakhan|bashkiria|belgorod|bir|bryansk|buryatia|cbg|chel|chelyabinsk|chita|chukotka|chuvashia|com|dagestan|e-burg|edu|gov|grozny|int|irkutsk|ivanovo|izhevsk|jar|joshkar-ola|kalmykia|kaluga|kamchatka|karelia|kazan|kchr|kemerovo|khabarovsk|khakassia|khv|kirov|koenig|komi|kostroma|kranoyarsk|kuban|kurgan|kursk|lipetsk|magadan|mari|mari-el|marine|mil|mordovia|mosreg|msk|murmansk|nalchik|net|nnov|nov|novosibirsk|nsk|omsk|orenburg|org|oryol|penza|perm|pp|pskov|ptz|rnd|ryazan|sakhalin|samara|saratov|simbirsk|smolensk|spb|stavropol|stv|surgut|tambov|tatarstan|tom|tomsk|tsaritsyn|tsk|tula|tuva|tver|tyumen|udm|udmurtia|ulan-ude|vladikavkaz|vladimir|vladivostok|volgograd|vologda|voronezh|vrn|vyatka|yakutia|yamal|yekaterinburg|yuzhno-sakhalinsk\\\",\\nrw:\\\"ac|co|com|edu|gouv|gov|int|mil|net\\\",sa:\\\"com|edu|gov|med|net|org|pub|sch\\\",sd:\\\"com|edu|gov|info|med|net|org|tv\\\",se:\\\"a|ac|b|bd|c|d|e|f|g|h|i|k|l|m|n|o|org|p|parti|pp|press|r|s|t|tm|u|w|x|y|z\\\",sg:\\\"com|edu|gov|idn|net|org|per\\\",sn:\\\"art|com|edu|gouv|org|perso|univ\\\",sy:\\\"com|edu|gov|mil|net|news|org\\\",th:\\\"ac|co|go|in|mi|net|or\\\",tj:\\\"ac|biz|co|com|edu|go|gov|info|int|mil|name|net|nic|org|test|web\\\",tn:\\\"agrinet|com|defense|edunet|ens|fin|gov|ind|info|intl|mincom|nat|net|org|perso|rnrt|rns|rnu|tourism\\\",tz:\\\"ac|co|go|ne|or\\\",\\nua:\\\"biz|cherkassy|chernigov|chernovtsy|ck|cn|co|com|crimea|cv|dn|dnepropetrovsk|donetsk|dp|edu|gov|if|in|ivano-frankivsk|kh|kharkov|kherson|khmelnitskiy|kiev|kirovograd|km|kr|ks|kv|lg|lugansk|lutsk|lviv|me|mk|net|nikolaev|od|odessa|org|pl|poltava|pp|rovno|rv|sebastopol|sumy|te|ternopil|uzhgorod|vinnica|vn|zaporizhzhe|zhitomir|zp|zt\\\",ug:\\\"ac|co|go|ne|or|org|sc\\\",uk:\\\"ac|bl|british-library|co|cym|gov|govt|icnet|jet|lea|ltd|me|mil|mod|national-library-scotland|nel|net|nhs|nic|nls|org|orgn|parliament|plc|police|sch|scot|soc\\\",\\nus:\\\"dni|fed|isa|kids|nsn\\\",uy:\\\"com|edu|gub|mil|net|org\\\",ve:\\\"co|com|edu|gob|info|mil|net|org|web\\\",vi:\\\"co|com|k12|net|org\\\",vn:\\\"ac|biz|com|edu|gov|health|info|int|name|net|org|pro\\\",ye:\\\"co|com|gov|ltd|me|net|org|plc\\\",yu:\\\"ac|co|edu|gov|org\\\",za:\\\"ac|agric|alt|bourse|city|co|cybernet|db|edu|gov|grondar|iaccess|imt|inca|landesign|law|mil|net|ngo|nis|nom|olivetti|org|pix|school|tm|web\\\",zm:\\\"ac|co|com|edu|gov|net|org|sch\\\"},has_expression:null,is_expression:null,has:function(d){return!!d.match(m.has_expression)},\\nis:function(d){return!!d.match(m.is_expression)},get:function(d){return(d=d.match(m.has_expression))&&d[1]||null},noConflict:function(){e.SecondLevelDomains===this&&(e.SecondLevelDomains=k);return this},init:function(){var d=\\\"\\\",e;for(e in m.list)u.call(m.list,e)&&(d+=\\\"|(\\\"+(\\\"(\\\"+m.list[e]+\\\").\\\"+e)+\\\")\\\");m.has_expression=RegExp(\\\"\\\\\\\\.(\\\"+d.substr(1)+\\\")$\\\",\\\"i\\\");m.is_expression=RegExp(\\\"^(\\\"+d.substr(1)+\\\")$\\\",\\\"i\\\")}};m.init();return m});\\n(function(e,k){\\\"object\\\"===typeof exports?module.exports=k(require(\\\"./punycode\\\"),require(\\\"./IPv6\\\"),require(\\\"./SecondLevelDomains\\\")):\\\"function\\\"===typeof define&&define.amd?define([\\\"./punycode\\\",\\\"./IPv6\\\",\\\"./SecondLevelDomains\\\"],k):e.URI=k(e.punycode,e.IPv6,e.SecondLevelDomains,e)})(this,function(e,k,u,m){function d(a,b){if(!(this instanceof d))return new d(a,b);void 0===a&&(a=\\\"undefined\\\"!==typeof location?location.href+\\\"\\\":\\\"\\\");this.href(a);return void 0!==b?this.absoluteTo(b):this}function g(a){return a.replace(/([.*+?^=!:${}()|[\\\\]\\\\/\\\\\\\\])/g,\\n\\\"\\\\\\\\$1\\\")}function q(a){return void 0===a?\\\"Undefined\\\":String(Object.prototype.toString.call(a)).slice(8,-1)}function l(a){return\\\"Array\\\"===q(a)}function r(a,b){var c,d;if(l(b)){c=0;for(d=b.length;c<d;c++)if(!r(a,b[c]))return!1;return!0}var p=q(b);c=0;for(d=a.length;c<d;c++)if(\\\"RegExp\\\"===p){if(\\\"string\\\"===typeof a[c]&&a[c].match(b))return!0}else if(a[c]===b)return!0;return!1}function z(a,b){if(!l(a)||!l(b)||a.length!==b.length)return!1;a.sort();b.sort();for(var c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;\\nreturn!0}function D(a){return escape(a)}function E(a){return encodeURIComponent(a).replace(/[!'()*]/g,D).replace(/\\\\*/g,\\\"%2A\\\")}var C=m&&m.URI;d.version=\\\"1.12.0\\\";var f=d.prototype,w=Object.prototype.hasOwnProperty;d._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:d.duplicateQueryParameters,escapeQuerySpace:d.escapeQuerySpace}};d.duplicateQueryParameters=!1;d.escapeQuerySpace=!0;d.protocol_expression=\\n/^[a-z][a-z0-9.+-]*$/i;d.idn_expression=/[^a-z0-9\\\\.-]/i;d.punycode_expression=/(xn--)/i;d.ip4_expression=/^\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}$/;d.ip6_expression=/^\\\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3}))|:)))(%.+)?\\\\s*$/;\\nd.find_uri_expression=/\\\\b((?:[a-z][\\\\w-]+:(?:\\\\/{1,3}|[a-z0-9%])|www\\\\d{0,3}[.]|[a-z0-9.\\\\-]+[.][a-z]{2,4}\\\\/)(?:[^\\\\s()<>]+|\\\\(([^\\\\s()<>]+|(\\\\([^\\\\s()<>]+\\\\)))*\\\\))+(?:\\\\(([^\\\\s()<>]+|(\\\\([^\\\\s()<>]+\\\\)))*\\\\)|[^\\\\s`!()\\\\[\\\\]{};:'\\\".,<>?\\\\u00ab\\\\u00bb\\\\u201c\\\\u201d\\\\u2018\\\\u2019]))/ig;d.findUri={start:/\\\\b(?:([a-z][a-z0-9.+-]*:\\\\/\\\\/)|www\\\\.)/gi,end:/[\\\\s\\\\r\\\\n]|$/,trim:/[`!()\\\\[\\\\]{};:'\\\".,<>?\\\\u00ab\\\\u00bb\\\\u201c\\\\u201d\\\\u201e\\\\u2018\\\\u2019]+$/};d.defaultPorts={http:\\\"80\\\",https:\\\"443\\\",ftp:\\\"21\\\",gopher:\\\"70\\\",ws:\\\"80\\\",wss:\\\"443\\\"};d.invalid_hostname_characters=\\n/[^a-zA-Z0-9\\\\.-]/;d.domAttributes={a:\\\"href\\\",blockquote:\\\"cite\\\",link:\\\"href\\\",base:\\\"href\\\",script:\\\"src\\\",form:\\\"action\\\",img:\\\"src\\\",area:\\\"href\\\",iframe:\\\"src\\\",embed:\\\"src\\\",source:\\\"src\\\",track:\\\"src\\\",input:\\\"src\\\"};d.getDomAttribute=function(a){if(a&&a.nodeName){var b=a.nodeName.toLowerCase();return\\\"input\\\"===b&&\\\"image\\\"!==a.type?void 0:d.domAttributes[b]}};d.encode=E;d.decode=decodeURIComponent;d.iso8859=function(){d.encode=escape;d.decode=unescape};d.unicode=function(){d.encode=E;d.decode=decodeURIComponent};d.characters=\\n{pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{\\\"%24\\\":\\\"$\\\",\\\"%26\\\":\\\"&\\\",\\\"%2B\\\":\\\"+\\\",\\\"%2C\\\":\\\",\\\",\\\"%3B\\\":\\\";\\\",\\\"%3D\\\":\\\"=\\\",\\\"%3A\\\":\\\":\\\",\\\"%40\\\":\\\"@\\\"}},decode:{expression:/[\\\\/\\\\?#]/g,map:{\\\"/\\\":\\\"%2F\\\",\\\"?\\\":\\\"%3F\\\",\\\"#\\\":\\\"%23\\\"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{\\\"%3A\\\":\\\":\\\",\\\"%2F\\\":\\\"/\\\",\\\"%3F\\\":\\\"?\\\",\\\"%23\\\":\\\"#\\\",\\\"%5B\\\":\\\"[\\\",\\\"%5D\\\":\\\"]\\\",\\\"%40\\\":\\\"@\\\",\\\"%21\\\":\\\"!\\\",\\\"%24\\\":\\\"$\\\",\\\"%26\\\":\\\"&\\\",\\\"%27\\\":\\\"'\\\",\\\"%28\\\":\\\"(\\\",\\\"%29\\\":\\\")\\\",\\\"%2A\\\":\\\"*\\\",\\\"%2B\\\":\\\"+\\\",\\\"%2C\\\":\\\",\\\",\\\"%3B\\\":\\\";\\\",\\\"%3D\\\":\\\"=\\\"}}}};d.encodeQuery=\\nfunction(a,b){var c=d.encode(a+\\\"\\\");return b?c.replace(/%20/g,\\\"+\\\"):c};d.decodeQuery=function(a,b){a+=\\\"\\\";try{return d.decode(b?a.replace(/\\\\+/g,\\\"%20\\\"):a)}catch(c){return a}};d.recodePath=function(a){a=(a+\\\"\\\").split(\\\"/\\\");for(var b=0,c=a.length;b<c;b++)a[b]=d.encodePathSegment(d.decode(a[b]));return a.join(\\\"/\\\")};d.decodePath=function(a){a=(a+\\\"\\\").split(\\\"/\\\");for(var b=0,c=a.length;b<c;b++)a[b]=d.decodePathSegment(a[b]);return a.join(\\\"/\\\")};var s={encode:\\\"encode\\\",decode:\\\"decode\\\"},v,y=function(a,b){return function(c){return d[b](c+\\n\\\"\\\").replace(d.characters[a][b].expression,function(c){return d.characters[a][b].map[c]})}};for(v in s)d[v+\\\"PathSegment\\\"]=y(\\\"pathname\\\",s[v]);d.encodeReserved=y(\\\"reserved\\\",\\\"encode\\\");d.parse=function(a,b){var c;b||(b={});c=a.indexOf(\\\"#\\\");-1<c&&(b.fragment=a.substring(c+1)||null,a=a.substring(0,c));c=a.indexOf(\\\"?\\\");-1<c&&(b.query=a.substring(c+1)||null,a=a.substring(0,c));\\\"//\\\"===a.substring(0,2)?(b.protocol=null,a=a.substring(2),a=d.parseAuthority(a,b)):(c=a.indexOf(\\\":\\\"),-1<c&&(b.protocol=a.substring(0,\\nc)||null,b.protocol&&!b.protocol.match(d.protocol_expression)?b.protocol=void 0:\\\"file\\\"===b.protocol?a=a.substring(c+3):\\\"//\\\"===a.substring(c+1,c+3)?(a=a.substring(c+3),a=d.parseAuthority(a,b)):(a=a.substring(c+1),b.urn=!0)));b.path=a;return b};d.parseHost=function(a,b){var c=a.indexOf(\\\"/\\\"),d;-1===c&&(c=a.length);\\\"[\\\"===a.charAt(0)?(d=a.indexOf(\\\"]\\\"),b.hostname=a.substring(1,d)||null,b.port=a.substring(d+2,c)||null):a.indexOf(\\\":\\\")!==a.lastIndexOf(\\\":\\\")?(b.hostname=a.substring(0,c)||null,b.port=null):(d=\\na.substring(0,c).split(\\\":\\\"),b.hostname=d[0]||null,b.port=d[1]||null);b.hostname&&\\\"/\\\"!==a.substring(c).charAt(0)&&(c++,a=\\\"/\\\"+a);return a.substring(c)||\\\"/\\\"};d.parseAuthority=function(a,b){a=d.parseUserinfo(a,b);return d.parseHost(a,b)};d.parseUserinfo=function(a,b){var c=a.indexOf(\\\"/\\\"),h=-1<c?a.lastIndexOf(\\\"@\\\",c):a.indexOf(\\\"@\\\");-1<h&&(-1===c||h<c)?(c=a.substring(0,h).split(\\\":\\\"),b.username=c[0]?d.decode(c[0]):null,c.shift(),b.password=c[0]?d.decode(c.join(\\\":\\\")):null,a=a.substring(h+1)):(b.username=null,\\nb.password=null);return a};d.parseQuery=function(a,b){if(!a)return{};a=a.replace(/&+/g,\\\"&\\\").replace(/^\\\\?*&*|&+$/g,\\\"\\\");if(!a)return{};for(var c={},h=a.split(\\\"&\\\"),p=h.length,n,e,f=0;f<p;f++)n=h[f].split(\\\"=\\\"),e=d.decodeQuery(n.shift(),b),n=n.length?d.decodeQuery(n.join(\\\"=\\\"),b):null,c[e]?(\\\"string\\\"===typeof c[e]&&(c[e]=[c[e]]),c[e].push(n)):c[e]=n;return c};d.build=function(a){var b=\\\"\\\";a.protocol&&(b+=a.protocol+\\\":\\\");a.urn||!b&&!a.hostname||(b+=\\\"//\\\");b+=d.buildAuthority(a)||\\\"\\\";\\\"string\\\"===typeof a.path&&\\n(\\\"/\\\"!==a.path.charAt(0)&&\\\"string\\\"===typeof a.hostname&&(b+=\\\"/\\\"),b+=a.path);\\\"string\\\"===typeof a.query&&a.query&&(b+=\\\"?\\\"+a.query);\\\"string\\\"===typeof a.fragment&&a.fragment&&(b+=\\\"#\\\"+a.fragment);return b};d.buildHost=function(a){var b=\\\"\\\";if(a.hostname)d.ip6_expression.test(a.hostname)?b=a.port?b+(\\\"[\\\"+a.hostname+\\\"]:\\\"+a.port):b+a.hostname:(b+=a.hostname,a.port&&(b+=\\\":\\\"+a.port));else return\\\"\\\";return b};d.buildAuthority=function(a){return d.buildUserinfo(a)+d.buildHost(a)};d.buildUserinfo=function(a){var b=\\n\\\"\\\";a.username&&(b+=d.encode(a.username),a.password&&(b+=\\\":\\\"+d.encode(a.password)),b+=\\\"@\\\");return b};d.buildQuery=function(a,b,c){var h=\\\"\\\",p,e,f,k;for(e in a)if(w.call(a,e)&&e)if(l(a[e]))for(p={},f=0,k=a[e].length;f<k;f++)void 0!==a[e][f]&&void 0===p[a[e][f]+\\\"\\\"]&&(h+=\\\"&\\\"+d.buildQueryParameter(e,a[e][f],c),!0!==b&&(p[a[e][f]+\\\"\\\"]=!0));else void 0!==a[e]&&(h+=\\\"&\\\"+d.buildQueryParameter(e,a[e],c));return h.substring(1)};d.buildQueryParameter=function(a,b,c){return d.encodeQuery(a,c)+(null!==b?\\\"=\\\"+d.encodeQuery(b,\\nc):\\\"\\\")};d.addQuery=function(a,b,c){if(\\\"object\\\"===typeof b)for(var h in b)w.call(b,h)&&d.addQuery(a,h,b[h]);else if(\\\"string\\\"===typeof b)void 0===a[b]?a[b]=c:(\\\"string\\\"===typeof a[b]&&(a[b]=[a[b]]),l(c)||(c=[c]),a[b]=a[b].concat(c));else throw new TypeError(\\\"URI.addQuery() accepts an object, string as the name parameter\\\");};d.removeQuery=function(a,b,c){var h;if(l(b))for(c=0,h=b.length;c<h;c++)a[b[c]]=void 0;else if(\\\"object\\\"===typeof b)for(h in b)w.call(b,h)&&d.removeQuery(a,h,b[h]);else if(\\\"string\\\"===\\ntypeof b)if(void 0!==c)if(a[b]===c)a[b]=void 0;else{if(l(a[b])){h=a[b];var p={},e,f;if(l(c))for(e=0,f=c.length;e<f;e++)p[c[e]]=!0;else p[c]=!0;e=0;for(f=h.length;e<f;e++)void 0!==p[h[e]]&&(h.splice(e,1),f--,e--);a[b]=h}}else a[b]=void 0;else throw new TypeError(\\\"URI.addQuery() accepts an object, string as the first parameter\\\");};d.hasQuery=function(a,b,c,h){if(\\\"object\\\"===typeof b){for(var e in b)if(w.call(b,e)&&!d.hasQuery(a,e,b[e]))return!1;return!0}if(\\\"string\\\"!==typeof b)throw new TypeError(\\\"URI.hasQuery() accepts an object, string as the name parameter\\\");\\nswitch(q(c)){case \\\"Undefined\\\":return b in a;case \\\"Boolean\\\":return a=Boolean(l(a[b])?a[b].length:a[b]),c===a;case \\\"Function\\\":return!!c(a[b],b,a);case \\\"Array\\\":return l(a[b])?(h?r:z)(a[b],c):!1;case \\\"RegExp\\\":return l(a[b])?h?r(a[b],c):!1:Boolean(a[b]&&a[b].match(c));case \\\"Number\\\":c=String(c);case \\\"String\\\":return l(a[b])?h?r(a[b],c):!1:a[b]===c;default:throw new TypeError(\\\"URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter\\\");}};d.commonPath=function(a,b){var c=\\nMath.min(a.length,b.length),d;for(d=0;d<c;d++)if(a.charAt(d)!==b.charAt(d)){d--;break}if(1>d)return a.charAt(0)===b.charAt(0)&&\\\"/\\\"===a.charAt(0)?\\\"/\\\":\\\"\\\";if(\\\"/\\\"!==a.charAt(d)||\\\"/\\\"!==b.charAt(d))d=a.substring(0,d).lastIndexOf(\\\"/\\\");return a.substring(0,d+1)};d.withinString=function(a,b,c){c||(c={});var h=c.start||d.findUri.start,e=c.end||d.findUri.end,f=c.trim||d.findUri.trim,k=/[a-z0-9-]=[\\\"']?$/i;for(h.lastIndex=0;;){var g=h.exec(a);if(!g)break;g=g.index;if(c.ignoreHtml){var l=a.slice(Math.max(g-3,0),\\ng);if(l&&k.test(l))continue}var l=g+a.slice(g).search(e),q=a.slice(g,l).replace(f,\\\"\\\");c.ignore&&c.ignore.test(q)||(l=g+q.length,q=b(q,g,l,a),a=a.slice(0,g)+q+a.slice(l),h.lastIndex=g+q.length)}h.lastIndex=0;return a};d.ensureValidHostname=function(a){if(a.match(d.invalid_hostname_characters)){if(!e)throw new TypeError(\\\"Hostname '\\\"+a+\\\"' contains characters other than [A-Z0-9.-] and Punycode.js is not available\\\");if(e.toASCII(a).match(d.invalid_hostname_characters))throw new TypeError(\\\"Hostname '\\\"+\\na+\\\"' contains characters other than [A-Z0-9.-]\\\");}};d.noConflict=function(a){if(a)return a={URI:this.noConflict()},URITemplate&&\\\"function\\\"==typeof URITemplate.noConflict&&(a.URITemplate=URITemplate.noConflict()),k&&\\\"function\\\"==typeof k.noConflict&&(a.IPv6=k.noConflict()),SecondLevelDomains&&\\\"function\\\"==typeof SecondLevelDomains.noConflict&&(a.SecondLevelDomains=SecondLevelDomains.noConflict()),a;m.URI===this&&(m.URI=C);return this};f.build=function(a){if(!0===a)this._deferred_build=!0;else if(void 0===\\na||this._deferred_build)this._string=d.build(this._parts),this._deferred_build=!1;return this};f.clone=function(){return new d(this)};f.valueOf=f.toString=function(){return this.build(!1)._string};s={protocol:\\\"protocol\\\",username:\\\"username\\\",password:\\\"password\\\",hostname:\\\"hostname\\\",port:\\\"port\\\"};y=function(a){return function(b,c){if(void 0===b)return this._parts[a]||\\\"\\\";this._parts[a]=b||null;this.build(!c);return this}};for(v in s)f[v]=y(s[v]);s={query:\\\"?\\\",fragment:\\\"#\\\"};y=function(a,b){return function(c,\\nd){if(void 0===c)return this._parts[a]||\\\"\\\";null!==c&&(c+=\\\"\\\",c.charAt(0)===b&&(c=c.substring(1)));this._parts[a]=c;this.build(!d);return this}};for(v in s)f[v]=y(v,s[v]);s={search:[\\\"?\\\",\\\"query\\\"],hash:[\\\"#\\\",\\\"fragment\\\"]};y=function(a,b){return function(c,d){var e=this[a](c,d);return\\\"string\\\"===typeof e&&e.length?b+e:e}};for(v in s)f[v]=y(s[v][1],s[v][0]);f.pathname=function(a,b){if(void 0===a||!0===a){var c=this._parts.path||(this._parts.hostname?\\\"/\\\":\\\"\\\");return a?d.decodePath(c):c}this._parts.path=a?d.recodePath(a):\\n\\\"/\\\";this.build(!b);return this};f.path=f.pathname;f.href=function(a,b){var c;if(void 0===a)return this.toString();this._string=\\\"\\\";this._parts=d._parts();var h=a instanceof d,e=\\\"object\\\"===typeof a&&(a.hostname||a.path||a.pathname);a.nodeName&&(e=d.getDomAttribute(a),a=a[e]||\\\"\\\",e=!1);!h&&e&&void 0!==a.pathname&&(a=a.toString());if(\\\"string\\\"===typeof a)this._parts=d.parse(a,this._parts);else if(h||e)for(c in h=h?a._parts:a,h)w.call(this._parts,c)&&(this._parts[c]=h[c]);else throw new TypeError(\\\"invalid input\\\");\\nthis.build(!b);return this};f.is=function(a){var b=!1,c=!1,h=!1,e=!1,f=!1,g=!1,k=!1,l=!this._parts.urn;this._parts.hostname&&(l=!1,c=d.ip4_expression.test(this._parts.hostname),h=d.ip6_expression.test(this._parts.hostname),b=c||h,f=(e=!b)&&u&&u.has(this._parts.hostname),g=e&&d.idn_expression.test(this._parts.hostname),k=e&&d.punycode_expression.test(this._parts.hostname));switch(a.toLowerCase()){case \\\"relative\\\":return l;case \\\"absolute\\\":return!l;case \\\"domain\\\":case \\\"name\\\":return e;case \\\"sld\\\":return f;\\ncase \\\"ip\\\":return b;case \\\"ip4\\\":case \\\"ipv4\\\":case \\\"inet4\\\":return c;case \\\"ip6\\\":case \\\"ipv6\\\":case \\\"inet6\\\":return h;case \\\"idn\\\":return g;case \\\"url\\\":return!this._parts.urn;case \\\"urn\\\":return!!this._parts.urn;case \\\"punycode\\\":return k}return null};var I=f.protocol,H=f.port,G=f.hostname;f.protocol=function(a,b){if(void 0!==a&&a&&(a=a.replace(/:(\\\\/\\\\/)?$/,\\\"\\\"),!a.match(d.protocol_expression)))throw new TypeError(\\\"Protocol '\\\"+a+\\\"' contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]\\\");return I.call(this,\\na,b)};f.scheme=f.protocol;f.port=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0!==a&&(0===a&&(a=null),a&&(a+=\\\"\\\",\\\":\\\"===a.charAt(0)&&(a=a.substring(1)),a.match(/[^0-9]/))))throw new TypeError(\\\"Port '\\\"+a+\\\"' contains characters other than [0-9]\\\");return H.call(this,a,b)};f.hostname=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0!==a){var c={};d.parseHost(a,c);a=c.hostname}return G.call(this,a,b)};f.host=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;\\nif(void 0===a)return this._parts.hostname?d.buildHost(this._parts):\\\"\\\";d.parseHost(a,this._parts);this.build(!b);return this};f.authority=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a)return this._parts.hostname?d.buildAuthority(this._parts):\\\"\\\";d.parseAuthority(a,this._parts);this.build(!b);return this};f.userinfo=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a){if(!this._parts.username)return\\\"\\\";var c=d.buildUserinfo(this._parts);return c.substring(0,\\nc.length-1)}\\\"@\\\"!==a[a.length-1]&&(a+=\\\"@\\\");d.parseUserinfo(a,this._parts);this.build(!b);return this};f.resource=function(a,b){var c;if(void 0===a)return this.path()+this.search()+this.hash();c=d.parse(a);this._parts.path=c.path;this._parts.query=c.query;this._parts.fragment=c.fragment;this.build(!b);return this};f.subdomain=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a){if(!this._parts.hostname||this.is(\\\"IP\\\"))return\\\"\\\";var c=this._parts.hostname.length-this.domain().length-\\n1;return this._parts.hostname.substring(0,c)||\\\"\\\"}c=this._parts.hostname.length-this.domain().length;c=this._parts.hostname.substring(0,c);c=RegExp(\\\"^\\\"+g(c));a&&\\\".\\\"!==a.charAt(a.length-1)&&(a+=\\\".\\\");a&&d.ensureValidHostname(a);this._parts.hostname=this._parts.hostname.replace(c,a);this.build(!b);return this};f.domain=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;\\\"boolean\\\"===typeof a&&(b=a,a=void 0);if(void 0===a){if(!this._parts.hostname||this.is(\\\"IP\\\"))return\\\"\\\";var c=this._parts.hostname.match(/\\\\./g);\\nif(c&&2>c.length)return this._parts.hostname;c=this._parts.hostname.length-this.tld(b).length-1;c=this._parts.hostname.lastIndexOf(\\\".\\\",c-1)+1;return this._parts.hostname.substring(c)||\\\"\\\"}if(!a)throw new TypeError(\\\"cannot set domain empty\\\");d.ensureValidHostname(a);!this._parts.hostname||this.is(\\\"IP\\\")?this._parts.hostname=a:(c=RegExp(g(this.domain())+\\\"$\\\"),this._parts.hostname=this._parts.hostname.replace(c,a));this.build(!b);return this};f.tld=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":\\nthis;\\\"boolean\\\"===typeof a&&(b=a,a=void 0);if(void 0===a){if(!this._parts.hostname||this.is(\\\"IP\\\"))return\\\"\\\";var c=this._parts.hostname.lastIndexOf(\\\".\\\"),c=this._parts.hostname.substring(c+1);return!0!==b&&u&&u.list[c.toLowerCase()]?u.get(this._parts.hostname)||c:c}if(a)if(a.match(/[^a-zA-Z0-9-]/))if(u&&u.is(a))c=RegExp(g(this.tld())+\\\"$\\\"),this._parts.hostname=this._parts.hostname.replace(c,a);else throw new TypeError(\\\"TLD '\\\"+a+\\\"' contains characters other than [A-Z0-9]\\\");else{if(!this._parts.hostname||\\nthis.is(\\\"IP\\\"))throw new ReferenceError(\\\"cannot set TLD on non-domain host\\\");c=RegExp(g(this.tld())+\\\"$\\\");this._parts.hostname=this._parts.hostname.replace(c,a)}else throw new TypeError(\\\"cannot set TLD empty\\\");this.build(!b);return this};f.directory=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a||!0===a){if(!this._parts.path&&!this._parts.hostname)return\\\"\\\";if(\\\"/\\\"===this._parts.path)return\\\"/\\\";var c=this._parts.path.length-this.filename().length-1,c=this._parts.path.substring(0,\\nc)||(this._parts.hostname?\\\"/\\\":\\\"\\\");return a?d.decodePath(c):c}c=this._parts.path.length-this.filename().length;c=this._parts.path.substring(0,c);c=RegExp(\\\"^\\\"+g(c));this.is(\\\"relative\\\")||(a||(a=\\\"/\\\"),\\\"/\\\"!==a.charAt(0)&&(a=\\\"/\\\"+a));a&&\\\"/\\\"!==a.charAt(a.length-1)&&(a+=\\\"/\\\");a=d.recodePath(a);this._parts.path=this._parts.path.replace(c,a);this.build(!b);return this};f.filename=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a||!0===a){if(!this._parts.path||\\\"/\\\"===this._parts.path)return\\\"\\\";\\nvar c=this._parts.path.lastIndexOf(\\\"/\\\"),c=this._parts.path.substring(c+1);return a?d.decodePathSegment(c):c}c=!1;\\\"/\\\"===a.charAt(0)&&(a=a.substring(1));a.match(/\\\\.?\\\\//)&&(c=!0);var h=RegExp(g(this.filename())+\\\"$\\\");a=d.recodePath(a);this._parts.path=this._parts.path.replace(h,a);c?this.normalizePath(b):this.build(!b);return this};f.suffix=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a||!0===a){if(!this._parts.path||\\\"/\\\"===this._parts.path)return\\\"\\\";var c=this.filename(),h=c.lastIndexOf(\\\".\\\");\\nif(-1===h)return\\\"\\\";c=c.substring(h+1);c=/^[a-z0-9%]+$/i.test(c)?c:\\\"\\\";return a?d.decodePathSegment(c):c}\\\".\\\"===a.charAt(0)&&(a=a.substring(1));if(c=this.suffix())h=a?RegExp(g(c)+\\\"$\\\"):RegExp(g(\\\".\\\"+c)+\\\"$\\\");else{if(!a)return this;this._parts.path+=\\\".\\\"+d.recodePath(a)}h&&(a=d.recodePath(a),this._parts.path=this._parts.path.replace(h,a));this.build(!b);return this};f.segment=function(a,b,c){var d=this._parts.urn?\\\":\\\":\\\"/\\\",e=this.path(),f=\\\"/\\\"===e.substring(0,1),e=e.split(d);void 0!==a&&\\\"number\\\"!==typeof a&&\\n(c=b,b=a,a=void 0);if(void 0!==a&&\\\"number\\\"!==typeof a)throw Error(\\\"Bad segment '\\\"+a+\\\"', must be 0-based integer\\\");f&&e.shift();0>a&&(a=Math.max(e.length+a,0));if(void 0===b)return void 0===a?e:e[a];if(null===a||void 0===e[a])if(l(b)){e=[];a=0;for(var g=b.length;a<g;a++)if(b[a].length||e.length&&e[e.length-1].length)e.length&&!e[e.length-1].length&&e.pop(),e.push(b[a])}else{if(b||\\\"string\\\"===typeof b)\\\"\\\"===e[e.length-1]?e[e.length-1]=b:e.push(b)}else b||\\\"string\\\"===typeof b&&b.length?e[a]=b:e.splice(a,\\n1);f&&e.unshift(\\\"\\\");return this.path(e.join(d),c)};f.segmentCoded=function(a,b,c){var e,f;\\\"number\\\"!==typeof a&&(c=b,b=a,a=void 0);if(void 0===b){a=this.segment(a,b,c);if(l(a))for(e=0,f=a.length;e<f;e++)a[e]=d.decode(a[e]);else a=void 0!==a?d.decode(a):void 0;return a}if(l(b))for(e=0,f=b.length;e<f;e++)b[e]=d.decode(b[e]);else b=\\\"string\\\"===typeof b?d.encode(b):b;return this.segment(a,b,c)};var F=f.query;f.query=function(a,b){if(!0===a)return d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);\\nif(\\\"function\\\"===typeof a){var c=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace),e=a.call(this,c);this._parts.query=d.buildQuery(e||c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!b);return this}return void 0!==a&&\\\"string\\\"!==typeof a?(this._parts.query=d.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):F.call(this,a,b)};f.setQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);\\nif(\\\"object\\\"===typeof a)for(var f in a)w.call(a,f)&&(e[f]=a[f]);else if(\\\"string\\\"===typeof a)e[a]=void 0!==b?b:null;else throw new TypeError(\\\"URI.addQuery() accepts an object, string as the name parameter\\\");this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);\\\"string\\\"!==typeof a&&(c=b);this.build(!c);return this};f.addQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);d.addQuery(e,a,void 0===b?null:b);this._parts.query=\\nd.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);\\\"string\\\"!==typeof a&&(c=b);this.build(!c);return this};f.removeQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);d.removeQuery(e,a,b);this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);\\\"string\\\"!==typeof a&&(c=b);this.build(!c);return this};f.hasQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);\\nreturn d.hasQuery(e,a,b,c)};f.setSearch=f.setQuery;f.addSearch=f.addQuery;f.removeSearch=f.removeQuery;f.hasSearch=f.hasQuery;f.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()};f.normalizeProtocol=function(a){\\\"string\\\"===typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),\\nthis.build(!a));return this};f.normalizeHostname=function(a){this._parts.hostname&&(this.is(\\\"IDN\\\")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is(\\\"IPv6\\\")&&k&&(this._parts.hostname=k.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!a));return this};f.normalizePort=function(a){\\\"string\\\"===typeof this._parts.protocol&&this._parts.port===d.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a));return this};f.normalizePath=\\nfunction(a){if(this._parts.urn||!this._parts.path||\\\"/\\\"===this._parts.path)return this;var b,c=this._parts.path,e=\\\"\\\",f,g;\\\"/\\\"!==c.charAt(0)&&(b=!0,c=\\\"/\\\"+c);c=c.replace(/(\\\\/(\\\\.\\\\/)+)|(\\\\/\\\\.$)/g,\\\"/\\\").replace(/\\\\/{2,}/g,\\\"/\\\");b&&(e=c.substring(1).match(/^(\\\\.\\\\.\\\\/)+/)||\\\"\\\")&&(e=e[0]);for(;;){f=c.indexOf(\\\"/..\\\");if(-1===f)break;else if(0===f){c=c.substring(3);continue}g=c.substring(0,f).lastIndexOf(\\\"/\\\");-1===g&&(g=f);c=c.substring(0,g)+c.substring(f+3)}b&&this.is(\\\"relative\\\")&&(c=e+c.substring(1));c=d.recodePath(c);\\nthis._parts.path=c;this.build(!a);return this};f.normalizePathname=f.normalizePath;f.normalizeQuery=function(a){\\\"string\\\"===typeof this._parts.query&&(this._parts.query.length?this.query(d.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a));return this};f.normalizeFragment=function(a){this._parts.fragment||(this._parts.fragment=null,this.build(!a));return this};f.normalizeSearch=f.normalizeQuery;f.normalizeHash=f.normalizeFragment;f.iso8859=function(){var a=\\nd.encode,b=d.decode;d.encode=escape;d.decode=decodeURIComponent;this.normalize();d.encode=a;d.decode=b;return this};f.unicode=function(){var a=d.encode,b=d.decode;d.encode=E;d.decode=unescape;this.normalize();d.encode=a;d.decode=b;return this};f.readable=function(){var a=this.clone();a.username(\\\"\\\").password(\\\"\\\").normalize();var b=\\\"\\\";a._parts.protocol&&(b+=a._parts.protocol+\\\"://\\\");a._parts.hostname&&(a.is(\\\"punycode\\\")&&e?(b+=e.toUnicode(a._parts.hostname),a._parts.port&&(b+=\\\":\\\"+a._parts.port)):b+=a.host());\\na._parts.hostname&&a._parts.path&&\\\"/\\\"!==a._parts.path.charAt(0)&&(b+=\\\"/\\\");b+=a.path(!0);if(a._parts.query){for(var c=\\\"\\\",f=0,g=a._parts.query.split(\\\"&\\\"),k=g.length;f<k;f++){var l=(g[f]||\\\"\\\").split(\\\"=\\\"),c=c+(\\\"&\\\"+d.decodeQuery(l[0],this._parts.escapeQuerySpace).replace(/&/g,\\\"%26\\\"));void 0!==l[1]&&(c+=\\\"=\\\"+d.decodeQuery(l[1],this._parts.escapeQuerySpace).replace(/&/g,\\\"%26\\\"))}b+=\\\"?\\\"+c.substring(1)}return b+=d.decodeQuery(a.hash(),!0)};f.absoluteTo=function(a){var b=this.clone(),c=[\\\"protocol\\\",\\\"username\\\",\\n\\\"password\\\",\\\"hostname\\\",\\\"port\\\"],e,f;if(this._parts.urn)throw Error(\\\"URNs do not have any generally defined hierarchical components\\\");a instanceof d||(a=new d(a));b._parts.protocol||(b._parts.protocol=a._parts.protocol);if(this._parts.hostname)return b;for(e=0;f=c[e];e++)b._parts[f]=a._parts[f];b._parts.path?\\\"..\\\"===b._parts.path.substring(-2)&&(b._parts.path+=\\\"/\\\"):(b._parts.path=a._parts.path,b._parts.query||(b._parts.query=a._parts.query));\\\"/\\\"!==b.path().charAt(0)&&(a=a.directory(),b._parts.path=(a?\\na+\\\"/\\\":\\\"\\\")+b._parts.path,b.normalizePath());b.build();return b};f.relativeTo=function(a){var b=this.clone().normalize(),c,e,f,g;if(b._parts.urn)throw Error(\\\"URNs do not have any generally defined hierarchical components\\\");a=(new d(a)).normalize();c=b._parts;e=a._parts;f=b.path();g=a.path();if(\\\"/\\\"!==f.charAt(0))throw Error(\\\"URI is already relative\\\");if(\\\"/\\\"!==g.charAt(0))throw Error(\\\"Cannot calculate a URI relative to another relative URI\\\");c.protocol===e.protocol&&(c.protocol=null);if(c.username===\\ne.username&&c.password===e.password&&null===c.protocol&&null===c.username&&null===c.password&&c.hostname===e.hostname&&c.port===e.port)c.hostname=null,c.port=null;else return b.build();if(f===g)return c.path=\\\"\\\",b.build();a=d.commonPath(b.path(),a.path());if(!a)return b.build();e=e.path.substring(a.length).replace(/[^\\\\/]*$/,\\\"\\\").replace(/.*?\\\\//g,\\\"../\\\");c.path=e+c.path.substring(a.length);return b.build()};f.equals=function(a){var b=this.clone();a=new d(a);var c={},e={},f={},g;b.normalize();a.normalize();\\nif(b.toString()===a.toString())return!0;c=b.query();e=a.query();b.query(\\\"\\\");a.query(\\\"\\\");if(b.toString()!==a.toString()||c.length!==e.length)return!1;c=d.parseQuery(c,this._parts.escapeQuerySpace);e=d.parseQuery(e,this._parts.escapeQuerySpace);for(g in c)if(w.call(c,g)){if(!l(c[g])){if(c[g]!==e[g])return!1}else if(!z(c[g],e[g]))return!1;f[g]=!0}for(g in e)if(w.call(e,g)&&!f[g])return!1;return!0};f.duplicateQueryParameters=function(a){this._parts.duplicateQueryParameters=!!a;return this};f.escapeQuerySpace=\\nfunction(a){this._parts.escapeQuerySpace=!!a;return this};return d});\\n(function(e,k){\\\"object\\\"===typeof exports?module.exports=k(require(\\\"./URI\\\")):\\\"function\\\"===typeof define&&define.amd?define([\\\"./URI\\\"],k):k(e.URI)})(this,function(e){var k=e.prototype,u=k.fragment;e.fragmentPrefix=\\\"?\\\";var m=e._parts;e._parts=function(){var d=m();d.fragmentPrefix=e.fragmentPrefix;return d};k.fragmentPrefix=function(d){this._parts.fragmentPrefix=d;return this};k.fragment=function(d,g){var k=this._parts.fragmentPrefix,l=this._parts.fragment||\\\"\\\";return!0===d?l.substring(0,k.length)!==k?\\n{}:e.parseQuery(l.substring(k.length)):void 0!==d&&\\\"string\\\"!==typeof d?(this._parts.fragment=k+e.buildQuery(d),this.build(!g),this):u.call(this,d,g)};k.addFragment=function(d,g,k){var l=this._parts.fragmentPrefix,m=e.parseQuery((this._parts.fragment||\\\"\\\").substring(l.length));e.addQuery(m,d,g);this._parts.fragment=l+e.buildQuery(m);\\\"string\\\"!==typeof d&&(k=g);this.build(!k);return this};k.removeFragment=function(d,g,k){var l=this._parts.fragmentPrefix,m=e.parseQuery((this._parts.fragment||\\\"\\\").substring(l.length));\\ne.removeQuery(m,d,g);this._parts.fragment=l+e.buildQuery(m);\\\"string\\\"!==typeof d&&(k=g);this.build(!k);return this};k.addHash=k.addFragment;k.removeHash=k.removeFragment;return{}});\\n;/*global unescape, module, define, window, global*/\\n\\n/*\\n UriTemplate Copyright (c) 2012-2013 Franz Antesberger. All Rights Reserved.\\n Available via the MIT license.\\n*/\\n\\n(function (exportCallback) {\\n    \\\"use strict\\\";\\n\\nvar UriTemplateError = (function () {\\n\\n    function UriTemplateError (options) {\\n        this.options = options;\\n    }\\n\\n    UriTemplateError.prototype.toString = function () {\\n        if (JSON && JSON.stringify) {\\n            return JSON.stringify(this.options);\\n        }\\n        else {\\n            return this.options;\\n        }\\n    };\\n\\n    return UriTemplateError;\\n}());\\n\\nvar objectHelper = (function () {\\n    function isArray (value) {\\n        return Object.prototype.toString.apply(value) === '[object Array]';\\n    }\\n\\n    function isString (value) {\\n        return Object.prototype.toString.apply(value) === '[object String]';\\n    }\\n    \\n    function isNumber (value) {\\n        return Object.prototype.toString.apply(value) === '[object Number]';\\n    }\\n    \\n    function isBoolean (value) {\\n        return Object.prototype.toString.apply(value) === '[object Boolean]';\\n    }\\n    \\n    function join (arr, separator) {\\n        var\\n            result = '',\\n            first = true,\\n            index;\\n        for (index = 0; index < arr.length; index += 1) {\\n            if (first) {\\n                first = false;\\n            }\\n            else {\\n                result += separator;\\n            }\\n            result += arr[index];\\n        }\\n        return result;\\n    }\\n\\n    function map (arr, mapper) {\\n        var\\n            result = [],\\n            index = 0;\\n        for (; index < arr.length; index += 1) {\\n            result.push(mapper(arr[index]));\\n        }\\n        return result;\\n    }\\n\\n    function filter (arr, predicate) {\\n        var\\n            result = [],\\n            index = 0;\\n        for (; index < arr.length; index += 1) {\\n            if (predicate(arr[index])) {\\n                result.push(arr[index]);\\n            }\\n        }\\n        return result;\\n    }\\n\\n    function deepFreezeUsingObjectFreeze (object) {\\n        if (typeof object !== \\\"object\\\" || object === null) {\\n            return object;\\n        }\\n        Object.freeze(object);\\n        var property, propertyName;\\n        for (propertyName in object) {\\n            if (object.hasOwnProperty(propertyName)) {\\n                property = object[propertyName];\\n                // be aware, arrays are 'object', too\\n                if ((typeof property === \\\"object\\\") && !(property instanceof RegExp)) {\\n                    deepFreeze(property);\\n                }\\n            }\\n        }\\n        return object;\\n    }\\n\\n    function deepFreeze (object) {\\n        if (typeof Object.freeze === 'function') {\\n            return deepFreezeUsingObjectFreeze(object);\\n        }\\n        return object;\\n    }\\n\\n\\n    return {\\n        isArray: isArray,\\n        isString: isString,\\n        isNumber: isNumber,\\n        isBoolean: isBoolean,\\n        join: join,\\n        map: map,\\n        filter: filter,\\n        deepFreeze: deepFreeze\\n    };\\n}());\\n\\nvar charHelper = (function () {\\n\\n    function isAlpha (chr) {\\n        return (chr >= 'a' && chr <= 'z') || ((chr >= 'A' && chr <= 'Z'));\\n    }\\n\\n    function isDigit (chr) {\\n        return chr >= '0' && chr <= '9';\\n    }\\n\\n    function isHexDigit (chr) {\\n        return isDigit(chr) || (chr >= 'a' && chr <= 'f') || (chr >= 'A' && chr <= 'F');\\n    }\\n\\n    return {\\n        isAlpha: isAlpha,\\n        isDigit: isDigit,\\n        isHexDigit: isHexDigit\\n    };\\n}());\\n\\nvar pctEncoder = (function () {\\n    var utf8 = {\\n        encode: function (chr) {\\n            // see http://ecmanaut.blogspot.de/2006/07/encoding-decoding-utf8-in-javascript.html\\n            return unescape(encodeURIComponent(chr));\\n        },\\n        numBytes: function (firstCharCode) {\\n            if (firstCharCode <= 0x7F) {\\n                return 1;\\n            }\\n            else if (0xC2 <= firstCharCode && firstCharCode <= 0xDF) {\\n                return 2;\\n            }\\n            else if (0xE0 <= firstCharCode && firstCharCode <= 0xEF) {\\n                return 3;\\n            }\\n            else if (0xF0 <= firstCharCode && firstCharCode <= 0xF4) {\\n                return 4;\\n            }\\n            // no valid first octet\\n            return 0;\\n        },\\n        isValidFollowingCharCode: function (charCode) {\\n            return 0x80 <= charCode && charCode <= 0xBF;\\n        }\\n    };\\n\\n    /**\\n     * encodes a character, if needed or not.\\n     * @param chr\\n     * @return pct-encoded character\\n     */\\n    function encodeCharacter (chr) {\\n        var\\n            result = '',\\n            octets = utf8.encode(chr),\\n            octet,\\n            index;\\n        for (index = 0; index < octets.length; index += 1) {\\n            octet = octets.charCodeAt(index);\\n            result += '%' + (octet < 0x10 ? '0' : '') + octet.toString(16).toUpperCase();\\n        }\\n        return result;\\n    }\\n\\n    /**\\n     * Returns, whether the given text at start is in the form 'percent hex-digit hex-digit', like '%3F'\\n     * @param text\\n     * @param start\\n     * @return {boolean|*|*}\\n     */\\n    function isPercentDigitDigit (text, start) {\\n        return text.charAt(start) === '%' && charHelper.isHexDigit(text.charAt(start + 1)) && charHelper.isHexDigit(text.charAt(start + 2));\\n    }\\n\\n    /**\\n     * Parses a hex number from start with length 2.\\n     * @param text a string\\n     * @param start the start index of the 2-digit hex number\\n     * @return {Number}\\n     */\\n    function parseHex2 (text, start) {\\n        return parseInt(text.substr(start, 2), 16);\\n    }\\n\\n    /**\\n     * Returns whether or not the given char sequence is a correctly pct-encoded sequence.\\n     * @param chr\\n     * @return {boolean}\\n     */\\n    function isPctEncoded (chr) {\\n        if (!isPercentDigitDigit(chr, 0)) {\\n            return false;\\n        }\\n        var firstCharCode = parseHex2(chr, 1);\\n        var numBytes = utf8.numBytes(firstCharCode);\\n        if (numBytes === 0) {\\n            return false;\\n        }\\n        for (var byteNumber = 1; byteNumber < numBytes; byteNumber += 1) {\\n            if (!isPercentDigitDigit(chr, 3*byteNumber) || !utf8.isValidFollowingCharCode(parseHex2(chr, 3*byteNumber + 1))) {\\n                return false;\\n            }\\n        }\\n        return true;\\n    }\\n\\n    /**\\n     * Reads as much as needed from the text, e.g. '%20' or '%C3%B6'. It does not decode!\\n     * @param text\\n     * @param startIndex\\n     * @return the character or pct-string of the text at startIndex\\n     */\\n    function pctCharAt(text, startIndex) {\\n        var chr = text.charAt(startIndex);\\n        if (!isPercentDigitDigit(text, startIndex)) {\\n            return chr;\\n        }\\n        var utf8CharCode = parseHex2(text, startIndex + 1);\\n        var numBytes = utf8.numBytes(utf8CharCode);\\n        if (numBytes === 0) {\\n            return chr;\\n        }\\n        for (var byteNumber = 1; byteNumber < numBytes; byteNumber += 1) {\\n            if (!isPercentDigitDigit(text, startIndex + 3 * byteNumber) || !utf8.isValidFollowingCharCode(parseHex2(text, startIndex + 3 * byteNumber + 1))) {\\n                return chr;\\n            }\\n        }\\n        return text.substr(startIndex, 3 * numBytes);\\n    }\\n\\n    return {\\n        encodeCharacter: encodeCharacter,\\n        isPctEncoded: isPctEncoded,\\n        pctCharAt: pctCharAt\\n    };\\n}());\\n\\nvar rfcCharHelper = (function () {\\n\\n    /**\\n     * Returns if an character is an varchar character according 2.3 of rfc 6570\\n     * @param chr\\n     * @return (Boolean)\\n     */\\n    function isVarchar (chr) {\\n        return charHelper.isAlpha(chr) || charHelper.isDigit(chr) || chr === '_' || pctEncoder.isPctEncoded(chr);\\n    }\\n\\n    /**\\n     * Returns if chr is an unreserved character according 1.5 of rfc 6570\\n     * @param chr\\n     * @return {Boolean}\\n     */\\n    function isUnreserved (chr) {\\n        return charHelper.isAlpha(chr) || charHelper.isDigit(chr) || chr === '-' || chr === '.' || chr === '_' || chr === '~';\\n    }\\n\\n    /**\\n     * Returns if chr is an reserved character according 1.5 of rfc 6570\\n     * or the percent character mentioned in 3.2.1.\\n     * @param chr\\n     * @return {Boolean}\\n     */\\n    function isReserved (chr) {\\n        return chr === ':' || chr === '/' || chr === '?' || chr === '#' || chr === '[' || chr === ']' || chr === '@' || chr === '!' || chr === '$' || chr === '&' || chr === '(' ||\\n            chr === ')' || chr === '*' || chr === '+' || chr === ',' || chr === ';' || chr === '=' || chr === \\\"'\\\";\\n    }\\n\\n    return {\\n        isVarchar: isVarchar,\\n        isUnreserved: isUnreserved,\\n        isReserved: isReserved\\n    };\\n\\n}());\\n\\n/**\\n * encoding of rfc 6570\\n */\\nvar encodingHelper = (function () {\\n\\n    function encode (text, passReserved) {\\n        var\\n            result = '',\\n            index,\\n            chr = '';\\n        if (typeof text === \\\"number\\\" || typeof text === \\\"boolean\\\") {\\n            text = text.toString();\\n        }\\n        for (index = 0; index < text.length; index += chr.length) {\\n            chr = text.charAt(index);\\n            result += rfcCharHelper.isUnreserved(chr) || (passReserved && rfcCharHelper.isReserved(chr)) ? chr : pctEncoder.encodeCharacter(chr);\\n        }\\n        return result;\\n    }\\n\\n    function encodePassReserved (text) {\\n        return encode(text, true);\\n    }\\n\\n    function encodeLiteralCharacter (literal, index) {\\n        var chr = pctEncoder.pctCharAt(literal, index);\\n        if (chr.length > 1) {\\n            return chr;\\n        }\\n        else {\\n            return rfcCharHelper.isReserved(chr) || rfcCharHelper.isUnreserved(chr) ? chr : pctEncoder.encodeCharacter(chr);\\n        }\\n    }\\n\\n    function encodeLiteral (literal) {\\n        var\\n            result = '',\\n            index,\\n            chr = '';\\n        for (index = 0; index < literal.length; index += chr.length) {\\n            chr = pctEncoder.pctCharAt(literal, index);\\n            if (chr.length > 1) {\\n                result += chr;\\n            }\\n            else {\\n                result += rfcCharHelper.isReserved(chr) || rfcCharHelper.isUnreserved(chr) ? chr : pctEncoder.encodeCharacter(chr);\\n            }\\n        }\\n        return result;\\n    }\\n\\n    return {\\n        encode: encode,\\n        encodePassReserved: encodePassReserved,\\n        encodeLiteral: encodeLiteral,\\n        encodeLiteralCharacter: encodeLiteralCharacter\\n    };\\n\\n}());\\n\\n\\n// the operators defined by rfc 6570\\nvar operators = (function () {\\n\\n    var\\n        bySymbol = {};\\n\\n    function create (symbol) {\\n        bySymbol[symbol] = {\\n            symbol: symbol,\\n            separator: (symbol === '?') ? '&' : (symbol === '' || symbol === '+' || symbol === '#') ? ',' : symbol,\\n            named: symbol === ';' || symbol === '&' || symbol === '?',\\n            ifEmpty: (symbol === '&' || symbol === '?') ? '=' : '',\\n            first: (symbol === '+' ) ? '' : symbol,\\n            encode: (symbol === '+' || symbol === '#') ? encodingHelper.encodePassReserved : encodingHelper.encode,\\n            toString: function () {\\n                return this.symbol;\\n            }\\n        };\\n    }\\n\\n    create('');\\n    create('+');\\n    create('#');\\n    create('.');\\n    create('/');\\n    create(';');\\n    create('?');\\n    create('&');\\n    return {\\n        valueOf: function (chr) {\\n            if (bySymbol[chr]) {\\n                return bySymbol[chr];\\n            }\\n            if (\\\"=,!@|\\\".indexOf(chr) >= 0) {\\n                return null;\\n            }\\n            return bySymbol[''];\\n        }\\n    };\\n}());\\n\\n\\n/**\\n * Detects, whether a given element is defined in the sense of rfc 6570\\n * Section 2.3 of the RFC makes clear defintions:\\n * * undefined and null are not defined.\\n * * the empty string is defined\\n * * an array (\\\"list\\\") is defined, if it is not empty (even if all elements are not defined)\\n * * an object (\\\"map\\\") is defined, if it contains at least one property with defined value\\n * @param object\\n * @return {Boolean}\\n */\\nfunction isDefined (object) {\\n    var\\n        propertyName;\\n    if (object === null || object === undefined) {\\n        return false;\\n    }\\n    if (objectHelper.isArray(object)) {\\n        // Section 2.3: A variable defined as a list value is considered undefined if the list contains zero members\\n        return object.length > 0;\\n    }\\n    if (typeof object === \\\"string\\\" || typeof object === \\\"number\\\" || typeof object === \\\"boolean\\\") {\\n        // falsy values like empty strings, false or 0 are \\\"defined\\\"\\n        return true;\\n    }\\n    // else Object\\n    for (propertyName in object) {\\n        if (object.hasOwnProperty(propertyName) && isDefined(object[propertyName])) {\\n            return true;\\n        }\\n    }\\n    return false;\\n}\\n\\nvar LiteralExpression = (function () {\\n    function LiteralExpression (literal) {\\n        this.literal = encodingHelper.encodeLiteral(literal);\\n    }\\n\\n    LiteralExpression.prototype.expand = function () {\\n        return this.literal;\\n    };\\n\\n    LiteralExpression.prototype.toString = LiteralExpression.prototype.expand;\\n\\n    return LiteralExpression;\\n}());\\n\\nvar parse = (function () {\\n\\n    function parseExpression (expressionText) {\\n        var\\n            operator,\\n            varspecs = [],\\n            varspec = null,\\n            varnameStart = null,\\n            maxLengthStart = null,\\n            index,\\n            chr = '';\\n\\n        function closeVarname () {\\n            var varname = expressionText.substring(varnameStart, index);\\n            if (varname.length === 0) {\\n                throw new UriTemplateError({expressionText: expressionText, message: \\\"a varname must be specified\\\", position: index});\\n            }\\n            varspec = {varname: varname, exploded: false, maxLength: null};\\n            varnameStart = null;\\n        }\\n\\n        function closeMaxLength () {\\n            if (maxLengthStart === index) {\\n                throw new UriTemplateError({expressionText: expressionText, message: \\\"after a ':' you have to specify the length\\\", position: index});\\n            }\\n            varspec.maxLength = parseInt(expressionText.substring(maxLengthStart, index), 10);\\n            maxLengthStart = null;\\n        }\\n\\n        operator = (function (operatorText) {\\n            var op = operators.valueOf(operatorText);\\n            if (op === null) {\\n                throw new UriTemplateError({expressionText: expressionText, message: \\\"illegal use of reserved operator\\\", position: index, operator: operatorText});\\n            }\\n            return op;\\n        }(expressionText.charAt(0)));\\n        index = operator.symbol.length;\\n\\n        varnameStart = index;\\n\\n        for (; index < expressionText.length; index += chr.length) {\\n            chr = pctEncoder.pctCharAt(expressionText, index);\\n\\n            if (varnameStart !== null) {\\n                // the spec says: varname =  varchar *( [\\\".\\\"] varchar )\\n                // so a dot is allowed except for the first char\\n                if (chr === '.') {\\n                    if (varnameStart === index) {\\n                        throw new UriTemplateError({expressionText: expressionText, message: \\\"a varname MUST NOT start with a dot\\\", position: index});\\n                    }\\n                    continue;\\n                }\\n                if (rfcCharHelper.isVarchar(chr)) {\\n                    continue;\\n                }\\n                closeVarname();\\n            }\\n            if (maxLengthStart !== null) {\\n                if (index === maxLengthStart && chr === '0') {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"A :prefix must not start with digit 0\\\", position: index});\\n                }\\n                if (charHelper.isDigit(chr)) {\\n                    if (index - maxLengthStart >= 4) {\\n                        throw new UriTemplateError({expressionText: expressionText, message: \\\"A :prefix must have max 4 digits\\\", position: index});\\n                    }\\n                    continue;\\n                }\\n                closeMaxLength();\\n            }\\n            if (chr === ':') {\\n                if (varspec.maxLength !== null) {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"only one :maxLength is allowed per varspec\\\", position: index});\\n                }\\n                if (varspec.exploded) {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"an exploeded varspec MUST NOT be varspeced\\\", position: index});\\n                }\\n                maxLengthStart = index + 1;\\n                continue;\\n            }\\n            if (chr === '*') {\\n                if (varspec === null) {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"exploded without varspec\\\", position: index});\\n                }\\n                if (varspec.exploded) {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"exploded twice\\\", position: index});\\n                }\\n                if (varspec.maxLength) {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"an explode (*) MUST NOT follow to a prefix\\\", position: index});\\n                }\\n                varspec.exploded = true;\\n                continue;\\n            }\\n            // the only legal character now is the comma\\n            if (chr === ',') {\\n                varspecs.push(varspec);\\n                varspec = null;\\n                varnameStart = index + 1;\\n                continue;\\n            }\\n            throw new UriTemplateError({expressionText: expressionText, message: \\\"illegal character\\\", character: chr, position: index});\\n        } // for chr\\n        if (varnameStart !== null) {\\n            closeVarname();\\n        }\\n        if (maxLengthStart !== null) {\\n            closeMaxLength();\\n        }\\n        varspecs.push(varspec);\\n        return new VariableExpression(expressionText, operator, varspecs);\\n    }\\n\\n    function escape_regexp_string(string) {\\n      // http://simonwillison.net/2006/Jan/20/escape/\\n      return string.replace(/[\\\\-\\\\[\\\\]{}()*+?.,\\\\\\\\\\\\^$|#\\\\s]/g, \\\"\\\\\\\\$&\\\");\\n    }\\n\\n    function parse (uriTemplateText) {\\n        // assert filled string\\n        var\\n            index,\\n            chr,\\n            expressions = [],\\n            expression,\\n            braceOpenIndex = null,\\n            regexp_string = '',\\n            can_match = true,\\n            literalStart = 0;\\n        for (index = 0; index < uriTemplateText.length; index += 1) {\\n            chr = uriTemplateText.charAt(index);\\n            if (literalStart !== null) {\\n                if (chr === '}') {\\n                    throw new UriTemplateError({templateText: uriTemplateText, message: \\\"unopened brace closed\\\", position: index});\\n                }\\n                if (chr === '{') {\\n                    if (literalStart < index) {\\n                        expression = new LiteralExpression(uriTemplateText.substring(literalStart, index));\\n                        expressions.push(expression);\\n                        regexp_string += escape_regexp_string(\\n                            expression.literal);\\n                    }\\n                    literalStart = null;\\n                    braceOpenIndex = index;\\n                }\\n                continue;\\n            }\\n\\n            if (braceOpenIndex !== null) {\\n                // here just { is forbidden\\n                if (chr === '{') {\\n                    throw new UriTemplateError({templateText: uriTemplateText, message: \\\"brace already opened\\\", position: index});\\n                }\\n                if (chr === '}') {\\n                    if (braceOpenIndex + 1 === index) {\\n                        throw new UriTemplateError({templateText: uriTemplateText, message: \\\"empty braces\\\", position: braceOpenIndex});\\n                    }\\n                    try {\\n                        expression = parseExpression(uriTemplateText.substring(braceOpenIndex + 1, index));\\n                    }\\n                    catch (error) {\\n                        if (error.prototype === UriTemplateError.prototype) {\\n                            throw new UriTemplateError({templateText: uriTemplateText, message: error.options.message, position: braceOpenIndex + error.options.position, details: error.options});\\n                        }\\n                        throw error;\\n                    }\\n                    expressions.push(expression);\\n                    if (expression.operator.symbol.length === 0) {\\n                      regexp_string += \\\"([^/]+)\\\";\\n                    } else {\\n                      can_match = false;\\n                    }\\n                    braceOpenIndex = null;\\n                    literalStart = index + 1;\\n                }\\n                continue;\\n            }\\n            throw new Error('reached unreachable code');\\n        }\\n        if (braceOpenIndex !== null) {\\n            throw new UriTemplateError({templateText: uriTemplateText, message: \\\"unclosed brace\\\", position: braceOpenIndex});\\n        }\\n        if (literalStart < uriTemplateText.length) {\\n            expression = new LiteralExpression(uriTemplateText.substring(literalStart));\\n            expressions.push(expression);\\n            regexp_string += escape_regexp_string(expression.literal);\\n        }\\n        if (can_match === false) {\\n          regexp_string = undefined;\\n        }\\n        return new UriTemplate(uriTemplateText, expressions, regexp_string);\\n    }\\n\\n    return parse;\\n}());\\n\\nvar VariableExpression = (function () {\\n    // helper function if JSON is not available\\n    function prettyPrint (value) {\\n        return (JSON && JSON.stringify) ? JSON.stringify(value) : value;\\n    }\\n\\n    function isEmpty (value) {\\n        if (!isDefined(value)) {\\n            return true;\\n        }\\n        if (objectHelper.isString(value)) {\\n            return value === '';\\n        }\\n        if (objectHelper.isNumber(value) || objectHelper.isBoolean(value)) {\\n            return false;\\n        }\\n        if (objectHelper.isArray(value)) {\\n            return value.length === 0;\\n        }\\n        for (var propertyName in value) {\\n            if (value.hasOwnProperty(propertyName)) {\\n                return false;\\n            }\\n        }\\n        return true;\\n    }\\n\\n    function propertyArray (object) {\\n        var\\n            result = [],\\n            propertyName;\\n        for (propertyName in object) {\\n            if (object.hasOwnProperty(propertyName)) {\\n                result.push({name: propertyName, value: object[propertyName]});\\n            }\\n        }\\n        return result;\\n    }\\n\\n    function VariableExpression (templateText, operator, varspecs) {\\n        this.templateText = templateText;\\n        this.operator = operator;\\n        this.varspecs = varspecs;\\n    }\\n\\n    VariableExpression.prototype.toString = function () {\\n        return this.templateText;\\n    };\\n\\n    function expandSimpleValue(varspec, operator, value) {\\n        var result = '';\\n        value = value.toString();\\n        if (operator.named) {\\n            result += encodingHelper.encodeLiteral(varspec.varname);\\n            if (value === '') {\\n                result += operator.ifEmpty;\\n                return result;\\n            }\\n            result += '=';\\n        }\\n        if (varspec.maxLength !== null) {\\n            value = value.substr(0, varspec.maxLength);\\n        }\\n        result += operator.encode(value);\\n        return result;\\n    }\\n\\n    function valueDefined (nameValue) {\\n        return isDefined(nameValue.value);\\n    }\\n\\n    function expandNotExploded(varspec, operator, value) {\\n        var\\n            arr = [],\\n            result = '';\\n        if (operator.named) {\\n            result += encodingHelper.encodeLiteral(varspec.varname);\\n            if (isEmpty(value)) {\\n                result += operator.ifEmpty;\\n                return result;\\n            }\\n            result += '=';\\n        }\\n        if (objectHelper.isArray(value)) {\\n            arr = value;\\n            arr = objectHelper.filter(arr, isDefined);\\n            arr = objectHelper.map(arr, operator.encode);\\n            result += objectHelper.join(arr, ',');\\n        }\\n        else {\\n            arr = propertyArray(value);\\n            arr = objectHelper.filter(arr, valueDefined);\\n            arr = objectHelper.map(arr, function (nameValue) {\\n                return operator.encode(nameValue.name) + ',' + operator.encode(nameValue.value);\\n            });\\n            result += objectHelper.join(arr, ',');\\n        }\\n        return result;\\n    }\\n\\n    function expandExplodedNamed (varspec, operator, value) {\\n        var\\n            isArray = objectHelper.isArray(value),\\n            arr = [];\\n        if (isArray) {\\n            arr = value;\\n            arr = objectHelper.filter(arr, isDefined);\\n            arr = objectHelper.map(arr, function (listElement) {\\n                var tmp = encodingHelper.encodeLiteral(varspec.varname);\\n                if (isEmpty(listElement)) {\\n                    tmp += operator.ifEmpty;\\n                }\\n                else {\\n                    tmp += '=' + operator.encode(listElement);\\n                }\\n                return tmp;\\n            });\\n        }\\n        else {\\n            arr = propertyArray(value);\\n            arr = objectHelper.filter(arr, valueDefined);\\n            arr = objectHelper.map(arr, function (nameValue) {\\n                var tmp = encodingHelper.encodeLiteral(nameValue.name);\\n                if (isEmpty(nameValue.value)) {\\n                    tmp += operator.ifEmpty;\\n                }\\n                else {\\n                    tmp += '=' + operator.encode(nameValue.value);\\n                }\\n                return tmp;\\n            });\\n        }\\n        return objectHelper.join(arr, operator.separator);\\n    }\\n\\n    function expandExplodedUnnamed (operator, value) {\\n        var\\n            arr = [],\\n            result = '';\\n        if (objectHelper.isArray(value)) {\\n            arr = value;\\n            arr = objectHelper.filter(arr, isDefined);\\n            arr = objectHelper.map(arr, operator.encode);\\n            result += objectHelper.join(arr, operator.separator);\\n        }\\n        else {\\n            arr = propertyArray(value);\\n            arr = objectHelper.filter(arr, function (nameValue) {\\n                return isDefined(nameValue.value);\\n            });\\n            arr = objectHelper.map(arr, function (nameValue) {\\n                return operator.encode(nameValue.name) + '=' + operator.encode(nameValue.value);\\n            });\\n            result += objectHelper.join(arr, operator.separator);\\n        }\\n        return result;\\n    }\\n\\n\\n    VariableExpression.prototype.expand = function (variables) {\\n        var\\n            expanded = [],\\n            index,\\n            varspec,\\n            value,\\n            valueIsArr,\\n            oneExploded = false,\\n            operator = this.operator;\\n\\n        // expand each varspec and join with operator's separator\\n        for (index = 0; index < this.varspecs.length; index += 1) {\\n            varspec = this.varspecs[index];\\n            value = variables[varspec.varname];\\n            // if (!isDefined(value)) {\\n            // if (variables.hasOwnProperty(varspec.name)) {\\n            if (value === null || value === undefined) {\\n                continue;\\n            }\\n            if (varspec.exploded) {\\n                oneExploded = true;\\n            }\\n            valueIsArr = objectHelper.isArray(value);\\n            if (typeof value === \\\"string\\\" || typeof value === \\\"number\\\" || typeof value === \\\"boolean\\\") {\\n                expanded.push(expandSimpleValue(varspec, operator, value));\\n            }\\n            else if (varspec.maxLength && isDefined(value)) {\\n                // 2.4.1 of the spec says: \\\"Prefix modifiers are not applicable to variables that have composite values.\\\"\\n                throw new Error('Prefix modifiers are not applicable to variables that have composite values. You tried to expand ' + this + \\\" with \\\" + prettyPrint(value));\\n            }\\n            else if (!varspec.exploded) {\\n                if (operator.named || !isEmpty(value)) {\\n                    expanded.push(expandNotExploded(varspec, operator, value));\\n                }\\n            }\\n            else if (isDefined(value)) {\\n                if (operator.named) {\\n                    expanded.push(expandExplodedNamed(varspec, operator, value));\\n                }\\n                else {\\n                    expanded.push(expandExplodedUnnamed(operator, value));\\n                }\\n            }\\n        }\\n\\n        if (expanded.length === 0) {\\n            return \\\"\\\";\\n        }\\n        else {\\n            return operator.first + objectHelper.join(expanded, operator.separator);\\n        }\\n    };\\n\\n    return VariableExpression;\\n}());\\n\\nvar UriTemplate = (function () {\\n    function UriTemplate (templateText, expressions, regexp_string) {\\n        this.templateText = templateText;\\n        this.expressions = expressions;\\n\\n        if (regexp_string !== undefined) {\\n          this.regexp = new RegExp(\\\"^\\\" + regexp_string + \\\"$\\\");\\n        }\\n\\n        objectHelper.deepFreeze(this);\\n    }\\n\\n    UriTemplate.prototype.toString = function () {\\n        return this.templateText;\\n    };\\n\\n    UriTemplate.prototype.expand = function (variables) {\\n        // this.expressions.map(function (expression) {return expression.expand(variables);}).join('');\\n        var\\n            index,\\n            result = '';\\n        for (index = 0; index < this.expressions.length; index += 1) {\\n            result += this.expressions[index].expand(variables);\\n        }\\n        return result;\\n    };\\n\\n    UriTemplate.prototype.extract = function (text) {\\n      var expression_index,\\n          extracted_index = 1,\\n          expression,\\n          varspec,\\n          matched = true,\\n          variables = {},\\n          result;\\n\\n      if ((this.regexp !== undefined) && (this.regexp.test(text))) {\\n        result = this.regexp.exec(text);\\n        for (expression_index = 0; expression_index < this.expressions.length; expression_index += 1) {\\n          expression = this.expressions[expression_index];\\n          if (expression.literal === undefined) {\\n            if ((expression.operator !== undefined) && (expression.operator.symbol.length === 0) && (expression.varspecs.length === 1)) {\\n              varspec = expression.varspecs[0];\\n              if ((varspec.exploded === false) && (varspec.maxLength === null)) {\\n                if (result[extracted_index].indexOf(',') === -1) {\\n                  variables[varspec.varname] = decodeURIComponent(result[extracted_index]);\\n                  extracted_index += 1;\\n                } else {\\n                  matched = false;\\n                }\\n              } else {\\n                matched = false;\\n              }\\n            } else {\\n              matched = false;\\n            }\\n          }\\n        }\\n        if (matched) {\\n          return variables;\\n        }\\n      }\\n      return false;\\n    };\\n\\n    UriTemplate.parse = parse;\\n    UriTemplate.UriTemplateError = UriTemplateError;\\n    return UriTemplate;\\n}());\\n\\n    exportCallback(UriTemplate);\\n\\n}(function (UriTemplate) {\\n        \\\"use strict\\\";\\n        // export UriTemplate, when module is present, or pass it to window or global\\n        if (typeof module !== \\\"undefined\\\") {\\n            module.exports = UriTemplate;\\n        }\\n        else if (typeof define === \\\"function\\\") {\\n            define([],function() {\\n                return UriTemplate;\\n            });\\n        }\\n        else if (typeof window !== \\\"undefined\\\") {\\n            window.UriTemplate = UriTemplate;\\n        }\\n        else {\\n            global.UriTemplate = UriTemplate;\\n        }\\n    }\\n));\\n;// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\\n// This work is free. You can redistribute it and/or modify it\\n// under the terms of the WTFPL, Version 2\\n// For more information see LICENSE.txt or http://www.wtfpl.net/\\n//\\n// For more information, the home page:\\n// http://pieroxy.net/blog/pages/lz-string/testing.html\\n//\\n// LZ-based compression algorithm, version 1.4.4\\nvar LZString = (function() {\\n\\n// private property\\nvar f = String.fromCharCode;\\nvar keyStrBase64 = \\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\\\";\\nvar keyStrUriSafe = \\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\\\";\\nvar baseReverseDic = {};\\n\\nfunction getBaseValue(alphabet, character) {\\n  if (!baseReverseDic[alphabet]) {\\n    baseReverseDic[alphabet] = {};\\n    for (var i=0 ; i<alphabet.length ; i++) {\\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\\n    }\\n  }\\n  return baseReverseDic[alphabet][character];\\n}\\n\\nvar LZString = {\\n  compressToBase64 : function (input) {\\n    if (input == null) return \\\"\\\";\\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\\n    switch (res.length % 4) { // To produce valid Base64\\n    default: // When could this happen ?\\n    case 0 : return res;\\n    case 1 : return res+\\\"===\\\";\\n    case 2 : return res+\\\"==\\\";\\n    case 3 : return res+\\\"=\\\";\\n    }\\n  },\\n\\n  decompressFromBase64 : function (input) {\\n    if (input == null) return \\\"\\\";\\n    if (input == \\\"\\\") return null;\\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\\n  },\\n\\n  compressToUTF16 : function (input) {\\n    if (input == null) return \\\"\\\";\\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \\\" \\\";\\n  },\\n\\n  decompressFromUTF16: function (compressed) {\\n    if (compressed == null) return \\\"\\\";\\n    if (compressed == \\\"\\\") return null;\\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\\n  },\\n\\n  //compress into uint8array (UCS-2 big endian format)\\n  compressToUint8Array: function (uncompressed) {\\n    var compressed = LZString.compress(uncompressed);\\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\\n\\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\\n      var current_value = compressed.charCodeAt(i);\\n      buf[i*2] = current_value >>> 8;\\n      buf[i*2+1] = current_value % 256;\\n    }\\n    return buf;\\n  },\\n\\n  //decompress from uint8array (UCS-2 big endian format)\\n  decompressFromUint8Array:function (compressed) {\\n    if (compressed===null || compressed===undefined){\\n        return LZString.decompress(compressed);\\n    } else {\\n        var buf=new Array(compressed.length/2); // 2 bytes per character\\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\\n        }\\n\\n        var result = [];\\n        buf.forEach(function (c) {\\n          result.push(f(c));\\n        });\\n        return LZString.decompress(result.join(''));\\n\\n    }\\n\\n  },\\n\\n\\n  //compress into a string that is already URI encoded\\n  compressToEncodedURIComponent: function (input) {\\n    if (input == null) return \\\"\\\";\\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\\n  },\\n\\n  //decompress from an output of compressToEncodedURIComponent\\n  decompressFromEncodedURIComponent:function (input) {\\n    if (input == null) return \\\"\\\";\\n    if (input == \\\"\\\") return null;\\n    input = input.replace(/ /g, \\\"+\\\");\\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\\n  },\\n\\n  compress: function (uncompressed) {\\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\\n  },\\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\\n    if (uncompressed == null) return \\\"\\\";\\n    var i, value,\\n        context_dictionary= {},\\n        context_dictionaryToCreate= {},\\n        context_c=\\\"\\\",\\n        context_wc=\\\"\\\",\\n        context_w=\\\"\\\",\\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\\n        context_dictSize= 3,\\n        context_numBits= 2,\\n        context_data=[],\\n        context_data_val=0,\\n        context_data_position=0,\\n        ii;\\n\\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\\n      context_c = uncompressed.charAt(ii);\\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\\n        context_dictionary[context_c] = context_dictSize++;\\n        context_dictionaryToCreate[context_c] = true;\\n      }\\n\\n      context_wc = context_w + context_c;\\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\\n        context_w = context_wc;\\n      } else {\\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\\n          if (context_w.charCodeAt(0)<256) {\\n            for (i=0 ; i<context_numBits ; i++) {\\n              context_data_val = (context_data_val << 1);\\n              if (context_data_position == bitsPerChar-1) {\\n                context_data_position = 0;\\n                context_data.push(getCharFromInt(context_data_val));\\n                context_data_val = 0;\\n              } else {\\n                context_data_position++;\\n              }\\n            }\\n            value = context_w.charCodeAt(0);\\n            for (i=0 ; i<8 ; i++) {\\n              context_data_val = (context_data_val << 1) | (value&1);\\n              if (context_data_position == bitsPerChar-1) {\\n                context_data_position = 0;\\n                context_data.push(getCharFromInt(context_data_val));\\n                context_data_val = 0;\\n              } else {\\n                context_data_position++;\\n              }\\n              value = value >> 1;\\n            }\\n          } else {\\n            value = 1;\\n            for (i=0 ; i<context_numBits ; i++) {\\n              context_data_val = (context_data_val << 1) | value;\\n              if (context_data_position ==bitsPerChar-1) {\\n                context_data_position = 0;\\n                context_data.push(getCharFromInt(context_data_val));\\n                context_data_val = 0;\\n              } else {\\n                context_data_position++;\\n              }\\n              value = 0;\\n            }\\n            value = context_w.charCodeAt(0);\\n            for (i=0 ; i<16 ; i++) {\\n              context_data_val = (context_data_val << 1) | (value&1);\\n              if (context_data_position == bitsPerChar-1) {\\n                context_data_position = 0;\\n                context_data.push(getCharFromInt(context_data_val));\\n                context_data_val = 0;\\n              } else {\\n                context_data_position++;\\n              }\\n              value = value >> 1;\\n            }\\n          }\\n          context_enlargeIn--;\\n          if (context_enlargeIn == 0) {\\n            context_enlargeIn = Math.pow(2, context_numBits);\\n            context_numBits++;\\n          }\\n          delete context_dictionaryToCreate[context_w];\\n        } else {\\n          value = context_dictionary[context_w];\\n          for (i=0 ; i<context_numBits ; i++) {\\n            context_data_val = (context_data_val << 1) | (value&1);\\n            if (context_data_position == bitsPerChar-1) {\\n              context_data_position = 0;\\n              context_data.push(getCharFromInt(context_data_val));\\n              context_data_val = 0;\\n            } else {\\n              context_data_position++;\\n            }\\n            value = value >> 1;\\n          }\\n\\n\\n        }\\n        context_enlargeIn--;\\n        if (context_enlargeIn == 0) {\\n          context_enlargeIn = Math.pow(2, context_numBits);\\n          context_numBits++;\\n        }\\n        // Add wc to the dictionary.\\n        context_dictionary[context_wc] = context_dictSize++;\\n        context_w = String(context_c);\\n      }\\n    }\\n\\n    // Output the code for w.\\n    if (context_w !== \\\"\\\") {\\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\\n        if (context_w.charCodeAt(0)<256) {\\n          for (i=0 ; i<context_numBits ; i++) {\\n            context_data_val = (context_data_val << 1);\\n            if (context_data_position == bitsPerChar-1) {\\n              context_data_position = 0;\\n              context_data.push(getCharFromInt(context_data_val));\\n              context_data_val = 0;\\n            } else {\\n              context_data_position++;\\n            }\\n          }\\n          value = context_w.charCodeAt(0);\\n          for (i=0 ; i<8 ; i++) {\\n            context_data_val = (context_data_val << 1) | (value&1);\\n            if (context_data_position == bitsPerChar-1) {\\n              context_data_position = 0;\\n              context_data.push(getCharFromInt(context_data_val));\\n              context_data_val = 0;\\n            } else {\\n              context_data_position++;\\n            }\\n            value = value >> 1;\\n          }\\n        } else {\\n          value = 1;\\n          for (i=0 ; i<context_numBits ; i++) {\\n            context_data_val = (context_data_val << 1) | value;\\n            if (context_data_position == bitsPerChar-1) {\\n              context_data_position = 0;\\n              context_data.push(getCharFromInt(context_data_val));\\n              context_data_val = 0;\\n            } else {\\n              context_data_position++;\\n            }\\n            value = 0;\\n          }\\n          value = context_w.charCodeAt(0);\\n          for (i=0 ; i<16 ; i++) {\\n            context_data_val = (context_data_val << 1) | (value&1);\\n            if (context_data_position == bitsPerChar-1) {\\n              context_data_position = 0;\\n              context_data.push(getCharFromInt(context_data_val));\\n              context_data_val = 0;\\n            } else {\\n              context_data_position++;\\n            }\\n            value = value >> 1;\\n          }\\n        }\\n        context_enlargeIn--;\\n        if (context_enlargeIn == 0) {\\n          context_enlargeIn = Math.pow(2, context_numBits);\\n          context_numBits++;\\n        }\\n        delete context_dictionaryToCreate[context_w];\\n      } else {\\n        value = context_dictionary[context_w];\\n        for (i=0 ; i<context_numBits ; i++) {\\n          context_data_val = (context_data_val << 1) | (value&1);\\n          if (context_data_position == bitsPerChar-1) {\\n            context_data_position = 0;\\n            context_data.push(getCharFromInt(context_data_val));\\n            context_data_val = 0;\\n          } else {\\n            context_data_position++;\\n          }\\n          value = value >> 1;\\n        }\\n\\n\\n      }\\n      context_enlargeIn--;\\n      if (context_enlargeIn == 0) {\\n        context_enlargeIn = Math.pow(2, context_numBits);\\n        context_numBits++;\\n      }\\n    }\\n\\n    // Mark the end of the stream\\n    value = 2;\\n    for (i=0 ; i<context_numBits ; i++) {\\n      context_data_val = (context_data_val << 1) | (value&1);\\n      if (context_data_position == bitsPerChar-1) {\\n        context_data_position = 0;\\n        context_data.push(getCharFromInt(context_data_val));\\n        context_data_val = 0;\\n      } else {\\n        context_data_position++;\\n      }\\n      value = value >> 1;\\n    }\\n\\n    // Flush the last char\\n    while (true) {\\n      context_data_val = (context_data_val << 1);\\n      if (context_data_position == bitsPerChar-1) {\\n        context_data.push(getCharFromInt(context_data_val));\\n        break;\\n      }\\n      else context_data_position++;\\n    }\\n    return context_data.join('');\\n  },\\n\\n  decompress: function (compressed) {\\n    if (compressed == null) return \\\"\\\";\\n    if (compressed == \\\"\\\") return null;\\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\\n  },\\n\\n  _decompress: function (length, resetValue, getNextValue) {\\n    var dictionary = [],\\n        next,\\n        enlargeIn = 4,\\n        dictSize = 4,\\n        numBits = 3,\\n        entry = \\\"\\\",\\n        result = [],\\n        i,\\n        w,\\n        bits, resb, maxpower, power,\\n        c,\\n        data = {val:getNextValue(0), position:resetValue, index:1};\\n\\n    for (i = 0; i < 3; i += 1) {\\n      dictionary[i] = i;\\n    }\\n\\n    bits = 0;\\n    maxpower = Math.pow(2,2);\\n    power=1;\\n    while (power!=maxpower) {\\n      resb = data.val & data.position;\\n      data.position >>= 1;\\n      if (data.position == 0) {\\n        data.position = resetValue;\\n        data.val = getNextValue(data.index++);\\n      }\\n      bits |= (resb>0 ? 1 : 0) * power;\\n      power <<= 1;\\n    }\\n\\n    switch (next = bits) {\\n      case 0:\\n          bits = 0;\\n          maxpower = Math.pow(2,8);\\n          power=1;\\n          while (power!=maxpower) {\\n            resb = data.val & data.position;\\n            data.position >>= 1;\\n            if (data.position == 0) {\\n              data.position = resetValue;\\n              data.val = getNextValue(data.index++);\\n            }\\n            bits |= (resb>0 ? 1 : 0) * power;\\n            power <<= 1;\\n          }\\n        c = f(bits);\\n        break;\\n      case 1:\\n          bits = 0;\\n          maxpower = Math.pow(2,16);\\n          power=1;\\n          while (power!=maxpower) {\\n            resb = data.val & data.position;\\n            data.position >>= 1;\\n            if (data.position == 0) {\\n              data.position = resetValue;\\n              data.val = getNextValue(data.index++);\\n            }\\n            bits |= (resb>0 ? 1 : 0) * power;\\n            power <<= 1;\\n          }\\n        c = f(bits);\\n        break;\\n      case 2:\\n        return \\\"\\\";\\n    }\\n    dictionary[3] = c;\\n    w = c;\\n    result.push(c);\\n    while (true) {\\n      if (data.index > length) {\\n        return \\\"\\\";\\n      }\\n\\n      bits = 0;\\n      maxpower = Math.pow(2,numBits);\\n      power=1;\\n      while (power!=maxpower) {\\n        resb = data.val & data.position;\\n        data.position >>= 1;\\n        if (data.position == 0) {\\n          data.position = resetValue;\\n          data.val = getNextValue(data.index++);\\n        }\\n        bits |= (resb>0 ? 1 : 0) * power;\\n        power <<= 1;\\n      }\\n\\n      switch (c = bits) {\\n        case 0:\\n          bits = 0;\\n          maxpower = Math.pow(2,8);\\n          power=1;\\n          while (power!=maxpower) {\\n            resb = data.val & data.position;\\n            data.position >>= 1;\\n            if (data.position == 0) {\\n              data.position = resetValue;\\n              data.val = getNextValue(data.index++);\\n            }\\n            bits |= (resb>0 ? 1 : 0) * power;\\n            power <<= 1;\\n          }\\n\\n          dictionary[dictSize++] = f(bits);\\n          c = dictSize-1;\\n          enlargeIn--;\\n          break;\\n        case 1:\\n          bits = 0;\\n          maxpower = Math.pow(2,16);\\n          power=1;\\n          while (power!=maxpower) {\\n            resb = data.val & data.position;\\n            data.position >>= 1;\\n            if (data.position == 0) {\\n              data.position = resetValue;\\n              data.val = getNextValue(data.index++);\\n            }\\n            bits |= (resb>0 ? 1 : 0) * power;\\n            power <<= 1;\\n          }\\n          dictionary[dictSize++] = f(bits);\\n          c = dictSize-1;\\n          enlargeIn--;\\n          break;\\n        case 2:\\n          return result.join('');\\n      }\\n\\n      if (enlargeIn == 0) {\\n        enlargeIn = Math.pow(2, numBits);\\n        numBits++;\\n      }\\n\\n      if (dictionary[c]) {\\n        entry = dictionary[c];\\n      } else {\\n        if (c === dictSize) {\\n          entry = w + w.charAt(0);\\n        } else {\\n          return null;\\n        }\\n      }\\n      result.push(entry);\\n\\n      // Add w+entry[0] to the dictionary.\\n      dictionary[dictSize++] = w + entry.charAt(0);\\n      enlargeIn--;\\n\\n      w = entry;\\n\\n      if (enlargeIn == 0) {\\n        enlargeIn = Math.pow(2, numBits);\\n        numBits++;\\n      }\\n\\n    }\\n  }\\n};\\n  return LZString;\\n})();\\n\\nif (typeof define === 'function' && define.amd) {\\n  define(function () { return LZString; });\\n} else if( typeof module !== 'undefined' && module != null ) {\\n  module.exports = LZString\\n}\\n;//! moment.js\\n//! version : 2.13.0\\n//! authors : Tim Wood, Iskren Chernev, Moment.js contributors\\n//! license : MIT\\n//! momentjs.com\\n\\n;(function (global, factory) {\\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\\n    typeof define === 'function' && define.amd ? define(factory) :\\n    global.moment = factory()\\n}(this, function () { 'use strict';\\n\\n    var hookCallback;\\n\\n    function utils_hooks__hooks () {\\n        return hookCallback.apply(null, arguments);\\n    }\\n\\n    // This is done to register the method called with moment()\\n    // without creating circular dependencies.\\n    function setHookCallback (callback) {\\n        hookCallback = callback;\\n    }\\n\\n    function isArray(input) {\\n        return input instanceof Array || Object.prototype.toString.call(input) === '[object Array]';\\n    }\\n\\n    function isDate(input) {\\n        return input instanceof Date || Object.prototype.toString.call(input) === '[object Date]';\\n    }\\n\\n    function map(arr, fn) {\\n        var res = [], i;\\n        for (i = 0; i < arr.length; ++i) {\\n            res.push(fn(arr[i], i));\\n        }\\n        return res;\\n    }\\n\\n    function hasOwnProp(a, b) {\\n        return Object.prototype.hasOwnProperty.call(a, b);\\n    }\\n\\n    function extend(a, b) {\\n        for (var i in b) {\\n            if (hasOwnProp(b, i)) {\\n                a[i] = b[i];\\n            }\\n        }\\n\\n        if (hasOwnProp(b, 'toString')) {\\n            a.toString = b.toString;\\n        }\\n\\n        if (hasOwnProp(b, 'valueOf')) {\\n            a.valueOf = b.valueOf;\\n        }\\n\\n        return a;\\n    }\\n\\n    function create_utc__createUTC (input, format, locale, strict) {\\n        return createLocalOrUTC(input, format, locale, strict, true).utc();\\n    }\\n\\n    function defaultParsingFlags() {\\n        // We need to deep clone this object.\\n        return {\\n            empty           : false,\\n            unusedTokens    : [],\\n            unusedInput     : [],\\n            overflow        : -2,\\n            charsLeftOver   : 0,\\n            nullInput       : false,\\n            invalidMonth    : null,\\n            invalidFormat   : false,\\n            userInvalidated : false,\\n            iso             : false,\\n            parsedDateParts : [],\\n            meridiem        : null\\n        };\\n    }\\n\\n    function getParsingFlags(m) {\\n        if (m._pf == null) {\\n            m._pf = defaultParsingFlags();\\n        }\\n        return m._pf;\\n    }\\n\\n    var some;\\n    if (Array.prototype.some) {\\n        some = Array.prototype.some;\\n    } else {\\n        some = function (fun) {\\n            var t = Object(this);\\n            var len = t.length >>> 0;\\n\\n            for (var i = 0; i < len; i++) {\\n                if (i in t && fun.call(this, t[i], i, t)) {\\n                    return true;\\n                }\\n            }\\n\\n            return false;\\n        };\\n    }\\n\\n    function valid__isValid(m) {\\n        if (m._isValid == null) {\\n            var flags = getParsingFlags(m);\\n            var parsedParts = some.call(flags.parsedDateParts, function (i) {\\n                return i != null;\\n            });\\n            m._isValid = !isNaN(m._d.getTime()) &&\\n                flags.overflow < 0 &&\\n                !flags.empty &&\\n                !flags.invalidMonth &&\\n                !flags.invalidWeekday &&\\n                !flags.nullInput &&\\n                !flags.invalidFormat &&\\n                !flags.userInvalidated &&\\n                (!flags.meridiem || (flags.meridiem && parsedParts));\\n\\n            if (m._strict) {\\n                m._isValid = m._isValid &&\\n                    flags.charsLeftOver === 0 &&\\n                    flags.unusedTokens.length === 0 &&\\n                    flags.bigHour === undefined;\\n            }\\n        }\\n        return m._isValid;\\n    }\\n\\n    function valid__createInvalid (flags) {\\n        var m = create_utc__createUTC(NaN);\\n        if (flags != null) {\\n            extend(getParsingFlags(m), flags);\\n        }\\n        else {\\n            getParsingFlags(m).userInvalidated = true;\\n        }\\n\\n        return m;\\n    }\\n\\n    function isUndefined(input) {\\n        return input === void 0;\\n    }\\n\\n    // Plugins that add properties should also add the key here (null value),\\n    // so we can properly clone ourselves.\\n    var momentProperties = utils_hooks__hooks.momentProperties = [];\\n\\n    function copyConfig(to, from) {\\n        var i, prop, val;\\n\\n        if (!isUndefined(from._isAMomentObject)) {\\n            to._isAMomentObject = from._isAMomentObject;\\n        }\\n        if (!isUndefined(from._i)) {\\n            to._i = from._i;\\n        }\\n        if (!isUndefined(from._f)) {\\n            to._f = from._f;\\n        }\\n        if (!isUndefined(from._l)) {\\n            to._l = from._l;\\n        }\\n        if (!isUndefined(from._strict)) {\\n            to._strict = from._strict;\\n        }\\n        if (!isUndefined(from._tzm)) {\\n            to._tzm = from._tzm;\\n        }\\n        if (!isUndefined(from._isUTC)) {\\n            to._isUTC = from._isUTC;\\n        }\\n        if (!isUndefined(from._offset)) {\\n            to._offset = from._offset;\\n        }\\n        if (!isUndefined(from._pf)) {\\n            to._pf = getParsingFlags(from);\\n        }\\n        if (!isUndefined(from._locale)) {\\n            to._locale = from._locale;\\n        }\\n\\n        if (momentProperties.length > 0) {\\n            for (i in momentProperties) {\\n                prop = momentProperties[i];\\n                val = from[prop];\\n                if (!isUndefined(val)) {\\n                    to[prop] = val;\\n                }\\n            }\\n        }\\n\\n        return to;\\n    }\\n\\n    var updateInProgress = false;\\n\\n    // Moment prototype object\\n    function Moment(config) {\\n        copyConfig(this, config);\\n        this._d = new Date(config._d != null ? config._d.getTime() : NaN);\\n        // Prevent infinite loop in case updateOffset creates new moment\\n        // objects.\\n        if (updateInProgress === false) {\\n            updateInProgress = true;\\n            utils_hooks__hooks.updateOffset(this);\\n            updateInProgress = false;\\n        }\\n    }\\n\\n    function isMoment (obj) {\\n        return obj instanceof Moment || (obj != null && obj._isAMomentObject != null);\\n    }\\n\\n    function absFloor (number) {\\n        if (number < 0) {\\n            return Math.ceil(number);\\n        } else {\\n            return Math.floor(number);\\n        }\\n    }\\n\\n    function toInt(argumentForCoercion) {\\n        var coercedNumber = +argumentForCoercion,\\n            value = 0;\\n\\n        if (coercedNumber !== 0 && isFinite(coercedNumber)) {\\n            value = absFloor(coercedNumber);\\n        }\\n\\n        return value;\\n    }\\n\\n    // compare two arrays, return the number of differences\\n    function compareArrays(array1, array2, dontConvert) {\\n        var len = Math.min(array1.length, array2.length),\\n            lengthDiff = Math.abs(array1.length - array2.length),\\n            diffs = 0,\\n            i;\\n        for (i = 0; i < len; i++) {\\n            if ((dontConvert && array1[i] !== array2[i]) ||\\n                (!dontConvert && toInt(array1[i]) !== toInt(array2[i]))) {\\n                diffs++;\\n            }\\n        }\\n        return diffs + lengthDiff;\\n    }\\n\\n    function warn(msg) {\\n        if (utils_hooks__hooks.suppressDeprecationWarnings === false &&\\n                (typeof console !==  'undefined') && console.warn) {\\n            console.warn('Deprecation warning: ' + msg);\\n        }\\n    }\\n\\n    function deprecate(msg, fn) {\\n        var firstTime = true;\\n\\n        return extend(function () {\\n            if (utils_hooks__hooks.deprecationHandler != null) {\\n                utils_hooks__hooks.deprecationHandler(null, msg);\\n            }\\n            if (firstTime) {\\n                warn(msg + '\\\\nArguments: ' + Array.prototype.slice.call(arguments).join(', ') + '\\\\n' + (new Error()).stack);\\n                firstTime = false;\\n            }\\n            return fn.apply(this, arguments);\\n        }, fn);\\n    }\\n\\n    var deprecations = {};\\n\\n    function deprecateSimple(name, msg) {\\n        if (utils_hooks__hooks.deprecationHandler != null) {\\n            utils_hooks__hooks.deprecationHandler(name, msg);\\n        }\\n        if (!deprecations[name]) {\\n            warn(msg);\\n            deprecations[name] = true;\\n        }\\n    }\\n\\n    utils_hooks__hooks.suppressDeprecationWarnings = false;\\n    utils_hooks__hooks.deprecationHandler = null;\\n\\n    function isFunction(input) {\\n        return input instanceof Function || Object.prototype.toString.call(input) === '[object Function]';\\n    }\\n\\n    function isObject(input) {\\n        return Object.prototype.toString.call(input) === '[object Object]';\\n    }\\n\\n    function locale_set__set (config) {\\n        var prop, i;\\n        for (i in config) {\\n            prop = config[i];\\n            if (isFunction(prop)) {\\n                this[i] = prop;\\n            } else {\\n                this['_' + i] = prop;\\n            }\\n        }\\n        this._config = config;\\n        // Lenient ordinal parsing accepts just a number in addition to\\n        // number + (possibly) stuff coming from _ordinalParseLenient.\\n        this._ordinalParseLenient = new RegExp(this._ordinalParse.source + '|' + (/\\\\d{1,2}/).source);\\n    }\\n\\n    function mergeConfigs(parentConfig, childConfig) {\\n        var res = extend({}, parentConfig), prop;\\n        for (prop in childConfig) {\\n            if (hasOwnProp(childConfig, prop)) {\\n                if (isObject(parentConfig[prop]) && isObject(childConfig[prop])) {\\n                    res[prop] = {};\\n                    extend(res[prop], parentConfig[prop]);\\n                    extend(res[prop], childConfig[prop]);\\n                } else if (childConfig[prop] != null) {\\n                    res[prop] = childConfig[prop];\\n                } else {\\n                    delete res[prop];\\n                }\\n            }\\n        }\\n        return res;\\n    }\\n\\n    function Locale(config) {\\n        if (config != null) {\\n            this.set(config);\\n        }\\n    }\\n\\n    var keys;\\n\\n    if (Object.keys) {\\n        keys = Object.keys;\\n    } else {\\n        keys = function (obj) {\\n            var i, res = [];\\n            for (i in obj) {\\n                if (hasOwnProp(obj, i)) {\\n                    res.push(i);\\n                }\\n            }\\n            return res;\\n        };\\n    }\\n\\n    // internal storage for locale config files\\n    var locales = {};\\n    var globalLocale;\\n\\n    function normalizeLocale(key) {\\n        return key ? key.toLowerCase().replace('_', '-') : key;\\n    }\\n\\n    // pick the locale from the array\\n    // try ['en-au', 'en-gb'] as 'en-au', 'en-gb', 'en', as in move through the list trying each\\n    // substring from most specific to least, but move to the next array item if it's a more specific variant than the current root\\n    function chooseLocale(names) {\\n        var i = 0, j, next, locale, split;\\n\\n        while (i < names.length) {\\n            split = normalizeLocale(names[i]).split('-');\\n            j = split.length;\\n            next = normalizeLocale(names[i + 1]);\\n            next = next ? next.split('-') : null;\\n            while (j > 0) {\\n                locale = loadLocale(split.slice(0, j).join('-'));\\n                if (locale) {\\n                    return locale;\\n                }\\n                if (next && next.length >= j && compareArrays(split, next, true) >= j - 1) {\\n                    //the next array item is better than a shallower substring of this one\\n                    break;\\n                }\\n                j--;\\n            }\\n            i++;\\n        }\\n        return null;\\n    }\\n\\n    function loadLocale(name) {\\n        var oldLocale = null;\\n        // TODO: Find a better way to register and load all the locales in Node\\n        if (!locales[name] && (typeof module !== 'undefined') &&\\n                module && module.exports) {\\n            try {\\n                oldLocale = globalLocale._abbr;\\n                require('./locale/' + name);\\n                // because defineLocale currently also sets the global locale, we\\n                // want to undo that for lazy loaded locales\\n                locale_locales__getSetGlobalLocale(oldLocale);\\n            } catch (e) { }\\n        }\\n        return locales[name];\\n    }\\n\\n    // This function will load locale and then set the global locale.  If\\n    // no arguments are passed in, it will simply return the current global\\n    // locale key.\\n    function locale_locales__getSetGlobalLocale (key, values) {\\n        var data;\\n        if (key) {\\n            if (isUndefined(values)) {\\n                data = locale_locales__getLocale(key);\\n            }\\n            else {\\n                data = defineLocale(key, values);\\n            }\\n\\n            if (data) {\\n                // moment.duration._locale = moment._locale = data;\\n                globalLocale = data;\\n            }\\n        }\\n\\n        return globalLocale._abbr;\\n    }\\n\\n    function defineLocale (name, config) {\\n        if (config !== null) {\\n            config.abbr = name;\\n            if (locales[name] != null) {\\n                deprecateSimple('defineLocaleOverride',\\n                        'use moment.updateLocale(localeName, config) to change ' +\\n                        'an existing locale. moment.defineLocale(localeName, ' +\\n                        'config) should only be used for creating a new locale');\\n                config = mergeConfigs(locales[name]._config, config);\\n            } else if (config.parentLocale != null) {\\n                if (locales[config.parentLocale] != null) {\\n                    config = mergeConfigs(locales[config.parentLocale]._config, config);\\n                } else {\\n                    // treat as if there is no base config\\n                    deprecateSimple('parentLocaleUndefined',\\n                            'specified parentLocale is not defined yet');\\n                }\\n            }\\n            locales[name] = new Locale(config);\\n\\n            // backwards compat for now: also set the locale\\n            locale_locales__getSetGlobalLocale(name);\\n\\n            return locales[name];\\n        } else {\\n            // useful for testing\\n            delete locales[name];\\n            return null;\\n        }\\n    }\\n\\n    function updateLocale(name, config) {\\n        if (config != null) {\\n            var locale;\\n            if (locales[name] != null) {\\n                config = mergeConfigs(locales[name]._config, config);\\n            }\\n            locale = new Locale(config);\\n            locale.parentLocale = locales[name];\\n            locales[name] = locale;\\n\\n            // backwards compat for now: also set the locale\\n            locale_locales__getSetGlobalLocale(name);\\n        } else {\\n            // pass null for config to unupdate, useful for tests\\n            if (locales[name] != null) {\\n                if (locales[name].parentLocale != null) {\\n                    locales[name] = locales[name].parentLocale;\\n                } else if (locales[name] != null) {\\n                    delete locales[name];\\n                }\\n            }\\n        }\\n        return locales[name];\\n    }\\n\\n    // returns locale data\\n    function locale_locales__getLocale (key) {\\n        var locale;\\n\\n        if (key && key._locale && key._locale._abbr) {\\n            key = key._locale._abbr;\\n        }\\n\\n        if (!key) {\\n            return globalLocale;\\n        }\\n\\n        if (!isArray(key)) {\\n            //short-circuit everything else\\n            locale = loadLocale(key);\\n            if (locale) {\\n                return locale;\\n            }\\n            key = [key];\\n        }\\n\\n        return chooseLocale(key);\\n    }\\n\\n    function locale_locales__listLocales() {\\n        return keys(locales);\\n    }\\n\\n    var aliases = {};\\n\\n    function addUnitAlias (unit, shorthand) {\\n        var lowerCase = unit.toLowerCase();\\n        aliases[lowerCase] = aliases[lowerCase + 's'] = aliases[shorthand] = unit;\\n    }\\n\\n    function normalizeUnits(units) {\\n        return typeof units === 'string' ? aliases[units] || aliases[units.toLowerCase()] : undefined;\\n    }\\n\\n    function normalizeObjectUnits(inputObject) {\\n        var normalizedInput = {},\\n            normalizedProp,\\n            prop;\\n\\n        for (prop in inputObject) {\\n            if (hasOwnProp(inputObject, prop)) {\\n                normalizedProp = normalizeUnits(prop);\\n                if (normalizedProp) {\\n                    normalizedInput[normalizedProp] = inputObject[prop];\\n                }\\n            }\\n        }\\n\\n        return normalizedInput;\\n    }\\n\\n    function makeGetSet (unit, keepTime) {\\n        return function (value) {\\n            if (value != null) {\\n                get_set__set(this, unit, value);\\n                utils_hooks__hooks.updateOffset(this, keepTime);\\n                return this;\\n            } else {\\n                return get_set__get(this, unit);\\n            }\\n        };\\n    }\\n\\n    function get_set__get (mom, unit) {\\n        return mom.isValid() ?\\n            mom._d['get' + (mom._isUTC ? 'UTC' : '') + unit]() : NaN;\\n    }\\n\\n    function get_set__set (mom, unit, value) {\\n        if (mom.isValid()) {\\n            mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](value);\\n        }\\n    }\\n\\n    // MOMENTS\\n\\n    function getSet (units, value) {\\n        var unit;\\n        if (typeof units === 'object') {\\n            for (unit in units) {\\n                this.set(unit, units[unit]);\\n            }\\n        } else {\\n            units = normalizeUnits(units);\\n            if (isFunction(this[units])) {\\n                return this[units](value);\\n            }\\n        }\\n        return this;\\n    }\\n\\n    function zeroFill(number, targetLength, forceSign) {\\n        var absNumber = '' + Math.abs(number),\\n            zerosToFill = targetLength - absNumber.length,\\n            sign = number >= 0;\\n        return (sign ? (forceSign ? '+' : '') : '-') +\\n            Math.pow(10, Math.max(0, zerosToFill)).toString().substr(1) + absNumber;\\n    }\\n\\n    var formattingTokens = /(\\\\[[^\\\\[]*\\\\])|(\\\\\\\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;\\n\\n    var localFormattingTokens = /(\\\\[[^\\\\[]*\\\\])|(\\\\\\\\)?(LTS|LT|LL?L?L?|l{1,4})/g;\\n\\n    var formatFunctions = {};\\n\\n    var formatTokenFunctions = {};\\n\\n    // token:    'M'\\n    // padded:   ['MM', 2]\\n    // ordinal:  'Mo'\\n    // callback: function () { this.month() + 1 }\\n    function addFormatToken (token, padded, ordinal, callback) {\\n        var func = callback;\\n        if (typeof callback === 'string') {\\n            func = function () {\\n                return this[callback]();\\n            };\\n        }\\n        if (token) {\\n            formatTokenFunctions[token] = func;\\n        }\\n        if (padded) {\\n            formatTokenFunctions[padded[0]] = function () {\\n                return zeroFill(func.apply(this, arguments), padded[1], padded[2]);\\n            };\\n        }\\n        if (ordinal) {\\n            formatTokenFunctions[ordinal] = function () {\\n                return this.localeData().ordinal(func.apply(this, arguments), token);\\n            };\\n        }\\n    }\\n\\n    function removeFormattingTokens(input) {\\n        if (input.match(/\\\\[[\\\\s\\\\S]/)) {\\n            return input.replace(/^\\\\[|\\\\]$/g, '');\\n        }\\n        return input.replace(/\\\\\\\\/g, '');\\n    }\\n\\n    function makeFormatFunction(format) {\\n        var array = format.match(formattingTokens), i, length;\\n\\n        for (i = 0, length = array.length; i < length; i++) {\\n            if (formatTokenFunctions[array[i]]) {\\n                array[i] = formatTokenFunctions[array[i]];\\n            } else {\\n                array[i] = removeFormattingTokens(array[i]);\\n            }\\n        }\\n\\n        return function (mom) {\\n            var output = '', i;\\n            for (i = 0; i < length; i++) {\\n                output += array[i] instanceof Function ? array[i].call(mom, format) : array[i];\\n            }\\n            return output;\\n        };\\n    }\\n\\n    // format date using native date object\\n    function formatMoment(m, format) {\\n        if (!m.isValid()) {\\n            return m.localeData().invalidDate();\\n        }\\n\\n        format = expandFormat(format, m.localeData());\\n        formatFunctions[format] = formatFunctions[format] || makeFormatFunction(format);\\n\\n        return formatFunctions[format](m);\\n    }\\n\\n    function expandFormat(format, locale) {\\n        var i = 5;\\n\\n        function replaceLongDateFormatTokens(input) {\\n            return locale.longDateFormat(input) || input;\\n        }\\n\\n        localFormattingTokens.lastIndex = 0;\\n        while (i >= 0 && localFormattingTokens.test(format)) {\\n            format = format.replace(localFormattingTokens, replaceLongDateFormatTokens);\\n            localFormattingTokens.lastIndex = 0;\\n            i -= 1;\\n        }\\n\\n        return format;\\n    }\\n\\n    var match1         = /\\\\d/;            //       0 - 9\\n    var match2         = /\\\\d\\\\d/;          //      00 - 99\\n    var match3         = /\\\\d{3}/;         //     000 - 999\\n    var match4         = /\\\\d{4}/;         //    0000 - 9999\\n    var match6         = /[+-]?\\\\d{6}/;    // -999999 - 999999\\n    var match1to2      = /\\\\d\\\\d?/;         //       0 - 99\\n    var match3to4      = /\\\\d\\\\d\\\\d\\\\d?/;     //     999 - 9999\\n    var match5to6      = /\\\\d\\\\d\\\\d\\\\d\\\\d\\\\d?/; //   99999 - 999999\\n    var match1to3      = /\\\\d{1,3}/;       //       0 - 999\\n    var match1to4      = /\\\\d{1,4}/;       //       0 - 9999\\n    var match1to6      = /[+-]?\\\\d{1,6}/;  // -999999 - 999999\\n\\n    var matchUnsigned  = /\\\\d+/;           //       0 - inf\\n    var matchSigned    = /[+-]?\\\\d+/;      //    -inf - inf\\n\\n    var matchOffset    = /Z|[+-]\\\\d\\\\d:?\\\\d\\\\d/gi; // +00:00 -00:00 +0000 -0000 or Z\\n    var matchShortOffset = /Z|[+-]\\\\d\\\\d(?::?\\\\d\\\\d)?/gi; // +00 -00 +00:00 -00:00 +0000 -0000 or Z\\n\\n    var matchTimestamp = /[+-]?\\\\d+(\\\\.\\\\d{1,3})?/; // 123456789 123456789.123\\n\\n    // any word (or two) characters or numbers including two/three word month in arabic.\\n    // includes scottish gaelic two word and hyphenated months\\n    var matchWord = /[0-9]*['a-z\\\\u00A0-\\\\u05FF\\\\u0700-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF]+|[\\\\u0600-\\\\u06FF\\\\/]+(\\\\s*?[\\\\u0600-\\\\u06FF]+){1,2}/i;\\n\\n\\n    var regexes = {};\\n\\n    function addRegexToken (token, regex, strictRegex) {\\n        regexes[token] = isFunction(regex) ? regex : function (isStrict, localeData) {\\n            return (isStrict && strictRegex) ? strictRegex : regex;\\n        };\\n    }\\n\\n    function getParseRegexForToken (token, config) {\\n        if (!hasOwnProp(regexes, token)) {\\n            return new RegExp(unescapeFormat(token));\\n        }\\n\\n        return regexes[token](config._strict, config._locale);\\n    }\\n\\n    // Code from http://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript\\n    function unescapeFormat(s) {\\n        return regexEscape(s.replace('\\\\\\\\', '').replace(/\\\\\\\\(\\\\[)|\\\\\\\\(\\\\])|\\\\[([^\\\\]\\\\[]*)\\\\]|\\\\\\\\(.)/g, function (matched, p1, p2, p3, p4) {\\n            return p1 || p2 || p3 || p4;\\n        }));\\n    }\\n\\n    function regexEscape(s) {\\n        return s.replace(/[-\\\\/\\\\\\\\^$*+?.()|[\\\\]{}]/g, '\\\\\\\\$&');\\n    }\\n\\n    var tokens = {};\\n\\n    function addParseToken (token, callback) {\\n        var i, func = callback;\\n        if (typeof token === 'string') {\\n            token = [token];\\n        }\\n        if (typeof callback === 'number') {\\n            func = function (input, array) {\\n                array[callback] = toInt(input);\\n            };\\n        }\\n        for (i = 0; i < token.length; i++) {\\n            tokens[token[i]] = func;\\n        }\\n    }\\n\\n    function addWeekParseToken (token, callback) {\\n        addParseToken(token, function (input, array, config, token) {\\n            config._w = config._w || {};\\n            callback(input, config._w, config, token);\\n        });\\n    }\\n\\n    function addTimeToArrayFromToken(token, input, config) {\\n        if (input != null && hasOwnProp(tokens, token)) {\\n            tokens[token](input, config._a, config, token);\\n        }\\n    }\\n\\n    var YEAR = 0;\\n    var MONTH = 1;\\n    var DATE = 2;\\n    var HOUR = 3;\\n    var MINUTE = 4;\\n    var SECOND = 5;\\n    var MILLISECOND = 6;\\n    var WEEK = 7;\\n    var WEEKDAY = 8;\\n\\n    var indexOf;\\n\\n    if (Array.prototype.indexOf) {\\n        indexOf = Array.prototype.indexOf;\\n    } else {\\n        indexOf = function (o) {\\n            // I know\\n            var i;\\n            for (i = 0; i < this.length; ++i) {\\n                if (this[i] === o) {\\n                    return i;\\n                }\\n            }\\n            return -1;\\n        };\\n    }\\n\\n    function daysInMonth(year, month) {\\n        return new Date(Date.UTC(year, month + 1, 0)).getUTCDate();\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('M', ['MM', 2], 'Mo', function () {\\n        return this.month() + 1;\\n    });\\n\\n    addFormatToken('MMM', 0, 0, function (format) {\\n        return this.localeData().monthsShort(this, format);\\n    });\\n\\n    addFormatToken('MMMM', 0, 0, function (format) {\\n        return this.localeData().months(this, format);\\n    });\\n\\n    // ALIASES\\n\\n    addUnitAlias('month', 'M');\\n\\n    // PARSING\\n\\n    addRegexToken('M',    match1to2);\\n    addRegexToken('MM',   match1to2, match2);\\n    addRegexToken('MMM',  function (isStrict, locale) {\\n        return locale.monthsShortRegex(isStrict);\\n    });\\n    addRegexToken('MMMM', function (isStrict, locale) {\\n        return locale.monthsRegex(isStrict);\\n    });\\n\\n    addParseToken(['M', 'MM'], function (input, array) {\\n        array[MONTH] = toInt(input) - 1;\\n    });\\n\\n    addParseToken(['MMM', 'MMMM'], function (input, array, config, token) {\\n        var month = config._locale.monthsParse(input, token, config._strict);\\n        // if we didn't find a month name, mark the date as invalid.\\n        if (month != null) {\\n            array[MONTH] = month;\\n        } else {\\n            getParsingFlags(config).invalidMonth = input;\\n        }\\n    });\\n\\n    // LOCALES\\n\\n    var MONTHS_IN_FORMAT = /D[oD]?(\\\\[[^\\\\[\\\\]]*\\\\]|\\\\s+)+MMMM?/;\\n    var defaultLocaleMonths = 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_');\\n    function localeMonths (m, format) {\\n        return isArray(this._months) ? this._months[m.month()] :\\n            this._months[MONTHS_IN_FORMAT.test(format) ? 'format' : 'standalone'][m.month()];\\n    }\\n\\n    var defaultLocaleMonthsShort = 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_');\\n    function localeMonthsShort (m, format) {\\n        return isArray(this._monthsShort) ? this._monthsShort[m.month()] :\\n            this._monthsShort[MONTHS_IN_FORMAT.test(format) ? 'format' : 'standalone'][m.month()];\\n    }\\n\\n    function units_month__handleStrictParse(monthName, format, strict) {\\n        var i, ii, mom, llc = monthName.toLocaleLowerCase();\\n        if (!this._monthsParse) {\\n            // this is not used\\n            this._monthsParse = [];\\n            this._longMonthsParse = [];\\n            this._shortMonthsParse = [];\\n            for (i = 0; i < 12; ++i) {\\n                mom = create_utc__createUTC([2000, i]);\\n                this._shortMonthsParse[i] = this.monthsShort(mom, '').toLocaleLowerCase();\\n                this._longMonthsParse[i] = this.months(mom, '').toLocaleLowerCase();\\n            }\\n        }\\n\\n        if (strict) {\\n            if (format === 'MMM') {\\n                ii = indexOf.call(this._shortMonthsParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else {\\n                ii = indexOf.call(this._longMonthsParse, llc);\\n                return ii !== -1 ? ii : null;\\n            }\\n        } else {\\n            if (format === 'MMM') {\\n                ii = indexOf.call(this._shortMonthsParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._longMonthsParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else {\\n                ii = indexOf.call(this._longMonthsParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._shortMonthsParse, llc);\\n                return ii !== -1 ? ii : null;\\n            }\\n        }\\n    }\\n\\n    function localeMonthsParse (monthName, format, strict) {\\n        var i, mom, regex;\\n\\n        if (this._monthsParseExact) {\\n            return units_month__handleStrictParse.call(this, monthName, format, strict);\\n        }\\n\\n        if (!this._monthsParse) {\\n            this._monthsParse = [];\\n            this._longMonthsParse = [];\\n            this._shortMonthsParse = [];\\n        }\\n\\n        // TODO: add sorting\\n        // Sorting makes sure if one month (or abbr) is a prefix of another\\n        // see sorting in computeMonthsParse\\n        for (i = 0; i < 12; i++) {\\n            // make the regex if we don't have it already\\n            mom = create_utc__createUTC([2000, i]);\\n            if (strict && !this._longMonthsParse[i]) {\\n                this._longMonthsParse[i] = new RegExp('^' + this.months(mom, '').replace('.', '') + '$', 'i');\\n                this._shortMonthsParse[i] = new RegExp('^' + this.monthsShort(mom, '').replace('.', '') + '$', 'i');\\n            }\\n            if (!strict && !this._monthsParse[i]) {\\n                regex = '^' + this.months(mom, '') + '|^' + this.monthsShort(mom, '');\\n                this._monthsParse[i] = new RegExp(regex.replace('.', ''), 'i');\\n            }\\n            // test the regex\\n            if (strict && format === 'MMMM' && this._longMonthsParse[i].test(monthName)) {\\n                return i;\\n            } else if (strict && format === 'MMM' && this._shortMonthsParse[i].test(monthName)) {\\n                return i;\\n            } else if (!strict && this._monthsParse[i].test(monthName)) {\\n                return i;\\n            }\\n        }\\n    }\\n\\n    // MOMENTS\\n\\n    function setMonth (mom, value) {\\n        var dayOfMonth;\\n\\n        if (!mom.isValid()) {\\n            // No op\\n            return mom;\\n        }\\n\\n        if (typeof value === 'string') {\\n            if (/^\\\\d+$/.test(value)) {\\n                value = toInt(value);\\n            } else {\\n                value = mom.localeData().monthsParse(value);\\n                // TODO: Another silent failure?\\n                if (typeof value !== 'number') {\\n                    return mom;\\n                }\\n            }\\n        }\\n\\n        dayOfMonth = Math.min(mom.date(), daysInMonth(mom.year(), value));\\n        mom._d['set' + (mom._isUTC ? 'UTC' : '') + 'Month'](value, dayOfMonth);\\n        return mom;\\n    }\\n\\n    function getSetMonth (value) {\\n        if (value != null) {\\n            setMonth(this, value);\\n            utils_hooks__hooks.updateOffset(this, true);\\n            return this;\\n        } else {\\n            return get_set__get(this, 'Month');\\n        }\\n    }\\n\\n    function getDaysInMonth () {\\n        return daysInMonth(this.year(), this.month());\\n    }\\n\\n    var defaultMonthsShortRegex = matchWord;\\n    function monthsShortRegex (isStrict) {\\n        if (this._monthsParseExact) {\\n            if (!hasOwnProp(this, '_monthsRegex')) {\\n                computeMonthsParse.call(this);\\n            }\\n            if (isStrict) {\\n                return this._monthsShortStrictRegex;\\n            } else {\\n                return this._monthsShortRegex;\\n            }\\n        } else {\\n            return this._monthsShortStrictRegex && isStrict ?\\n                this._monthsShortStrictRegex : this._monthsShortRegex;\\n        }\\n    }\\n\\n    var defaultMonthsRegex = matchWord;\\n    function monthsRegex (isStrict) {\\n        if (this._monthsParseExact) {\\n            if (!hasOwnProp(this, '_monthsRegex')) {\\n                computeMonthsParse.call(this);\\n            }\\n            if (isStrict) {\\n                return this._monthsStrictRegex;\\n            } else {\\n                return this._monthsRegex;\\n            }\\n        } else {\\n            return this._monthsStrictRegex && isStrict ?\\n                this._monthsStrictRegex : this._monthsRegex;\\n        }\\n    }\\n\\n    function computeMonthsParse () {\\n        function cmpLenRev(a, b) {\\n            return b.length - a.length;\\n        }\\n\\n        var shortPieces = [], longPieces = [], mixedPieces = [],\\n            i, mom;\\n        for (i = 0; i < 12; i++) {\\n            // make the regex if we don't have it already\\n            mom = create_utc__createUTC([2000, i]);\\n            shortPieces.push(this.monthsShort(mom, ''));\\n            longPieces.push(this.months(mom, ''));\\n            mixedPieces.push(this.months(mom, ''));\\n            mixedPieces.push(this.monthsShort(mom, ''));\\n        }\\n        // Sorting makes sure if one month (or abbr) is a prefix of another it\\n        // will match the longer piece.\\n        shortPieces.sort(cmpLenRev);\\n        longPieces.sort(cmpLenRev);\\n        mixedPieces.sort(cmpLenRev);\\n        for (i = 0; i < 12; i++) {\\n            shortPieces[i] = regexEscape(shortPieces[i]);\\n            longPieces[i] = regexEscape(longPieces[i]);\\n            mixedPieces[i] = regexEscape(mixedPieces[i]);\\n        }\\n\\n        this._monthsRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');\\n        this._monthsShortRegex = this._monthsRegex;\\n        this._monthsStrictRegex = new RegExp('^(' + longPieces.join('|') + ')', 'i');\\n        this._monthsShortStrictRegex = new RegExp('^(' + shortPieces.join('|') + ')', 'i');\\n    }\\n\\n    function checkOverflow (m) {\\n        var overflow;\\n        var a = m._a;\\n\\n        if (a && getParsingFlags(m).overflow === -2) {\\n            overflow =\\n                a[MONTH]       < 0 || a[MONTH]       > 11  ? MONTH :\\n                a[DATE]        < 1 || a[DATE]        > daysInMonth(a[YEAR], a[MONTH]) ? DATE :\\n                a[HOUR]        < 0 || a[HOUR]        > 24 || (a[HOUR] === 24 && (a[MINUTE] !== 0 || a[SECOND] !== 0 || a[MILLISECOND] !== 0)) ? HOUR :\\n                a[MINUTE]      < 0 || a[MINUTE]      > 59  ? MINUTE :\\n                a[SECOND]      < 0 || a[SECOND]      > 59  ? SECOND :\\n                a[MILLISECOND] < 0 || a[MILLISECOND] > 999 ? MILLISECOND :\\n                -1;\\n\\n            if (getParsingFlags(m)._overflowDayOfYear && (overflow < YEAR || overflow > DATE)) {\\n                overflow = DATE;\\n            }\\n            if (getParsingFlags(m)._overflowWeeks && overflow === -1) {\\n                overflow = WEEK;\\n            }\\n            if (getParsingFlags(m)._overflowWeekday && overflow === -1) {\\n                overflow = WEEKDAY;\\n            }\\n\\n            getParsingFlags(m).overflow = overflow;\\n        }\\n\\n        return m;\\n    }\\n\\n    // iso 8601 regex\\n    // 0000-00-00 0000-W00 or 0000-W00-0 + T + 00 or 00:00 or 00:00:00 or 00:00:00.000 + +00:00 or +0000 or +00)\\n    var extendedIsoRegex = /^\\\\s*((?:[+-]\\\\d{6}|\\\\d{4})-(?:\\\\d\\\\d-\\\\d\\\\d|W\\\\d\\\\d-\\\\d|W\\\\d\\\\d|\\\\d\\\\d\\\\d|\\\\d\\\\d))(?:(T| )(\\\\d\\\\d(?::\\\\d\\\\d(?::\\\\d\\\\d(?:[.,]\\\\d+)?)?)?)([\\\\+\\\\-]\\\\d\\\\d(?::?\\\\d\\\\d)?|\\\\s*Z)?)?/;\\n    var basicIsoRegex = /^\\\\s*((?:[+-]\\\\d{6}|\\\\d{4})(?:\\\\d\\\\d\\\\d\\\\d|W\\\\d\\\\d\\\\d|W\\\\d\\\\d|\\\\d\\\\d\\\\d|\\\\d\\\\d))(?:(T| )(\\\\d\\\\d(?:\\\\d\\\\d(?:\\\\d\\\\d(?:[.,]\\\\d+)?)?)?)([\\\\+\\\\-]\\\\d\\\\d(?::?\\\\d\\\\d)?|\\\\s*Z)?)?/;\\n\\n    var tzRegex = /Z|[+-]\\\\d\\\\d(?::?\\\\d\\\\d)?/;\\n\\n    var isoDates = [\\n        ['YYYYYY-MM-DD', /[+-]\\\\d{6}-\\\\d\\\\d-\\\\d\\\\d/],\\n        ['YYYY-MM-DD', /\\\\d{4}-\\\\d\\\\d-\\\\d\\\\d/],\\n        ['GGGG-[W]WW-E', /\\\\d{4}-W\\\\d\\\\d-\\\\d/],\\n        ['GGGG-[W]WW', /\\\\d{4}-W\\\\d\\\\d/, false],\\n        ['YYYY-DDD', /\\\\d{4}-\\\\d{3}/],\\n        ['YYYY-MM', /\\\\d{4}-\\\\d\\\\d/, false],\\n        ['YYYYYYMMDD', /[+-]\\\\d{10}/],\\n        ['YYYYMMDD', /\\\\d{8}/],\\n        // YYYYMM is NOT allowed by the standard\\n        ['GGGG[W]WWE', /\\\\d{4}W\\\\d{3}/],\\n        ['GGGG[W]WW', /\\\\d{4}W\\\\d{2}/, false],\\n        ['YYYYDDD', /\\\\d{7}/]\\n    ];\\n\\n    // iso time formats and regexes\\n    var isoTimes = [\\n        ['HH:mm:ss.SSSS', /\\\\d\\\\d:\\\\d\\\\d:\\\\d\\\\d\\\\.\\\\d+/],\\n        ['HH:mm:ss,SSSS', /\\\\d\\\\d:\\\\d\\\\d:\\\\d\\\\d,\\\\d+/],\\n        ['HH:mm:ss', /\\\\d\\\\d:\\\\d\\\\d:\\\\d\\\\d/],\\n        ['HH:mm', /\\\\d\\\\d:\\\\d\\\\d/],\\n        ['HHmmss.SSSS', /\\\\d\\\\d\\\\d\\\\d\\\\d\\\\d\\\\.\\\\d+/],\\n        ['HHmmss,SSSS', /\\\\d\\\\d\\\\d\\\\d\\\\d\\\\d,\\\\d+/],\\n        ['HHmmss', /\\\\d\\\\d\\\\d\\\\d\\\\d\\\\d/],\\n        ['HHmm', /\\\\d\\\\d\\\\d\\\\d/],\\n        ['HH', /\\\\d\\\\d/]\\n    ];\\n\\n    var aspNetJsonRegex = /^\\\\/?Date\\\\((\\\\-?\\\\d+)/i;\\n\\n    // date from iso format\\n    function configFromISO(config) {\\n        var i, l,\\n            string = config._i,\\n            match = extendedIsoRegex.exec(string) || basicIsoRegex.exec(string),\\n            allowTime, dateFormat, timeFormat, tzFormat;\\n\\n        if (match) {\\n            getParsingFlags(config).iso = true;\\n\\n            for (i = 0, l = isoDates.length; i < l; i++) {\\n                if (isoDates[i][1].exec(match[1])) {\\n                    dateFormat = isoDates[i][0];\\n                    allowTime = isoDates[i][2] !== false;\\n                    break;\\n                }\\n            }\\n            if (dateFormat == null) {\\n                config._isValid = false;\\n                return;\\n            }\\n            if (match[3]) {\\n                for (i = 0, l = isoTimes.length; i < l; i++) {\\n                    if (isoTimes[i][1].exec(match[3])) {\\n                        // match[2] should be 'T' or space\\n                        timeFormat = (match[2] || ' ') + isoTimes[i][0];\\n                        break;\\n                    }\\n                }\\n                if (timeFormat == null) {\\n                    config._isValid = false;\\n                    return;\\n                }\\n            }\\n            if (!allowTime && timeFormat != null) {\\n                config._isValid = false;\\n                return;\\n            }\\n            if (match[4]) {\\n                if (tzRegex.exec(match[4])) {\\n                    tzFormat = 'Z';\\n                } else {\\n                    config._isValid = false;\\n                    return;\\n                }\\n            }\\n            config._f = dateFormat + (timeFormat || '') + (tzFormat || '');\\n            configFromStringAndFormat(config);\\n        } else {\\n            config._isValid = false;\\n        }\\n    }\\n\\n    // date from iso format or fallback\\n    function configFromString(config) {\\n        var matched = aspNetJsonRegex.exec(config._i);\\n\\n        if (matched !== null) {\\n            config._d = new Date(+matched[1]);\\n            return;\\n        }\\n\\n        configFromISO(config);\\n        if (config._isValid === false) {\\n            delete config._isValid;\\n            utils_hooks__hooks.createFromInputFallback(config);\\n        }\\n    }\\n\\n    utils_hooks__hooks.createFromInputFallback = deprecate(\\n        'moment construction falls back to js Date. This is ' +\\n        'discouraged and will be removed in upcoming major ' +\\n        'release. Please refer to ' +\\n        'https://github.com/moment/moment/issues/1407 for more info.',\\n        function (config) {\\n            config._d = new Date(config._i + (config._useUTC ? ' UTC' : ''));\\n        }\\n    );\\n\\n    function createDate (y, m, d, h, M, s, ms) {\\n        //can't just apply() to create a date:\\n        //http://stackoverflow.com/questions/181348/instantiating-a-javascript-object-by-calling-prototype-constructor-apply\\n        var date = new Date(y, m, d, h, M, s, ms);\\n\\n        //the date constructor remaps years 0-99 to 1900-1999\\n        if (y < 100 && y >= 0 && isFinite(date.getFullYear())) {\\n            date.setFullYear(y);\\n        }\\n        return date;\\n    }\\n\\n    function createUTCDate (y) {\\n        var date = new Date(Date.UTC.apply(null, arguments));\\n\\n        //the Date.UTC function remaps years 0-99 to 1900-1999\\n        if (y < 100 && y >= 0 && isFinite(date.getUTCFullYear())) {\\n            date.setUTCFullYear(y);\\n        }\\n        return date;\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('Y', 0, 0, function () {\\n        var y = this.year();\\n        return y <= 9999 ? '' + y : '+' + y;\\n    });\\n\\n    addFormatToken(0, ['YY', 2], 0, function () {\\n        return this.year() % 100;\\n    });\\n\\n    addFormatToken(0, ['YYYY',   4],       0, 'year');\\n    addFormatToken(0, ['YYYYY',  5],       0, 'year');\\n    addFormatToken(0, ['YYYYYY', 6, true], 0, 'year');\\n\\n    // ALIASES\\n\\n    addUnitAlias('year', 'y');\\n\\n    // PARSING\\n\\n    addRegexToken('Y',      matchSigned);\\n    addRegexToken('YY',     match1to2, match2);\\n    addRegexToken('YYYY',   match1to4, match4);\\n    addRegexToken('YYYYY',  match1to6, match6);\\n    addRegexToken('YYYYYY', match1to6, match6);\\n\\n    addParseToken(['YYYYY', 'YYYYYY'], YEAR);\\n    addParseToken('YYYY', function (input, array) {\\n        array[YEAR] = input.length === 2 ? utils_hooks__hooks.parseTwoDigitYear(input) : toInt(input);\\n    });\\n    addParseToken('YY', function (input, array) {\\n        array[YEAR] = utils_hooks__hooks.parseTwoDigitYear(input);\\n    });\\n    addParseToken('Y', function (input, array) {\\n        array[YEAR] = parseInt(input, 10);\\n    });\\n\\n    // HELPERS\\n\\n    function daysInYear(year) {\\n        return isLeapYear(year) ? 366 : 365;\\n    }\\n\\n    function isLeapYear(year) {\\n        return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;\\n    }\\n\\n    // HOOKS\\n\\n    utils_hooks__hooks.parseTwoDigitYear = function (input) {\\n        return toInt(input) + (toInt(input) > 68 ? 1900 : 2000);\\n    };\\n\\n    // MOMENTS\\n\\n    var getSetYear = makeGetSet('FullYear', true);\\n\\n    function getIsLeapYear () {\\n        return isLeapYear(this.year());\\n    }\\n\\n    // start-of-first-week - start-of-year\\n    function firstWeekOffset(year, dow, doy) {\\n        var // first-week day -- which january is always in the first week (4 for iso, 1 for other)\\n            fwd = 7 + dow - doy,\\n            // first-week day local weekday -- which local weekday is fwd\\n            fwdlw = (7 + createUTCDate(year, 0, fwd).getUTCDay() - dow) % 7;\\n\\n        return -fwdlw + fwd - 1;\\n    }\\n\\n    //http://en.wikipedia.org/wiki/ISO_week_date#Calculating_a_date_given_the_year.2C_week_number_and_weekday\\n    function dayOfYearFromWeeks(year, week, weekday, dow, doy) {\\n        var localWeekday = (7 + weekday - dow) % 7,\\n            weekOffset = firstWeekOffset(year, dow, doy),\\n            dayOfYear = 1 + 7 * (week - 1) + localWeekday + weekOffset,\\n            resYear, resDayOfYear;\\n\\n        if (dayOfYear <= 0) {\\n            resYear = year - 1;\\n            resDayOfYear = daysInYear(resYear) + dayOfYear;\\n        } else if (dayOfYear > daysInYear(year)) {\\n            resYear = year + 1;\\n            resDayOfYear = dayOfYear - daysInYear(year);\\n        } else {\\n            resYear = year;\\n            resDayOfYear = dayOfYear;\\n        }\\n\\n        return {\\n            year: resYear,\\n            dayOfYear: resDayOfYear\\n        };\\n    }\\n\\n    function weekOfYear(mom, dow, doy) {\\n        var weekOffset = firstWeekOffset(mom.year(), dow, doy),\\n            week = Math.floor((mom.dayOfYear() - weekOffset - 1) / 7) + 1,\\n            resWeek, resYear;\\n\\n        if (week < 1) {\\n            resYear = mom.year() - 1;\\n            resWeek = week + weeksInYear(resYear, dow, doy);\\n        } else if (week > weeksInYear(mom.year(), dow, doy)) {\\n            resWeek = week - weeksInYear(mom.year(), dow, doy);\\n            resYear = mom.year() + 1;\\n        } else {\\n            resYear = mom.year();\\n            resWeek = week;\\n        }\\n\\n        return {\\n            week: resWeek,\\n            year: resYear\\n        };\\n    }\\n\\n    function weeksInYear(year, dow, doy) {\\n        var weekOffset = firstWeekOffset(year, dow, doy),\\n            weekOffsetNext = firstWeekOffset(year + 1, dow, doy);\\n        return (daysInYear(year) - weekOffset + weekOffsetNext) / 7;\\n    }\\n\\n    // Pick the first defined of two or three arguments.\\n    function defaults(a, b, c) {\\n        if (a != null) {\\n            return a;\\n        }\\n        if (b != null) {\\n            return b;\\n        }\\n        return c;\\n    }\\n\\n    function currentDateArray(config) {\\n        // hooks is actually the exported moment object\\n        var nowValue = new Date(utils_hooks__hooks.now());\\n        if (config._useUTC) {\\n            return [nowValue.getUTCFullYear(), nowValue.getUTCMonth(), nowValue.getUTCDate()];\\n        }\\n        return [nowValue.getFullYear(), nowValue.getMonth(), nowValue.getDate()];\\n    }\\n\\n    // convert an array to a date.\\n    // the array should mirror the parameters below\\n    // note: all values past the year are optional and will default to the lowest possible value.\\n    // [year, month, day , hour, minute, second, millisecond]\\n    function configFromArray (config) {\\n        var i, date, input = [], currentDate, yearToUse;\\n\\n        if (config._d) {\\n            return;\\n        }\\n\\n        currentDate = currentDateArray(config);\\n\\n        //compute day of the year from weeks and weekdays\\n        if (config._w && config._a[DATE] == null && config._a[MONTH] == null) {\\n            dayOfYearFromWeekInfo(config);\\n        }\\n\\n        //if the day of the year is set, figure out what it is\\n        if (config._dayOfYear) {\\n            yearToUse = defaults(config._a[YEAR], currentDate[YEAR]);\\n\\n            if (config._dayOfYear > daysInYear(yearToUse)) {\\n                getParsingFlags(config)._overflowDayOfYear = true;\\n            }\\n\\n            date = createUTCDate(yearToUse, 0, config._dayOfYear);\\n            config._a[MONTH] = date.getUTCMonth();\\n            config._a[DATE] = date.getUTCDate();\\n        }\\n\\n        // Default to current date.\\n        // * if no year, month, day of month are given, default to today\\n        // * if day of month is given, default month and year\\n        // * if month is given, default only year\\n        // * if year is given, don't default anything\\n        for (i = 0; i < 3 && config._a[i] == null; ++i) {\\n            config._a[i] = input[i] = currentDate[i];\\n        }\\n\\n        // Zero out whatever was not defaulted, including time\\n        for (; i < 7; i++) {\\n            config._a[i] = input[i] = (config._a[i] == null) ? (i === 2 ? 1 : 0) : config._a[i];\\n        }\\n\\n        // Check for 24:00:00.000\\n        if (config._a[HOUR] === 24 &&\\n                config._a[MINUTE] === 0 &&\\n                config._a[SECOND] === 0 &&\\n                config._a[MILLISECOND] === 0) {\\n            config._nextDay = true;\\n            config._a[HOUR] = 0;\\n        }\\n\\n        config._d = (config._useUTC ? createUTCDate : createDate).apply(null, input);\\n        // Apply timezone offset from input. The actual utcOffset can be changed\\n        // with parseZone.\\n        if (config._tzm != null) {\\n            config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);\\n        }\\n\\n        if (config._nextDay) {\\n            config._a[HOUR] = 24;\\n        }\\n    }\\n\\n    function dayOfYearFromWeekInfo(config) {\\n        var w, weekYear, week, weekday, dow, doy, temp, weekdayOverflow;\\n\\n        w = config._w;\\n        if (w.GG != null || w.W != null || w.E != null) {\\n            dow = 1;\\n            doy = 4;\\n\\n            // TODO: We need to take the current isoWeekYear, but that depends on\\n            // how we interpret now (local, utc, fixed offset). So create\\n            // a now version of current config (take local/utc/offset flags, and\\n            // create now).\\n            weekYear = defaults(w.GG, config._a[YEAR], weekOfYear(local__createLocal(), 1, 4).year);\\n            week = defaults(w.W, 1);\\n            weekday = defaults(w.E, 1);\\n            if (weekday < 1 || weekday > 7) {\\n                weekdayOverflow = true;\\n            }\\n        } else {\\n            dow = config._locale._week.dow;\\n            doy = config._locale._week.doy;\\n\\n            weekYear = defaults(w.gg, config._a[YEAR], weekOfYear(local__createLocal(), dow, doy).year);\\n            week = defaults(w.w, 1);\\n\\n            if (w.d != null) {\\n                // weekday -- low day numbers are considered next week\\n                weekday = w.d;\\n                if (weekday < 0 || weekday > 6) {\\n                    weekdayOverflow = true;\\n                }\\n            } else if (w.e != null) {\\n                // local weekday -- counting starts from begining of week\\n                weekday = w.e + dow;\\n                if (w.e < 0 || w.e > 6) {\\n                    weekdayOverflow = true;\\n                }\\n            } else {\\n                // default to begining of week\\n                weekday = dow;\\n            }\\n        }\\n        if (week < 1 || week > weeksInYear(weekYear, dow, doy)) {\\n            getParsingFlags(config)._overflowWeeks = true;\\n        } else if (weekdayOverflow != null) {\\n            getParsingFlags(config)._overflowWeekday = true;\\n        } else {\\n            temp = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy);\\n            config._a[YEAR] = temp.year;\\n            config._dayOfYear = temp.dayOfYear;\\n        }\\n    }\\n\\n    // constant that refers to the ISO standard\\n    utils_hooks__hooks.ISO_8601 = function () {};\\n\\n    // date from string and format string\\n    function configFromStringAndFormat(config) {\\n        // TODO: Move this to another part of the creation flow to prevent circular deps\\n        if (config._f === utils_hooks__hooks.ISO_8601) {\\n            configFromISO(config);\\n            return;\\n        }\\n\\n        config._a = [];\\n        getParsingFlags(config).empty = true;\\n\\n        // This array is used to make a Date, either with `new Date` or `Date.UTC`\\n        var string = '' + config._i,\\n            i, parsedInput, tokens, token, skipped,\\n            stringLength = string.length,\\n            totalParsedInputLength = 0;\\n\\n        tokens = expandFormat(config._f, config._locale).match(formattingTokens) || [];\\n\\n        for (i = 0; i < tokens.length; i++) {\\n            token = tokens[i];\\n            parsedInput = (string.match(getParseRegexForToken(token, config)) || [])[0];\\n            // console.log('token', token, 'parsedInput', parsedInput,\\n            //         'regex', getParseRegexForToken(token, config));\\n            if (parsedInput) {\\n                skipped = string.substr(0, string.indexOf(parsedInput));\\n                if (skipped.length > 0) {\\n                    getParsingFlags(config).unusedInput.push(skipped);\\n                }\\n                string = string.slice(string.indexOf(parsedInput) + parsedInput.length);\\n                totalParsedInputLength += parsedInput.length;\\n            }\\n            // don't parse if it's not a known token\\n            if (formatTokenFunctions[token]) {\\n                if (parsedInput) {\\n                    getParsingFlags(config).empty = false;\\n                }\\n                else {\\n                    getParsingFlags(config).unusedTokens.push(token);\\n                }\\n                addTimeToArrayFromToken(token, parsedInput, config);\\n            }\\n            else if (config._strict && !parsedInput) {\\n                getParsingFlags(config).unusedTokens.push(token);\\n            }\\n        }\\n\\n        // add remaining unparsed input length to the string\\n        getParsingFlags(config).charsLeftOver = stringLength - totalParsedInputLength;\\n        if (string.length > 0) {\\n            getParsingFlags(config).unusedInput.push(string);\\n        }\\n\\n        // clear _12h flag if hour is <= 12\\n        if (getParsingFlags(config).bigHour === true &&\\n                config._a[HOUR] <= 12 &&\\n                config._a[HOUR] > 0) {\\n            getParsingFlags(config).bigHour = undefined;\\n        }\\n\\n        getParsingFlags(config).parsedDateParts = config._a.slice(0);\\n        getParsingFlags(config).meridiem = config._meridiem;\\n        // handle meridiem\\n        config._a[HOUR] = meridiemFixWrap(config._locale, config._a[HOUR], config._meridiem);\\n\\n        configFromArray(config);\\n        checkOverflow(config);\\n    }\\n\\n\\n    function meridiemFixWrap (locale, hour, meridiem) {\\n        var isPm;\\n\\n        if (meridiem == null) {\\n            // nothing to do\\n            return hour;\\n        }\\n        if (locale.meridiemHour != null) {\\n            return locale.meridiemHour(hour, meridiem);\\n        } else if (locale.isPM != null) {\\n            // Fallback\\n            isPm = locale.isPM(meridiem);\\n            if (isPm && hour < 12) {\\n                hour += 12;\\n            }\\n            if (!isPm && hour === 12) {\\n                hour = 0;\\n            }\\n            return hour;\\n        } else {\\n            // this is not supposed to happen\\n            return hour;\\n        }\\n    }\\n\\n    // date from string and array of format strings\\n    function configFromStringAndArray(config) {\\n        var tempConfig,\\n            bestMoment,\\n\\n            scoreToBeat,\\n            i,\\n            currentScore;\\n\\n        if (config._f.length === 0) {\\n            getParsingFlags(config).invalidFormat = true;\\n            config._d = new Date(NaN);\\n            return;\\n        }\\n\\n        for (i = 0; i < config._f.length; i++) {\\n            currentScore = 0;\\n            tempConfig = copyConfig({}, config);\\n            if (config._useUTC != null) {\\n                tempConfig._useUTC = config._useUTC;\\n            }\\n            tempConfig._f = config._f[i];\\n            configFromStringAndFormat(tempConfig);\\n\\n            if (!valid__isValid(tempConfig)) {\\n                continue;\\n            }\\n\\n            // if there is any input that was not parsed add a penalty for that format\\n            currentScore += getParsingFlags(tempConfig).charsLeftOver;\\n\\n            //or tokens\\n            currentScore += getParsingFlags(tempConfig).unusedTokens.length * 10;\\n\\n            getParsingFlags(tempConfig).score = currentScore;\\n\\n            if (scoreToBeat == null || currentScore < scoreToBeat) {\\n                scoreToBeat = currentScore;\\n                bestMoment = tempConfig;\\n            }\\n        }\\n\\n        extend(config, bestMoment || tempConfig);\\n    }\\n\\n    function configFromObject(config) {\\n        if (config._d) {\\n            return;\\n        }\\n\\n        var i = normalizeObjectUnits(config._i);\\n        config._a = map([i.year, i.month, i.day || i.date, i.hour, i.minute, i.second, i.millisecond], function (obj) {\\n            return obj && parseInt(obj, 10);\\n        });\\n\\n        configFromArray(config);\\n    }\\n\\n    function createFromConfig (config) {\\n        var res = new Moment(checkOverflow(prepareConfig(config)));\\n        if (res._nextDay) {\\n            // Adding is smart enough around DST\\n            res.add(1, 'd');\\n            res._nextDay = undefined;\\n        }\\n\\n        return res;\\n    }\\n\\n    function prepareConfig (config) {\\n        var input = config._i,\\n            format = config._f;\\n\\n        config._locale = config._locale || locale_locales__getLocale(config._l);\\n\\n        if (input === null || (format === undefined && input === '')) {\\n            return valid__createInvalid({nullInput: true});\\n        }\\n\\n        if (typeof input === 'string') {\\n            config._i = input = config._locale.preparse(input);\\n        }\\n\\n        if (isMoment(input)) {\\n            return new Moment(checkOverflow(input));\\n        } else if (isArray(format)) {\\n            configFromStringAndArray(config);\\n        } else if (format) {\\n            configFromStringAndFormat(config);\\n        } else if (isDate(input)) {\\n            config._d = input;\\n        } else {\\n            configFromInput(config);\\n        }\\n\\n        if (!valid__isValid(config)) {\\n            config._d = null;\\n        }\\n\\n        return config;\\n    }\\n\\n    function configFromInput(config) {\\n        var input = config._i;\\n        if (input === undefined) {\\n            config._d = new Date(utils_hooks__hooks.now());\\n        } else if (isDate(input)) {\\n            config._d = new Date(input.valueOf());\\n        } else if (typeof input === 'string') {\\n            configFromString(config);\\n        } else if (isArray(input)) {\\n            config._a = map(input.slice(0), function (obj) {\\n                return parseInt(obj, 10);\\n            });\\n            configFromArray(config);\\n        } else if (typeof(input) === 'object') {\\n            configFromObject(config);\\n        } else if (typeof(input) === 'number') {\\n            // from milliseconds\\n            config._d = new Date(input);\\n        } else {\\n            utils_hooks__hooks.createFromInputFallback(config);\\n        }\\n    }\\n\\n    function createLocalOrUTC (input, format, locale, strict, isUTC) {\\n        var c = {};\\n\\n        if (typeof(locale) === 'boolean') {\\n            strict = locale;\\n            locale = undefined;\\n        }\\n        // object construction must be done this way.\\n        // https://github.com/moment/moment/issues/1423\\n        c._isAMomentObject = true;\\n        c._useUTC = c._isUTC = isUTC;\\n        c._l = locale;\\n        c._i = input;\\n        c._f = format;\\n        c._strict = strict;\\n\\n        return createFromConfig(c);\\n    }\\n\\n    function local__createLocal (input, format, locale, strict) {\\n        return createLocalOrUTC(input, format, locale, strict, false);\\n    }\\n\\n    var prototypeMin = deprecate(\\n         'moment().min is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548',\\n         function () {\\n             var other = local__createLocal.apply(null, arguments);\\n             if (this.isValid() && other.isValid()) {\\n                 return other < this ? this : other;\\n             } else {\\n                 return valid__createInvalid();\\n             }\\n         }\\n     );\\n\\n    var prototypeMax = deprecate(\\n        'moment().max is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548',\\n        function () {\\n            var other = local__createLocal.apply(null, arguments);\\n            if (this.isValid() && other.isValid()) {\\n                return other > this ? this : other;\\n            } else {\\n                return valid__createInvalid();\\n            }\\n        }\\n    );\\n\\n    // Pick a moment m from moments so that m[fn](other) is true for all\\n    // other. This relies on the function fn to be transitive.\\n    //\\n    // moments should either be an array of moment objects or an array, whose\\n    // first element is an array of moment objects.\\n    function pickBy(fn, moments) {\\n        var res, i;\\n        if (moments.length === 1 && isArray(moments[0])) {\\n            moments = moments[0];\\n        }\\n        if (!moments.length) {\\n            return local__createLocal();\\n        }\\n        res = moments[0];\\n        for (i = 1; i < moments.length; ++i) {\\n            if (!moments[i].isValid() || moments[i][fn](res)) {\\n                res = moments[i];\\n            }\\n        }\\n        return res;\\n    }\\n\\n    // TODO: Use [].sort instead?\\n    function min () {\\n        var args = [].slice.call(arguments, 0);\\n\\n        return pickBy('isBefore', args);\\n    }\\n\\n    function max () {\\n        var args = [].slice.call(arguments, 0);\\n\\n        return pickBy('isAfter', args);\\n    }\\n\\n    var now = function () {\\n        return Date.now ? Date.now() : +(new Date());\\n    };\\n\\n    function Duration (duration) {\\n        var normalizedInput = normalizeObjectUnits(duration),\\n            years = normalizedInput.year || 0,\\n            quarters = normalizedInput.quarter || 0,\\n            months = normalizedInput.month || 0,\\n            weeks = normalizedInput.week || 0,\\n            days = normalizedInput.day || 0,\\n            hours = normalizedInput.hour || 0,\\n            minutes = normalizedInput.minute || 0,\\n            seconds = normalizedInput.second || 0,\\n            milliseconds = normalizedInput.millisecond || 0;\\n\\n        // representation for dateAddRemove\\n        this._milliseconds = +milliseconds +\\n            seconds * 1e3 + // 1000\\n            minutes * 6e4 + // 1000 * 60\\n            hours * 1000 * 60 * 60; //using 1000 * 60 * 60 instead of 36e5 to avoid floating point rounding errors https://github.com/moment/moment/issues/2978\\n        // Because of dateAddRemove treats 24 hours as different from a\\n        // day when working around DST, we need to store them separately\\n        this._days = +days +\\n            weeks * 7;\\n        // It is impossible translate months into days without knowing\\n        // which months you are are talking about, so we have to store\\n        // it separately.\\n        this._months = +months +\\n            quarters * 3 +\\n            years * 12;\\n\\n        this._data = {};\\n\\n        this._locale = locale_locales__getLocale();\\n\\n        this._bubble();\\n    }\\n\\n    function isDuration (obj) {\\n        return obj instanceof Duration;\\n    }\\n\\n    // FORMATTING\\n\\n    function offset (token, separator) {\\n        addFormatToken(token, 0, 0, function () {\\n            var offset = this.utcOffset();\\n            var sign = '+';\\n            if (offset < 0) {\\n                offset = -offset;\\n                sign = '-';\\n            }\\n            return sign + zeroFill(~~(offset / 60), 2) + separator + zeroFill(~~(offset) % 60, 2);\\n        });\\n    }\\n\\n    offset('Z', ':');\\n    offset('ZZ', '');\\n\\n    // PARSING\\n\\n    addRegexToken('Z',  matchShortOffset);\\n    addRegexToken('ZZ', matchShortOffset);\\n    addParseToken(['Z', 'ZZ'], function (input, array, config) {\\n        config._useUTC = true;\\n        config._tzm = offsetFromString(matchShortOffset, input);\\n    });\\n\\n    // HELPERS\\n\\n    // timezone chunker\\n    // '+10:00' > ['10',  '00']\\n    // '-1530'  > ['-15', '30']\\n    var chunkOffset = /([\\\\+\\\\-]|\\\\d\\\\d)/gi;\\n\\n    function offsetFromString(matcher, string) {\\n        var matches = ((string || '').match(matcher) || []);\\n        var chunk   = matches[matches.length - 1] || [];\\n        var parts   = (chunk + '').match(chunkOffset) || ['-', 0, 0];\\n        var minutes = +(parts[1] * 60) + toInt(parts[2]);\\n\\n        return parts[0] === '+' ? minutes : -minutes;\\n    }\\n\\n    // Return a moment from input, that is local/utc/zone equivalent to model.\\n    function cloneWithOffset(input, model) {\\n        var res, diff;\\n        if (model._isUTC) {\\n            res = model.clone();\\n            diff = (isMoment(input) || isDate(input) ? input.valueOf() : local__createLocal(input).valueOf()) - res.valueOf();\\n            // Use low-level api, because this fn is low-level api.\\n            res._d.setTime(res._d.valueOf() + diff);\\n            utils_hooks__hooks.updateOffset(res, false);\\n            return res;\\n        } else {\\n            return local__createLocal(input).local();\\n        }\\n    }\\n\\n    function getDateOffset (m) {\\n        // On Firefox.24 Date#getTimezoneOffset returns a floating point.\\n        // https://github.com/moment/moment/pull/1871\\n        return -Math.round(m._d.getTimezoneOffset() / 15) * 15;\\n    }\\n\\n    // HOOKS\\n\\n    // This function will be called whenever a moment is mutated.\\n    // It is intended to keep the offset in sync with the timezone.\\n    utils_hooks__hooks.updateOffset = function () {};\\n\\n    // MOMENTS\\n\\n    // keepLocalTime = true means only change the timezone, without\\n    // affecting the local hour. So 5:31:26 +0300 --[utcOffset(2, true)]-->\\n    // 5:31:26 +0200 It is possible that 5:31:26 doesn't exist with offset\\n    // +0200, so we adjust the time as needed, to be valid.\\n    //\\n    // Keeping the time actually adds/subtracts (one hour)\\n    // from the actual represented time. That is why we call updateOffset\\n    // a second time. In case it wants us to change the offset again\\n    // _changeInProgress == true case, then we have to adjust, because\\n    // there is no such time in the given timezone.\\n    function getSetOffset (input, keepLocalTime) {\\n        var offset = this._offset || 0,\\n            localAdjust;\\n        if (!this.isValid()) {\\n            return input != null ? this : NaN;\\n        }\\n        if (input != null) {\\n            if (typeof input === 'string') {\\n                input = offsetFromString(matchShortOffset, input);\\n            } else if (Math.abs(input) < 16) {\\n                input = input * 60;\\n            }\\n            if (!this._isUTC && keepLocalTime) {\\n                localAdjust = getDateOffset(this);\\n            }\\n            this._offset = input;\\n            this._isUTC = true;\\n            if (localAdjust != null) {\\n                this.add(localAdjust, 'm');\\n            }\\n            if (offset !== input) {\\n                if (!keepLocalTime || this._changeInProgress) {\\n                    add_subtract__addSubtract(this, create__createDuration(input - offset, 'm'), 1, false);\\n                } else if (!this._changeInProgress) {\\n                    this._changeInProgress = true;\\n                    utils_hooks__hooks.updateOffset(this, true);\\n                    this._changeInProgress = null;\\n                }\\n            }\\n            return this;\\n        } else {\\n            return this._isUTC ? offset : getDateOffset(this);\\n        }\\n    }\\n\\n    function getSetZone (input, keepLocalTime) {\\n        if (input != null) {\\n            if (typeof input !== 'string') {\\n                input = -input;\\n            }\\n\\n            this.utcOffset(input, keepLocalTime);\\n\\n            return this;\\n        } else {\\n            return -this.utcOffset();\\n        }\\n    }\\n\\n    function setOffsetToUTC (keepLocalTime) {\\n        return this.utcOffset(0, keepLocalTime);\\n    }\\n\\n    function setOffsetToLocal (keepLocalTime) {\\n        if (this._isUTC) {\\n            this.utcOffset(0, keepLocalTime);\\n            this._isUTC = false;\\n\\n            if (keepLocalTime) {\\n                this.subtract(getDateOffset(this), 'm');\\n            }\\n        }\\n        return this;\\n    }\\n\\n    function setOffsetToParsedOffset () {\\n        if (this._tzm) {\\n            this.utcOffset(this._tzm);\\n        } else if (typeof this._i === 'string') {\\n            this.utcOffset(offsetFromString(matchOffset, this._i));\\n        }\\n        return this;\\n    }\\n\\n    function hasAlignedHourOffset (input) {\\n        if (!this.isValid()) {\\n            return false;\\n        }\\n        input = input ? local__createLocal(input).utcOffset() : 0;\\n\\n        return (this.utcOffset() - input) % 60 === 0;\\n    }\\n\\n    function isDaylightSavingTime () {\\n        return (\\n            this.utcOffset() > this.clone().month(0).utcOffset() ||\\n            this.utcOffset() > this.clone().month(5).utcOffset()\\n        );\\n    }\\n\\n    function isDaylightSavingTimeShifted () {\\n        if (!isUndefined(this._isDSTShifted)) {\\n            return this._isDSTShifted;\\n        }\\n\\n        var c = {};\\n\\n        copyConfig(c, this);\\n        c = prepareConfig(c);\\n\\n        if (c._a) {\\n            var other = c._isUTC ? create_utc__createUTC(c._a) : local__createLocal(c._a);\\n            this._isDSTShifted = this.isValid() &&\\n                compareArrays(c._a, other.toArray()) > 0;\\n        } else {\\n            this._isDSTShifted = false;\\n        }\\n\\n        return this._isDSTShifted;\\n    }\\n\\n    function isLocal () {\\n        return this.isValid() ? !this._isUTC : false;\\n    }\\n\\n    function isUtcOffset () {\\n        return this.isValid() ? this._isUTC : false;\\n    }\\n\\n    function isUtc () {\\n        return this.isValid() ? this._isUTC && this._offset === 0 : false;\\n    }\\n\\n    // ASP.NET json date format regex\\n    var aspNetRegex = /^(\\\\-)?(?:(\\\\d*)[. ])?(\\\\d+)\\\\:(\\\\d+)(?:\\\\:(\\\\d+)\\\\.?(\\\\d{3})?\\\\d*)?$/;\\n\\n    // from http://docs.closure-library.googlecode.com/git/closure_goog_date_date.js.source.html\\n    // somewhat more in line with 4.4.3.2 2004 spec, but allows decimal anywhere\\n    // and further modified to allow for strings containing both week and day\\n    var isoRegex = /^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;\\n\\n    function create__createDuration (input, key) {\\n        var duration = input,\\n            // matching against regexp is expensive, do it on demand\\n            match = null,\\n            sign,\\n            ret,\\n            diffRes;\\n\\n        if (isDuration(input)) {\\n            duration = {\\n                ms : input._milliseconds,\\n                d  : input._days,\\n                M  : input._months\\n            };\\n        } else if (typeof input === 'number') {\\n            duration = {};\\n            if (key) {\\n                duration[key] = input;\\n            } else {\\n                duration.milliseconds = input;\\n            }\\n        } else if (!!(match = aspNetRegex.exec(input))) {\\n            sign = (match[1] === '-') ? -1 : 1;\\n            duration = {\\n                y  : 0,\\n                d  : toInt(match[DATE])        * sign,\\n                h  : toInt(match[HOUR])        * sign,\\n                m  : toInt(match[MINUTE])      * sign,\\n                s  : toInt(match[SECOND])      * sign,\\n                ms : toInt(match[MILLISECOND]) * sign\\n            };\\n        } else if (!!(match = isoRegex.exec(input))) {\\n            sign = (match[1] === '-') ? -1 : 1;\\n            duration = {\\n                y : parseIso(match[2], sign),\\n                M : parseIso(match[3], sign),\\n                w : parseIso(match[4], sign),\\n                d : parseIso(match[5], sign),\\n                h : parseIso(match[6], sign),\\n                m : parseIso(match[7], sign),\\n                s : parseIso(match[8], sign)\\n            };\\n        } else if (duration == null) {// checks for null or undefined\\n            duration = {};\\n        } else if (typeof duration === 'object' && ('from' in duration || 'to' in duration)) {\\n            diffRes = momentsDifference(local__createLocal(duration.from), local__createLocal(duration.to));\\n\\n            duration = {};\\n            duration.ms = diffRes.milliseconds;\\n            duration.M = diffRes.months;\\n        }\\n\\n        ret = new Duration(duration);\\n\\n        if (isDuration(input) && hasOwnProp(input, '_locale')) {\\n            ret._locale = input._locale;\\n        }\\n\\n        return ret;\\n    }\\n\\n    create__createDuration.fn = Duration.prototype;\\n\\n    function parseIso (inp, sign) {\\n        // We'd normally use ~~inp for this, but unfortunately it also\\n        // converts floats to ints.\\n        // inp may be undefined, so careful calling replace on it.\\n        var res = inp && parseFloat(inp.replace(',', '.'));\\n        // apply sign while we're at it\\n        return (isNaN(res) ? 0 : res) * sign;\\n    }\\n\\n    function positiveMomentsDifference(base, other) {\\n        var res = {milliseconds: 0, months: 0};\\n\\n        res.months = other.month() - base.month() +\\n            (other.year() - base.year()) * 12;\\n        if (base.clone().add(res.months, 'M').isAfter(other)) {\\n            --res.months;\\n        }\\n\\n        res.milliseconds = +other - +(base.clone().add(res.months, 'M'));\\n\\n        return res;\\n    }\\n\\n    function momentsDifference(base, other) {\\n        var res;\\n        if (!(base.isValid() && other.isValid())) {\\n            return {milliseconds: 0, months: 0};\\n        }\\n\\n        other = cloneWithOffset(other, base);\\n        if (base.isBefore(other)) {\\n            res = positiveMomentsDifference(base, other);\\n        } else {\\n            res = positiveMomentsDifference(other, base);\\n            res.milliseconds = -res.milliseconds;\\n            res.months = -res.months;\\n        }\\n\\n        return res;\\n    }\\n\\n    function absRound (number) {\\n        if (number < 0) {\\n            return Math.round(-1 * number) * -1;\\n        } else {\\n            return Math.round(number);\\n        }\\n    }\\n\\n    // TODO: remove 'name' arg after deprecation is removed\\n    function createAdder(direction, name) {\\n        return function (val, period) {\\n            var dur, tmp;\\n            //invert the arguments, but complain about it\\n            if (period !== null && !isNaN(+period)) {\\n                deprecateSimple(name, 'moment().' + name  + '(period, number) is deprecated. Please use moment().' + name + '(number, period).');\\n                tmp = val; val = period; period = tmp;\\n            }\\n\\n            val = typeof val === 'string' ? +val : val;\\n            dur = create__createDuration(val, period);\\n            add_subtract__addSubtract(this, dur, direction);\\n            return this;\\n        };\\n    }\\n\\n    function add_subtract__addSubtract (mom, duration, isAdding, updateOffset) {\\n        var milliseconds = duration._milliseconds,\\n            days = absRound(duration._days),\\n            months = absRound(duration._months);\\n\\n        if (!mom.isValid()) {\\n            // No op\\n            return;\\n        }\\n\\n        updateOffset = updateOffset == null ? true : updateOffset;\\n\\n        if (milliseconds) {\\n            mom._d.setTime(mom._d.valueOf() + milliseconds * isAdding);\\n        }\\n        if (days) {\\n            get_set__set(mom, 'Date', get_set__get(mom, 'Date') + days * isAdding);\\n        }\\n        if (months) {\\n            setMonth(mom, get_set__get(mom, 'Month') + months * isAdding);\\n        }\\n        if (updateOffset) {\\n            utils_hooks__hooks.updateOffset(mom, days || months);\\n        }\\n    }\\n\\n    var add_subtract__add      = createAdder(1, 'add');\\n    var add_subtract__subtract = createAdder(-1, 'subtract');\\n\\n    function moment_calendar__calendar (time, formats) {\\n        // We want to compare the start of today, vs this.\\n        // Getting start-of-today depends on whether we're local/utc/offset or not.\\n        var now = time || local__createLocal(),\\n            sod = cloneWithOffset(now, this).startOf('day'),\\n            diff = this.diff(sod, 'days', true),\\n            format = diff < -6 ? 'sameElse' :\\n                diff < -1 ? 'lastWeek' :\\n                diff < 0 ? 'lastDay' :\\n                diff < 1 ? 'sameDay' :\\n                diff < 2 ? 'nextDay' :\\n                diff < 7 ? 'nextWeek' : 'sameElse';\\n\\n        var output = formats && (isFunction(formats[format]) ? formats[format]() : formats[format]);\\n\\n        return this.format(output || this.localeData().calendar(format, this, local__createLocal(now)));\\n    }\\n\\n    function clone () {\\n        return new Moment(this);\\n    }\\n\\n    function isAfter (input, units) {\\n        var localInput = isMoment(input) ? input : local__createLocal(input);\\n        if (!(this.isValid() && localInput.isValid())) {\\n            return false;\\n        }\\n        units = normalizeUnits(!isUndefined(units) ? units : 'millisecond');\\n        if (units === 'millisecond') {\\n            return this.valueOf() > localInput.valueOf();\\n        } else {\\n            return localInput.valueOf() < this.clone().startOf(units).valueOf();\\n        }\\n    }\\n\\n    function isBefore (input, units) {\\n        var localInput = isMoment(input) ? input : local__createLocal(input);\\n        if (!(this.isValid() && localInput.isValid())) {\\n            return false;\\n        }\\n        units = normalizeUnits(!isUndefined(units) ? units : 'millisecond');\\n        if (units === 'millisecond') {\\n            return this.valueOf() < localInput.valueOf();\\n        } else {\\n            return this.clone().endOf(units).valueOf() < localInput.valueOf();\\n        }\\n    }\\n\\n    function isBetween (from, to, units, inclusivity) {\\n        inclusivity = inclusivity || '()';\\n        return (inclusivity[0] === '(' ? this.isAfter(from, units) : !this.isBefore(from, units)) &&\\n            (inclusivity[1] === ')' ? this.isBefore(to, units) : !this.isAfter(to, units));\\n    }\\n\\n    function isSame (input, units) {\\n        var localInput = isMoment(input) ? input : local__createLocal(input),\\n            inputMs;\\n        if (!(this.isValid() && localInput.isValid())) {\\n            return false;\\n        }\\n        units = normalizeUnits(units || 'millisecond');\\n        if (units === 'millisecond') {\\n            return this.valueOf() === localInput.valueOf();\\n        } else {\\n            inputMs = localInput.valueOf();\\n            return this.clone().startOf(units).valueOf() <= inputMs && inputMs <= this.clone().endOf(units).valueOf();\\n        }\\n    }\\n\\n    function isSameOrAfter (input, units) {\\n        return this.isSame(input, units) || this.isAfter(input,units);\\n    }\\n\\n    function isSameOrBefore (input, units) {\\n        return this.isSame(input, units) || this.isBefore(input,units);\\n    }\\n\\n    function diff (input, units, asFloat) {\\n        var that,\\n            zoneDelta,\\n            delta, output;\\n\\n        if (!this.isValid()) {\\n            return NaN;\\n        }\\n\\n        that = cloneWithOffset(input, this);\\n\\n        if (!that.isValid()) {\\n            return NaN;\\n        }\\n\\n        zoneDelta = (that.utcOffset() - this.utcOffset()) * 6e4;\\n\\n        units = normalizeUnits(units);\\n\\n        if (units === 'year' || units === 'month' || units === 'quarter') {\\n            output = monthDiff(this, that);\\n            if (units === 'quarter') {\\n                output = output / 3;\\n            } else if (units === 'year') {\\n                output = output / 12;\\n            }\\n        } else {\\n            delta = this - that;\\n            output = units === 'second' ? delta / 1e3 : // 1000\\n                units === 'minute' ? delta / 6e4 : // 1000 * 60\\n                units === 'hour' ? delta / 36e5 : // 1000 * 60 * 60\\n                units === 'day' ? (delta - zoneDelta) / 864e5 : // 1000 * 60 * 60 * 24, negate dst\\n                units === 'week' ? (delta - zoneDelta) / 6048e5 : // 1000 * 60 * 60 * 24 * 7, negate dst\\n                delta;\\n        }\\n        return asFloat ? output : absFloor(output);\\n    }\\n\\n    function monthDiff (a, b) {\\n        // difference in months\\n        var wholeMonthDiff = ((b.year() - a.year()) * 12) + (b.month() - a.month()),\\n            // b is in (anchor - 1 month, anchor + 1 month)\\n            anchor = a.clone().add(wholeMonthDiff, 'months'),\\n            anchor2, adjust;\\n\\n        if (b - anchor < 0) {\\n            anchor2 = a.clone().add(wholeMonthDiff - 1, 'months');\\n            // linear across the month\\n            adjust = (b - anchor) / (anchor - anchor2);\\n        } else {\\n            anchor2 = a.clone().add(wholeMonthDiff + 1, 'months');\\n            // linear across the month\\n            adjust = (b - anchor) / (anchor2 - anchor);\\n        }\\n\\n        //check for negative zero, return zero if negative zero\\n        return -(wholeMonthDiff + adjust) || 0;\\n    }\\n\\n    utils_hooks__hooks.defaultFormat = 'YYYY-MM-DDTHH:mm:ssZ';\\n    utils_hooks__hooks.defaultFormatUtc = 'YYYY-MM-DDTHH:mm:ss[Z]';\\n\\n    function toString () {\\n        return this.clone().locale('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ');\\n    }\\n\\n    function moment_format__toISOString () {\\n        var m = this.clone().utc();\\n        if (0 < m.year() && m.year() <= 9999) {\\n            if (isFunction(Date.prototype.toISOString)) {\\n                // native implementation is ~50x faster, use it when we can\\n                return this.toDate().toISOString();\\n            } else {\\n                return formatMoment(m, 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]');\\n            }\\n        } else {\\n            return formatMoment(m, 'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]');\\n        }\\n    }\\n\\n    function format (inputString) {\\n        if (!inputString) {\\n            inputString = this.isUtc() ? utils_hooks__hooks.defaultFormatUtc : utils_hooks__hooks.defaultFormat;\\n        }\\n        var output = formatMoment(this, inputString);\\n        return this.localeData().postformat(output);\\n    }\\n\\n    function from (time, withoutSuffix) {\\n        if (this.isValid() &&\\n                ((isMoment(time) && time.isValid()) ||\\n                 local__createLocal(time).isValid())) {\\n            return create__createDuration({to: this, from: time}).locale(this.locale()).humanize(!withoutSuffix);\\n        } else {\\n            return this.localeData().invalidDate();\\n        }\\n    }\\n\\n    function fromNow (withoutSuffix) {\\n        return this.from(local__createLocal(), withoutSuffix);\\n    }\\n\\n    function to (time, withoutSuffix) {\\n        if (this.isValid() &&\\n                ((isMoment(time) && time.isValid()) ||\\n                 local__createLocal(time).isValid())) {\\n            return create__createDuration({from: this, to: time}).locale(this.locale()).humanize(!withoutSuffix);\\n        } else {\\n            return this.localeData().invalidDate();\\n        }\\n    }\\n\\n    function toNow (withoutSuffix) {\\n        return this.to(local__createLocal(), withoutSuffix);\\n    }\\n\\n    // If passed a locale key, it will set the locale for this\\n    // instance.  Otherwise, it will return the locale configuration\\n    // variables for this instance.\\n    function locale (key) {\\n        var newLocaleData;\\n\\n        if (key === undefined) {\\n            return this._locale._abbr;\\n        } else {\\n            newLocaleData = locale_locales__getLocale(key);\\n            if (newLocaleData != null) {\\n                this._locale = newLocaleData;\\n            }\\n            return this;\\n        }\\n    }\\n\\n    var lang = deprecate(\\n        'moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.',\\n        function (key) {\\n            if (key === undefined) {\\n                return this.localeData();\\n            } else {\\n                return this.locale(key);\\n            }\\n        }\\n    );\\n\\n    function localeData () {\\n        return this._locale;\\n    }\\n\\n    function startOf (units) {\\n        units = normalizeUnits(units);\\n        // the following switch intentionally omits break keywords\\n        // to utilize falling through the cases.\\n        switch (units) {\\n        case 'year':\\n            this.month(0);\\n            /* falls through */\\n        case 'quarter':\\n        case 'month':\\n            this.date(1);\\n            /* falls through */\\n        case 'week':\\n        case 'isoWeek':\\n        case 'day':\\n        case 'date':\\n            this.hours(0);\\n            /* falls through */\\n        case 'hour':\\n            this.minutes(0);\\n            /* falls through */\\n        case 'minute':\\n            this.seconds(0);\\n            /* falls through */\\n        case 'second':\\n            this.milliseconds(0);\\n        }\\n\\n        // weeks are a special case\\n        if (units === 'week') {\\n            this.weekday(0);\\n        }\\n        if (units === 'isoWeek') {\\n            this.isoWeekday(1);\\n        }\\n\\n        // quarters are also special\\n        if (units === 'quarter') {\\n            this.month(Math.floor(this.month() / 3) * 3);\\n        }\\n\\n        return this;\\n    }\\n\\n    function endOf (units) {\\n        units = normalizeUnits(units);\\n        if (units === undefined || units === 'millisecond') {\\n            return this;\\n        }\\n\\n        // 'date' is an alias for 'day', so it should be considered as such.\\n        if (units === 'date') {\\n            units = 'day';\\n        }\\n\\n        return this.startOf(units).add(1, (units === 'isoWeek' ? 'week' : units)).subtract(1, 'ms');\\n    }\\n\\n    function to_type__valueOf () {\\n        return this._d.valueOf() - ((this._offset || 0) * 60000);\\n    }\\n\\n    function unix () {\\n        return Math.floor(this.valueOf() / 1000);\\n    }\\n\\n    function toDate () {\\n        return this._offset ? new Date(this.valueOf()) : this._d;\\n    }\\n\\n    function toArray () {\\n        var m = this;\\n        return [m.year(), m.month(), m.date(), m.hour(), m.minute(), m.second(), m.millisecond()];\\n    }\\n\\n    function toObject () {\\n        var m = this;\\n        return {\\n            years: m.year(),\\n            months: m.month(),\\n            date: m.date(),\\n            hours: m.hours(),\\n            minutes: m.minutes(),\\n            seconds: m.seconds(),\\n            milliseconds: m.milliseconds()\\n        };\\n    }\\n\\n    function toJSON () {\\n        // new Date(NaN).toJSON() === null\\n        return this.isValid() ? this.toISOString() : null;\\n    }\\n\\n    function moment_valid__isValid () {\\n        return valid__isValid(this);\\n    }\\n\\n    function parsingFlags () {\\n        return extend({}, getParsingFlags(this));\\n    }\\n\\n    function invalidAt () {\\n        return getParsingFlags(this).overflow;\\n    }\\n\\n    function creationData() {\\n        return {\\n            input: this._i,\\n            format: this._f,\\n            locale: this._locale,\\n            isUTC: this._isUTC,\\n            strict: this._strict\\n        };\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken(0, ['gg', 2], 0, function () {\\n        return this.weekYear() % 100;\\n    });\\n\\n    addFormatToken(0, ['GG', 2], 0, function () {\\n        return this.isoWeekYear() % 100;\\n    });\\n\\n    function addWeekYearFormatToken (token, getter) {\\n        addFormatToken(0, [token, token.length], 0, getter);\\n    }\\n\\n    addWeekYearFormatToken('gggg',     'weekYear');\\n    addWeekYearFormatToken('ggggg',    'weekYear');\\n    addWeekYearFormatToken('GGGG',  'isoWeekYear');\\n    addWeekYearFormatToken('GGGGG', 'isoWeekYear');\\n\\n    // ALIASES\\n\\n    addUnitAlias('weekYear', 'gg');\\n    addUnitAlias('isoWeekYear', 'GG');\\n\\n    // PARSING\\n\\n    addRegexToken('G',      matchSigned);\\n    addRegexToken('g',      matchSigned);\\n    addRegexToken('GG',     match1to2, match2);\\n    addRegexToken('gg',     match1to2, match2);\\n    addRegexToken('GGGG',   match1to4, match4);\\n    addRegexToken('gggg',   match1to4, match4);\\n    addRegexToken('GGGGG',  match1to6, match6);\\n    addRegexToken('ggggg',  match1to6, match6);\\n\\n    addWeekParseToken(['gggg', 'ggggg', 'GGGG', 'GGGGG'], function (input, week, config, token) {\\n        week[token.substr(0, 2)] = toInt(input);\\n    });\\n\\n    addWeekParseToken(['gg', 'GG'], function (input, week, config, token) {\\n        week[token] = utils_hooks__hooks.parseTwoDigitYear(input);\\n    });\\n\\n    // MOMENTS\\n\\n    function getSetWeekYear (input) {\\n        return getSetWeekYearHelper.call(this,\\n                input,\\n                this.week(),\\n                this.weekday(),\\n                this.localeData()._week.dow,\\n                this.localeData()._week.doy);\\n    }\\n\\n    function getSetISOWeekYear (input) {\\n        return getSetWeekYearHelper.call(this,\\n                input, this.isoWeek(), this.isoWeekday(), 1, 4);\\n    }\\n\\n    function getISOWeeksInYear () {\\n        return weeksInYear(this.year(), 1, 4);\\n    }\\n\\n    function getWeeksInYear () {\\n        var weekInfo = this.localeData()._week;\\n        return weeksInYear(this.year(), weekInfo.dow, weekInfo.doy);\\n    }\\n\\n    function getSetWeekYearHelper(input, week, weekday, dow, doy) {\\n        var weeksTarget;\\n        if (input == null) {\\n            return weekOfYear(this, dow, doy).year;\\n        } else {\\n            weeksTarget = weeksInYear(input, dow, doy);\\n            if (week > weeksTarget) {\\n                week = weeksTarget;\\n            }\\n            return setWeekAll.call(this, input, week, weekday, dow, doy);\\n        }\\n    }\\n\\n    function setWeekAll(weekYear, week, weekday, dow, doy) {\\n        var dayOfYearData = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy),\\n            date = createUTCDate(dayOfYearData.year, 0, dayOfYearData.dayOfYear);\\n\\n        this.year(date.getUTCFullYear());\\n        this.month(date.getUTCMonth());\\n        this.date(date.getUTCDate());\\n        return this;\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('Q', 0, 'Qo', 'quarter');\\n\\n    // ALIASES\\n\\n    addUnitAlias('quarter', 'Q');\\n\\n    // PARSING\\n\\n    addRegexToken('Q', match1);\\n    addParseToken('Q', function (input, array) {\\n        array[MONTH] = (toInt(input) - 1) * 3;\\n    });\\n\\n    // MOMENTS\\n\\n    function getSetQuarter (input) {\\n        return input == null ? Math.ceil((this.month() + 1) / 3) : this.month((input - 1) * 3 + this.month() % 3);\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('w', ['ww', 2], 'wo', 'week');\\n    addFormatToken('W', ['WW', 2], 'Wo', 'isoWeek');\\n\\n    // ALIASES\\n\\n    addUnitAlias('week', 'w');\\n    addUnitAlias('isoWeek', 'W');\\n\\n    // PARSING\\n\\n    addRegexToken('w',  match1to2);\\n    addRegexToken('ww', match1to2, match2);\\n    addRegexToken('W',  match1to2);\\n    addRegexToken('WW', match1to2, match2);\\n\\n    addWeekParseToken(['w', 'ww', 'W', 'WW'], function (input, week, config, token) {\\n        week[token.substr(0, 1)] = toInt(input);\\n    });\\n\\n    // HELPERS\\n\\n    // LOCALES\\n\\n    function localeWeek (mom) {\\n        return weekOfYear(mom, this._week.dow, this._week.doy).week;\\n    }\\n\\n    var defaultLocaleWeek = {\\n        dow : 0, // Sunday is the first day of the week.\\n        doy : 6  // The week that contains Jan 1st is the first week of the year.\\n    };\\n\\n    function localeFirstDayOfWeek () {\\n        return this._week.dow;\\n    }\\n\\n    function localeFirstDayOfYear () {\\n        return this._week.doy;\\n    }\\n\\n    // MOMENTS\\n\\n    function getSetWeek (input) {\\n        var week = this.localeData().week(this);\\n        return input == null ? week : this.add((input - week) * 7, 'd');\\n    }\\n\\n    function getSetISOWeek (input) {\\n        var week = weekOfYear(this, 1, 4).week;\\n        return input == null ? week : this.add((input - week) * 7, 'd');\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('D', ['DD', 2], 'Do', 'date');\\n\\n    // ALIASES\\n\\n    addUnitAlias('date', 'D');\\n\\n    // PARSING\\n\\n    addRegexToken('D',  match1to2);\\n    addRegexToken('DD', match1to2, match2);\\n    addRegexToken('Do', function (isStrict, locale) {\\n        return isStrict ? locale._ordinalParse : locale._ordinalParseLenient;\\n    });\\n\\n    addParseToken(['D', 'DD'], DATE);\\n    addParseToken('Do', function (input, array) {\\n        array[DATE] = toInt(input.match(match1to2)[0], 10);\\n    });\\n\\n    // MOMENTS\\n\\n    var getSetDayOfMonth = makeGetSet('Date', true);\\n\\n    // FORMATTING\\n\\n    addFormatToken('d', 0, 'do', 'day');\\n\\n    addFormatToken('dd', 0, 0, function (format) {\\n        return this.localeData().weekdaysMin(this, format);\\n    });\\n\\n    addFormatToken('ddd', 0, 0, function (format) {\\n        return this.localeData().weekdaysShort(this, format);\\n    });\\n\\n    addFormatToken('dddd', 0, 0, function (format) {\\n        return this.localeData().weekdays(this, format);\\n    });\\n\\n    addFormatToken('e', 0, 0, 'weekday');\\n    addFormatToken('E', 0, 0, 'isoWeekday');\\n\\n    // ALIASES\\n\\n    addUnitAlias('day', 'd');\\n    addUnitAlias('weekday', 'e');\\n    addUnitAlias('isoWeekday', 'E');\\n\\n    // PARSING\\n\\n    addRegexToken('d',    match1to2);\\n    addRegexToken('e',    match1to2);\\n    addRegexToken('E',    match1to2);\\n    addRegexToken('dd',   function (isStrict, locale) {\\n        return locale.weekdaysMinRegex(isStrict);\\n    });\\n    addRegexToken('ddd',   function (isStrict, locale) {\\n        return locale.weekdaysShortRegex(isStrict);\\n    });\\n    addRegexToken('dddd',   function (isStrict, locale) {\\n        return locale.weekdaysRegex(isStrict);\\n    });\\n\\n    addWeekParseToken(['dd', 'ddd', 'dddd'], function (input, week, config, token) {\\n        var weekday = config._locale.weekdaysParse(input, token, config._strict);\\n        // if we didn't get a weekday name, mark the date as invalid\\n        if (weekday != null) {\\n            week.d = weekday;\\n        } else {\\n            getParsingFlags(config).invalidWeekday = input;\\n        }\\n    });\\n\\n    addWeekParseToken(['d', 'e', 'E'], function (input, week, config, token) {\\n        week[token] = toInt(input);\\n    });\\n\\n    // HELPERS\\n\\n    function parseWeekday(input, locale) {\\n        if (typeof input !== 'string') {\\n            return input;\\n        }\\n\\n        if (!isNaN(input)) {\\n            return parseInt(input, 10);\\n        }\\n\\n        input = locale.weekdaysParse(input);\\n        if (typeof input === 'number') {\\n            return input;\\n        }\\n\\n        return null;\\n    }\\n\\n    // LOCALES\\n\\n    var defaultLocaleWeekdays = 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_');\\n    function localeWeekdays (m, format) {\\n        return isArray(this._weekdays) ? this._weekdays[m.day()] :\\n            this._weekdays[this._weekdays.isFormat.test(format) ? 'format' : 'standalone'][m.day()];\\n    }\\n\\n    var defaultLocaleWeekdaysShort = 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_');\\n    function localeWeekdaysShort (m) {\\n        return this._weekdaysShort[m.day()];\\n    }\\n\\n    var defaultLocaleWeekdaysMin = 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_');\\n    function localeWeekdaysMin (m) {\\n        return this._weekdaysMin[m.day()];\\n    }\\n\\n    function day_of_week__handleStrictParse(weekdayName, format, strict) {\\n        var i, ii, mom, llc = weekdayName.toLocaleLowerCase();\\n        if (!this._weekdaysParse) {\\n            this._weekdaysParse = [];\\n            this._shortWeekdaysParse = [];\\n            this._minWeekdaysParse = [];\\n\\n            for (i = 0; i < 7; ++i) {\\n                mom = create_utc__createUTC([2000, 1]).day(i);\\n                this._minWeekdaysParse[i] = this.weekdaysMin(mom, '').toLocaleLowerCase();\\n                this._shortWeekdaysParse[i] = this.weekdaysShort(mom, '').toLocaleLowerCase();\\n                this._weekdaysParse[i] = this.weekdays(mom, '').toLocaleLowerCase();\\n            }\\n        }\\n\\n        if (strict) {\\n            if (format === 'dddd') {\\n                ii = indexOf.call(this._weekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else if (format === 'ddd') {\\n                ii = indexOf.call(this._shortWeekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else {\\n                ii = indexOf.call(this._minWeekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            }\\n        } else {\\n            if (format === 'dddd') {\\n                ii = indexOf.call(this._weekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._shortWeekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._minWeekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else if (format === 'ddd') {\\n                ii = indexOf.call(this._shortWeekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._weekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._minWeekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else {\\n                ii = indexOf.call(this._minWeekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._weekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._shortWeekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            }\\n        }\\n    }\\n\\n    function localeWeekdaysParse (weekdayName, format, strict) {\\n        var i, mom, regex;\\n\\n        if (this._weekdaysParseExact) {\\n            return day_of_week__handleStrictParse.call(this, weekdayName, format, strict);\\n        }\\n\\n        if (!this._weekdaysParse) {\\n            this._weekdaysParse = [];\\n            this._minWeekdaysParse = [];\\n            this._shortWeekdaysParse = [];\\n            this._fullWeekdaysParse = [];\\n        }\\n\\n        for (i = 0; i < 7; i++) {\\n            // make the regex if we don't have it already\\n\\n            mom = create_utc__createUTC([2000, 1]).day(i);\\n            if (strict && !this._fullWeekdaysParse[i]) {\\n                this._fullWeekdaysParse[i] = new RegExp('^' + this.weekdays(mom, '').replace('.', '\\\\.?') + '$', 'i');\\n                this._shortWeekdaysParse[i] = new RegExp('^' + this.weekdaysShort(mom, '').replace('.', '\\\\.?') + '$', 'i');\\n                this._minWeekdaysParse[i] = new RegExp('^' + this.weekdaysMin(mom, '').replace('.', '\\\\.?') + '$', 'i');\\n            }\\n            if (!this._weekdaysParse[i]) {\\n                regex = '^' + this.weekdays(mom, '') + '|^' + this.weekdaysShort(mom, '') + '|^' + this.weekdaysMin(mom, '');\\n                this._weekdaysParse[i] = new RegExp(regex.replace('.', ''), 'i');\\n            }\\n            // test the regex\\n            if (strict && format === 'dddd' && this._fullWeekdaysParse[i].test(weekdayName)) {\\n                return i;\\n            } else if (strict && format === 'ddd' && this._shortWeekdaysParse[i].test(weekdayName)) {\\n                return i;\\n            } else if (strict && format === 'dd' && this._minWeekdaysParse[i].test(weekdayName)) {\\n                return i;\\n            } else if (!strict && this._weekdaysParse[i].test(weekdayName)) {\\n                return i;\\n            }\\n        }\\n    }\\n\\n    // MOMENTS\\n\\n    function getSetDayOfWeek (input) {\\n        if (!this.isValid()) {\\n            return input != null ? this : NaN;\\n        }\\n        var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();\\n        if (input != null) {\\n            input = parseWeekday(input, this.localeData());\\n            return this.add(input - day, 'd');\\n        } else {\\n            return day;\\n        }\\n    }\\n\\n    function getSetLocaleDayOfWeek (input) {\\n        if (!this.isValid()) {\\n            return input != null ? this : NaN;\\n        }\\n        var weekday = (this.day() + 7 - this.localeData()._week.dow) % 7;\\n        return input == null ? weekday : this.add(input - weekday, 'd');\\n    }\\n\\n    function getSetISODayOfWeek (input) {\\n        if (!this.isValid()) {\\n            return input != null ? this : NaN;\\n        }\\n        // behaves the same as moment#day except\\n        // as a getter, returns 7 instead of 0 (1-7 range instead of 0-6)\\n        // as a setter, sunday should belong to the previous week.\\n        return input == null ? this.day() || 7 : this.day(this.day() % 7 ? input : input - 7);\\n    }\\n\\n    var defaultWeekdaysRegex = matchWord;\\n    function weekdaysRegex (isStrict) {\\n        if (this._weekdaysParseExact) {\\n            if (!hasOwnProp(this, '_weekdaysRegex')) {\\n                computeWeekdaysParse.call(this);\\n            }\\n            if (isStrict) {\\n                return this._weekdaysStrictRegex;\\n            } else {\\n                return this._weekdaysRegex;\\n            }\\n        } else {\\n            return this._weekdaysStrictRegex && isStrict ?\\n                this._weekdaysStrictRegex : this._weekdaysRegex;\\n        }\\n    }\\n\\n    var defaultWeekdaysShortRegex = matchWord;\\n    function weekdaysShortRegex (isStrict) {\\n        if (this._weekdaysParseExact) {\\n            if (!hasOwnProp(this, '_weekdaysRegex')) {\\n                computeWeekdaysParse.call(this);\\n            }\\n            if (isStrict) {\\n                return this._weekdaysShortStrictRegex;\\n            } else {\\n                return this._weekdaysShortRegex;\\n            }\\n        } else {\\n            return this._weekdaysShortStrictRegex && isStrict ?\\n                this._weekdaysShortStrictRegex : this._weekdaysShortRegex;\\n        }\\n    }\\n\\n    var defaultWeekdaysMinRegex = matchWord;\\n    function weekdaysMinRegex (isStrict) {\\n        if (this._weekdaysParseExact) {\\n            if (!hasOwnProp(this, '_weekdaysRegex')) {\\n                computeWeekdaysParse.call(this);\\n            }\\n            if (isStrict) {\\n                return this._weekdaysMinStrictRegex;\\n            } else {\\n                return this._weekdaysMinRegex;\\n            }\\n        } else {\\n            return this._weekdaysMinStrictRegex && isStrict ?\\n                this._weekdaysMinStrictRegex : this._weekdaysMinRegex;\\n        }\\n    }\\n\\n\\n    function computeWeekdaysParse () {\\n        function cmpLenRev(a, b) {\\n            return b.length - a.length;\\n        }\\n\\n        var minPieces = [], shortPieces = [], longPieces = [], mixedPieces = [],\\n            i, mom, minp, shortp, longp;\\n        for (i = 0; i < 7; i++) {\\n            // make the regex if we don't have it already\\n            mom = create_utc__createUTC([2000, 1]).day(i);\\n            minp = this.weekdaysMin(mom, '');\\n            shortp = this.weekdaysShort(mom, '');\\n            longp = this.weekdays(mom, '');\\n            minPieces.push(minp);\\n            shortPieces.push(shortp);\\n            longPieces.push(longp);\\n            mixedPieces.push(minp);\\n            mixedPieces.push(shortp);\\n            mixedPieces.push(longp);\\n        }\\n        // Sorting makes sure if one weekday (or abbr) is a prefix of another it\\n        // will match the longer piece.\\n        minPieces.sort(cmpLenRev);\\n        shortPieces.sort(cmpLenRev);\\n        longPieces.sort(cmpLenRev);\\n        mixedPieces.sort(cmpLenRev);\\n        for (i = 0; i < 7; i++) {\\n            shortPieces[i] = regexEscape(shortPieces[i]);\\n            longPieces[i] = regexEscape(longPieces[i]);\\n            mixedPieces[i] = regexEscape(mixedPieces[i]);\\n        }\\n\\n        this._weekdaysRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');\\n        this._weekdaysShortRegex = this._weekdaysRegex;\\n        this._weekdaysMinRegex = this._weekdaysRegex;\\n\\n        this._weekdaysStrictRegex = new RegExp('^(' + longPieces.join('|') + ')', 'i');\\n        this._weekdaysShortStrictRegex = new RegExp('^(' + shortPieces.join('|') + ')', 'i');\\n        this._weekdaysMinStrictRegex = new RegExp('^(' + minPieces.join('|') + ')', 'i');\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('DDD', ['DDDD', 3], 'DDDo', 'dayOfYear');\\n\\n    // ALIASES\\n\\n    addUnitAlias('dayOfYear', 'DDD');\\n\\n    // PARSING\\n\\n    addRegexToken('DDD',  match1to3);\\n    addRegexToken('DDDD', match3);\\n    addParseToken(['DDD', 'DDDD'], function (input, array, config) {\\n        config._dayOfYear = toInt(input);\\n    });\\n\\n    // HELPERS\\n\\n    // MOMENTS\\n\\n    function getSetDayOfYear (input) {\\n        var dayOfYear = Math.round((this.clone().startOf('day') - this.clone().startOf('year')) / 864e5) + 1;\\n        return input == null ? dayOfYear : this.add((input - dayOfYear), 'd');\\n    }\\n\\n    // FORMATTING\\n\\n    function hFormat() {\\n        return this.hours() % 12 || 12;\\n    }\\n\\n    function kFormat() {\\n        return this.hours() || 24;\\n    }\\n\\n    addFormatToken('H', ['HH', 2], 0, 'hour');\\n    addFormatToken('h', ['hh', 2], 0, hFormat);\\n    addFormatToken('k', ['kk', 2], 0, kFormat);\\n\\n    addFormatToken('hmm', 0, 0, function () {\\n        return '' + hFormat.apply(this) + zeroFill(this.minutes(), 2);\\n    });\\n\\n    addFormatToken('hmmss', 0, 0, function () {\\n        return '' + hFormat.apply(this) + zeroFill(this.minutes(), 2) +\\n            zeroFill(this.seconds(), 2);\\n    });\\n\\n    addFormatToken('Hmm', 0, 0, function () {\\n        return '' + this.hours() + zeroFill(this.minutes(), 2);\\n    });\\n\\n    addFormatToken('Hmmss', 0, 0, function () {\\n        return '' + this.hours() + zeroFill(this.minutes(), 2) +\\n            zeroFill(this.seconds(), 2);\\n    });\\n\\n    function meridiem (token, lowercase) {\\n        addFormatToken(token, 0, 0, function () {\\n            return this.localeData().meridiem(this.hours(), this.minutes(), lowercase);\\n        });\\n    }\\n\\n    meridiem('a', true);\\n    meridiem('A', false);\\n\\n    // ALIASES\\n\\n    addUnitAlias('hour', 'h');\\n\\n    // PARSING\\n\\n    function matchMeridiem (isStrict, locale) {\\n        return locale._meridiemParse;\\n    }\\n\\n    addRegexToken('a',  matchMeridiem);\\n    addRegexToken('A',  matchMeridiem);\\n    addRegexToken('H',  match1to2);\\n    addRegexToken('h',  match1to2);\\n    addRegexToken('HH', match1to2, match2);\\n    addRegexToken('hh', match1to2, match2);\\n\\n    addRegexToken('hmm', match3to4);\\n    addRegexToken('hmmss', match5to6);\\n    addRegexToken('Hmm', match3to4);\\n    addRegexToken('Hmmss', match5to6);\\n\\n    addParseToken(['H', 'HH'], HOUR);\\n    addParseToken(['a', 'A'], function (input, array, config) {\\n        config._isPm = config._locale.isPM(input);\\n        config._meridiem = input;\\n    });\\n    addParseToken(['h', 'hh'], function (input, array, config) {\\n        array[HOUR] = toInt(input);\\n        getParsingFlags(config).bigHour = true;\\n    });\\n    addParseToken('hmm', function (input, array, config) {\\n        var pos = input.length - 2;\\n        array[HOUR] = toInt(input.substr(0, pos));\\n        array[MINUTE] = toInt(input.substr(pos));\\n        getParsingFlags(config).bigHour = true;\\n    });\\n    addParseToken('hmmss', function (input, array, config) {\\n        var pos1 = input.length - 4;\\n        var pos2 = input.length - 2;\\n        array[HOUR] = toInt(input.substr(0, pos1));\\n        array[MINUTE] = toInt(input.substr(pos1, 2));\\n        array[SECOND] = toInt(input.substr(pos2));\\n        getParsingFlags(config).bigHour = true;\\n    });\\n    addParseToken('Hmm', function (input, array, config) {\\n        var pos = input.length - 2;\\n        array[HOUR] = toInt(input.substr(0, pos));\\n        array[MINUTE] = toInt(input.substr(pos));\\n    });\\n    addParseToken('Hmmss', function (input, array, config) {\\n        var pos1 = input.length - 4;\\n        var pos2 = input.length - 2;\\n        array[HOUR] = toInt(input.substr(0, pos1));\\n        array[MINUTE] = toInt(input.substr(pos1, 2));\\n        array[SECOND] = toInt(input.substr(pos2));\\n    });\\n\\n    // LOCALES\\n\\n    function localeIsPM (input) {\\n        // IE8 Quirks Mode & IE7 Standards Mode do not allow accessing strings like arrays\\n        // Using charAt should be more compatible.\\n        return ((input + '').toLowerCase().charAt(0) === 'p');\\n    }\\n\\n    var defaultLocaleMeridiemParse = /[ap]\\\\.?m?\\\\.?/i;\\n    function localeMeridiem (hours, minutes, isLower) {\\n        if (hours > 11) {\\n            return isLower ? 'pm' : 'PM';\\n        } else {\\n            return isLower ? 'am' : 'AM';\\n        }\\n    }\\n\\n\\n    // MOMENTS\\n\\n    // Setting the hour should keep the time, because the user explicitly\\n    // specified which hour he wants. So trying to maintain the same hour (in\\n    // a new timezone) makes sense. Adding/subtracting hours does not follow\\n    // this rule.\\n    var getSetHour = makeGetSet('Hours', true);\\n\\n    // FORMATTING\\n\\n    addFormatToken('m', ['mm', 2], 0, 'minute');\\n\\n    // ALIASES\\n\\n    addUnitAlias('minute', 'm');\\n\\n    // PARSING\\n\\n    addRegexToken('m',  match1to2);\\n    addRegexToken('mm', match1to2, match2);\\n    addParseToken(['m', 'mm'], MINUTE);\\n\\n    // MOMENTS\\n\\n    var getSetMinute = makeGetSet('Minutes', false);\\n\\n    // FORMATTING\\n\\n    addFormatToken('s', ['ss', 2], 0, 'second');\\n\\n    // ALIASES\\n\\n    addUnitAlias('second', 's');\\n\\n    // PARSING\\n\\n    addRegexToken('s',  match1to2);\\n    addRegexToken('ss', match1to2, match2);\\n    addParseToken(['s', 'ss'], SECOND);\\n\\n    // MOMENTS\\n\\n    var getSetSecond = makeGetSet('Seconds', false);\\n\\n    // FORMATTING\\n\\n    addFormatToken('S', 0, 0, function () {\\n        return ~~(this.millisecond() / 100);\\n    });\\n\\n    addFormatToken(0, ['SS', 2], 0, function () {\\n        return ~~(this.millisecond() / 10);\\n    });\\n\\n    addFormatToken(0, ['SSS', 3], 0, 'millisecond');\\n    addFormatToken(0, ['SSSS', 4], 0, function () {\\n        return this.millisecond() * 10;\\n    });\\n    addFormatToken(0, ['SSSSS', 5], 0, function () {\\n        return this.millisecond() * 100;\\n    });\\n    addFormatToken(0, ['SSSSSS', 6], 0, function () {\\n        return this.millisecond() * 1000;\\n    });\\n    addFormatToken(0, ['SSSSSSS', 7], 0, function () {\\n        return this.millisecond() * 10000;\\n    });\\n    addFormatToken(0, ['SSSSSSSS', 8], 0, function () {\\n        return this.millisecond() * 100000;\\n    });\\n    addFormatToken(0, ['SSSSSSSSS', 9], 0, function () {\\n        return this.millisecond() * 1000000;\\n    });\\n\\n\\n    // ALIASES\\n\\n    addUnitAlias('millisecond', 'ms');\\n\\n    // PARSING\\n\\n    addRegexToken('S',    match1to3, match1);\\n    addRegexToken('SS',   match1to3, match2);\\n    addRegexToken('SSS',  match1to3, match3);\\n\\n    var token;\\n    for (token = 'SSSS'; token.length <= 9; token += 'S') {\\n        addRegexToken(token, matchUnsigned);\\n    }\\n\\n    function parseMs(input, array) {\\n        array[MILLISECOND] = toInt(('0.' + input) * 1000);\\n    }\\n\\n    for (token = 'S'; token.length <= 9; token += 'S') {\\n        addParseToken(token, parseMs);\\n    }\\n    // MOMENTS\\n\\n    var getSetMillisecond = makeGetSet('Milliseconds', false);\\n\\n    // FORMATTING\\n\\n    addFormatToken('z',  0, 0, 'zoneAbbr');\\n    addFormatToken('zz', 0, 0, 'zoneName');\\n\\n    // MOMENTS\\n\\n    function getZoneAbbr () {\\n        return this._isUTC ? 'UTC' : '';\\n    }\\n\\n    function getZoneName () {\\n        return this._isUTC ? 'Coordinated Universal Time' : '';\\n    }\\n\\n    var momentPrototype__proto = Moment.prototype;\\n\\n    momentPrototype__proto.add               = add_subtract__add;\\n    momentPrototype__proto.calendar          = moment_calendar__calendar;\\n    momentPrototype__proto.clone             = clone;\\n    momentPrototype__proto.diff              = diff;\\n    momentPrototype__proto.endOf             = endOf;\\n    momentPrototype__proto.format            = format;\\n    momentPrototype__proto.from              = from;\\n    momentPrototype__proto.fromNow           = fromNow;\\n    momentPrototype__proto.to                = to;\\n    momentPrototype__proto.toNow             = toNow;\\n    momentPrototype__proto.get               = getSet;\\n    momentPrototype__proto.invalidAt         = invalidAt;\\n    momentPrototype__proto.isAfter           = isAfter;\\n    momentPrototype__proto.isBefore          = isBefore;\\n    momentPrototype__proto.isBetween         = isBetween;\\n    momentPrototype__proto.isSame            = isSame;\\n    momentPrototype__proto.isSameOrAfter     = isSameOrAfter;\\n    momentPrototype__proto.isSameOrBefore    = isSameOrBefore;\\n    momentPrototype__proto.isValid           = moment_valid__isValid;\\n    momentPrototype__proto.lang              = lang;\\n    momentPrototype__proto.locale            = locale;\\n    momentPrototype__proto.localeData        = localeData;\\n    momentPrototype__proto.max               = prototypeMax;\\n    momentPrototype__proto.min               = prototypeMin;\\n    momentPrototype__proto.parsingFlags      = parsingFlags;\\n    momentPrototype__proto.set               = getSet;\\n    momentPrototype__proto.startOf           = startOf;\\n    momentPrototype__proto.subtract          = add_subtract__subtract;\\n    momentPrototype__proto.toArray           = toArray;\\n    momentPrototype__proto.toObject          = toObject;\\n    momentPrototype__proto.toDate            = toDate;\\n    momentPrototype__proto.toISOString       = moment_format__toISOString;\\n    momentPrototype__proto.toJSON            = toJSON;\\n    momentPrototype__proto.toString          = toString;\\n    momentPrototype__proto.unix              = unix;\\n    momentPrototype__proto.valueOf           = to_type__valueOf;\\n    momentPrototype__proto.creationData      = creationData;\\n\\n    // Year\\n    momentPrototype__proto.year       = getSetYear;\\n    momentPrototype__proto.isLeapYear = getIsLeapYear;\\n\\n    // Week Year\\n    momentPrototype__proto.weekYear    = getSetWeekYear;\\n    momentPrototype__proto.isoWeekYear = getSetISOWeekYear;\\n\\n    // Quarter\\n    momentPrototype__proto.quarter = momentPrototype__proto.quarters = getSetQuarter;\\n\\n    // Month\\n    momentPrototype__proto.month       = getSetMonth;\\n    momentPrototype__proto.daysInMonth = getDaysInMonth;\\n\\n    // Week\\n    momentPrototype__proto.week           = momentPrototype__proto.weeks        = getSetWeek;\\n    momentPrototype__proto.isoWeek        = momentPrototype__proto.isoWeeks     = getSetISOWeek;\\n    momentPrototype__proto.weeksInYear    = getWeeksInYear;\\n    momentPrototype__proto.isoWeeksInYear = getISOWeeksInYear;\\n\\n    // Day\\n    momentPrototype__proto.date       = getSetDayOfMonth;\\n    momentPrototype__proto.day        = momentPrototype__proto.days             = getSetDayOfWeek;\\n    momentPrototype__proto.weekday    = getSetLocaleDayOfWeek;\\n    momentPrototype__proto.isoWeekday = getSetISODayOfWeek;\\n    momentPrototype__proto.dayOfYear  = getSetDayOfYear;\\n\\n    // Hour\\n    momentPrototype__proto.hour = momentPrototype__proto.hours = getSetHour;\\n\\n    // Minute\\n    momentPrototype__proto.minute = momentPrototype__proto.minutes = getSetMinute;\\n\\n    // Second\\n    momentPrototype__proto.second = momentPrototype__proto.seconds = getSetSecond;\\n\\n    // Millisecond\\n    momentPrototype__proto.millisecond = momentPrototype__proto.milliseconds = getSetMillisecond;\\n\\n    // Offset\\n    momentPrototype__proto.utcOffset            = getSetOffset;\\n    momentPrototype__proto.utc                  = setOffsetToUTC;\\n    momentPrototype__proto.local                = setOffsetToLocal;\\n    momentPrototype__proto.parseZone            = setOffsetToParsedOffset;\\n    momentPrototype__proto.hasAlignedHourOffset = hasAlignedHourOffset;\\n    momentPrototype__proto.isDST                = isDaylightSavingTime;\\n    momentPrototype__proto.isDSTShifted         = isDaylightSavingTimeShifted;\\n    momentPrototype__proto.isLocal              = isLocal;\\n    momentPrototype__proto.isUtcOffset          = isUtcOffset;\\n    momentPrototype__proto.isUtc                = isUtc;\\n    momentPrototype__proto.isUTC                = isUtc;\\n\\n    // Timezone\\n    momentPrototype__proto.zoneAbbr = getZoneAbbr;\\n    momentPrototype__proto.zoneName = getZoneName;\\n\\n    // Deprecations\\n    momentPrototype__proto.dates  = deprecate('dates accessor is deprecated. Use date instead.', getSetDayOfMonth);\\n    momentPrototype__proto.months = deprecate('months accessor is deprecated. Use month instead', getSetMonth);\\n    momentPrototype__proto.years  = deprecate('years accessor is deprecated. Use year instead', getSetYear);\\n    momentPrototype__proto.zone   = deprecate('moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779', getSetZone);\\n\\n    var momentPrototype = momentPrototype__proto;\\n\\n    function moment__createUnix (input) {\\n        return local__createLocal(input * 1000);\\n    }\\n\\n    function moment__createInZone () {\\n        return local__createLocal.apply(null, arguments).parseZone();\\n    }\\n\\n    var defaultCalendar = {\\n        sameDay : '[Today at] LT',\\n        nextDay : '[Tomorrow at] LT',\\n        nextWeek : 'dddd [at] LT',\\n        lastDay : '[Yesterday at] LT',\\n        lastWeek : '[Last] dddd [at] LT',\\n        sameElse : 'L'\\n    };\\n\\n    function locale_calendar__calendar (key, mom, now) {\\n        var output = this._calendar[key];\\n        return isFunction(output) ? output.call(mom, now) : output;\\n    }\\n\\n    var defaultLongDateFormat = {\\n        LTS  : 'h:mm:ss A',\\n        LT   : 'h:mm A',\\n        L    : 'MM/DD/YYYY',\\n        LL   : 'MMMM D, YYYY',\\n        LLL  : 'MMMM D, YYYY h:mm A',\\n        LLLL : 'dddd, MMMM D, YYYY h:mm A'\\n    };\\n\\n    function longDateFormat (key) {\\n        var format = this._longDateFormat[key],\\n            formatUpper = this._longDateFormat[key.toUpperCase()];\\n\\n        if (format || !formatUpper) {\\n            return format;\\n        }\\n\\n        this._longDateFormat[key] = formatUpper.replace(/MMMM|MM|DD|dddd/g, function (val) {\\n            return val.slice(1);\\n        });\\n\\n        return this._longDateFormat[key];\\n    }\\n\\n    var defaultInvalidDate = 'Invalid date';\\n\\n    function invalidDate () {\\n        return this._invalidDate;\\n    }\\n\\n    var defaultOrdinal = '%d';\\n    var defaultOrdinalParse = /\\\\d{1,2}/;\\n\\n    function ordinal (number) {\\n        return this._ordinal.replace('%d', number);\\n    }\\n\\n    function preParsePostFormat (string) {\\n        return string;\\n    }\\n\\n    var defaultRelativeTime = {\\n        future : 'in %s',\\n        past   : '%s ago',\\n        s  : 'a few seconds',\\n        m  : 'a minute',\\n        mm : '%d minutes',\\n        h  : 'an hour',\\n        hh : '%d hours',\\n        d  : 'a day',\\n        dd : '%d days',\\n        M  : 'a month',\\n        MM : '%d months',\\n        y  : 'a year',\\n        yy : '%d years'\\n    };\\n\\n    function relative__relativeTime (number, withoutSuffix, string, isFuture) {\\n        var output = this._relativeTime[string];\\n        return (isFunction(output)) ?\\n            output(number, withoutSuffix, string, isFuture) :\\n            output.replace(/%d/i, number);\\n    }\\n\\n    function pastFuture (diff, output) {\\n        var format = this._relativeTime[diff > 0 ? 'future' : 'past'];\\n        return isFunction(format) ? format(output) : format.replace(/%s/i, output);\\n    }\\n\\n    var prototype__proto = Locale.prototype;\\n\\n    prototype__proto._calendar       = defaultCalendar;\\n    prototype__proto.calendar        = locale_calendar__calendar;\\n    prototype__proto._longDateFormat = defaultLongDateFormat;\\n    prototype__proto.longDateFormat  = longDateFormat;\\n    prototype__proto._invalidDate    = defaultInvalidDate;\\n    prototype__proto.invalidDate     = invalidDate;\\n    prototype__proto._ordinal        = defaultOrdinal;\\n    prototype__proto.ordinal         = ordinal;\\n    prototype__proto._ordinalParse   = defaultOrdinalParse;\\n    prototype__proto.preparse        = preParsePostFormat;\\n    prototype__proto.postformat      = preParsePostFormat;\\n    prototype__proto._relativeTime   = defaultRelativeTime;\\n    prototype__proto.relativeTime    = relative__relativeTime;\\n    prototype__proto.pastFuture      = pastFuture;\\n    prototype__proto.set             = locale_set__set;\\n\\n    // Month\\n    prototype__proto.months            =        localeMonths;\\n    prototype__proto._months           = defaultLocaleMonths;\\n    prototype__proto.monthsShort       =        localeMonthsShort;\\n    prototype__proto._monthsShort      = defaultLocaleMonthsShort;\\n    prototype__proto.monthsParse       =        localeMonthsParse;\\n    prototype__proto._monthsRegex      = defaultMonthsRegex;\\n    prototype__proto.monthsRegex       = monthsRegex;\\n    prototype__proto._monthsShortRegex = defaultMonthsShortRegex;\\n    prototype__proto.monthsShortRegex  = monthsShortRegex;\\n\\n    // Week\\n    prototype__proto.week = localeWeek;\\n    prototype__proto._week = defaultLocaleWeek;\\n    prototype__proto.firstDayOfYear = localeFirstDayOfYear;\\n    prototype__proto.firstDayOfWeek = localeFirstDayOfWeek;\\n\\n    // Day of Week\\n    prototype__proto.weekdays       =        localeWeekdays;\\n    prototype__proto._weekdays      = defaultLocaleWeekdays;\\n    prototype__proto.weekdaysMin    =        localeWeekdaysMin;\\n    prototype__proto._weekdaysMin   = defaultLocaleWeekdaysMin;\\n    prototype__proto.weekdaysShort  =        localeWeekdaysShort;\\n    prototype__proto._weekdaysShort = defaultLocaleWeekdaysShort;\\n    prototype__proto.weekdaysParse  =        localeWeekdaysParse;\\n\\n    prototype__proto._weekdaysRegex      = defaultWeekdaysRegex;\\n    prototype__proto.weekdaysRegex       =        weekdaysRegex;\\n    prototype__proto._weekdaysShortRegex = defaultWeekdaysShortRegex;\\n    prototype__proto.weekdaysShortRegex  =        weekdaysShortRegex;\\n    prototype__proto._weekdaysMinRegex   = defaultWeekdaysMinRegex;\\n    prototype__proto.weekdaysMinRegex    =        weekdaysMinRegex;\\n\\n    // Hours\\n    prototype__proto.isPM = localeIsPM;\\n    prototype__proto._meridiemParse = defaultLocaleMeridiemParse;\\n    prototype__proto.meridiem = localeMeridiem;\\n\\n    function lists__get (format, index, field, setter) {\\n        var locale = locale_locales__getLocale();\\n        var utc = create_utc__createUTC().set(setter, index);\\n        return locale[field](utc, format);\\n    }\\n\\n    function listMonthsImpl (format, index, field) {\\n        if (typeof format === 'number') {\\n            index = format;\\n            format = undefined;\\n        }\\n\\n        format = format || '';\\n\\n        if (index != null) {\\n            return lists__get(format, index, field, 'month');\\n        }\\n\\n        var i;\\n        var out = [];\\n        for (i = 0; i < 12; i++) {\\n            out[i] = lists__get(format, i, field, 'month');\\n        }\\n        return out;\\n    }\\n\\n    // ()\\n    // (5)\\n    // (fmt, 5)\\n    // (fmt)\\n    // (true)\\n    // (true, 5)\\n    // (true, fmt, 5)\\n    // (true, fmt)\\n    function listWeekdaysImpl (localeSorted, format, index, field) {\\n        if (typeof localeSorted === 'boolean') {\\n            if (typeof format === 'number') {\\n                index = format;\\n                format = undefined;\\n            }\\n\\n            format = format || '';\\n        } else {\\n            format = localeSorted;\\n            index = format;\\n            localeSorted = false;\\n\\n            if (typeof format === 'number') {\\n                index = format;\\n                format = undefined;\\n            }\\n\\n            format = format || '';\\n        }\\n\\n        var locale = locale_locales__getLocale(),\\n            shift = localeSorted ? locale._week.dow : 0;\\n\\n        if (index != null) {\\n            return lists__get(format, (index + shift) % 7, field, 'day');\\n        }\\n\\n        var i;\\n        var out = [];\\n        for (i = 0; i < 7; i++) {\\n            out[i] = lists__get(format, (i + shift) % 7, field, 'day');\\n        }\\n        return out;\\n    }\\n\\n    function lists__listMonths (format, index) {\\n        return listMonthsImpl(format, index, 'months');\\n    }\\n\\n    function lists__listMonthsShort (format, index) {\\n        return listMonthsImpl(format, index, 'monthsShort');\\n    }\\n\\n    function lists__listWeekdays (localeSorted, format, index) {\\n        return listWeekdaysImpl(localeSorted, format, index, 'weekdays');\\n    }\\n\\n    function lists__listWeekdaysShort (localeSorted, format, index) {\\n        return listWeekdaysImpl(localeSorted, format, index, 'weekdaysShort');\\n    }\\n\\n    function lists__listWeekdaysMin (localeSorted, format, index) {\\n        return listWeekdaysImpl(localeSorted, format, index, 'weekdaysMin');\\n    }\\n\\n    locale_locales__getSetGlobalLocale('en', {\\n        ordinalParse: /\\\\d{1,2}(th|st|nd|rd)/,\\n        ordinal : function (number) {\\n            var b = number % 10,\\n                output = (toInt(number % 100 / 10) === 1) ? 'th' :\\n                (b === 1) ? 'st' :\\n                (b === 2) ? 'nd' :\\n                (b === 3) ? 'rd' : 'th';\\n            return number + output;\\n        }\\n    });\\n\\n    // Side effect imports\\n    utils_hooks__hooks.lang = deprecate('moment.lang is deprecated. Use moment.locale instead.', locale_locales__getSetGlobalLocale);\\n    utils_hooks__hooks.langData = deprecate('moment.langData is deprecated. Use moment.localeData instead.', locale_locales__getLocale);\\n\\n    var mathAbs = Math.abs;\\n\\n    function duration_abs__abs () {\\n        var data           = this._data;\\n\\n        this._milliseconds = mathAbs(this._milliseconds);\\n        this._days         = mathAbs(this._days);\\n        this._months       = mathAbs(this._months);\\n\\n        data.milliseconds  = mathAbs(data.milliseconds);\\n        data.seconds       = mathAbs(data.seconds);\\n        data.minutes       = mathAbs(data.minutes);\\n        data.hours         = mathAbs(data.hours);\\n        data.months        = mathAbs(data.months);\\n        data.years         = mathAbs(data.years);\\n\\n        return this;\\n    }\\n\\n    function duration_add_subtract__addSubtract (duration, input, value, direction) {\\n        var other = create__createDuration(input, value);\\n\\n        duration._milliseconds += direction * other._milliseconds;\\n        duration._days         += direction * other._days;\\n        duration._months       += direction * other._months;\\n\\n        return duration._bubble();\\n    }\\n\\n    // supports only 2.0-style add(1, 's') or add(duration)\\n    function duration_add_subtract__add (input, value) {\\n        return duration_add_subtract__addSubtract(this, input, value, 1);\\n    }\\n\\n    // supports only 2.0-style subtract(1, 's') or subtract(duration)\\n    function duration_add_subtract__subtract (input, value) {\\n        return duration_add_subtract__addSubtract(this, input, value, -1);\\n    }\\n\\n    function absCeil (number) {\\n        if (number < 0) {\\n            return Math.floor(number);\\n        } else {\\n            return Math.ceil(number);\\n        }\\n    }\\n\\n    function bubble () {\\n        var milliseconds = this._milliseconds;\\n        var days         = this._days;\\n        var months       = this._months;\\n        var data         = this._data;\\n        var seconds, minutes, hours, years, monthsFromDays;\\n\\n        // if we have a mix of positive and negative values, bubble down first\\n        // check: https://github.com/moment/moment/issues/2166\\n        if (!((milliseconds >= 0 && days >= 0 && months >= 0) ||\\n                (milliseconds <= 0 && days <= 0 && months <= 0))) {\\n            milliseconds += absCeil(monthsToDays(months) + days) * 864e5;\\n            days = 0;\\n            months = 0;\\n        }\\n\\n        // The following code bubbles up values, see the tests for\\n        // examples of what that means.\\n        data.milliseconds = milliseconds % 1000;\\n\\n        seconds           = absFloor(milliseconds / 1000);\\n        data.seconds      = seconds % 60;\\n\\n        minutes           = absFloor(seconds / 60);\\n        data.minutes      = minutes % 60;\\n\\n        hours             = absFloor(minutes / 60);\\n        data.hours        = hours % 24;\\n\\n        days += absFloor(hours / 24);\\n\\n        // convert days to months\\n        monthsFromDays = absFloor(daysToMonths(days));\\n        months += monthsFromDays;\\n        days -= absCeil(monthsToDays(monthsFromDays));\\n\\n        // 12 months -> 1 year\\n        years = absFloor(months / 12);\\n        months %= 12;\\n\\n        data.days   = days;\\n        data.months = months;\\n        data.years  = years;\\n\\n        return this;\\n    }\\n\\n    function daysToMonths (days) {\\n        // 400 years have 146097 days (taking into account leap year rules)\\n        // 400 years have 12 months === 4800\\n        return days * 4800 / 146097;\\n    }\\n\\n    function monthsToDays (months) {\\n        // the reverse of daysToMonths\\n        return months * 146097 / 4800;\\n    }\\n\\n    function as (units) {\\n        var days;\\n        var months;\\n        var milliseconds = this._milliseconds;\\n\\n        units = normalizeUnits(units);\\n\\n        if (units === 'month' || units === 'year') {\\n            days   = this._days   + milliseconds / 864e5;\\n            months = this._months + daysToMonths(days);\\n            return units === 'month' ? months : months / 12;\\n        } else {\\n            // handle milliseconds separately because of floating point math errors (issue #1867)\\n            days = this._days + Math.round(monthsToDays(this._months));\\n            switch (units) {\\n                case 'week'   : return days / 7     + milliseconds / 6048e5;\\n                case 'day'    : return days         + milliseconds / 864e5;\\n                case 'hour'   : return days * 24    + milliseconds / 36e5;\\n                case 'minute' : return days * 1440  + milliseconds / 6e4;\\n                case 'second' : return days * 86400 + milliseconds / 1000;\\n                // Math.floor prevents floating point math errors here\\n                case 'millisecond': return Math.floor(days * 864e5) + milliseconds;\\n                default: throw new Error('Unknown unit ' + units);\\n            }\\n        }\\n    }\\n\\n    // TODO: Use this.as('ms')?\\n    function duration_as__valueOf () {\\n        return (\\n            this._milliseconds +\\n            this._days * 864e5 +\\n            (this._months % 12) * 2592e6 +\\n            toInt(this._months / 12) * 31536e6\\n        );\\n    }\\n\\n    function makeAs (alias) {\\n        return function () {\\n            return this.as(alias);\\n        };\\n    }\\n\\n    var asMilliseconds = makeAs('ms');\\n    var asSeconds      = makeAs('s');\\n    var asMinutes      = makeAs('m');\\n    var asHours        = makeAs('h');\\n    var asDays         = makeAs('d');\\n    var asWeeks        = makeAs('w');\\n    var asMonths       = makeAs('M');\\n    var asYears        = makeAs('y');\\n\\n    function duration_get__get (units) {\\n        units = normalizeUnits(units);\\n        return this[units + 's']();\\n    }\\n\\n    function makeGetter(name) {\\n        return function () {\\n            return this._data[name];\\n        };\\n    }\\n\\n    var milliseconds = makeGetter('milliseconds');\\n    var seconds      = makeGetter('seconds');\\n    var minutes      = makeGetter('minutes');\\n    var hours        = makeGetter('hours');\\n    var days         = makeGetter('days');\\n    var months       = makeGetter('months');\\n    var years        = makeGetter('years');\\n\\n    function weeks () {\\n        return absFloor(this.days() / 7);\\n    }\\n\\n    var round = Math.round;\\n    var thresholds = {\\n        s: 45,  // seconds to minute\\n        m: 45,  // minutes to hour\\n        h: 22,  // hours to day\\n        d: 26,  // days to month\\n        M: 11   // months to year\\n    };\\n\\n    // helper function for moment.fn.from, moment.fn.fromNow, and moment.duration.fn.humanize\\n    function substituteTimeAgo(string, number, withoutSuffix, isFuture, locale) {\\n        return locale.relativeTime(number || 1, !!withoutSuffix, string, isFuture);\\n    }\\n\\n    function duration_humanize__relativeTime (posNegDuration, withoutSuffix, locale) {\\n        var duration = create__createDuration(posNegDuration).abs();\\n        var seconds  = round(duration.as('s'));\\n        var minutes  = round(duration.as('m'));\\n        var hours    = round(duration.as('h'));\\n        var days     = round(duration.as('d'));\\n        var months   = round(duration.as('M'));\\n        var years    = round(duration.as('y'));\\n\\n        var a = seconds < thresholds.s && ['s', seconds]  ||\\n                minutes <= 1           && ['m']           ||\\n                minutes < thresholds.m && ['mm', minutes] ||\\n                hours   <= 1           && ['h']           ||\\n                hours   < thresholds.h && ['hh', hours]   ||\\n                days    <= 1           && ['d']           ||\\n                days    < thresholds.d && ['dd', days]    ||\\n                months  <= 1           && ['M']           ||\\n                months  < thresholds.M && ['MM', months]  ||\\n                years   <= 1           && ['y']           || ['yy', years];\\n\\n        a[2] = withoutSuffix;\\n        a[3] = +posNegDuration > 0;\\n        a[4] = locale;\\n        return substituteTimeAgo.apply(null, a);\\n    }\\n\\n    // This function allows you to set a threshold for relative time strings\\n    function duration_humanize__getSetRelativeTimeThreshold (threshold, limit) {\\n        if (thresholds[threshold] === undefined) {\\n            return false;\\n        }\\n        if (limit === undefined) {\\n            return thresholds[threshold];\\n        }\\n        thresholds[threshold] = limit;\\n        return true;\\n    }\\n\\n    function humanize (withSuffix) {\\n        var locale = this.localeData();\\n        var output = duration_humanize__relativeTime(this, !withSuffix, locale);\\n\\n        if (withSuffix) {\\n            output = locale.pastFuture(+this, output);\\n        }\\n\\n        return locale.postformat(output);\\n    }\\n\\n    var iso_string__abs = Math.abs;\\n\\n    function iso_string__toISOString() {\\n        // for ISO strings we do not use the normal bubbling rules:\\n        //  * milliseconds bubble up until they become hours\\n        //  * days do not bubble at all\\n        //  * months bubble up until they become years\\n        // This is because there is no context-free conversion between hours and days\\n        // (think of clock changes)\\n        // and also not between days and months (28-31 days per month)\\n        var seconds = iso_string__abs(this._milliseconds) / 1000;\\n        var days         = iso_string__abs(this._days);\\n        var months       = iso_string__abs(this._months);\\n        var minutes, hours, years;\\n\\n        // 3600 seconds -> 60 minutes -> 1 hour\\n        minutes           = absFloor(seconds / 60);\\n        hours             = absFloor(minutes / 60);\\n        seconds %= 60;\\n        minutes %= 60;\\n\\n        // 12 months -> 1 year\\n        years  = absFloor(months / 12);\\n        months %= 12;\\n\\n\\n        // inspired by https://github.com/dordille/moment-isoduration/blob/master/moment.isoduration.js\\n        var Y = years;\\n        var M = months;\\n        var D = days;\\n        var h = hours;\\n        var m = minutes;\\n        var s = seconds;\\n        var total = this.asSeconds();\\n\\n        if (!total) {\\n            // this is the same as C#'s (Noda) and python (isodate)...\\n            // but not other JS (goog.date)\\n            return 'P0D';\\n        }\\n\\n        return (total < 0 ? '-' : '') +\\n            'P' +\\n            (Y ? Y + 'Y' : '') +\\n            (M ? M + 'M' : '') +\\n            (D ? D + 'D' : '') +\\n            ((h || m || s) ? 'T' : '') +\\n            (h ? h + 'H' : '') +\\n            (m ? m + 'M' : '') +\\n            (s ? s + 'S' : '');\\n    }\\n\\n    var duration_prototype__proto = Duration.prototype;\\n\\n    duration_prototype__proto.abs            = duration_abs__abs;\\n    duration_prototype__proto.add            = duration_add_subtract__add;\\n    duration_prototype__proto.subtract       = duration_add_subtract__subtract;\\n    duration_prototype__proto.as             = as;\\n    duration_prototype__proto.asMilliseconds = asMilliseconds;\\n    duration_prototype__proto.asSeconds      = asSeconds;\\n    duration_prototype__proto.asMinutes      = asMinutes;\\n    duration_prototype__proto.asHours        = asHours;\\n    duration_prototype__proto.asDays         = asDays;\\n    duration_prototype__proto.asWeeks        = asWeeks;\\n    duration_prototype__proto.asMonths       = asMonths;\\n    duration_prototype__proto.asYears        = asYears;\\n    duration_prototype__proto.valueOf        = duration_as__valueOf;\\n    duration_prototype__proto._bubble        = bubble;\\n    duration_prototype__proto.get            = duration_get__get;\\n    duration_prototype__proto.milliseconds   = milliseconds;\\n    duration_prototype__proto.seconds        = seconds;\\n    duration_prototype__proto.minutes        = minutes;\\n    duration_prototype__proto.hours          = hours;\\n    duration_prototype__proto.days           = days;\\n    duration_prototype__proto.weeks          = weeks;\\n    duration_prototype__proto.months         = months;\\n    duration_prototype__proto.years          = years;\\n    duration_prototype__proto.humanize       = humanize;\\n    duration_prototype__proto.toISOString    = iso_string__toISOString;\\n    duration_prototype__proto.toString       = iso_string__toISOString;\\n    duration_prototype__proto.toJSON         = iso_string__toISOString;\\n    duration_prototype__proto.locale         = locale;\\n    duration_prototype__proto.localeData     = localeData;\\n\\n    // Deprecations\\n    duration_prototype__proto.toIsoString = deprecate('toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)', iso_string__toISOString);\\n    duration_prototype__proto.lang = lang;\\n\\n    // Side effect imports\\n\\n    // FORMATTING\\n\\n    addFormatToken('X', 0, 0, 'unix');\\n    addFormatToken('x', 0, 0, 'valueOf');\\n\\n    // PARSING\\n\\n    addRegexToken('x', matchSigned);\\n    addRegexToken('X', matchTimestamp);\\n    addParseToken('X', function (input, array, config) {\\n        config._d = new Date(parseFloat(input, 10) * 1000);\\n    });\\n    addParseToken('x', function (input, array, config) {\\n        config._d = new Date(toInt(input));\\n    });\\n\\n    // Side effect imports\\n\\n\\n    utils_hooks__hooks.version = '2.13.0';\\n\\n    setHookCallback(local__createLocal);\\n\\n    utils_hooks__hooks.fn                    = momentPrototype;\\n    utils_hooks__hooks.min                   = min;\\n    utils_hooks__hooks.max                   = max;\\n    utils_hooks__hooks.now                   = now;\\n    utils_hooks__hooks.utc                   = create_utc__createUTC;\\n    utils_hooks__hooks.unix                  = moment__createUnix;\\n    utils_hooks__hooks.months                = lists__listMonths;\\n    utils_hooks__hooks.isDate                = isDate;\\n    utils_hooks__hooks.locale                = locale_locales__getSetGlobalLocale;\\n    utils_hooks__hooks.invalid               = valid__createInvalid;\\n    utils_hooks__hooks.duration              = create__createDuration;\\n    utils_hooks__hooks.isMoment              = isMoment;\\n    utils_hooks__hooks.weekdays              = lists__listWeekdays;\\n    utils_hooks__hooks.parseZone             = moment__createInZone;\\n    utils_hooks__hooks.localeData            = locale_locales__getLocale;\\n    utils_hooks__hooks.isDuration            = isDuration;\\n    utils_hooks__hooks.monthsShort           = lists__listMonthsShort;\\n    utils_hooks__hooks.weekdaysMin           = lists__listWeekdaysMin;\\n    utils_hooks__hooks.defineLocale          = defineLocale;\\n    utils_hooks__hooks.updateLocale          = updateLocale;\\n    utils_hooks__hooks.locales               = locale_locales__listLocales;\\n    utils_hooks__hooks.weekdaysShort         = lists__listWeekdaysShort;\\n    utils_hooks__hooks.normalizeUnits        = normalizeUnits;\\n    utils_hooks__hooks.relativeTimeThreshold = duration_humanize__getSetRelativeTimeThreshold;\\n    utils_hooks__hooks.prototype             = momentPrototype;\\n\\n    var _moment = utils_hooks__hooks;\\n\\n    return _moment;\\n\\n}));;/**\\n * Parse a text request to a json query object tree\\n *\\n * @param  {String} string The string to parse\\n * @return {Object} The json query tree\\n */\\nfunction parseStringToObject(string) {\\n\\nvar arrayExtend = function () {\\n  var j, i, newlist = [], list_list = arguments;\\n  for (j = 0; j < list_list.length; j += 1) {\\n    for (i = 0; i < list_list[j].length; i += 1) {\\n      newlist.push(list_list[j][i]);\\n    }\\n  }\\n  return newlist;\\n\\n}, mkSimpleQuery = function (key, value, operator) {\\n  var object = {\\\"type\\\": \\\"simple\\\", \\\"key\\\": key, \\\"value\\\": value};\\n  if (operator !== undefined) {\\n    object.operator = operator;\\n  }\\n  return object;\\n\\n}, mkNotQuery = function (query) {\\n  if (query.operator === \\\"NOT\\\") {\\n    return query.query_list[0];\\n  }\\n  return {\\\"type\\\": \\\"complex\\\", \\\"operator\\\": \\\"NOT\\\", \\\"query_list\\\": [query]};\\n\\n}, mkComplexQuery = function (operator, query_list) {\\n  var i, query_list2 = [];\\n  for (i = 0; i < query_list.length; i += 1) {\\n    if (query_list[i].operator === operator) {\\n      query_list2 = arrayExtend(query_list2, query_list[i].query_list);\\n    } else {\\n      query_list2.push(query_list[i]);\\n    }\\n  }\\n  return {type:\\\"complex\\\",operator:operator,query_list:query_list2};\\n\\n}, simpleQuerySetKey = function (query, key) {\\n  var i;\\n  if (query.type === \\\"complex\\\") {\\n    for (i = 0; i < query.query_list.length; ++i) {\\n      simpleQuerySetKey (query.query_list[i],key);\\n    }\\n    return true;\\n  }\\n  if (query.type === \\\"simple\\\" && !query.key) {\\n    query.key = key;\\n    return true;\\n  }\\n  return false;\\n},\\n  error_offsets = [],\\n  error_lookaheads = [],\\n  error_count = 0,\\n  result;\\n;/* parser generated by jison 0.4.16 */\\n/*\\n  Returns a Parser object of the following structure:\\n\\n  Parser: {\\n    yy: {}\\n  }\\n\\n  Parser.prototype: {\\n    yy: {},\\n    trace: function(),\\n    symbols_: {associative list: name ==> number},\\n    terminals_: {associative list: number ==> name},\\n    productions_: [...],\\n    performAction: function anonymous(yytext, yyleng, yylineno, yy, yystate, $$, _$),\\n    table: [...],\\n    defaultActions: {...},\\n    parseError: function(str, hash),\\n    parse: function(input),\\n\\n    lexer: {\\n        EOF: 1,\\n        parseError: function(str, hash),\\n        setInput: function(input),\\n        input: function(),\\n        unput: function(str),\\n        more: function(),\\n        less: function(n),\\n        pastInput: function(),\\n        upcomingInput: function(),\\n        showPosition: function(),\\n        test_match: function(regex_match_array, rule_index),\\n        next: function(),\\n        lex: function(),\\n        begin: function(condition),\\n        popState: function(),\\n        _currentRules: function(),\\n        topState: function(),\\n        pushState: function(condition),\\n\\n        options: {\\n            ranges: boolean           (optional: true ==> token location info will include a .range[] member)\\n            flex: boolean             (optional: true ==> flex-like lexing behaviour where the rules are tested exhaustively to find the longest match)\\n            backtrack_lexer: boolean  (optional: true ==> lexer regexes are tested in order and for each matching regex the action code is invoked; the lexer terminates the scan when a token is returned by the action code)\\n        },\\n\\n        performAction: function(yy, yy_, $avoiding_name_collisions, YY_START),\\n        rules: [...],\\n        conditions: {associative list: name ==> set},\\n    }\\n  }\\n\\n\\n  token location info (@$, _$, etc.): {\\n    first_line: n,\\n    last_line: n,\\n    first_column: n,\\n    last_column: n,\\n    range: [start_number, end_number]       (where the numbers are indexes into the input string, regular zero-based)\\n  }\\n\\n\\n  the parseError function receives a 'hash' object with these members for lexer and parser errors: {\\n    text:        (matched text)\\n    token:       (the produced terminal token, if any)\\n    line:        (yylineno)\\n  }\\n  while parser (grammar) errors will also provide these members, i.e. parser errors deliver a superset of attributes: {\\n    loc:         (yylloc)\\n    expected:    (string describing the set of expected tokens)\\n    recoverable: (boolean: TRUE when the parser has a error recovery rule available for this particular error)\\n  }\\n*/\\nvar parser = (function(){\\nvar o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v);return o},$V0=[1,5],$V1=[1,7],$V2=[1,8],$V3=[1,10],$V4=[1,12],$V5=[1,6,7,15],$V6=[1,6,7,9,12,14,15,16,19,21],$V7=[1,6,7,9,11,12,14,15,16,19,21],$V8=[2,17];\\nvar parser = {trace: function trace() { },\\nyy: {},\\nsymbols_: {\\\"error\\\":2,\\\"begin\\\":3,\\\"search_text\\\":4,\\\"end\\\":5,\\\"EOF\\\":6,\\\"NEWLINE\\\":7,\\\"and_expression\\\":8,\\\"OR\\\":9,\\\"boolean_expression\\\":10,\\\"AND\\\":11,\\\"NOT\\\":12,\\\"expression\\\":13,\\\"LEFT_PARENTHESE\\\":14,\\\"RIGHT_PARENTHESE\\\":15,\\\"WORD\\\":16,\\\"DEFINITION\\\":17,\\\"value\\\":18,\\\"OPERATOR\\\":19,\\\"string\\\":20,\\\"QUOTE\\\":21,\\\"QUOTED_STRING\\\":22,\\\"$accept\\\":0,\\\"$end\\\":1},\\nterminals_: {2:\\\"error\\\",6:\\\"EOF\\\",7:\\\"NEWLINE\\\",9:\\\"OR\\\",11:\\\"AND\\\",12:\\\"NOT\\\",14:\\\"LEFT_PARENTHESE\\\",15:\\\"RIGHT_PARENTHESE\\\",16:\\\"WORD\\\",17:\\\"DEFINITION\\\",19:\\\"OPERATOR\\\",21:\\\"QUOTE\\\",22:\\\"QUOTED_STRING\\\"},\\nproductions_: [0,[3,2],[5,0],[5,1],[5,1],[4,1],[4,2],[4,3],[8,1],[8,3],[10,2],[10,1],[13,3],[13,3],[13,1],[18,2],[18,1],[20,1],[20,3]],\\nperformAction: function anonymous(yytext, yyleng, yylineno, yy, yystate /* action[1] */, $$ /* vstack */, _$ /* lstack */) {\\n/* this == yyval */\\n\\nvar $0 = $$.length - 1;\\nswitch (yystate) {\\ncase 1:\\n return $$[$0-1]; \\nbreak;\\ncase 5: case 8: case 11: case 14: case 16:\\n this.$ = $$[$0]; \\nbreak;\\ncase 6:\\n this.$ = mkComplexQuery('OR', [$$[$0-1], $$[$0]]); \\nbreak;\\ncase 7:\\n this.$ = mkComplexQuery('OR', [$$[$0-2], $$[$0]]); \\nbreak;\\ncase 9:\\n this.$ = mkComplexQuery('AND', [$$[$0-2], $$[$0]]); \\nbreak;\\ncase 10:\\n this.$ = mkNotQuery($$[$0]); \\nbreak;\\ncase 12:\\n this.$ = $$[$0-1]; \\nbreak;\\ncase 13:\\n simpleQuerySetKey($$[$0], $$[$0-2]); this.$ = $$[$0]; \\nbreak;\\ncase 15:\\n $$[$0].operator = $$[$0-1] ; this.$ = $$[$0]; \\nbreak;\\ncase 17:\\n this.$ = mkSimpleQuery('', $$[$0]); \\nbreak;\\ncase 18:\\n this.$ = mkSimpleQuery('', $$[$0-1]); \\nbreak;\\n}\\n},\\ntable: [{3:1,4:2,8:3,10:4,12:$V0,13:6,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},{1:[3]},{1:[2,2],5:13,6:[1,14],7:[1,15]},o($V5,[2,5],{8:3,10:4,13:6,18:9,20:11,4:16,9:[1,17],12:$V0,14:$V1,16:$V2,19:$V3,21:$V4}),o($V6,[2,8],{11:[1,18]}),{13:19,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},o($V7,[2,11]),{4:20,8:3,10:4,12:$V0,13:6,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},o($V7,$V8,{17:[1,21]}),o($V7,[2,14]),{16:[1,23],20:22,21:$V4},o($V7,[2,16]),{22:[1,24]},{1:[2,1]},{1:[2,3]},{1:[2,4]},o($V5,[2,6]),{4:25,8:3,10:4,12:$V0,13:6,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},{8:26,10:4,12:$V0,13:6,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},o($V7,[2,10]),{15:[1,27]},{13:28,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},o($V7,[2,15]),o($V7,$V8),{21:[1,29]},o($V5,[2,7]),o($V6,[2,9]),o($V7,[2,12]),o($V7,[2,13]),o($V7,[2,18])],\\ndefaultActions: {13:[2,1],14:[2,3],15:[2,4]},\\nparseError: function parseError(str, hash) {\\n    if (hash.recoverable) {\\n        this.trace(str);\\n    } else {\\n        function _parseError (msg, hash) {\\n            this.message = msg;\\n            this.hash = hash;\\n        }\\n        _parseError.prototype = new Error();\\n\\n        throw new _parseError(str, hash);\\n    }\\n},\\nparse: function parse(input) {\\n    var self = this, stack = [0], tstack = [], vstack = [null], lstack = [], table = this.table, yytext = '', yylineno = 0, yyleng = 0, recovering = 0, TERROR = 2, EOF = 1;\\n    var args = lstack.slice.call(arguments, 1);\\n    var lexer = Object.create(this.lexer);\\n    var sharedState = { yy: {} };\\n    for (var k in this.yy) {\\n        if (Object.prototype.hasOwnProperty.call(this.yy, k)) {\\n            sharedState.yy[k] = this.yy[k];\\n        }\\n    }\\n    lexer.setInput(input, sharedState.yy);\\n    sharedState.yy.lexer = lexer;\\n    sharedState.yy.parser = this;\\n    if (typeof lexer.yylloc == 'undefined') {\\n        lexer.yylloc = {};\\n    }\\n    var yyloc = lexer.yylloc;\\n    lstack.push(yyloc);\\n    var ranges = lexer.options && lexer.options.ranges;\\n    if (typeof sharedState.yy.parseError === 'function') {\\n        this.parseError = sharedState.yy.parseError;\\n    } else {\\n        this.parseError = Object.getPrototypeOf(this).parseError;\\n    }\\n    function popStack(n) {\\n        stack.length = stack.length - 2 * n;\\n        vstack.length = vstack.length - n;\\n        lstack.length = lstack.length - n;\\n    }\\n    _token_stack:\\n        var lex = function () {\\n            var token;\\n            token = lexer.lex() || EOF;\\n            if (typeof token !== 'number') {\\n                token = self.symbols_[token] || token;\\n            }\\n            return token;\\n        };\\n    var symbol, preErrorSymbol, state, action, a, r, yyval = {}, p, len, newState, expected;\\n    while (true) {\\n        state = stack[stack.length - 1];\\n        if (this.defaultActions[state]) {\\n            action = this.defaultActions[state];\\n        } else {\\n            if (symbol === null || typeof symbol == 'undefined') {\\n                symbol = lex();\\n            }\\n            action = table[state] && table[state][symbol];\\n        }\\n                    if (typeof action === 'undefined' || !action.length || !action[0]) {\\n                var errStr = '';\\n                expected = [];\\n                for (p in table[state]) {\\n                    if (this.terminals_[p] && p > TERROR) {\\n                        expected.push('\\\\'' + this.terminals_[p] + '\\\\'');\\n                    }\\n                }\\n                if (lexer.showPosition) {\\n                    errStr = 'Parse error on line ' + (yylineno + 1) + ':\\\\n' + lexer.showPosition() + '\\\\nExpecting ' + expected.join(', ') + ', got \\\\'' + (this.terminals_[symbol] || symbol) + '\\\\'';\\n                } else {\\n                    errStr = 'Parse error on line ' + (yylineno + 1) + ': Unexpected ' + (symbol == EOF ? 'end of input' : '\\\\'' + (this.terminals_[symbol] || symbol) + '\\\\'');\\n                }\\n                this.parseError(errStr, {\\n                    text: lexer.match,\\n                    token: this.terminals_[symbol] || symbol,\\n                    line: lexer.yylineno,\\n                    loc: yyloc,\\n                    expected: expected\\n                });\\n            }\\n        if (action[0] instanceof Array && action.length > 1) {\\n            throw new Error('Parse Error: multiple actions possible at state: ' + state + ', token: ' + symbol);\\n        }\\n        switch (action[0]) {\\n        case 1:\\n            stack.push(symbol);\\n            vstack.push(lexer.yytext);\\n            lstack.push(lexer.yylloc);\\n            stack.push(action[1]);\\n            symbol = null;\\n            if (!preErrorSymbol) {\\n                yyleng = lexer.yyleng;\\n                yytext = lexer.yytext;\\n                yylineno = lexer.yylineno;\\n                yyloc = lexer.yylloc;\\n                if (recovering > 0) {\\n                    recovering--;\\n                }\\n            } else {\\n                symbol = preErrorSymbol;\\n                preErrorSymbol = null;\\n            }\\n            break;\\n        case 2:\\n            len = this.productions_[action[1]][1];\\n            yyval.$ = vstack[vstack.length - len];\\n            yyval._$ = {\\n                first_line: lstack[lstack.length - (len || 1)].first_line,\\n                last_line: lstack[lstack.length - 1].last_line,\\n                first_column: lstack[lstack.length - (len || 1)].first_column,\\n                last_column: lstack[lstack.length - 1].last_column\\n            };\\n            if (ranges) {\\n                yyval._$.range = [\\n                    lstack[lstack.length - (len || 1)].range[0],\\n                    lstack[lstack.length - 1].range[1]\\n                ];\\n            }\\n            r = this.performAction.apply(yyval, [\\n                yytext,\\n                yyleng,\\n                yylineno,\\n                sharedState.yy,\\n                action[1],\\n                vstack,\\n                lstack\\n            ].concat(args));\\n            if (typeof r !== 'undefined') {\\n                return r;\\n            }\\n            if (len) {\\n                stack = stack.slice(0, -1 * len * 2);\\n                vstack = vstack.slice(0, -1 * len);\\n                lstack = lstack.slice(0, -1 * len);\\n            }\\n            stack.push(this.productions_[action[1]][0]);\\n            vstack.push(yyval.$);\\n            lstack.push(yyval._$);\\n            newState = table[stack[stack.length - 2]][stack[stack.length - 1]];\\n            stack.push(newState);\\n            break;\\n        case 3:\\n            return true;\\n        }\\n    }\\n    return true;\\n}};\\n/* generated by jison-lex 0.3.4 */\\nvar lexer = (function(){\\nvar lexer = ({\\n\\nEOF:1,\\n\\nparseError:function parseError(str, hash) {\\n        if (this.yy.parser) {\\n            this.yy.parser.parseError(str, hash);\\n        } else {\\n            throw new Error(str);\\n        }\\n    },\\n\\n// resets the lexer, sets new input\\nsetInput:function (input, yy) {\\n        this.yy = yy || this.yy || {};\\n        this._input = input;\\n        this._more = this._backtrack = this.done = false;\\n        this.yylineno = this.yyleng = 0;\\n        this.yytext = this.matched = this.match = '';\\n        this.conditionStack = ['INITIAL'];\\n        this.yylloc = {\\n            first_line: 1,\\n            first_column: 0,\\n            last_line: 1,\\n            last_column: 0\\n        };\\n        if (this.options.ranges) {\\n            this.yylloc.range = [0,0];\\n        }\\n        this.offset = 0;\\n        return this;\\n    },\\n\\n// consumes and returns one char from the input\\ninput:function () {\\n        var ch = this._input[0];\\n        this.yytext += ch;\\n        this.yyleng++;\\n        this.offset++;\\n        this.match += ch;\\n        this.matched += ch;\\n        var lines = ch.match(/(?:\\\\r\\\\n?|\\\\n).*/g);\\n        if (lines) {\\n            this.yylineno++;\\n            this.yylloc.last_line++;\\n        } else {\\n            this.yylloc.last_column++;\\n        }\\n        if (this.options.ranges) {\\n            this.yylloc.range[1]++;\\n        }\\n\\n        this._input = this._input.slice(1);\\n        return ch;\\n    },\\n\\n// unshifts one char (or a string) into the input\\nunput:function (ch) {\\n        var len = ch.length;\\n        var lines = ch.split(/(?:\\\\r\\\\n?|\\\\n)/g);\\n\\n        this._input = ch + this._input;\\n        this.yytext = this.yytext.substr(0, this.yytext.length - len);\\n        //this.yyleng -= len;\\n        this.offset -= len;\\n        var oldLines = this.match.split(/(?:\\\\r\\\\n?|\\\\n)/g);\\n        this.match = this.match.substr(0, this.match.length - 1);\\n        this.matched = this.matched.substr(0, this.matched.length - 1);\\n\\n        if (lines.length - 1) {\\n            this.yylineno -= lines.length - 1;\\n        }\\n        var r = this.yylloc.range;\\n\\n        this.yylloc = {\\n            first_line: this.yylloc.first_line,\\n            last_line: this.yylineno + 1,\\n            first_column: this.yylloc.first_column,\\n            last_column: lines ?\\n                (lines.length === oldLines.length ? this.yylloc.first_column : 0)\\n                 + oldLines[oldLines.length - lines.length].length - lines[0].length :\\n              this.yylloc.first_column - len\\n        };\\n\\n        if (this.options.ranges) {\\n            this.yylloc.range = [r[0], r[0] + this.yyleng - len];\\n        }\\n        this.yyleng = this.yytext.length;\\n        return this;\\n    },\\n\\n// When called from action, caches matched text and appends it on next action\\nmore:function () {\\n        this._more = true;\\n        return this;\\n    },\\n\\n// When called from action, signals the lexer that this rule fails to match the input, so the next matching rule (regex) should be tested instead.\\nreject:function () {\\n        if (this.options.backtrack_lexer) {\\n            this._backtrack = true;\\n        } else {\\n            return this.parseError('Lexical error on line ' + (this.yylineno + 1) + '. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\\\\n' + this.showPosition(), {\\n                text: \\\"\\\",\\n                token: null,\\n                line: this.yylineno\\n            });\\n\\n        }\\n        return this;\\n    },\\n\\n// retain first n characters of the match\\nless:function (n) {\\n        this.unput(this.match.slice(n));\\n    },\\n\\n// displays already matched input, i.e. for error messages\\npastInput:function () {\\n        var past = this.matched.substr(0, this.matched.length - this.match.length);\\n        return (past.length > 20 ? '...':'') + past.substr(-20).replace(/\\\\n/g, \\\"\\\");\\n    },\\n\\n// displays upcoming input, i.e. for error messages\\nupcomingInput:function () {\\n        var next = this.match;\\n        if (next.length < 20) {\\n            next += this._input.substr(0, 20-next.length);\\n        }\\n        return (next.substr(0,20) + (next.length > 20 ? '...' : '')).replace(/\\\\n/g, \\\"\\\");\\n    },\\n\\n// displays the character position where the lexing error occurred, i.e. for error messages\\nshowPosition:function () {\\n        var pre = this.pastInput();\\n        var c = new Array(pre.length + 1).join(\\\"-\\\");\\n        return pre + this.upcomingInput() + \\\"\\\\n\\\" + c + \\\"^\\\";\\n    },\\n\\n// test the lexed token: return FALSE when not a match, otherwise return token\\ntest_match:function (match, indexed_rule) {\\n        var token,\\n            lines,\\n            backup;\\n\\n        if (this.options.backtrack_lexer) {\\n            // save context\\n            backup = {\\n                yylineno: this.yylineno,\\n                yylloc: {\\n                    first_line: this.yylloc.first_line,\\n                    last_line: this.last_line,\\n                    first_column: this.yylloc.first_column,\\n                    last_column: this.yylloc.last_column\\n                },\\n                yytext: this.yytext,\\n                match: this.match,\\n                matches: this.matches,\\n                matched: this.matched,\\n                yyleng: this.yyleng,\\n                offset: this.offset,\\n                _more: this._more,\\n                _input: this._input,\\n                yy: this.yy,\\n                conditionStack: this.conditionStack.slice(0),\\n                done: this.done\\n            };\\n            if (this.options.ranges) {\\n                backup.yylloc.range = this.yylloc.range.slice(0);\\n            }\\n        }\\n\\n        lines = match[0].match(/(?:\\\\r\\\\n?|\\\\n).*/g);\\n        if (lines) {\\n            this.yylineno += lines.length;\\n        }\\n        this.yylloc = {\\n            first_line: this.yylloc.last_line,\\n            last_line: this.yylineno + 1,\\n            first_column: this.yylloc.last_column,\\n            last_column: lines ?\\n                         lines[lines.length - 1].length - lines[lines.length - 1].match(/\\\\r?\\\\n?/)[0].length :\\n                         this.yylloc.last_column + match[0].length\\n        };\\n        this.yytext += match[0];\\n        this.match += match[0];\\n        this.matches = match;\\n        this.yyleng = this.yytext.length;\\n        if (this.options.ranges) {\\n            this.yylloc.range = [this.offset, this.offset += this.yyleng];\\n        }\\n        this._more = false;\\n        this._backtrack = false;\\n        this._input = this._input.slice(match[0].length);\\n        this.matched += match[0];\\n        token = this.performAction.call(this, this.yy, this, indexed_rule, this.conditionStack[this.conditionStack.length - 1]);\\n        if (this.done && this._input) {\\n            this.done = false;\\n        }\\n        if (token) {\\n            return token;\\n        } else if (this._backtrack) {\\n            // recover context\\n            for (var k in backup) {\\n                this[k] = backup[k];\\n            }\\n            return false; // rule action called reject() implying the next rule should be tested instead.\\n        }\\n        return false;\\n    },\\n\\n// return next match in input\\nnext:function () {\\n        if (this.done) {\\n            return this.EOF;\\n        }\\n        if (!this._input) {\\n            this.done = true;\\n        }\\n\\n        var token,\\n            match,\\n            tempMatch,\\n            index;\\n        if (!this._more) {\\n            this.yytext = '';\\n            this.match = '';\\n        }\\n        var rules = this._currentRules();\\n        for (var i = 0; i < rules.length; i++) {\\n            tempMatch = this._input.match(this.rules[rules[i]]);\\n            if (tempMatch && (!match || tempMatch[0].length > match[0].length)) {\\n                match = tempMatch;\\n                index = i;\\n                if (this.options.backtrack_lexer) {\\n                    token = this.test_match(tempMatch, rules[i]);\\n                    if (token !== false) {\\n                        return token;\\n                    } else if (this._backtrack) {\\n                        match = false;\\n                        continue; // rule action called reject() implying a rule MISmatch.\\n                    } else {\\n                        // else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)\\n                        return false;\\n                    }\\n                } else if (!this.options.flex) {\\n                    break;\\n                }\\n            }\\n        }\\n        if (match) {\\n            token = this.test_match(match, rules[index]);\\n            if (token !== false) {\\n                return token;\\n            }\\n            // else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)\\n            return false;\\n        }\\n        if (this._input === \\\"\\\") {\\n            return this.EOF;\\n        } else {\\n            return this.parseError('Lexical error on line ' + (this.yylineno + 1) + '. Unrecognized text.\\\\n' + this.showPosition(), {\\n                text: \\\"\\\",\\n                token: null,\\n                line: this.yylineno\\n            });\\n        }\\n    },\\n\\n// return next match that has a token\\nlex:function lex() {\\n        var r = this.next();\\n        if (r) {\\n            return r;\\n        } else {\\n            return this.lex();\\n        }\\n    },\\n\\n// activates a new lexer condition state (pushes the new lexer condition state onto the condition stack)\\nbegin:function begin(condition) {\\n        this.conditionStack.push(condition);\\n    },\\n\\n// pop the previously active lexer condition state off the condition stack\\npopState:function popState() {\\n        var n = this.conditionStack.length - 1;\\n        if (n > 0) {\\n            return this.conditionStack.pop();\\n        } else {\\n            return this.conditionStack[0];\\n        }\\n    },\\n\\n// produce the lexer rule set which is active for the currently active lexer condition state\\n_currentRules:function _currentRules() {\\n        if (this.conditionStack.length && this.conditionStack[this.conditionStack.length - 1]) {\\n            return this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules;\\n        } else {\\n            return this.conditions[\\\"INITIAL\\\"].rules;\\n        }\\n    },\\n\\n// return the currently active lexer condition state; when an index argument is provided it produces the N-th previous condition state, if available\\ntopState:function topState(n) {\\n        n = this.conditionStack.length - 1 - Math.abs(n || 0);\\n        if (n >= 0) {\\n            return this.conditionStack[n];\\n        } else {\\n            return \\\"INITIAL\\\";\\n        }\\n    },\\n\\n// alias for begin(condition)\\npushState:function pushState(condition) {\\n        this.begin(condition);\\n    },\\n\\n// return the number of states currently on the stack\\nstateStackSize:function stateStackSize() {\\n        return this.conditionStack.length;\\n    },\\noptions: {},\\nperformAction: function anonymous(yy,yy_,$avoiding_name_collisions,YY_START) {\\nvar YYSTATE=YY_START;\\nswitch($avoiding_name_collisions) {\\ncase 0:this.begin(\\\"letsquote\\\"); return \\\"QUOTE\\\";\\nbreak;\\ncase 1:this.popState(); this.begin(\\\"endquote\\\"); return \\\"QUOTED_STRING\\\";\\nbreak;\\ncase 2:this.popState(); return \\\"QUOTE\\\";\\nbreak;\\ncase 3:/* skip whitespace */\\nbreak;\\ncase 4:return \\\"LEFT_PARENTHESE\\\";\\nbreak;\\ncase 5:return \\\"RIGHT_PARENTHESE\\\";\\nbreak;\\ncase 6:return \\\"AND\\\";\\nbreak;\\ncase 7:return \\\"OR\\\";\\nbreak;\\ncase 8:return \\\"NOT\\\";\\nbreak;\\ncase 9:return \\\"DEFINITION\\\";\\nbreak;\\ncase 10:return 19;\\nbreak;\\ncase 11:return 16;\\nbreak;\\ncase 12:return 6;\\nbreak;\\n}\\n},\\nrules: [/^(?:\\\")/,/^(?:(\\\\\\\\\\\"|[^\\\"])*)/,/^(?:\\\")/,/^(?:[^\\\\S]+)/,/^(?:\\\\()/,/^(?:\\\\))/,/^(?:AND\\\\b)/,/^(?:OR\\\\b)/,/^(?:NOT\\\\b)/,/^(?::)/,/^(?:(!?=|<=?|>=?))/,/^(?:[^\\\\s\\\\n\\\"():><!=]+)/,/^(?:$)/],\\nconditions: {\\\"endquote\\\":{\\\"rules\\\":[2],\\\"inclusive\\\":false},\\\"letsquote\\\":{\\\"rules\\\":[1],\\\"inclusive\\\":false},\\\"INITIAL\\\":{\\\"rules\\\":[0,3,4,5,6,7,8,9,10,11,12],\\\"inclusive\\\":true}}\\n});\\nreturn lexer;\\n})();\\nparser.lexer = lexer;\\nfunction Parser () {\\n  this.yy = {};\\n}\\nParser.prototype = parser;parser.Parser = Parser;\\nreturn new Parser;\\n})();;  return parser.parse(string);\\n} // parseStringToObject\\n\\n;/*global RSVP, window, parseStringToObject*/\\n/*jslint nomen: true, maxlen: 90*/\\n(function (RSVP, window, parseStringToObject) {\\n  \\\"use strict\\\";\\n\\n  var query_class_dict = {},\\n    regexp_escape = /[\\\\-\\\\[\\\\]{}()*+?.,\\\\\\\\\\\\^$|#\\\\s]/g,\\n    regexp_percent = /%/g,\\n    regexp_underscore = /_/g,\\n    regexp_operator = /^(?:AND|OR|NOT)$/i,\\n    regexp_comparaison = /^(?:!?=|<=?|>=?)$/i;\\n\\n  /**\\n   * Convert metadata values to array of strings. ex:\\n   *\\n   *     \\\"a\\\" -> [\\\"a\\\"],\\n   *     {\\\"content\\\": \\\"a\\\"} -> [\\\"a\\\"]\\n   *\\n   * @param  {Any} value The metadata value\\n   * @return {Array} The value in string array format\\n   */\\n  function metadataValueToStringArray(value) {\\n    var i, new_value = [];\\n    if (value === undefined) {\\n      return undefined;\\n    }\\n    if (!Array.isArray(value)) {\\n      value = [value];\\n    }\\n    for (i = 0; i < value.length; i += 1) {\\n      if (typeof value[i] === 'object') {\\n        new_value[i] = value[i].content;\\n      } else {\\n        new_value[i] = value[i];\\n      }\\n    }\\n    return new_value;\\n  }\\n\\n  /**\\n   * A sort function to sort items by key\\n   *\\n   * @param  {String} key The key to sort on\\n   * @param  {String} [way=\\\"ascending\\\"] 'ascending' or 'descending'\\n   * @return {Function} The sort function\\n   */\\n  function sortFunction(key, way) {\\n    var result;\\n    if (way === 'descending') {\\n      result = 1;\\n    } else if (way === 'ascending') {\\n      result = -1;\\n    } else {\\n      throw new TypeError(\\\"Query.sortFunction(): \\\" +\\n                          \\\"Argument 2 must be 'ascending' or 'descending'\\\");\\n    }\\n    return function (a, b) {\\n      // this comparison is 5 times faster than json comparison\\n      var i, l;\\n      a = metadataValueToStringArray(a[key]) || [];\\n      b = metadataValueToStringArray(b[key]) || [];\\n      l = a.length > b.length ? a.length : b.length;\\n      for (i = 0; i < l; i += 1) {\\n        if (a[i] === undefined) {\\n          return result;\\n        }\\n        if (b[i] === undefined) {\\n          return -result;\\n        }\\n        if (a[i] > b[i]) {\\n          return -result;\\n        }\\n        if (a[i] < b[i]) {\\n          return result;\\n        }\\n      }\\n      return 0;\\n    };\\n  }\\n\\n  /**\\n   * Sort a list of items, according to keys and directions.\\n   *\\n   * @param  {Array} sort_on_option List of couples [key, direction]\\n   * @param  {Array} list The item list to sort\\n   * @return {Array} The filtered list\\n   */\\n  function sortOn(sort_on_option, list) {\\n    var sort_index;\\n    if (!Array.isArray(sort_on_option)) {\\n      throw new TypeError(\\\"jioquery.sortOn(): \\\" +\\n                          \\\"Argument 1 is not of type 'array'\\\");\\n    }\\n    for (sort_index = sort_on_option.length - 1; sort_index >= 0;\\n         sort_index -= 1) {\\n      list.sort(sortFunction(\\n        sort_on_option[sort_index][0],\\n        sort_on_option[sort_index][1]\\n      ));\\n    }\\n    return list;\\n  }\\n\\n  /**\\n   * Limit a list of items, according to index and length.\\n   *\\n   * @param  {Array} limit_option A couple [from, length]\\n   * @param  {Array} list The item list to limit\\n   * @return {Array} The filtered list\\n   */\\n  function limit(limit_option, list) {\\n    if (!Array.isArray(limit_option)) {\\n      throw new TypeError(\\\"jioquery.limit(): \\\" +\\n                          \\\"Argument 1 is not of type 'array'\\\");\\n    }\\n    if (!Array.isArray(list)) {\\n      throw new TypeError(\\\"jioquery.limit(): \\\" +\\n                          \\\"Argument 2 is not of type 'array'\\\");\\n    }\\n    list.splice(0, limit_option[0]);\\n    if (limit_option[1]) {\\n      list.splice(limit_option[1]);\\n    }\\n    return list;\\n  }\\n\\n  /**\\n   * Filter a list of items, modifying them to select only wanted keys.\\n   *\\n   * @param  {Array} select_option Key list to keep\\n   * @param  {Array} list The item list to filter\\n   * @return {Array} The filtered list\\n   */\\n  function select(select_option, list) {\\n    var i, j, new_item;\\n    if (!Array.isArray(select_option)) {\\n      throw new TypeError(\\\"jioquery.select(): \\\" +\\n                          \\\"Argument 1 is not of type Array\\\");\\n    }\\n    if (!Array.isArray(list)) {\\n      throw new TypeError(\\\"jioquery.select(): \\\" +\\n                          \\\"Argument 2 is not of type Array\\\");\\n    }\\n    for (i = 0; i < list.length; i += 1) {\\n      new_item = {};\\n      for (j = 0; j < select_option.length; j += 1) {\\n        if (list[i].hasOwnProperty([select_option[j]])) {\\n          new_item[select_option[j]] = list[i][select_option[j]];\\n        }\\n      }\\n      for (j in new_item) {\\n        if (new_item.hasOwnProperty(j)) {\\n          list[i] = new_item;\\n          break;\\n        }\\n      }\\n    }\\n    return list;\\n  }\\n\\n  /**\\n   * The query to use to filter a list of objects.\\n   * This is an abstract class.\\n   *\\n   * @class Query\\n   * @constructor\\n   */\\n  function Query() {\\n\\n    /**\\n     * Called before parsing the query. Must be overridden!\\n     *\\n     * @method onParseStart\\n     * @param  {Object} object The object shared in the parse process\\n     * @param  {Object} option Some option gave in parse()\\n     */\\n  //   this.onParseStart = emptyFunction;\\n\\n    /**\\n     * Called when parsing a simple query. Must be overridden!\\n     *\\n     * @method onParseSimpleQuery\\n     * @param  {Object} object The object shared in the parse process\\n     * @param  {Object} option Some option gave in parse()\\n     */\\n  //   this.onParseSimpleQuery = emptyFunction;\\n\\n    /**\\n     * Called when parsing a complex query. Must be overridden!\\n     *\\n     * @method onParseComplexQuery\\n     * @param  {Object} object The object shared in the parse process\\n     * @param  {Object} option Some option gave in parse()\\n     */\\n  //   this.onParseComplexQuery = emptyFunction;\\n\\n    /**\\n     * Called after parsing the query. Must be overridden!\\n     *\\n     * @method onParseEnd\\n     * @param  {Object} object The object shared in the parse process\\n     * @param  {Object} option Some option gave in parse()\\n     */\\n  //   this.onParseEnd = emptyFunction;\\n\\n    return;\\n  }\\n\\n  /**\\n   * Filter the item list with matching item only\\n   *\\n   * @method exec\\n   * @param  {Array} item_list The list of object\\n   * @param  {Object} [option] Some operation option\\n   * @param  {Array} [option.select_list] A object keys to retrieve\\n   * @param  {Array} [option.sort_on] Couples of object keys and \\\"ascending\\\"\\n   *                 or \\\"descending\\\"\\n   * @param  {Array} [option.limit] Couple of integer, first is an index and\\n   *                 second is the length.\\n   */\\n  Query.prototype.exec = function (item_list, option) {\\n    if (!Array.isArray(item_list)) {\\n      throw new TypeError(\\\"Query().exec(): Argument 1 is not of type 'array'\\\");\\n    }\\n    if (option === undefined) {\\n      option = {};\\n    }\\n    if (typeof option !== 'object') {\\n      throw new TypeError(\\\"Query().exec(): \\\" +\\n                          \\\"Optional argument 2 is not of type 'object'\\\");\\n    }\\n    var context = this,\\n      i;\\n    for (i = item_list.length - 1; i >= 0; i -= 1) {\\n      if (!context.match(item_list[i])) {\\n        item_list.splice(i, 1);\\n      }\\n    }\\n\\n    if (option.sort_on) {\\n      sortOn(option.sort_on, item_list);\\n    }\\n\\n    if (option.limit) {\\n      limit(option.limit, item_list);\\n    }\\n\\n    select(option.select_list || [], item_list);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return item_list;\\n      });\\n  };\\n\\n  /**\\n   * Test if an item matches this query\\n   *\\n   * @method match\\n   * @param  {Object} item The object to test\\n   * @return {Boolean} true if match, false otherwise\\n   */\\n  Query.prototype.match = function () {\\n    return true;\\n  };\\n\\n  /**\\n   * Browse the Query in deep calling parser method in each step.\\n   *\\n   * `onParseStart` is called first, on end `onParseEnd` is called.\\n   * It starts from the simple queries at the bottom of the tree calling the\\n   * parser method `onParseSimpleQuery`, and go up calling the\\n   * `onParseComplexQuery` method.\\n   *\\n   * @method parse\\n   * @param  {Object} option Any options you want (except 'parsed')\\n   * @return {Any} The parse result\\n   */\\n  Query.prototype.parse = function (option) {\\n    var that = this,\\n      object;\\n    /**\\n     * The recursive parser.\\n     *\\n     * @param  {Object} object The object shared in the parse process\\n     * @param  {Object} options Some options usable in the parseMethods\\n     * @return {Any} The parser result\\n     */\\n    function recParse(object, option) {\\n      var query = object.parsed,\\n        queue = new RSVP.Queue(),\\n        i;\\n\\n      function enqueue(j) {\\n        queue\\n          .push(function () {\\n            object.parsed = query.query_list[j];\\n            return recParse(object, option);\\n          })\\n          .push(function () {\\n            query.query_list[j] = object.parsed;\\n          });\\n      }\\n\\n      if (query.type === \\\"complex\\\") {\\n\\n\\n        for (i = 0; i < query.query_list.length; i += 1) {\\n          enqueue(i);\\n        }\\n\\n        return queue\\n          .push(function () {\\n            object.parsed = query;\\n            return that.onParseComplexQuery(object, option);\\n          });\\n\\n      }\\n      if (query.type === \\\"simple\\\") {\\n        return that.onParseSimpleQuery(object, option);\\n      }\\n    }\\n    object = {\\n      parsed: JSON.parse(JSON.stringify(that.serialized()))\\n    };\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that.onParseStart(object, option);\\n      })\\n      .push(function () {\\n        return recParse(object, option);\\n      })\\n      .push(function () {\\n        return that.onParseEnd(object, option);\\n      })\\n      .push(function () {\\n        return object.parsed;\\n      });\\n\\n  };\\n\\n  /**\\n   * Convert this query to a parsable string.\\n   *\\n   * @method toString\\n   * @return {String} The string version of this query\\n   */\\n  Query.prototype.toString = function () {\\n    return \\\"\\\";\\n  };\\n\\n  /**\\n   * Convert this query to an jsonable object in order to be remake thanks to\\n   * QueryFactory class.\\n   *\\n   * @method serialized\\n   * @return {Object} The jsonable object\\n   */\\n  Query.prototype.serialized = function () {\\n    return undefined;\\n  };\\n\\n  /**\\n   * Provides static methods to create Query object\\n   *\\n   * @class QueryFactory\\n   */\\n  function QueryFactory() {\\n    return;\\n  }\\n\\n  /**\\n   * Escapes regexp special chars from a string.\\n   *\\n   * @param  {String} string The string to escape\\n   * @return {String} The escaped string\\n   */\\n  function stringEscapeRegexpCharacters(string) {\\n    return string.replace(regexp_escape, \\\"\\\\\\\\$&\\\");\\n  }\\n\\n  /**\\n   * Inherits the prototype methods from one constructor into another. The\\n   * prototype of `constructor` will be set to a new object created from\\n   * `superConstructor`.\\n   *\\n   * @param  {Function} constructor The constructor which inherits the super one\\n   * @param  {Function} superConstructor The super constructor\\n   */\\n  function inherits(constructor, superConstructor) {\\n    constructor.super_ = superConstructor;\\n    constructor.prototype = Object.create(superConstructor.prototype, {\\n      \\\"constructor\\\": {\\n        \\\"configurable\\\": true,\\n        \\\"enumerable\\\": false,\\n        \\\"writable\\\": true,\\n        \\\"value\\\": constructor\\n      }\\n    });\\n  }\\n\\n  /**\\n   * Convert a search text to a regexp.\\n   *\\n   * @param  {String} string The string to convert\\n   * @param  {Boolean} [use_wildcard_character=true] Use wildcard \\\"%\\\" and \\\"_\\\"\\n   * @return {RegExp} The search text regexp\\n   */\\n  function searchTextToRegExp(string, use_wildcard_characters) {\\n    if (typeof string !== 'string') {\\n      throw new TypeError(\\\"jioquery.searchTextToRegExp(): \\\" +\\n                          \\\"Argument 1 is not of type 'string'\\\");\\n    }\\n    if (use_wildcard_characters === false) {\\n      return new RegExp(\\\"^\\\" + stringEscapeRegexpCharacters(string) + \\\"$\\\");\\n    }\\n    return new RegExp(\\\"^\\\" + stringEscapeRegexpCharacters(string)\\n      .replace(regexp_percent, '.*')\\n      .replace(regexp_underscore, '.') + \\\"$\\\");\\n  }\\n\\n  /**\\n   * The ComplexQuery inherits from Query, and compares one or several metadata\\n   * values.\\n   *\\n   * @class ComplexQuery\\n   * @extends Query\\n   * @param  {Object} [spec={}] The specifications\\n   * @param  {String} [spec.operator=\\\"AND\\\"] The compare method to use\\n   * @param  {String} spec.key The metadata key\\n   * @param  {String} spec.value The value of the metadata to compare\\n   */\\n  function ComplexQuery(spec, key_schema) {\\n    Query.call(this);\\n\\n    /**\\n     * Logical operator to use to compare object values\\n     *\\n     * @attribute operator\\n     * @type String\\n     * @default \\\"AND\\\"\\n     * @optional\\n     */\\n    this.operator = spec.operator;\\n\\n    /**\\n     * The sub Query list which are used to query an item.\\n     *\\n     * @attribute query_list\\n     * @type Array\\n     * @default []\\n     * @optional\\n     */\\n    this.query_list = spec.query_list || [];\\n    this.query_list = this.query_list.map(\\n      // decorate the map to avoid sending the index as key_schema argument\\n      function (o) { return QueryFactory.create(o, key_schema); }\\n    );\\n\\n  }\\n  inherits(ComplexQuery, Query);\\n\\n  ComplexQuery.prototype.operator = \\\"AND\\\";\\n  ComplexQuery.prototype.type = \\\"complex\\\";\\n\\n  /**\\n   * #crossLink \\\"Query/match:method\\\"\\n   */\\n  ComplexQuery.prototype.match = function (item) {\\n    var operator = this.operator;\\n    if (!(regexp_operator.test(operator))) {\\n      operator = \\\"AND\\\";\\n    }\\n    return this[operator.toUpperCase()](item);\\n  };\\n\\n  /**\\n   * #crossLink \\\"Query/toString:method\\\"\\n   */\\n  ComplexQuery.prototype.toString = function () {\\n    var str_list = [], this_operator = this.operator;\\n    if (this.operator === \\\"NOT\\\") {\\n      str_list.push(\\\"NOT (\\\");\\n      str_list.push(this.query_list[0].toString());\\n      str_list.push(\\\")\\\");\\n      return str_list.join(\\\" \\\");\\n    }\\n    this.query_list.forEach(function (query) {\\n      str_list.push(\\\"(\\\");\\n      str_list.push(query.toString());\\n      str_list.push(\\\")\\\");\\n      str_list.push(this_operator);\\n    });\\n    str_list.length -= 1;\\n    return str_list.join(\\\" \\\");\\n  };\\n\\n  /**\\n   * #crossLink \\\"Query/serialized:method\\\"\\n   */\\n  ComplexQuery.prototype.serialized = function () {\\n    var s = {\\n      \\\"type\\\": \\\"complex\\\",\\n      \\\"operator\\\": this.operator,\\n      \\\"query_list\\\": []\\n    };\\n    this.query_list.forEach(function (query) {\\n      s.query_list.push(\\n        typeof query.toJSON === \\\"function\\\" ? query.toJSON() : query\\n      );\\n    });\\n    return s;\\n  };\\n  ComplexQuery.prototype.toJSON = ComplexQuery.prototype.serialized;\\n\\n  /**\\n   * Comparison operator, test if all sub queries match the\\n   * item value\\n   *\\n   * @method AND\\n   * @param  {Object} item The item to match\\n   * @return {Boolean} true if all match, false otherwise\\n   */\\n  ComplexQuery.prototype.AND = function (item) {\\n    var result = true,\\n      i = 0;\\n\\n    while (result && (i !== this.query_list.length)) {\\n      result = this.query_list[i].match(item);\\n      i += 1;\\n    }\\n    return result;\\n\\n  };\\n\\n  /**\\n   * Comparison operator, test if one of the sub queries matches the\\n   * item value\\n   *\\n   * @method OR\\n   * @param  {Object} item The item to match\\n   * @return {Boolean} true if one match, false otherwise\\n   */\\n  ComplexQuery.prototype.OR = function (item) {\\n    var result = false,\\n      i = 0;\\n\\n    while ((!result) && (i !== this.query_list.length)) {\\n      result = this.query_list[i].match(item);\\n      i += 1;\\n    }\\n\\n    return result;\\n  };\\n\\n  /**\\n   * Comparison operator, test if the sub query does not match the\\n   * item value\\n   *\\n   * @method NOT\\n   * @param  {Object} item The item to match\\n   * @return {Boolean} true if one match, false otherwise\\n   */\\n  ComplexQuery.prototype.NOT = function (item) {\\n    return !this.query_list[0].match(item);\\n  };\\n\\n  /**\\n   * Creates Query object from a search text string or a serialized version\\n   * of a Query.\\n   *\\n   * @method create\\n   * @static\\n   * @param  {Object,String} object The search text or the serialized version\\n   *         of a Query\\n   * @return {Query} A Query object\\n   */\\n  QueryFactory.create = function (object, key_schema) {\\n    if (object === \\\"\\\") {\\n      return new Query();\\n    }\\n    if (typeof object === \\\"string\\\") {\\n      object = parseStringToObject(object);\\n    }\\n    if (typeof (object || {}).type === \\\"string\\\" &&\\n        query_class_dict[object.type]) {\\n      return new query_class_dict[object.type](object, key_schema);\\n    }\\n    throw new TypeError(\\\"QueryFactory.create(): \\\" +\\n                        \\\"Argument 1 is not a search text or a parsable object\\\");\\n  };\\n\\n  function objectToSearchText(query) {\\n    var str_list = [];\\n    if (query.type === \\\"complex\\\") {\\n      str_list.push(\\\"(\\\");\\n      (query.query_list || []).forEach(function (sub_query) {\\n        str_list.push(objectToSearchText(sub_query));\\n        str_list.push(query.operator);\\n      });\\n      str_list.length -= 1;\\n      str_list.push(\\\")\\\");\\n      return str_list.join(\\\" \\\");\\n    }\\n    if (query.type === \\\"simple\\\") {\\n      return (query.key ? query.key + \\\": \\\" : \\\"\\\") +\\n        (query.operator || \\\"\\\") + ' \\\"' + query.value + '\\\"';\\n    }\\n    throw new TypeError(\\\"This object is not a query\\\");\\n  }\\n\\n  function checkKeySchema(key_schema) {\\n    var prop;\\n\\n    if (key_schema !== undefined) {\\n      if (typeof key_schema !== 'object') {\\n        throw new TypeError(\\\"SimpleQuery().create(): \\\" +\\n                            \\\"key_schema is not of type 'object'\\\");\\n      }\\n      // key_set is mandatory\\n      if (key_schema.key_set === undefined) {\\n        throw new TypeError(\\\"SimpleQuery().create(): \\\" +\\n                            \\\"key_schema has no 'key_set' property\\\");\\n      }\\n      for (prop in key_schema) {\\n        if (key_schema.hasOwnProperty(prop)) {\\n          switch (prop) {\\n          case 'key_set':\\n          case 'cast_lookup':\\n          case 'match_lookup':\\n            break;\\n          default:\\n            throw new TypeError(\\\"SimpleQuery().create(): \\\" +\\n                               \\\"key_schema has unknown property '\\\" + prop + \\\"'\\\");\\n          }\\n        }\\n      }\\n    }\\n  }\\n\\n  /**\\n   * The SimpleQuery inherits from Query, and compares one metadata value\\n   *\\n   * @class SimpleQuery\\n   * @extends Query\\n   * @param  {Object} [spec={}] The specifications\\n   * @param  {String} [spec.operator=\\\"=\\\"] The compare method to use\\n   * @param  {String} spec.key The metadata key\\n   * @param  {String} spec.value The value of the metadata to compare\\n   */\\n  function SimpleQuery(spec, key_schema) {\\n    Query.call(this);\\n\\n    checkKeySchema(key_schema);\\n\\n    this._key_schema = key_schema || {};\\n\\n    /**\\n     * Operator to use to compare object values\\n     *\\n     * @attribute operator\\n     * @type String\\n     * @optional\\n     */\\n    this.operator = spec.operator;\\n\\n    /**\\n     * Key of the object which refers to the value to compare\\n     *\\n     * @attribute key\\n     * @type String\\n     */\\n    this.key = spec.key;\\n\\n    /**\\n     * Value is used to do the comparison with the object value\\n     *\\n     * @attribute value\\n     * @type String\\n     */\\n    this.value = spec.value;\\n\\n  }\\n  inherits(SimpleQuery, Query);\\n\\n  SimpleQuery.prototype.type = \\\"simple\\\";\\n\\n  function checkKey(key) {\\n    var prop;\\n\\n    if (key.read_from === undefined) {\\n      throw new TypeError(\\\"Custom key is missing the read_from property\\\");\\n    }\\n\\n    for (prop in key) {\\n      if (key.hasOwnProperty(prop)) {\\n        switch (prop) {\\n        case 'read_from':\\n        case 'cast_to':\\n        case 'equal_match':\\n          break;\\n        default:\\n          throw new TypeError(\\\"Custom key has unknown property '\\\" +\\n                              prop + \\\"'\\\");\\n        }\\n      }\\n    }\\n  }\\n\\n  /**\\n   * #crossLink \\\"Query/match:method\\\"\\n   */\\n  SimpleQuery.prototype.match = function (item) {\\n    var object_value = null,\\n      equal_match = null,\\n      cast_to = null,\\n      matchMethod = null,\\n      operator = this.operator,\\n      value = null,\\n      key = this.key;\\n\\n    if (!(regexp_comparaison.test(operator))) {\\n      // `operator` is not correct, we have to change it to \\\"like\\\" or \\\"=\\\"\\n      if (regexp_percent.test(this.value)) {\\n        // `value` contains a non escaped `%`\\n        operator = \\\"like\\\";\\n      } else {\\n        // `value` does not contain non escaped `%`\\n        operator = \\\"=\\\";\\n      }\\n    }\\n\\n    matchMethod = this[operator];\\n\\n    if (this._key_schema.key_set && this._key_schema.key_set[key] !== undefined) {\\n      key = this._key_schema.key_set[key];\\n    }\\n\\n    if (typeof key === 'object') {\\n      checkKey(key);\\n      object_value = item[key.read_from];\\n\\n      equal_match = key.equal_match;\\n\\n      // equal_match can be a string\\n      if (typeof equal_match === 'string') {\\n        // XXX raise error if equal_match not in match_lookup\\n        equal_match = this._key_schema.match_lookup[equal_match];\\n      }\\n\\n      // equal_match overrides the default '=' operator\\n      if (equal_match !== undefined) {\\n        matchMethod = (operator === \\\"=\\\" || operator === \\\"like\\\" ?\\n                       equal_match : matchMethod);\\n      }\\n\\n      value = this.value;\\n      cast_to = key.cast_to;\\n      if (cast_to) {\\n        // cast_to can be a string\\n        if (typeof cast_to === 'string') {\\n          // XXX raise error if cast_to not in cast_lookup\\n          cast_to = this._key_schema.cast_lookup[cast_to];\\n        }\\n\\n        try {\\n          value = cast_to(value);\\n        } catch (e) {\\n          value = undefined;\\n        }\\n\\n        try {\\n          object_value = cast_to(object_value);\\n        } catch (e) {\\n          object_value = undefined;\\n        }\\n      }\\n    } else {\\n      object_value = item[key];\\n      value = this.value;\\n    }\\n    if (object_value === undefined || value === undefined) {\\n      return false;\\n    }\\n    return matchMethod(object_value, value);\\n  };\\n\\n  /**\\n   * #crossLink \\\"Query/toString:method\\\"\\n   */\\n  SimpleQuery.prototype.toString = function () {\\n    return (this.key ? this.key + \\\":\\\" : \\\"\\\") +\\n      (this.operator ? \\\" \\\" + this.operator : \\\"\\\") + ' \\\"' + this.value + '\\\"';\\n  };\\n\\n  /**\\n   * #crossLink \\\"Query/serialized:method\\\"\\n   */\\n  SimpleQuery.prototype.serialized = function () {\\n    var object = {\\n      \\\"type\\\": \\\"simple\\\",\\n      \\\"key\\\": this.key,\\n      \\\"value\\\": this.value\\n    };\\n    if (this.operator !== undefined) {\\n      object.operator = this.operator;\\n    }\\n    return object;\\n  };\\n  SimpleQuery.prototype.toJSON = SimpleQuery.prototype.serialized;\\n\\n  /**\\n   * Comparison operator, test if this query value matches the item value\\n   *\\n   * @method =\\n   * @param  {String} object_value The value to compare\\n   * @param  {String} comparison_value The comparison value\\n   * @return {Boolean} true if match, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\"=\\\"] = function (object_value, comparison_value) {\\n    var value, i;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    for (i = 0; i < object_value.length; i += 1) {\\n      value = object_value[i];\\n      if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n        value = value.content;\\n      }\\n      if (typeof value.cmp === \\\"function\\\") {\\n        return (value.cmp(comparison_value) === 0);\\n      }\\n      if (comparison_value.toString() === value.toString()) {\\n        return true;\\n      }\\n    }\\n    return false;\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value matches the item value\\n   *\\n   * @method like\\n   * @param  {String} object_value The value to compare\\n   * @param  {String} comparison_value The comparison value\\n   * @return {Boolean} true if match, false otherwise\\n   */\\n  SimpleQuery.prototype.like = function (object_value, comparison_value) {\\n    var value, i;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    for (i = 0; i < object_value.length; i += 1) {\\n      value = object_value[i];\\n      if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n        value = value.content;\\n      }\\n      if (typeof value.cmp === \\\"function\\\") {\\n        return (value.cmp(comparison_value) === 0);\\n      }\\n      if (\\n        searchTextToRegExp(comparison_value.toString()).test(value.toString())\\n      ) {\\n        return true;\\n      }\\n    }\\n    return false;\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value does not match the item value\\n   *\\n   * @method !=\\n   * @param  {String} object_value The value to compare\\n   * @param  {String} comparison_value The comparison value\\n   * @return {Boolean} true if not match, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\"!=\\\"] = function (object_value, comparison_value) {\\n    var value, i;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    for (i = 0; i < object_value.length; i += 1) {\\n      value = object_value[i];\\n      if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n        value = value.content;\\n      }\\n      if (typeof value.cmp === \\\"function\\\") {\\n        return (value.cmp(comparison_value) !== 0);\\n      }\\n      if (comparison_value.toString() === value.toString()) {\\n        return false;\\n      }\\n    }\\n    return true;\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value is lower than the item value\\n   *\\n   * @method <\\n   * @param  {Number, String} object_value The value to compare\\n   * @param  {Number, String} comparison_value The comparison value\\n   * @return {Boolean} true if lower, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\"<\\\"] = function (object_value, comparison_value) {\\n    var value;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    value = object_value[0];\\n    if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n      value = value.content;\\n    }\\n    if (typeof value.cmp === \\\"function\\\") {\\n      return (value.cmp(comparison_value) < 0);\\n    }\\n    return (value < comparison_value);\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value is equal or lower than the\\n   * item value\\n   *\\n   * @method <=\\n   * @param  {Number, String} object_value The value to compare\\n   * @param  {Number, String} comparison_value The comparison value\\n   * @return {Boolean} true if equal or lower, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\"<=\\\"] = function (object_value, comparison_value) {\\n    var value;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    value = object_value[0];\\n    if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n      value = value.content;\\n    }\\n    if (typeof value.cmp === \\\"function\\\") {\\n      return (value.cmp(comparison_value) <= 0);\\n    }\\n    return (value <= comparison_value);\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value is greater than the item\\n   * value\\n   *\\n   * @method >\\n   * @param  {Number, String} object_value The value to compare\\n   * @param  {Number, String} comparison_value The comparison value\\n   * @return {Boolean} true if greater, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\">\\\"] = function (object_value, comparison_value) {\\n    var value;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    value = object_value[0];\\n    if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n      value = value.content;\\n    }\\n    if (typeof value.cmp === \\\"function\\\") {\\n      return (value.cmp(comparison_value) > 0);\\n    }\\n    return (value > comparison_value);\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value is equal or greater than the\\n   * item value\\n   *\\n   * @method >=\\n   * @param  {Number, String} object_value The value to compare\\n   * @param  {Number, String} comparison_value The comparison value\\n   * @return {Boolean} true if equal or greater, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\">=\\\"] = function (object_value, comparison_value) {\\n    var value;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    value = object_value[0];\\n    if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n      value = value.content;\\n    }\\n    if (typeof value.cmp === \\\"function\\\") {\\n      return (value.cmp(comparison_value) >= 0);\\n    }\\n    return (value >= comparison_value);\\n  };\\n\\n  query_class_dict.simple = SimpleQuery;\\n  query_class_dict.complex = ComplexQuery;\\n\\n  Query.parseStringToObject = parseStringToObject;\\n  Query.objectToSearchText = objectToSearchText;\\n\\n  window.Query = Query;\\n  window.SimpleQuery = SimpleQuery;\\n  window.ComplexQuery = ComplexQuery;\\n  window.QueryFactory = QueryFactory;\\n\\n}(RSVP, window, parseStringToObject));\\n;/*global window, moment */\\n/*jslint nomen: true, maxlen: 200*/\\n(function (window, moment) {\\n  \\\"use strict\\\";\\n\\n//   /**\\n//    * Add a secured (write permission denied) property to an object.\\n//    *\\n//    * @param  {Object} object The object to fill\\n//    * @param  {String} key The object key where to store the property\\n//    * @param  {Any} value The value to store\\n//    */\\n//   function _export(key, value) {\\n//     Object.defineProperty(to_export, key, {\\n//       \\\"configurable\\\": false,\\n//       \\\"enumerable\\\": true,\\n//       \\\"writable\\\": false,\\n//       \\\"value\\\": value\\n//     });\\n//   }\\n\\n  var YEAR = 'year',\\n    MONTH = 'month',\\n    DAY = 'day',\\n    HOUR = 'hour',\\n    MIN = 'minute',\\n    SEC = 'second',\\n    MSEC = 'millisecond',\\n    precision_grade = {\\n      'year': 0,\\n      'month': 1,\\n      'day': 2,\\n      'hour': 3,\\n      'minute': 4,\\n      'second': 5,\\n      'millisecond': 6\\n    },\\n    lesserPrecision = function (p1, p2) {\\n      return (precision_grade[p1] < precision_grade[p2]) ? p1 : p2;\\n    },\\n    JIODate;\\n\\n\\n  JIODate = function (str) {\\n    // in case of forgotten 'new'\\n    if (!(this instanceof JIODate)) {\\n      return new JIODate(str);\\n    }\\n\\n    if (str instanceof JIODate) {\\n      this.mom = str.mom.clone();\\n      this._precision = str._precision;\\n      return;\\n    }\\n\\n    if (str === undefined) {\\n      this.mom = moment();\\n      this.setPrecision(MSEC);\\n      return;\\n    }\\n\\n    this.mom = null;\\n    this._str = str;\\n\\n    // http://www.w3.org/TR/NOTE-datetime\\n    // http://dotat.at/tmp/ISO_8601-2004_E.pdf\\n\\n    // XXX these regexps fail to detect many invalid dates.\\n\\n    if (str.match(/\\\\d{4}-[01]\\\\d-[0-3]\\\\dT[0-2]\\\\d:[0-5]\\\\d:[0-5]\\\\d\\\\.\\\\d+([+\\\\-][0-2]\\\\d:[0-5]\\\\d|Z)/)\\n          || str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d-\\\\d\\\\d \\\\d\\\\d:\\\\d\\\\d:\\\\d\\\\d\\\\.\\\\d\\\\d\\\\d/)) {\\n      // ISO, milliseconds\\n      this.mom = moment(str);\\n      this.setPrecision(MSEC);\\n    } else if (str.match(/\\\\d{4}-[01]\\\\d-[0-3]\\\\dT[0-2]\\\\d:[0-5]\\\\d:[0-5]\\\\d([+\\\\-][0-2]\\\\d:[0-5]\\\\d|Z)/)\\n          || str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d-\\\\d\\\\d \\\\d\\\\d:\\\\d\\\\d:\\\\d\\\\d/)) {\\n      // ISO, seconds\\n      this.mom = moment(str);\\n      this.setPrecision(SEC);\\n    } else if (str.match(/\\\\d{4}-[01]\\\\d-[0-3]\\\\dT[0-2]\\\\d:[0-5]\\\\d([+\\\\-][0-2]\\\\d:[0-5]\\\\d|Z)/)\\n          || str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d-\\\\d\\\\d \\\\d\\\\d:\\\\d\\\\d/)) {\\n      // ISO, minutes\\n      this.mom = moment(str);\\n      this.setPrecision(MIN);\\n    } else if (str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d-\\\\d\\\\d \\\\d\\\\d/)) {\\n      this.mom = moment(str);\\n      this.setPrecision(HOUR);\\n    } else if (str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d-\\\\d\\\\d/)) {\\n      this.mom = moment(str);\\n      this.setPrecision(DAY);\\n    } else if (str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d/)) {\\n      this.mom = moment(str);\\n      this.setPrecision(MONTH);\\n    } else if (str.match(/\\\\d\\\\d\\\\d\\\\d/)) {\\n      // Creating a moment with only the year will show this deprecation\\n      // warning:\\n      //\\n      // Deprecation warning: moment construction falls back to js Date. This is\\n      // discouraged and will be removed in upcoming major release. Please refer\\n      // to https://github.com/moment/moment/issues/1407 for more info.\\n      //\\n      // TL;DR: parsing year-only strings with momentjs falls back to native\\n      // Date and it won't correctly represent the year in local time if UTF\\n      // offset is negative.\\n      //\\n      // The solution is to use the format parameter, so momentjs won't fall\\n      // back to the native Date and we will have the correct year in local\\n      // time.\\n      //\\n      this.mom = moment(str, 'YYYY');\\n      this.setPrecision(YEAR);\\n    }\\n\\n    if (!this.mom) {\\n      throw new Error(\\\"Cannot parse: \\\" + str);\\n    }\\n\\n  };\\n\\n\\n  JIODate.prototype.setPrecision = function (prec) {\\n    this._precision = prec;\\n  };\\n\\n\\n  JIODate.prototype.getPrecision = function () {\\n    return this._precision;\\n  };\\n\\n\\n  JIODate.prototype.cmp = function (other) {\\n    var m1 = this.mom,\\n      m2 = other.mom,\\n      p = lesserPrecision(this._precision, other._precision);\\n    return m1.isBefore(m2, p) ? -1 : (m1.isSame(m2, p) ? 0 : +1);\\n  };\\n\\n\\n  JIODate.prototype.toPrecisionString = function (precision) {\\n    var fmt;\\n\\n    precision = precision || this._precision;\\n\\n    fmt = {\\n      'millisecond': 'YYYY-MM-DD HH:mm:ss.SSS',\\n      'second': 'YYYY-MM-DD HH:mm:ss',\\n      'minute': 'YYYY-MM-DD HH:mm',\\n      'hour': 'YYYY-MM-DD HH',\\n      'day': 'YYYY-MM-DD',\\n      'month': 'YYYY-MM',\\n      'year': 'YYYY'\\n    }[precision];\\n\\n    if (!fmt) {\\n      throw new TypeError(\\\"Unsupported precision value '\\\" + precision + \\\"'\\\");\\n    }\\n\\n    return this.mom.format(fmt);\\n  };\\n\\n\\n  JIODate.prototype.toString = function () {\\n    return this._str;\\n  };\\n\\n\\n//   _export('JIODate', JIODate);\\n// \\n//   _export('YEAR', YEAR);\\n//   _export('MONTH', MONTH);\\n//   _export('DAY', DAY);\\n//   _export('HOUR', HOUR);\\n//   _export('MIN', MIN);\\n//   _export('SEC', SEC);\\n//   _export('MSEC', MSEC);\\n\\n  window.jiodate = {\\n    JIODate: JIODate,\\n    YEAR: YEAR,\\n    MONTH: MONTH,\\n    DAY: DAY,\\n    HOUR: HOUR,\\n    MIN: MIN,\\n    SEC: SEC,\\n    MSEC: MSEC\\n  };\\n}(window, moment));\\n;/*global window, RSVP, Blob, XMLHttpRequest, QueryFactory, Query, atob,\\n  FileReader, ArrayBuffer, Uint8Array, navigator */\\n(function (window, RSVP, Blob, QueryFactory, Query, atob,\\n           FileReader, ArrayBuffer, Uint8Array, navigator) {\\n  \\\"use strict\\\";\\n\\n  if (window.openDatabase === undefined) {\\n    window.openDatabase = function () {\\n      throw new Error('WebSQL is not supported by ' + navigator.userAgent);\\n    };\\n  }\\n\\n  var util = {},\\n    jIO;\\n\\n  function jIOError(message, status_code) {\\n    if ((message !== undefined) && (typeof message !== \\\"string\\\")) {\\n      throw new TypeError('You must pass a string.');\\n    }\\n    this.message = message || \\\"Default Message\\\";\\n    this.status_code = status_code || 500;\\n  }\\n  jIOError.prototype = new Error();\\n  jIOError.prototype.constructor = jIOError;\\n  util.jIOError = jIOError;\\n\\n  /**\\n   * Send request with XHR and return a promise. xhr.onload: The promise is\\n   * resolved when the status code is lower than 400 with the xhr object as\\n   * first parameter. xhr.onerror: reject with xhr object as first\\n   * parameter. xhr.onprogress: notifies the xhr object.\\n   *\\n   * @param  {Object} param The parameters\\n   * @param  {String} [param.type=\\\"GET\\\"] The request method\\n   * @param  {String} [param.dataType=\\\"\\\"] The data type to retrieve\\n   * @param  {String} param.url The url\\n   * @param  {Any} [param.data] The data to send\\n   * @param  {Function} [param.beforeSend] A function called just before the\\n   *    send request. The first parameter of this function is the XHR object.\\n   * @return {Promise} The promise\\n   */\\n  function ajax(param) {\\n    var xhr = new XMLHttpRequest();\\n    return new RSVP.Promise(function (resolve, reject, notify) {\\n      var k;\\n      xhr.open(param.type || \\\"GET\\\", param.url, true);\\n      xhr.responseType = param.dataType || \\\"\\\";\\n      if (typeof param.headers === 'object' && param.headers !== null) {\\n        for (k in param.headers) {\\n          if (param.headers.hasOwnProperty(k)) {\\n            xhr.setRequestHeader(k, param.headers[k]);\\n          }\\n        }\\n      }\\n      xhr.addEventListener(\\\"load\\\", function (e) {\\n        if (e.target.status >= 400) {\\n          return reject(e);\\n        }\\n        resolve(e);\\n      });\\n      xhr.addEventListener(\\\"error\\\", reject);\\n      xhr.addEventListener(\\\"progress\\\", notify);\\n      if (typeof param.xhrFields === 'object' && param.xhrFields !== null) {\\n        for (k in param.xhrFields) {\\n          if (param.xhrFields.hasOwnProperty(k)) {\\n            xhr[k] = param.xhrFields[k];\\n          }\\n        }\\n      }\\n      if (typeof param.beforeSend === 'function') {\\n        param.beforeSend(xhr);\\n      }\\n      xhr.send(param.data);\\n    }, function () {\\n      xhr.abort();\\n    });\\n  }\\n  util.ajax = ajax;\\n\\n  function readBlobAsText(blob, encoding) {\\n    var fr = new FileReader();\\n    return new RSVP.Promise(function (resolve, reject, notify) {\\n      fr.addEventListener(\\\"load\\\", resolve);\\n      fr.addEventListener(\\\"error\\\", reject);\\n      fr.addEventListener(\\\"progress\\\", notify);\\n      fr.readAsText(blob, encoding);\\n    }, function () {\\n      fr.abort();\\n    });\\n  }\\n  util.readBlobAsText = readBlobAsText;\\n\\n  function readBlobAsArrayBuffer(blob) {\\n    var fr = new FileReader();\\n    return new RSVP.Promise(function (resolve, reject, notify) {\\n      fr.addEventListener(\\\"load\\\", resolve);\\n      fr.addEventListener(\\\"error\\\", reject);\\n      fr.addEventListener(\\\"progress\\\", notify);\\n      fr.readAsArrayBuffer(blob);\\n    }, function () {\\n      fr.abort();\\n    });\\n  }\\n  util.readBlobAsArrayBuffer = readBlobAsArrayBuffer;\\n\\n  function readBlobAsDataURL(blob) {\\n    var fr = new FileReader();\\n    return new RSVP.Promise(function (resolve, reject, notify) {\\n      fr.addEventListener(\\\"load\\\", resolve);\\n      fr.addEventListener(\\\"error\\\", reject);\\n      fr.addEventListener(\\\"progress\\\", notify);\\n      fr.readAsDataURL(blob);\\n    }, function () {\\n      fr.abort();\\n    });\\n  }\\n  util.readBlobAsDataURL = readBlobAsDataURL;\\n\\n  function stringify(obj) {\\n    // Implement a stable JSON.stringify\\n    // Object's keys are alphabetically ordered\\n    var key,\\n      key_list,\\n      i,\\n      value,\\n      result_list;\\n    if (obj === undefined) {\\n      return undefined;\\n    }\\n    if (obj.constructor === Object) {\\n      key_list = Object.keys(obj).sort();\\n      result_list = [];\\n      for (i = 0; i < key_list.length; i += 1) {\\n        key = key_list[i];\\n        value = stringify(obj[key]);\\n        if (value !== undefined) {\\n          result_list.push(stringify(key) + ':' + value);\\n        }\\n      }\\n      return '{' + result_list.join(',') + '}';\\n    }\\n    if (obj.constructor === Array) {\\n      result_list = [];\\n      for (i = 0; i < obj.length; i += 1) {\\n        result_list.push(stringify(obj[i]));\\n      }\\n      return '[' + result_list.join(',') + ']';\\n    }\\n    return JSON.stringify(obj);\\n  }\\n  util.stringify = stringify;\\n\\n\\n  // https://gist.github.com/davoclavo/4424731\\n  function dataURItoBlob(dataURI) {\\n    if (dataURI === 'data:') {\\n      return new Blob();\\n    }\\n    // convert base64 to raw binary data held in a string\\n    var byteString = atob(dataURI.split(',')[1]),\\n    // separate out the mime component\\n      mimeString = dataURI.split(',')[0].split(':')[1],\\n    // write the bytes of the string to an ArrayBuffer\\n      arrayBuffer = new ArrayBuffer(byteString.length),\\n      _ia = new Uint8Array(arrayBuffer),\\n      i;\\n    mimeString = mimeString.slice(0, mimeString.length - \\\";base64\\\".length);\\n    for (i = 0; i < byteString.length; i += 1) {\\n      _ia[i] = byteString.charCodeAt(i);\\n    }\\n    return new Blob([arrayBuffer], {type: mimeString});\\n  }\\n\\n  util.dataURItoBlob = dataURItoBlob;\\n\\n  // tools\\n  function checkId(argument_list, storage, method_name) {\\n    if (typeof argument_list[0] !== 'string' || argument_list[0] === '') {\\n      throw new jIO.util.jIOError(\\n        \\\"Document id must be a non empty string on '\\\" + storage.__type +\\n          \\\".\\\" + method_name + \\\"'.\\\",\\n        400\\n      );\\n    }\\n  }\\n\\n  function checkAttachmentId(argument_list, storage, method_name) {\\n    if (typeof argument_list[1] !== 'string' || argument_list[1] === '') {\\n      throw new jIO.util.jIOError(\\n        \\\"Attachment id must be a non empty string on '\\\" + storage.__type +\\n          \\\".\\\" + method_name + \\\"'.\\\",\\n        400\\n      );\\n    }\\n  }\\n\\n  function declareMethod(klass, name, precondition_function, post_function) {\\n    klass.prototype[name] = function () {\\n      var argument_list = arguments,\\n        context = this,\\n        precondition_result;\\n\\n      return new RSVP.Queue()\\n        .push(function () {\\n          if (precondition_function !== undefined) {\\n            return precondition_function.apply(\\n              context.__storage,\\n              [argument_list, context, name]\\n            );\\n          }\\n        })\\n        .push(function (result) {\\n          var storage_method = context.__storage[name];\\n          precondition_result = result;\\n          if (storage_method === undefined) {\\n            throw new jIO.util.jIOError(\\n              \\\"Capacity '\\\" + name + \\\"' is not implemented on '\\\" +\\n                context.__type + \\\"'\\\",\\n              501\\n            );\\n          }\\n          return storage_method.apply(\\n            context.__storage,\\n            argument_list\\n          );\\n        })\\n        .push(function (result) {\\n          if (post_function !== undefined) {\\n            return post_function.call(\\n              context,\\n              argument_list,\\n              result,\\n              precondition_result\\n            );\\n          }\\n          return result;\\n        });\\n    };\\n    // Allow chain\\n    return this;\\n  }\\n\\n\\n\\n\\n  /////////////////////////////////////////////////////////////////\\n  // jIO Storage Proxy\\n  /////////////////////////////////////////////////////////////////\\n  function JioProxyStorage(type, storage) {\\n    if (!(this instanceof JioProxyStorage)) {\\n      return new JioProxyStorage();\\n    }\\n    this.__type = type;\\n    this.__storage = storage;\\n  }\\n\\n  declareMethod(JioProxyStorage, \\\"put\\\", checkId, function (argument_list) {\\n    return argument_list[0];\\n  });\\n  declareMethod(JioProxyStorage, \\\"get\\\", checkId);\\n  declareMethod(JioProxyStorage, \\\"bulk\\\");\\n  declareMethod(JioProxyStorage, \\\"remove\\\", checkId, function (argument_list) {\\n    return argument_list[0];\\n  });\\n\\n  JioProxyStorage.prototype.post = function () {\\n    var context = this,\\n      argument_list = arguments;\\n    return new RSVP.Queue()\\n      .push(function () {\\n        var storage_method = context.__storage.post;\\n        if (storage_method === undefined) {\\n          throw new jIO.util.jIOError(\\n            \\\"Capacity 'post' is not implemented on '\\\" + context.__type + \\\"'\\\",\\n            501\\n          );\\n        }\\n        return context.__storage.post.apply(context.__storage, argument_list);\\n      });\\n  };\\n\\n  declareMethod(JioProxyStorage, 'putAttachment', function (argument_list,\\n                                                            storage,\\n                                                            method_name) {\\n    checkId(argument_list, storage, method_name);\\n    checkAttachmentId(argument_list, storage, method_name);\\n\\n    var options = argument_list[3] || {};\\n\\n    if (typeof argument_list[2] === 'string') {\\n      argument_list[2] = new Blob([argument_list[2]], {\\n        \\\"type\\\": options._content_type || options._mimetype ||\\n                \\\"text/plain;charset=utf-8\\\"\\n      });\\n    } else if (!(argument_list[2] instanceof Blob)) {\\n      throw new jIO.util.jIOError(\\n        'Attachment content is not a blob',\\n        400\\n      );\\n    }\\n  });\\n\\n  declareMethod(JioProxyStorage, 'removeAttachment', function (argument_list,\\n                                                               storage,\\n                                                               method_name) {\\n    checkId(argument_list, storage, method_name);\\n    checkAttachmentId(argument_list, storage, method_name);\\n  });\\n\\n  declareMethod(JioProxyStorage, 'getAttachment', function (argument_list,\\n                                                            storage,\\n                                                            method_name) {\\n    var result = \\\"blob\\\";\\n//     if (param.storage_spec.type !== \\\"indexeddb\\\" &&\\n//         param.storage_spec.type !== \\\"dav\\\" &&\\n//         (param.kwargs._start !== undefined\\n//          || param.kwargs._end !== undefined)) {\\n//       restCommandRejecter(param, [\\n//         'bad_request',\\n//         'unsupport',\\n//         '_start, _end not support'\\n//       ]);\\n//       return false;\\n//     }\\n    checkId(argument_list, storage, method_name);\\n    checkAttachmentId(argument_list, storage, method_name);\\n    // Drop optional parameters, which are only used in postfunction\\n    if (argument_list[2] !== undefined) {\\n      result = argument_list[2].format || result;\\n      delete argument_list[2].format;\\n    }\\n    return result;\\n  }, function (argument_list, blob, convert) {\\n    var result;\\n    if (!(blob instanceof Blob)) {\\n      throw new jIO.util.jIOError(\\n        \\\"'getAttachment' (\\\" + argument_list[0] + \\\" , \\\" +\\n          argument_list[1] + \\\") on '\\\" + this.__type +\\n          \\\"' does not return a Blob.\\\",\\n        501\\n      );\\n    }\\n    if (convert === \\\"blob\\\") {\\n      result = blob;\\n    } else if (convert === \\\"data_url\\\") {\\n      result = new RSVP.Queue()\\n        .push(function () {\\n          return jIO.util.readBlobAsDataURL(blob);\\n        })\\n        .push(function (evt) {\\n          return evt.target.result;\\n        });\\n    } else if (convert === \\\"array_buffer\\\") {\\n      result = new RSVP.Queue()\\n        .push(function () {\\n          return jIO.util.readBlobAsArrayBuffer(blob);\\n        })\\n        .push(function (evt) {\\n          return evt.target.result;\\n        });\\n    } else if (convert === \\\"text\\\") {\\n      result = new RSVP.Queue()\\n        .push(function () {\\n          return jIO.util.readBlobAsText(blob);\\n        })\\n        .push(function (evt) {\\n          return evt.target.result;\\n        });\\n    } else if (convert === \\\"json\\\") {\\n      result = new RSVP.Queue()\\n        .push(function () {\\n          return jIO.util.readBlobAsText(blob);\\n        })\\n        .push(function (evt) {\\n          return JSON.parse(evt.target.result);\\n        });\\n    } else {\\n      throw new jIO.util.jIOError(\\n        this.__type + \\\".getAttachment format: '\\\" + convert +\\n          \\\"' is not supported\\\",\\n        400\\n      );\\n    }\\n    return result;\\n  });\\n\\n  JioProxyStorage.prototype.buildQuery = function () {\\n    var storage_method = this.__storage.buildQuery,\\n      context = this,\\n      argument_list = arguments;\\n    if (storage_method === undefined) {\\n      throw new jIO.util.jIOError(\\n        \\\"Capacity 'buildQuery' is not implemented on '\\\" + this.__type + \\\"'\\\",\\n        501\\n      );\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return storage_method.apply(\\n          context.__storage,\\n          argument_list\\n        );\\n      });\\n  };\\n\\n  JioProxyStorage.prototype.hasCapacity = function (name) {\\n    var storage_method = this.__storage.hasCapacity,\\n      capacity_method = this.__storage[name];\\n    if (capacity_method !== undefined) {\\n      return true;\\n    }\\n    if ((storage_method === undefined) ||\\n        !storage_method.apply(this.__storage, arguments)) {\\n      throw new jIO.util.jIOError(\\n        \\\"Capacity '\\\" + name + \\\"' is not implemented on '\\\" + this.__type + \\\"'\\\",\\n        501\\n      );\\n    }\\n    return true;\\n  };\\n\\n  JioProxyStorage.prototype.allDocs = function (options) {\\n    var context = this;\\n    if (options === undefined) {\\n      options = {};\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        if (context.hasCapacity(\\\"list\\\") &&\\n            ((options.query === undefined) || context.hasCapacity(\\\"query\\\")) &&\\n            ((options.sort_on === undefined) || context.hasCapacity(\\\"sort\\\")) &&\\n            ((options.select_list === undefined) ||\\n             context.hasCapacity(\\\"select\\\")) &&\\n            ((options.include_docs === undefined) ||\\n             context.hasCapacity(\\\"include\\\")) &&\\n            ((options.limit === undefined) || context.hasCapacity(\\\"limit\\\"))) {\\n          return context.buildQuery(options);\\n        }\\n      })\\n      .push(function (result) {\\n        return {\\n          data: {\\n            rows: result,\\n            total_rows: result.length\\n          }\\n        };\\n      });\\n  };\\n\\n  declareMethod(JioProxyStorage, \\\"allAttachments\\\", checkId);\\n  declareMethod(JioProxyStorage, \\\"repair\\\");\\n\\n  JioProxyStorage.prototype.repair = function () {\\n    var context = this,\\n      argument_list = arguments;\\n    return new RSVP.Queue()\\n      .push(function () {\\n        var storage_method = context.__storage.repair;\\n        if (storage_method !== undefined) {\\n          return context.__storage.repair.apply(context.__storage,\\n                                                argument_list);\\n        }\\n      });\\n  };\\n\\n  /////////////////////////////////////////////////////////////////\\n  // Storage builder\\n  /////////////////////////////////////////////////////////////////\\n  function JioBuilder() {\\n    if (!(this instanceof JioBuilder)) {\\n      return new JioBuilder();\\n    }\\n    this.__storage_types = {};\\n  }\\n\\n  JioBuilder.prototype.createJIO = function (storage_spec, util) {\\n\\n    if (typeof storage_spec.type !== 'string') {\\n      throw new TypeError(\\\"Invalid storage description\\\");\\n    }\\n    if (!this.__storage_types[storage_spec.type]) {\\n      throw new TypeError(\\\"Unknown storage '\\\" + storage_spec.type + \\\"'\\\");\\n    }\\n\\n    return new JioProxyStorage(\\n      storage_spec.type,\\n      new this.__storage_types[storage_spec.type](storage_spec, util)\\n    );\\n\\n  };\\n\\n  JioBuilder.prototype.addStorage = function (type, Constructor) {\\n    if (typeof type !== 'string') {\\n      throw new TypeError(\\n        \\\"jIO.addStorage(): Argument 1 is not of type 'string'\\\"\\n      );\\n    }\\n    if (typeof Constructor !== 'function') {\\n      throw new TypeError(\\\"jIO.addStorage(): \\\" +\\n                          \\\"Argument 2 is not of type 'function'\\\");\\n    }\\n    if (this.__storage_types[type] !== undefined) {\\n      throw new TypeError(\\\"jIO.addStorage(): Storage type already exists\\\");\\n    }\\n    this.__storage_types[type] = Constructor;\\n  };\\n\\n  JioBuilder.prototype.util = util;\\n  JioBuilder.prototype.QueryFactory = QueryFactory;\\n  JioBuilder.prototype.Query = Query;\\n\\n  /////////////////////////////////////////////////////////////////\\n  // global\\n  /////////////////////////////////////////////////////////////////\\n  jIO = new JioBuilder();\\n  window.jIO = jIO;\\n\\n}(window, RSVP, Blob, QueryFactory, Query, atob,\\n  FileReader, ArrayBuffer, Uint8Array, navigator));\\n;/*\\n * Rusha, a JavaScript implementation of the Secure Hash Algorithm, SHA-1,\\n * as defined in FIPS PUB 180-1, tuned for high performance with large inputs.\\n * (http://github.com/srijs/rusha)\\n *\\n * Inspired by Paul Johnstons implementation (http://pajhome.org.uk/crypt/md5).\\n *\\n * Copyright (c) 2013 Sam Rijs (http://awesam.de).\\n * Released under the terms of the MIT license as follows:\\n *\\n * Permission is hereby granted, free of charge, to any person obtaining a\\n * copy of this software and associated documentation files (the \\\"Software\\\"),\\n * to deal in the Software without restriction, including without limitation\\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\\n * and/or sell copies of the Software, and to permit persons to whom the\\n * Software is furnished to do so, subject to the following conditions:\\n *\\n * The above copyright notice and this permission notice shall be included in\\n * all copies or substantial portions of the Software.\\n *\\n * THE SOFTWARE IS PROVIDED \\\"AS IS\\\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\\n * IN THE SOFTWARE.\\n */\\n(function () {\\n    // If we'e running in Node.JS, export a module.\\n    if (typeof module !== 'undefined') {\\n        module.exports = Rusha;\\n    } else if (typeof window !== 'undefined') {\\n        window.Rusha = Rusha;\\n    }\\n    // If we're running in a webworker, accept\\n    // messages containing a jobid and a buffer\\n    // or blob object, and return the hash result.\\n    if (typeof FileReaderSync !== 'undefined') {\\n        var reader = new FileReaderSync(), hasher = new Rusha(4 * 1024 * 1024);\\n        self.onmessage = function onMessage(event) {\\n            var hash, data = event.data.data;\\n            try {\\n                hash = hasher.digest(data);\\n                self.postMessage({\\n                    id: event.data.id,\\n                    hash: hash\\n                });\\n            } catch (e) {\\n                self.postMessage({\\n                    id: event.data.id,\\n                    error: e.name\\n                });\\n            }\\n        };\\n    }\\n    var util = {\\n            getDataType: function (data) {\\n                if (typeof data === 'string') {\\n                    return 'string';\\n                }\\n                if (data instanceof Array) {\\n                    return 'array';\\n                }\\n                if (typeof global !== 'undefined' && global.Buffer && global.Buffer.isBuffer(data)) {\\n                    return 'buffer';\\n                }\\n                if (data instanceof ArrayBuffer) {\\n                    return 'arraybuffer';\\n                }\\n                if (data.buffer instanceof ArrayBuffer) {\\n                    return 'view';\\n                }\\n                if (data instanceof Blob) {\\n                    return 'blob';\\n                }\\n                throw new Error('Unsupported data type.');\\n            }\\n        };\\n    // The Rusha object is a wrapper around the low-level RushaCore.\\n    // It provides means of converting different inputs to the\\n    // format accepted by RushaCore as well as other utility methods.\\n    function Rusha(chunkSize) {\\n        'use strict';\\n        // Private object structure.\\n        var self$2 = { fill: 0 };\\n        // Calculate the length of buffer that the sha1 routine uses\\n        // including the padding.\\n        var padlen = function (len) {\\n            for (len += 9; len % 64 > 0; len += 1);\\n            return len;\\n        };\\n        var padZeroes = function (bin, len) {\\n            for (var i = len >> 2; i < bin.length; i++)\\n                bin[i] = 0;\\n        };\\n        var padData = function (bin, chunkLen, msgLen) {\\n            bin[chunkLen >> 2] |= 128 << 24 - (chunkLen % 4 << 3);\\n            bin[((chunkLen >> 2) + 2 & ~15) + 14] = msgLen >> 29;\\n            bin[((chunkLen >> 2) + 2 & ~15) + 15] = msgLen << 3;\\n        };\\n        // Convert a binary string and write it to the heap.\\n        // A binary string is expected to only contain char codes < 256.\\n        var convStr = function (H8, H32, start, len, off) {\\n            var str = this, i, om = off % 4, lm = len % 4, j = len - lm;\\n            if (j > 0) {\\n                switch (om) {\\n                case 0:\\n                    H8[off + 3 | 0] = str.charCodeAt(start);\\n                case 1:\\n                    H8[off + 2 | 0] = str.charCodeAt(start + 1);\\n                case 2:\\n                    H8[off + 1 | 0] = str.charCodeAt(start + 2);\\n                case 3:\\n                    H8[off | 0] = str.charCodeAt(start + 3);\\n                }\\n            }\\n            for (i = om; i < j; i = i + 4 | 0) {\\n                H32[off + i >> 2] = str.charCodeAt(start + i) << 24 | str.charCodeAt(start + i + 1) << 16 | str.charCodeAt(start + i + 2) << 8 | str.charCodeAt(start + i + 3);\\n            }\\n            switch (lm) {\\n            case 3:\\n                H8[off + j + 1 | 0] = str.charCodeAt(start + j + 2);\\n            case 2:\\n                H8[off + j + 2 | 0] = str.charCodeAt(start + j + 1);\\n            case 1:\\n                H8[off + j + 3 | 0] = str.charCodeAt(start + j);\\n            }\\n        };\\n        // Convert a buffer or array and write it to the heap.\\n        // The buffer or array is expected to only contain elements < 256.\\n        var convBuf = function (H8, H32, start, len, off) {\\n            var buf = this, i, om = off % 4, lm = len % 4, j = len - lm;\\n            if (j > 0) {\\n                switch (om) {\\n                case 0:\\n                    H8[off + 3 | 0] = buf[start];\\n                case 1:\\n                    H8[off + 2 | 0] = buf[start + 1];\\n                case 2:\\n                    H8[off + 1 | 0] = buf[start + 2];\\n                case 3:\\n                    H8[off | 0] = buf[start + 3];\\n                }\\n            }\\n            for (i = 4 - om; i < j; i = i += 4 | 0) {\\n                H32[off + i >> 2] = buf[start + i] << 24 | buf[start + i + 1] << 16 | buf[start + i + 2] << 8 | buf[start + i + 3];\\n            }\\n            switch (lm) {\\n            case 3:\\n                H8[off + j + 1 | 0] = buf[start + j + 2];\\n            case 2:\\n                H8[off + j + 2 | 0] = buf[start + j + 1];\\n            case 1:\\n                H8[off + j + 3 | 0] = buf[start + j];\\n            }\\n        };\\n        var convBlob = function (H8, H32, start, len, off) {\\n            var blob = this, i, om = off % 4, lm = len % 4, j = len - lm;\\n            var buf = new Uint8Array(reader.readAsArrayBuffer(blob.slice(start, start + len)));\\n            if (j > 0) {\\n                switch (om) {\\n                case 0:\\n                    H8[off + 3 | 0] = buf[0];\\n                case 1:\\n                    H8[off + 2 | 0] = buf[1];\\n                case 2:\\n                    H8[off + 1 | 0] = buf[2];\\n                case 3:\\n                    H8[off | 0] = buf[3];\\n                }\\n            }\\n            for (i = 4 - om; i < j; i = i += 4 | 0) {\\n                H32[off + i >> 2] = buf[i] << 24 | buf[i + 1] << 16 | buf[i + 2] << 8 | buf[i + 3];\\n            }\\n            switch (lm) {\\n            case 3:\\n                H8[off + j + 1 | 0] = buf[j + 2];\\n            case 2:\\n                H8[off + j + 2 | 0] = buf[j + 1];\\n            case 1:\\n                H8[off + j + 3 | 0] = buf[j];\\n            }\\n        };\\n        var convFn = function (data) {\\n            switch (util.getDataType(data)) {\\n            case 'string':\\n                return convStr.bind(data);\\n            case 'array':\\n                return convBuf.bind(data);\\n            case 'buffer':\\n                return convBuf.bind(data);\\n            case 'arraybuffer':\\n                return convBuf.bind(new Uint8Array(data));\\n            case 'view':\\n                return convBuf.bind(new Uint8Array(data.buffer, data.byteOffset, data.byteLength));\\n            case 'blob':\\n                return convBlob.bind(data);\\n            }\\n        };\\n        var slice = function (data, offset) {\\n            switch (util.getDataType(data)) {\\n            case 'string':\\n                return data.slice(offset);\\n            case 'array':\\n                return data.slice(offset);\\n            case 'buffer':\\n                return data.slice(offset);\\n            case 'arraybuffer':\\n                return data.slice(offset);\\n            case 'view':\\n                return data.buffer.slice(offset);\\n            }\\n        };\\n        // Convert an ArrayBuffer into its hexadecimal string representation.\\n        var hex = function (arrayBuffer) {\\n            var i, x, hex_tab = '0123456789abcdef', res = [], binarray = new Uint8Array(arrayBuffer);\\n            for (i = 0; i < binarray.length; i++) {\\n                x = binarray[i];\\n                res[i] = hex_tab.charAt(x >> 4 & 15) + hex_tab.charAt(x >> 0 & 15);\\n            }\\n            return res.join('');\\n        };\\n        var ceilHeapSize = function (v) {\\n            // The asm.js spec says:\\n            // The heap object's byteLength must be either\\n            // 2^n for n in [12, 24) or 2^24 * n for n ≥ 1.\\n            // Also, byteLengths smaller than 2^16 are deprecated.\\n            var p;\\n            // If v is smaller than 2^16, the smallest possible solution\\n            // is 2^16.\\n            if (v <= 65536)\\n                return 65536;\\n            // If v < 2^24, we round up to 2^n,\\n            // otherwise we round up to 2^24 * n.\\n            if (v < 16777216) {\\n                for (p = 1; p < v; p = p << 1);\\n            } else {\\n                for (p = 16777216; p < v; p += 16777216);\\n            }\\n            return p;\\n        };\\n        // Initialize the internal data structures to a new capacity.\\n        var init = function (size) {\\n            if (size % 64 > 0) {\\n                throw new Error('Chunk size must be a multiple of 128 bit');\\n            }\\n            self$2.maxChunkLen = size;\\n            self$2.padMaxChunkLen = padlen(size);\\n            // The size of the heap is the sum of:\\n            // 1. The padded input message size\\n            // 2. The extended space the algorithm needs (320 byte)\\n            // 3. The 160 bit state the algoritm uses\\n            self$2.heap = new ArrayBuffer(ceilHeapSize(self$2.padMaxChunkLen + 320 + 20));\\n            self$2.h32 = new Int32Array(self$2.heap);\\n            self$2.h8 = new Int8Array(self$2.heap);\\n            self$2.core = RushaCore({\\n                Int32Array: Int32Array,\\n                DataView: DataView\\n            }, {}, self$2.heap);\\n            self$2.buffer = null;\\n        };\\n        // Iinitializethe datastructures according\\n        // to a chunk siyze.\\n        init(chunkSize || 64 * 1024);\\n        var initState = function (heap, padMsgLen) {\\n            var io = new Int32Array(heap, padMsgLen + 320, 5);\\n            io[0] = 1732584193;\\n            io[1] = -271733879;\\n            io[2] = -1732584194;\\n            io[3] = 271733878;\\n            io[4] = -1009589776;\\n        };\\n        var padChunk = function (chunkLen, msgLen) {\\n            var padChunkLen = padlen(chunkLen);\\n            var view = new Int32Array(self$2.heap, 0, padChunkLen >> 2);\\n            padZeroes(view, chunkLen);\\n            padData(view, chunkLen, msgLen);\\n            return padChunkLen;\\n        };\\n        // Write data to the heap.\\n        var write = function (data, chunkOffset, chunkLen) {\\n            convFn(data)(self$2.h8, self$2.h32, chunkOffset, chunkLen, 0);\\n        };\\n        // Initialize and call the RushaCore,\\n        // assuming an input buffer of length len * 4.\\n        var coreCall = function (data, chunkOffset, chunkLen, msgLen, finalize) {\\n            var padChunkLen = chunkLen;\\n            if (finalize) {\\n                padChunkLen = padChunk(chunkLen, msgLen);\\n            }\\n            write(data, chunkOffset, chunkLen);\\n            self$2.core.hash(padChunkLen, self$2.padMaxChunkLen);\\n        };\\n        var getRawDigest = function (heap, padMaxChunkLen) {\\n            var io = new Int32Array(heap, padMaxChunkLen + 320, 5);\\n            var out = new Int32Array(5);\\n            var arr = new DataView(out.buffer);\\n            arr.setInt32(0, io[0], false);\\n            arr.setInt32(4, io[1], false);\\n            arr.setInt32(8, io[2], false);\\n            arr.setInt32(12, io[3], false);\\n            arr.setInt32(16, io[4], false);\\n            return out;\\n        };\\n        // Calculate the hash digest as an array of 5 32bit integers.\\n        var rawDigest = this.rawDigest = function (str) {\\n                var msgLen = str.byteLength || str.length || str.size || 0;\\n                initState(self$2.heap, self$2.padMaxChunkLen);\\n                var chunkOffset = 0, chunkLen = self$2.maxChunkLen, last;\\n                for (chunkOffset = 0; msgLen > chunkOffset + chunkLen; chunkOffset += chunkLen) {\\n                    coreCall(str, chunkOffset, chunkLen, msgLen, false);\\n                }\\n                coreCall(str, chunkOffset, msgLen - chunkOffset, msgLen, true);\\n                return getRawDigest(self$2.heap, self$2.padMaxChunkLen);\\n            };\\n        // The digest and digestFrom* interface returns the hash digest\\n        // as a hex string.\\n        this.digest = this.digestFromString = this.digestFromBuffer = this.digestFromArrayBuffer = function (str) {\\n            return hex(rawDigest(str).buffer);\\n        };\\n    }\\n    ;\\n    // The low-level RushCore module provides the heart of Rusha,\\n    // a high-speed sha1 implementation working on an Int32Array heap.\\n    // At first glance, the implementation seems complicated, however\\n    // with the SHA1 spec at hand, it is obvious this almost a textbook\\n    // implementation that has a few functions hand-inlined and a few loops\\n    // hand-unrolled.\\n    function RushaCore(stdlib, foreign, heap) {\\n        'use asm';\\n        var H = new stdlib.Int32Array(heap);\\n        function hash(k, x) {\\n            // k in bytes\\n            k = k | 0;\\n            x = x | 0;\\n            var i = 0, j = 0, y0 = 0, z0 = 0, y1 = 0, z1 = 0, y2 = 0, z2 = 0, y3 = 0, z3 = 0, y4 = 0, z4 = 0, t0 = 0, t1 = 0;\\n            y0 = H[x + 320 >> 2] | 0;\\n            y1 = H[x + 324 >> 2] | 0;\\n            y2 = H[x + 328 >> 2] | 0;\\n            y3 = H[x + 332 >> 2] | 0;\\n            y4 = H[x + 336 >> 2] | 0;\\n            for (i = 0; (i | 0) < (k | 0); i = i + 64 | 0) {\\n                z0 = y0;\\n                z1 = y1;\\n                z2 = y2;\\n                z3 = y3;\\n                z4 = y4;\\n                for (j = 0; (j | 0) < 64; j = j + 4 | 0) {\\n                    t1 = H[i + j >> 2] | 0;\\n                    t0 = ((y0 << 5 | y0 >>> 27) + (y1 & y2 | ~y1 & y3) | 0) + ((t1 + y4 | 0) + 1518500249 | 0) | 0;\\n                    y4 = y3;\\n                    y3 = y2;\\n                    y2 = y1 << 30 | y1 >>> 2;\\n                    y1 = y0;\\n                    y0 = t0;\\n                    ;\\n                    H[k + j >> 2] = t1;\\n                }\\n                for (j = k + 64 | 0; (j | 0) < (k + 80 | 0); j = j + 4 | 0) {\\n                    t1 = (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) << 1 | (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) >>> 31;\\n                    t0 = ((y0 << 5 | y0 >>> 27) + (y1 & y2 | ~y1 & y3) | 0) + ((t1 + y4 | 0) + 1518500249 | 0) | 0;\\n                    y4 = y3;\\n                    y3 = y2;\\n                    y2 = y1 << 30 | y1 >>> 2;\\n                    y1 = y0;\\n                    y0 = t0;\\n                    ;\\n                    H[j >> 2] = t1;\\n                }\\n                for (j = k + 80 | 0; (j | 0) < (k + 160 | 0); j = j + 4 | 0) {\\n                    t1 = (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) << 1 | (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) >>> 31;\\n                    t0 = ((y0 << 5 | y0 >>> 27) + (y1 ^ y2 ^ y3) | 0) + ((t1 + y4 | 0) + 1859775393 | 0) | 0;\\n                    y4 = y3;\\n                    y3 = y2;\\n                    y2 = y1 << 30 | y1 >>> 2;\\n                    y1 = y0;\\n                    y0 = t0;\\n                    ;\\n                    H[j >> 2] = t1;\\n                }\\n                for (j = k + 160 | 0; (j | 0) < (k + 240 | 0); j = j + 4 | 0) {\\n                    t1 = (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) << 1 | (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) >>> 31;\\n                    t0 = ((y0 << 5 | y0 >>> 27) + (y1 & y2 | y1 & y3 | y2 & y3) | 0) + ((t1 + y4 | 0) - 1894007588 | 0) | 0;\\n                    y4 = y3;\\n                    y3 = y2;\\n                    y2 = y1 << 30 | y1 >>> 2;\\n                    y1 = y0;\\n                    y0 = t0;\\n                    ;\\n                    H[j >> 2] = t1;\\n                }\\n                for (j = k + 240 | 0; (j | 0) < (k + 320 | 0); j = j + 4 | 0) {\\n                    t1 = (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) << 1 | (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) >>> 31;\\n                    t0 = ((y0 << 5 | y0 >>> 27) + (y1 ^ y2 ^ y3) | 0) + ((t1 + y4 | 0) - 899497514 | 0) | 0;\\n                    y4 = y3;\\n                    y3 = y2;\\n                    y2 = y1 << 30 | y1 >>> 2;\\n                    y1 = y0;\\n                    y0 = t0;\\n                    ;\\n                    H[j >> 2] = t1;\\n                }\\n                y0 = y0 + z0 | 0;\\n                y1 = y1 + z1 | 0;\\n                y2 = y2 + z2 | 0;\\n                y3 = y3 + z3 | 0;\\n                y4 = y4 + z4 | 0;\\n            }\\n            H[x + 320 >> 2] = y0;\\n            H[x + 324 >> 2] = y1;\\n            H[x + 328 >> 2] = y2;\\n            H[x + 332 >> 2] = y3;\\n            H[x + 336 >> 2] = y4;\\n        }\\n        return { hash: hash };\\n    }\\n}());;/*\\n * JIO extension for resource replication.\\n * Copyright (C) 2013, 2015  Nexedi SA\\n *\\n *   This library is free software: you can redistribute it and/or modify\\n *   it under the terms of the GNU Lesser General Public License as published by\\n *   the Free Software Foundation, either version 3 of the License, or\\n *   (at your option) any later version.\\n *\\n *   This library is distributed in the hope that it will be useful,\\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\\n *   GNU Lesser General Public License for more details.\\n *\\n *   You should have received a copy of the GNU Lesser General Public License\\n *   along with this program.  If not, see <http://www.gnu.org/licenses/>.\\n */\\n\\n/*jslint nomen: true*/\\n/*global jIO, RSVP, Rusha*/\\n\\n(function (jIO, RSVP, Rusha, stringify) {\\n  \\\"use strict\\\";\\n\\n  var rusha = new Rusha(),\\n    CONFLICT_THROW = 0,\\n    CONFLICT_KEEP_LOCAL = 1,\\n    CONFLICT_KEEP_REMOTE = 2,\\n    CONFLICT_CONTINUE = 3;\\n\\n  /****************************************************\\n   Use a local jIO to read/write/search documents\\n   Synchronize in background those document with a remote jIO.\\n   Synchronization status is stored for each document as an local attachment.\\n  ****************************************************/\\n\\n  function generateHash(content) {\\n    // XXX Improve performance by moving calculation to WebWorker\\n    return rusha.digestFromString(content);\\n  }\\n\\n  function ReplicateStorage(spec) {\\n    this._query_options = spec.query || {};\\n\\n    this._local_sub_storage = jIO.createJIO(spec.local_sub_storage);\\n    this._remote_sub_storage = jIO.createJIO(spec.remote_sub_storage);\\n\\n    this._signature_hash = \\\"_replicate_\\\" + generateHash(\\n      stringify(spec.local_sub_storage) +\\n        stringify(spec.remote_sub_storage) +\\n        stringify(this._query_options)\\n    );\\n    this._signature_sub_storage = jIO.createJIO({\\n      type: \\\"document\\\",\\n      document_id: this._signature_hash,\\n      sub_storage: spec.signature_storage || spec.local_sub_storage\\n    });\\n\\n    this._use_remote_post = spec.use_remote_post || false;\\n\\n    this._conflict_handling = spec.conflict_handling || 0;\\n    // 0: no resolution (ie, throw an Error)\\n    // 1: keep the local state\\n    //    (overwrites the remote document with local content)\\n    //    (delete remote document if local is deleted)\\n    // 2: keep the remote state\\n    //    (overwrites the local document with remote content)\\n    //    (delete local document if remote is deleted)\\n    // 3: keep both copies (leave documents untouched, no signature update)\\n    if ((this._conflict_handling !== CONFLICT_THROW) &&\\n        (this._conflict_handling !== CONFLICT_KEEP_LOCAL) &&\\n        (this._conflict_handling !== CONFLICT_KEEP_REMOTE) &&\\n        (this._conflict_handling !== CONFLICT_CONTINUE)) {\\n      throw new jIO.util.jIOError(\\\"Unsupported conflict handling: \\\" +\\n                                  this._conflict_handling, 400);\\n    }\\n\\n    this._check_local_modification = spec.check_local_modification;\\n    if (this._check_local_modification === undefined) {\\n      this._check_local_modification = true;\\n    }\\n    this._check_local_creation = spec.check_local_creation;\\n    if (this._check_local_creation === undefined) {\\n      this._check_local_creation = true;\\n    }\\n    this._check_local_deletion = spec.check_local_deletion;\\n    if (this._check_local_deletion === undefined) {\\n      this._check_local_deletion = true;\\n    }\\n    this._check_remote_modification = spec.check_remote_modification;\\n    if (this._check_remote_modification === undefined) {\\n      this._check_remote_modification = true;\\n    }\\n    this._check_remote_creation = spec.check_remote_creation;\\n    if (this._check_remote_creation === undefined) {\\n      this._check_remote_creation = true;\\n    }\\n    this._check_remote_deletion = spec.check_remote_deletion;\\n    if (this._check_remote_deletion === undefined) {\\n      this._check_remote_deletion = true;\\n    }\\n  }\\n\\n  ReplicateStorage.prototype.remove = function (id) {\\n    if (id === this._signature_hash) {\\n      throw new jIO.util.jIOError(this._signature_hash + \\\" is frozen\\\",\\n                                  403);\\n    }\\n    return this._local_sub_storage.remove.apply(this._local_sub_storage,\\n                                                arguments);\\n  };\\n  ReplicateStorage.prototype.post = function () {\\n    return this._local_sub_storage.post.apply(this._local_sub_storage,\\n                                              arguments);\\n  };\\n  ReplicateStorage.prototype.put = function (id) {\\n    if (id === this._signature_hash) {\\n      throw new jIO.util.jIOError(this._signature_hash + \\\" is frozen\\\",\\n                                  403);\\n    }\\n    return this._local_sub_storage.put.apply(this._local_sub_storage,\\n                                             arguments);\\n  };\\n  ReplicateStorage.prototype.get = function () {\\n    return this._local_sub_storage.get.apply(this._local_sub_storage,\\n                                             arguments);\\n  };\\n  ReplicateStorage.prototype.hasCapacity = function () {\\n    return this._local_sub_storage.hasCapacity.apply(this._local_sub_storage,\\n                                                     arguments);\\n  };\\n  ReplicateStorage.prototype.buildQuery = function () {\\n    // XXX Remove signature document?\\n    return this._local_sub_storage.buildQuery.apply(this._local_sub_storage,\\n                                                    arguments);\\n  };\\n\\n  ReplicateStorage.prototype.repair = function () {\\n    var context = this,\\n      argument_list = arguments,\\n      skip_document_dict = {};\\n\\n    // Do not sync the signature document\\n    skip_document_dict[context._signature_hash] = null;\\n\\n    function propagateModification(source, destination, doc, hash, id,\\n                                   options) {\\n      var result,\\n        post_id,\\n        to_skip = true;\\n      if (options === undefined) {\\n        options = {};\\n      }\\n      if (options.use_post) {\\n        result = destination.post(doc)\\n          .push(function (new_id) {\\n            to_skip = false;\\n            post_id = new_id;\\n            return source.put(post_id, doc);\\n          })\\n          .push(function () {\\n            return source.remove(id);\\n          })\\n          .push(function () {\\n            return context._signature_sub_storage.remove(id);\\n          })\\n          .push(function () {\\n            to_skip = true;\\n            return context._signature_sub_storage.put(post_id, {\\n              \\\"hash\\\": hash\\n            });\\n          })\\n          .push(function () {\\n            skip_document_dict[post_id] = null;\\n          });\\n      } else {\\n        result = destination.put(id, doc)\\n          .push(function () {\\n            return context._signature_sub_storage.put(id, {\\n              \\\"hash\\\": hash\\n            });\\n          });\\n      }\\n      return result\\n        .push(function () {\\n          if (to_skip) {\\n            skip_document_dict[id] = null;\\n          }\\n        });\\n    }\\n\\n    function propagateDeletion(destination, id) {\\n      return destination.remove(id)\\n        .push(function () {\\n          return context._signature_sub_storage.remove(id);\\n        })\\n        .push(function () {\\n          skip_document_dict[id] = null;\\n        });\\n    }\\n\\n    function checkAndPropagate(status_hash, local_hash, doc,\\n                               source, destination, id,\\n                               conflict_force, conflict_revert,\\n                               conflict_ignore,\\n                               options) {\\n      return destination.get(id)\\n        .push(function (remote_doc) {\\n          return [remote_doc, generateHash(stringify(remote_doc))];\\n        }, function (error) {\\n          if ((error instanceof jIO.util.jIOError) &&\\n              (error.status_code === 404)) {\\n            return [null, null];\\n          }\\n          throw error;\\n        })\\n        .push(function (remote_list) {\\n          var remote_doc = remote_list[0],\\n            remote_hash = remote_list[1];\\n\\n          if (local_hash === remote_hash) {\\n            // Same modifications on both side\\n            if (local_hash === null) {\\n              // Deleted on both side, drop signature\\n              return context._signature_sub_storage.remove(id)\\n                .push(function () {\\n                  skip_document_dict[id] = null;\\n                });\\n            }\\n\\n            return context._signature_sub_storage.put(id, {\\n              \\\"hash\\\": local_hash\\n            })\\n              .push(function () {\\n                skip_document_dict[id] = null;\\n              });\\n          }\\n\\n          if ((remote_hash === status_hash) || (conflict_force === true)) {\\n            // Modified only locally. No conflict or force\\n            if (local_hash === null) {\\n              // Deleted locally\\n              return propagateDeletion(destination, id);\\n            }\\n            return propagateModification(source, destination, doc,\\n                                         local_hash, id,\\n                                         {use_post: ((options.use_post) &&\\n                                                     (remote_hash === null))});\\n          }\\n\\n          // Conflict cases\\n          if (conflict_ignore === true) {\\n            return;\\n          }\\n\\n          if ((conflict_revert === true) || (local_hash === null)) {\\n            // Automatically resolve conflict or force revert\\n            if (remote_hash === null) {\\n              // Deleted remotely\\n              return propagateDeletion(source, id);\\n            }\\n            return propagateModification(\\n              destination,\\n              source,\\n              remote_doc,\\n              remote_hash,\\n              id,\\n              {use_post: ((options.use_revert_post) &&\\n                          (local_hash === null))}\\n            );\\n          }\\n\\n          // Minimize conflict if it can be resolved\\n          if (remote_hash === null) {\\n            // Copy remote modification remotely\\n            return propagateModification(source, destination, doc,\\n                                         local_hash, id,\\n                                         {use_post: options.use_post});\\n          }\\n          throw new jIO.util.jIOError(\\\"Conflict on '\\\" + id + \\\"': \\\" +\\n                                      stringify(doc || '') + \\\" !== \\\" +\\n                                      stringify(remote_doc || ''),\\n                                      409);\\n        });\\n    }\\n\\n    function checkLocalDeletion(queue, destination, id, source,\\n                                conflict_force, conflict_revert,\\n                                conflict_ignore, options) {\\n      var status_hash;\\n      queue\\n        .push(function () {\\n          return context._signature_sub_storage.get(id);\\n        })\\n        .push(function (result) {\\n          status_hash = result.hash;\\n          return checkAndPropagate(status_hash, null, null,\\n                                   source, destination, id,\\n                                   conflict_force, conflict_revert,\\n                                   conflict_ignore,\\n                                   options);\\n        });\\n    }\\n\\n    function checkSignatureDifference(queue, source, destination, id,\\n                                      conflict_force, conflict_revert,\\n                                      conflict_ignore,\\n                                      is_creation, is_modification,\\n                                      getMethod, options) {\\n      queue\\n        .push(function () {\\n          // Optimisation to save a get call to signature storage\\n          if (is_creation === true) {\\n            return RSVP.all([\\n              getMethod(id),\\n              {hash: null}\\n            ]);\\n          }\\n          if (is_modification === true) {\\n            return RSVP.all([\\n              getMethod(id),\\n              context._signature_sub_storage.get(id)\\n            ]);\\n          }\\n          throw new jIO.util.jIOError(\\\"Unexpected call of\\\"\\n                                      + \\\" checkSignatureDifference\\\",\\n                                      409);\\n        })\\n        .push(function (result_list) {\\n          var doc = result_list[0],\\n            local_hash = generateHash(stringify(doc)),\\n            status_hash = result_list[1].hash;\\n\\n          if (local_hash !== status_hash) {\\n            return checkAndPropagate(status_hash, local_hash, doc,\\n                                     source, destination, id,\\n                                     conflict_force, conflict_revert,\\n                                     conflict_ignore,\\n                                     options);\\n          }\\n        });\\n    }\\n\\n    function checkBulkSignatureDifference(queue, source, destination, id_list,\\n                                          document_status_list, options,\\n                                          conflict_force, conflict_revert,\\n                                          conflict_ignore) {\\n      queue\\n        .push(function () {\\n          return source.bulk(id_list);\\n        })\\n        .push(function (result_list) {\\n          var i,\\n            sub_queue = new RSVP.Queue();\\n\\n          function getResult(j) {\\n            return function (id) {\\n              if (id !== id_list[j].parameter_list[0]) {\\n                throw new Error(\\\"Does not access expected ID \\\" + id);\\n              }\\n              return result_list[j];\\n            };\\n          }\\n\\n          for (i = 0; i < result_list.length; i += 1) {\\n            checkSignatureDifference(sub_queue, source, destination,\\n                               id_list[i].parameter_list[0],\\n                               conflict_force, conflict_revert,\\n                               conflict_ignore,\\n                               document_status_list[i].is_creation,\\n                               document_status_list[i].is_modification,\\n                               getResult(i), options);\\n          }\\n          return sub_queue;\\n        });\\n    }\\n\\n    function pushStorage(source, destination, options) {\\n      var queue = new RSVP.Queue();\\n      if (!options.hasOwnProperty(\\\"use_post\\\")) {\\n        options.use_post = false;\\n      }\\n      if (!options.hasOwnProperty(\\\"use_revert_post\\\")) {\\n        options.use_revert_post = false;\\n      }\\n      return queue\\n        .push(function () {\\n          return RSVP.all([\\n            source.allDocs(context._query_options),\\n            context._signature_sub_storage.allDocs()\\n          ]);\\n        })\\n        .push(function (result_list) {\\n          var i,\\n            local_dict = {},\\n            document_list = [],\\n            document_status_list = [],\\n            signature_dict = {},\\n            is_modification,\\n            is_creation,\\n            key;\\n          for (i = 0; i < result_list[0].data.total_rows; i += 1) {\\n            if (!skip_document_dict.hasOwnProperty(\\n                result_list[0].data.rows[i].id\\n              )) {\\n              local_dict[result_list[0].data.rows[i].id] = i;\\n            }\\n          }\\n          for (i = 0; i < result_list[1].data.total_rows; i += 1) {\\n            if (!skip_document_dict.hasOwnProperty(\\n                result_list[1].data.rows[i].id\\n              )) {\\n              signature_dict[result_list[1].data.rows[i].id] = i;\\n            }\\n          }\\n          for (key in local_dict) {\\n            if (local_dict.hasOwnProperty(key)) {\\n              is_modification = signature_dict.hasOwnProperty(key)\\n                && options.check_modification;\\n              is_creation = !signature_dict.hasOwnProperty(key)\\n                && options.check_creation;\\n              if (is_modification === true || is_creation === true) {\\n                if (options.use_bulk_get === true) {\\n                  document_list.push({\\n                    method: \\\"get\\\",\\n                    parameter_list: [key]\\n                  });\\n                  document_status_list.push({\\n                    is_creation: is_creation,\\n                    is_modification: is_modification\\n                  });\\n                } else {\\n                  checkSignatureDifference(queue, source, destination, key,\\n                                           options.conflict_force,\\n                                           options.conflict_revert,\\n                                           options.conflict_ignore,\\n                                           is_creation, is_modification,\\n                                           source.get.bind(source),\\n                                           options);\\n                }\\n              }\\n            }\\n          }\\n          if (options.check_deletion === true) {\\n            for (key in signature_dict) {\\n              if (signature_dict.hasOwnProperty(key)) {\\n                if (!local_dict.hasOwnProperty(key)) {\\n                  checkLocalDeletion(queue, destination, key, source,\\n                                     options.conflict_force,\\n                                     options.conflict_revert,\\n                                     options.conflict_ignore,\\n                                     options);\\n                }\\n              }\\n            }\\n          }\\n          if ((options.use_bulk_get === true) && (document_list.length !== 0)) {\\n            checkBulkSignatureDifference(queue, source, destination,\\n                                         document_list, document_status_list,\\n                                         options,\\n                                         options.conflict_force,\\n                                         options.conflict_revert,\\n                                         options.conflict_ignore);\\n          }\\n        });\\n    }\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        // Ensure that the document storage is usable\\n        return context._signature_sub_storage.__storage._sub_storage.get(\\n          context._signature_hash\\n        );\\n      })\\n      .push(undefined, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          return context._signature_sub_storage.__storage._sub_storage.put(\\n            context._signature_hash,\\n            {}\\n          );\\n        }\\n        throw error;\\n      })\\n\\n      .push(function () {\\n        return RSVP.all([\\n// Don't repair local_sub_storage twice\\n//           context._signature_sub_storage.repair.apply(\\n//             context._signature_sub_storage,\\n//             argument_list\\n//           ),\\n          context._local_sub_storage.repair.apply(\\n            context._local_sub_storage,\\n            argument_list\\n          ),\\n          context._remote_sub_storage.repair.apply(\\n            context._remote_sub_storage,\\n            argument_list\\n          )\\n        ]);\\n      })\\n\\n      .push(function () {\\n        if (context._check_local_modification ||\\n            context._check_local_creation ||\\n            context._check_local_deletion) {\\n          return pushStorage(context._local_sub_storage,\\n                             context._remote_sub_storage,\\n                             {\\n              use_post: context._use_remote_post,\\n              conflict_force: (context._conflict_handling ===\\n                               CONFLICT_KEEP_LOCAL),\\n              conflict_revert: (context._conflict_handling ===\\n                                CONFLICT_KEEP_REMOTE),\\n              conflict_ignore: (context._conflict_handling ===\\n                                CONFLICT_CONTINUE),\\n              check_modification: context._check_local_modification,\\n              check_creation: context._check_local_creation,\\n              check_deletion: context._check_local_deletion\\n            });\\n        }\\n      })\\n      .push(function () {\\n        // Autoactivate bulk if substorage implements it\\n        // Keep it like this until the bulk API is stabilized\\n        var use_bulk_get = false;\\n        try {\\n          use_bulk_get = context._remote_sub_storage.hasCapacity(\\\"bulk\\\");\\n        } catch (error) {\\n          if (!((error instanceof jIO.util.jIOError) &&\\n               (error.status_code === 501))) {\\n            throw error;\\n          }\\n        }\\n        if (context._check_remote_modification ||\\n            context._check_remote_creation ||\\n            context._check_remote_deletion) {\\n          return pushStorage(context._remote_sub_storage,\\n                             context._local_sub_storage, {\\n              use_bulk_get: use_bulk_get,\\n              use_revert_post: context._use_remote_post,\\n              conflict_force: (context._conflict_handling ===\\n                               CONFLICT_KEEP_REMOTE),\\n              conflict_revert: (context._conflict_handling ===\\n                                CONFLICT_KEEP_LOCAL),\\n              conflict_ignore: (context._conflict_handling ===\\n                                CONFLICT_CONTINUE),\\n              check_modification: context._check_remote_modification,\\n              check_creation: context._check_remote_creation,\\n              check_deletion: context._check_remote_deletion\\n            });\\n        }\\n      });\\n  };\\n\\n  jIO.addStorage('replicate', ReplicateStorage);\\n\\n}(jIO, RSVP, Rusha, jIO.util.stringify));\\n;/*\\n * Copyright 2015, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/*jslint nomen: true*/\\n/*global Rusha*/\\n\\n/**\\n * JIO Sha Storage. Type = 'sha'.\\n */\\n\\n(function (Rusha) {\\n  \\\"use strict\\\";\\n\\n  var rusha = new Rusha();\\n\\n  function ShaStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n  }\\n\\n  ShaStorage.prototype.post = function (param) {\\n    return this._sub_storage.put(\\n      rusha.digestFromString(JSON.stringify(param)),\\n      param\\n    );\\n  };\\n\\n  ShaStorage.prototype.get = function () {\\n    return this._sub_storage.get.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.remove = function () {\\n    return this._sub_storage.remove.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.hasCapacity = function () {\\n    return this._sub_storage.hasCapacity.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.buildQuery = function () {\\n    return this._sub_storage.buildQuery.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.getAttachment = function () {\\n    return this._sub_storage.getAttachment.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.putAttachment = function () {\\n    return this._sub_storage.putAttachment.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.removeAttachment = function () {\\n    return this._sub_storage.removeAttachment.apply(this._sub_storage,\\n                                                    arguments);\\n  };\\n  ShaStorage.prototype.allAttachments = function () {\\n    return this._sub_storage.allAttachments.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.repair = function () {\\n    return this._sub_storage.repair.apply(this._sub_storage, arguments);\\n  };\\n\\n  jIO.addStorage('sha', ShaStorage);\\n\\n}(Rusha));\\n;/*jslint nomen: true*/\\n(function (jIO) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The jIO UUIDStorage extension\\n   *\\n   * @class UUIDStorage\\n   * @constructor\\n   */\\n  function UUIDStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n  }\\n\\n  UUIDStorage.prototype.get = function () {\\n    return this._sub_storage.get.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.allAttachments = function () {\\n    return this._sub_storage.allAttachments.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.post = function (param) {\\n\\n    function S4() {\\n      return ('0000' + Math.floor(\\n        Math.random() * 0x10000 /* 65536 */\\n      ).toString(16)).slice(-4);\\n    }\\n\\n    var id = S4() + S4() + \\\"-\\\" +\\n      S4() + \\\"-\\\" +\\n      S4() + \\\"-\\\" +\\n      S4() + \\\"-\\\" +\\n      S4() + S4() + S4();\\n\\n    return this.put(id, param);\\n  };\\n  UUIDStorage.prototype.put = function () {\\n    return this._sub_storage.put.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.remove = function () {\\n    return this._sub_storage.remove.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.getAttachment = function () {\\n    return this._sub_storage.getAttachment.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.putAttachment = function () {\\n    return this._sub_storage.putAttachment.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.removeAttachment = function () {\\n    return this._sub_storage.removeAttachment.apply(this._sub_storage,\\n                                                    arguments);\\n  };\\n  UUIDStorage.prototype.repair = function () {\\n    return this._sub_storage.repair.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.hasCapacity = function (name) {\\n    return this._sub_storage.hasCapacity(name);\\n  };\\n  UUIDStorage.prototype.buildQuery = function () {\\n    return this._sub_storage.buildQuery.apply(this._sub_storage,\\n                                              arguments);\\n  };\\n\\n  jIO.addStorage('uuid', UUIDStorage);\\n\\n}(jIO));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/*jslint nomen: true*/\\n/*global jIO, RSVP*/\\n\\n/**\\n * JIO Memory Storage. Type = 'memory'.\\n * Memory browser \\\"database\\\" storage.\\n *\\n * Storage Description:\\n *\\n *     {\\n *       \\\"type\\\": \\\"memory\\\"\\n *     }\\n *\\n * @class MemoryStorage\\n */\\n\\n(function (jIO, JSON, RSVP) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The JIO MemoryStorage extension\\n   *\\n   * @class MemoryStorage\\n   * @constructor\\n   */\\n  function MemoryStorage() {\\n    this._database = {};\\n  }\\n\\n  MemoryStorage.prototype.put = function (id, metadata) {\\n    if (!this._database.hasOwnProperty(id)) {\\n      this._database[id] = {\\n        attachments: {}\\n      };\\n    }\\n    this._database[id].doc = JSON.stringify(metadata);\\n    return id;\\n  };\\n\\n  MemoryStorage.prototype.get = function (id) {\\n    try {\\n      return JSON.parse(this._database[id].doc);\\n    } catch (error) {\\n      if (error instanceof TypeError) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find document: \\\" + id,\\n          404\\n        );\\n      }\\n      throw error;\\n    }\\n  };\\n\\n  MemoryStorage.prototype.allAttachments = function (id) {\\n    var key,\\n      attachments = {};\\n    try {\\n      for (key in this._database[id].attachments) {\\n        if (this._database[id].attachments.hasOwnProperty(key)) {\\n          attachments[key] = {};\\n        }\\n      }\\n    } catch (error) {\\n      if (error instanceof TypeError) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find document: \\\" + id,\\n          404\\n        );\\n      }\\n      throw error;\\n    }\\n    return attachments;\\n  };\\n\\n  MemoryStorage.prototype.remove = function (id) {\\n    delete this._database[id];\\n    return id;\\n  };\\n\\n  MemoryStorage.prototype.getAttachment = function (id, name) {\\n    try {\\n      var result = this._database[id].attachments[name];\\n      if (result === undefined) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find attachment: \\\" + id + \\\" , \\\" + name,\\n          404\\n        );\\n      }\\n      return jIO.util.dataURItoBlob(result);\\n    } catch (error) {\\n      if (error instanceof TypeError) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find attachment: \\\" + id + \\\" , \\\" + name,\\n          404\\n        );\\n      }\\n      throw error;\\n    }\\n  };\\n\\n  MemoryStorage.prototype.putAttachment = function (id, name, blob) {\\n    var attachment_dict;\\n    try {\\n      attachment_dict = this._database[id].attachments;\\n    } catch (error) {\\n      if (error instanceof TypeError) {\\n        throw new jIO.util.jIOError(\\\"Cannot find document: \\\" + id, 404);\\n      }\\n      throw error;\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.readBlobAsDataURL(blob);\\n      })\\n      .push(function (evt) {\\n        attachment_dict[name] = evt.target.result;\\n      });\\n  };\\n\\n  MemoryStorage.prototype.removeAttachment = function (id, name) {\\n    try {\\n      delete this._database[id].attachments[name];\\n    } catch (error) {\\n      if (error instanceof TypeError) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find document: \\\" + id,\\n          404\\n        );\\n      }\\n      throw error;\\n    }\\n  };\\n\\n\\n  MemoryStorage.prototype.hasCapacity = function (name) {\\n    return ((name === \\\"list\\\") || (name === \\\"include\\\"));\\n  };\\n\\n  MemoryStorage.prototype.buildQuery = function (options) {\\n    var rows = [],\\n      i;\\n    for (i in this._database) {\\n      if (this._database.hasOwnProperty(i)) {\\n        if (options.include_docs === true) {\\n          rows.push({\\n            id: i,\\n            value: {},\\n            doc: JSON.parse(this._database[i].doc)\\n          });\\n        } else {\\n          rows.push({\\n            id: i,\\n            value: {}\\n          });\\n        }\\n\\n      }\\n    }\\n    return rows;\\n  };\\n\\n  jIO.addStorage('memory', MemoryStorage);\\n\\n}(jIO, JSON, RSVP));\\n;/*jslint nomen: true*/\\n/*global RSVP, Blob, LZString, DOMException*/\\n(function (RSVP, Blob, LZString, DOMException) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The jIO ZipStorage extension\\n   *\\n   * @class ZipStorage\\n   * @constructor\\n   */\\n\\n  var MIME_TYPE = \\\"application/x-jio-utf16_lz_string\\\";\\n\\n  function ZipStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n  }\\n\\n  ZipStorage.prototype.get = function () {\\n    return this._sub_storage.get.apply(this._sub_storage,\\n                                        arguments);\\n  };\\n\\n  ZipStorage.prototype.post = function () {\\n    return this._sub_storage.post.apply(this._sub_storage,\\n                                        arguments);\\n  };\\n\\n  ZipStorage.prototype.put = function () {\\n    return this._sub_storage.put.apply(this._sub_storage,\\n                                       arguments);\\n  };\\n\\n  ZipStorage.prototype.remove = function () {\\n    return this._sub_storage.remove.apply(this._sub_storage,\\n                                          arguments);\\n  };\\n\\n  ZipStorage.prototype.hasCapacity = function () {\\n    return this._sub_storage.hasCapacity.apply(this._sub_storage,\\n                                               arguments);\\n  };\\n\\n  ZipStorage.prototype.buildQuery = function () {\\n    return this._sub_storage.buildQuery.apply(this._sub_storage,\\n                                              arguments);\\n  };\\n\\n  ZipStorage.prototype.getAttachment = function (id, name) {\\n    var that = this;\\n    return that._sub_storage.getAttachment(id, name)\\n      .push(function (blob) {\\n        if (blob.type !== MIME_TYPE) {\\n          return blob;\\n        }\\n        return new RSVP.Queue()\\n          .push(function () {\\n            return jIO.util.readBlobAsText(blob, 'utf16');\\n          })\\n          .push(function (evt) {\\n            var result =\\n              LZString.decompressFromUTF16(evt.target.result);\\n            if (result === '') {\\n              return blob;\\n            }\\n            try {\\n              return jIO.util.dataURItoBlob(\\n                result\\n              );\\n            } catch (error) {\\n              if (error instanceof DOMException) {\\n                return blob;\\n              }\\n              throw error;\\n            }\\n          });\\n      });\\n  };\\n\\n  function myEndsWith(str, query) {\\n    return (str.indexOf(query) === str.length - query.length);\\n  }\\n\\n  ZipStorage.prototype.putAttachment = function (id, name, blob) {\\n    var that = this;\\n    if ((blob.type.indexOf(\\\"text/\\\") === 0) || myEndsWith(blob.type, \\\"xml\\\") ||\\n        myEndsWith(blob.type, \\\"json\\\")) {\\n      return new RSVP.Queue()\\n        .push(function () {\\n          return jIO.util.readBlobAsDataURL(blob);\\n        })\\n        .push(function (data) {\\n          var result = LZString.compressToUTF16(data.target.result);\\n          blob = new Blob([result],\\n                          {type: MIME_TYPE});\\n          return that._sub_storage.putAttachment(id, name, blob);\\n        });\\n    }\\n    return this._sub_storage.putAttachment.apply(this._sub_storage,\\n                                                 arguments);\\n  };\\n\\n  ZipStorage.prototype.removeAttachment = function () {\\n    return this._sub_storage.removeAttachment.apply(this._sub_storage,\\n                                                    arguments);\\n  };\\n\\n  ZipStorage.prototype.allAttachments = function () {\\n    return this._sub_storage.allAttachments.apply(this._sub_storage,\\n                                                  arguments);\\n  };\\n\\n  jIO.addStorage('zip', ZipStorage);\\n}(RSVP, Blob, LZString, DOMException));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n/**\\n * JIO Dropbox Storage. Type = \\\"dropbox\\\".\\n * Dropbox \\\"database\\\" storage.\\n */\\n/*global Blob, jIO, RSVP, UriTemplate*/\\n/*jslint nomen: true*/\\n\\n(function (jIO, RSVP, Blob, UriTemplate) {\\n  \\\"use strict\\\";\\n  var UPLOAD_URL = \\\"https://content.dropboxapi.com/1/files_put/\\\" +\\n      \\\"{+root}{+id}{+name}{?access_token}\\\",\\n    upload_template = UriTemplate.parse(UPLOAD_URL),\\n    CREATE_DIR_URL = \\\"https://api.dropboxapi.com/1/fileops/create_folder\\\" +\\n      \\\"{?access_token,root,path}\\\",\\n    create_dir_template = UriTemplate.parse(CREATE_DIR_URL),\\n    REMOVE_URL = \\\"https://api.dropboxapi.com/1/fileops/delete/\\\" +\\n      \\\"{?access_token,root,path}\\\",\\n    remote_template = UriTemplate.parse(REMOVE_URL),\\n    GET_URL = \\\"https://content.dropboxapi.com/1/files\\\" +\\n      \\\"{/root,id}{+name}{?access_token}\\\",\\n    get_template = UriTemplate.parse(GET_URL),\\n    //LIST_URL = 'https://api.dropboxapi.com/1/metadata/sandbox/';\\n    METADATA_URL = \\\"https://api.dropboxapi.com/1/metadata\\\" +\\n      \\\"{/root}{+id}{?access_token}\\\",\\n    metadata_template = UriTemplate.parse(METADATA_URL);\\n\\n  function restrictDocumentId(id) {\\n    if (id.indexOf(\\\"/\\\") !== 0) {\\n      throw new jIO.util.jIOError(\\\"id \\\" + id + \\\" is forbidden (no begin /)\\\",\\n                                  400);\\n    }\\n    if (id.lastIndexOf(\\\"/\\\") !== (id.length - 1)) {\\n      throw new jIO.util.jIOError(\\\"id \\\" + id + \\\" is forbidden (no end /)\\\",\\n                                  400);\\n    }\\n    return id;\\n  }\\n\\n  function restrictAttachmentId(id) {\\n    if (id.indexOf(\\\"/\\\") !== -1) {\\n      throw new jIO.util.jIOError(\\\"attachment \\\" + id + \\\" is forbidden\\\",\\n                                  400);\\n    }\\n  }\\n\\n  /**\\n   * The JIO Dropbox Storage extension\\n   *\\n   * @class DropboxStorage\\n   * @constructor\\n   */\\n  function DropboxStorage(spec) {\\n    if (typeof spec.access_token !== 'string' || !spec.access_token) {\\n      throw new TypeError(\\\"Access Token' must be a string \\\" +\\n                          \\\"which contains more than one character.\\\");\\n    }\\n    if (typeof spec.root !== 'string' || !spec.root ||\\n        (spec.root !== \\\"dropbox\\\" && spec.root !== \\\"sandbox\\\")) {\\n      throw new TypeError(\\\"root must be 'dropbox' or 'sandbox'\\\");\\n    }\\n    this._access_token = spec.access_token;\\n    this._root = spec.root;\\n  }\\n\\n  DropboxStorage.prototype.put = function (id, param) {\\n    var that = this;\\n    id = restrictDocumentId(id);\\n    if (Object.getOwnPropertyNames(param).length > 0) {\\n      // Reject if param has some properties\\n      throw new jIO.util.jIOError(\\\"Can not store properties: \\\" +\\n                                  Object.getOwnPropertyNames(param), 400);\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"POST\\\",\\n          url: create_dir_template.expand({\\n            access_token: that._access_token,\\n            root: that._root,\\n            path: id\\n          })\\n        });\\n      })\\n      .push(undefined, function (err) {\\n        if ((err.target !== undefined) &&\\n            (err.target.status === 405)) {\\n          // Directory already exists, no need to fail\\n          return;\\n        }\\n        throw err;\\n      });\\n  };\\n\\n  DropboxStorage.prototype.remove = function (id) {\\n    id = restrictDocumentId(id);\\n    return jIO.util.ajax({\\n      type: \\\"POST\\\",\\n      url: remote_template.expand({\\n        access_token: this._access_token,\\n        root: this._root,\\n        path: id\\n      })\\n    });\\n  };\\n\\n  DropboxStorage.prototype.get = function (id) {\\n    var that = this;\\n\\n    if (id === \\\"/\\\") {\\n      return {};\\n    }\\n    id = restrictDocumentId(id);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"GET\\\",\\n          url: metadata_template.expand({\\n            access_token: that._access_token,\\n            root: that._root,\\n            id: id\\n          })\\n        });\\n      })\\n      .push(function (evt) {\\n        var obj = JSON.parse(evt.target.response ||\\n                             evt.target.responseText);\\n        if (obj.is_dir) {\\n          return {};\\n        }\\n        throw new jIO.util.jIOError(\\\"Not a directory: \\\" + id, 404);\\n      }, function (error) {\\n        if (error.target !== undefined && error.target.status === 404) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document: \\\" + id, 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  DropboxStorage.prototype.allAttachments = function (id) {\\n\\n    var that = this;\\n    id = restrictDocumentId(id);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"GET\\\",\\n          url: metadata_template.expand({\\n            access_token: that._access_token,\\n            root: that._root,\\n            id: id\\n          })\\n        });\\n      })\\n      .push(function (evt) {\\n        var obj = JSON.parse(evt.target.response || evt.target.responseText),\\n          i,\\n          result = {};\\n        if (!obj.is_dir) {\\n          throw new jIO.util.jIOError(\\\"Not a directory: \\\" + id, 404);\\n        }\\n        for (i = 0; i < obj.contents.length; i += 1) {\\n          if (!obj.contents[i].is_dir) {\\n            result[obj.contents[i].path.split(\\\"/\\\").pop()] = {};\\n          }\\n        }\\n        return result;\\n      }, function (error) {\\n        if (error.target !== undefined && error.target.status === 404) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document: \\\" + id, 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  //currently, putAttachment will fail with files larger than 150MB,\\n  //due to the Dropbox API. the API provides the \\\"chunked_upload\\\" method\\n  //to pass this limit, but upload process becomes more complex to implement.\\n  //\\n  //putAttachment will also create a folder if you try to put an attachment\\n  //to an inexisting foler.\\n\\n  DropboxStorage.prototype.putAttachment = function (id, name, blob) {\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return jIO.util.ajax({\\n      type: \\\"PUT\\\",\\n      url: upload_template.expand({\\n        root: this._root,\\n        id: id,\\n        name: name,\\n        access_token: this._access_token\\n      }),\\n      dataType: blob.type,\\n      data: blob\\n    });\\n  };\\n\\n  DropboxStorage.prototype.getAttachment = function (id, name) {\\n    var that = this;\\n\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"GET\\\",\\n          dataType: \\\"blob\\\",\\n          url: get_template.expand({\\n            root: that._root,\\n            id: id,\\n            name: name,\\n            access_token: that._access_token\\n          })\\n        });\\n      })\\n      .push(function (evt) {\\n        return new Blob(\\n          [evt.target.response || evt.target.responseText],\\n          {\\\"type\\\": evt.target.getResponseHeader('Content-Type') ||\\n            \\\"application/octet-stream\\\"}\\n        );\\n      }, function (error) {\\n        if (error.target !== undefined && error.target.status === 404) {\\n          throw new jIO.util.jIOError(\\\"Cannot find attachment: \\\" +\\n                                      id + \\\", \\\" + name, 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  //removeAttachment removes also directories.(due to Dropbox API)\\n\\n  DropboxStorage.prototype.removeAttachment = function (id, name) {\\n    var that = this;\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"POST\\\",\\n          url: remote_template.expand({\\n            access_token: that._access_token,\\n            root: that._root,\\n            path: id + name\\n          })\\n        });\\n      }).push(undefined, function (error) {\\n        if (error.target !== undefined && error.target.status === 404) {\\n          throw new jIO.util.jIOError(\\\"Cannot find attachment: \\\" +\\n                                      id + \\\", \\\" + name, 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  jIO.addStorage('dropbox', DropboxStorage);\\n\\n}(jIO, RSVP, Blob, UriTemplate));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/*jslint nomen: true*/\\n/*global jIO, RSVP, DOMParser, Blob */\\n\\n// JIO Dav Storage Description :\\n// {\\n//   type: \\\"dav\\\",\\n//   url: {string},\\n//   basic_login: {string} // Basic authentication\\n// }\\n\\n// NOTE: to get the authentication type ->\\n// curl --verbose  -X OPTION http://domain/\\n// In the headers: \\\"WWW-Authenticate: Basic realm=\\\"DAV-upload\\\"\\n\\n(function (jIO, RSVP, DOMParser, Blob) {\\n  \\\"use strict\\\";\\n\\n  function ajax(storage, options) {\\n    if (options === undefined) {\\n      options = {};\\n    }\\n    if (storage._authorization !== undefined) {\\n      if (options.headers === undefined) {\\n        options.headers = {};\\n      }\\n      options.headers.Authorization = storage._authorization;\\n    }\\n\\n    if (storage._with_credentials !== undefined) {\\n      if (options.xhrFields === undefined) {\\n        options.xhrFields = {};\\n      }\\n      options.xhrFields.withCredentials = storage._with_credentials;\\n    }\\n//       if (start !== undefined) {\\n//         if (end !== undefined) {\\n//           headers.Range = \\\"bytes=\\\" + start + \\\"-\\\" + end;\\n//         } else {\\n//           headers.Range = \\\"bytes=\\\" + start + \\\"-\\\";\\n//         }\\n//       }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax(options);\\n      });\\n  }\\n\\n  function restrictDocumentId(id) {\\n    if (id.indexOf(\\\"/\\\") !== 0) {\\n      throw new jIO.util.jIOError(\\\"id \\\" + id + \\\" is forbidden (no begin /)\\\",\\n                                  400);\\n    }\\n    if (id.lastIndexOf(\\\"/\\\") !== (id.length - 1)) {\\n      throw new jIO.util.jIOError(\\\"id \\\" + id + \\\" is forbidden (no end /)\\\",\\n                                  400);\\n    }\\n    return id;\\n  }\\n\\n  function restrictAttachmentId(id) {\\n    if (id.indexOf(\\\"/\\\") !== -1) {\\n      throw new jIO.util.jIOError(\\\"attachment \\\" + id + \\\" is forbidden\\\",\\n                                  400);\\n    }\\n  }\\n\\n  /**\\n   * The JIO WebDAV Storage extension\\n   *\\n   * @class DavStorage\\n   * @constructor\\n   */\\n  function DavStorage(spec) {\\n    if (typeof spec.url !== 'string') {\\n      throw new TypeError(\\\"DavStorage 'url' is not of type string\\\");\\n    }\\n    this._url = spec.url;\\n    // XXX digest login\\n    if (typeof spec.basic_login === 'string') {\\n      this._authorization = \\\"Basic \\\" + spec.basic_login;\\n    }\\n    this._with_credentials = spec.with_credentials;\\n  }\\n\\n  DavStorage.prototype.put = function (id, param) {\\n    var that = this;\\n    id = restrictDocumentId(id);\\n    if (Object.getOwnPropertyNames(param).length > 0) {\\n      // Reject if param has some properties\\n      throw new jIO.util.jIOError(\\\"Can not store properties: \\\" +\\n                                  Object.getOwnPropertyNames(param), 400);\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(that, {\\n          type: \\\"MKCOL\\\",\\n          url: that._url + id\\n        });\\n      })\\n      .push(undefined, function (err) {\\n        if ((err.target !== undefined) &&\\n            (err.target.status === 405)) {\\n          return;\\n        }\\n        throw err;\\n      });\\n  };\\n\\n  DavStorage.prototype.remove = function (id) {\\n    id = restrictDocumentId(id);\\n    return ajax(this, {\\n      type: \\\"DELETE\\\",\\n      url: this._url + id\\n    });\\n  };\\n\\n  DavStorage.prototype.get = function (id) {\\n    var context = this;\\n    id = restrictDocumentId(id);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(context, {\\n          type: \\\"PROPFIND\\\",\\n          url: context._url + id,\\n          dataType: \\\"text\\\",\\n          headers: {\\n            // Increasing this value is a performance killer\\n            Depth: \\\"1\\\"\\n          }\\n        });\\n      })\\n      .push(function () {\\n        return {};\\n      }, function (error) {\\n        if ((error.target !== undefined) &&\\n            (error.target.status === 404)) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  DavStorage.prototype.allAttachments = function (id) {\\n\\n    var context = this;\\n    id = restrictDocumentId(id);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(context, {\\n          type: \\\"PROPFIND\\\",\\n          url: context._url + id,\\n          dataType: \\\"text\\\",\\n          headers: {\\n            // Increasing this value is a performance killer\\n            Depth: \\\"1\\\"\\n          }\\n        });\\n      })\\n\\n\\n      .push(function (response) {\\n        // Extract all meta informations and return them to JSON\\n\\n        var i,\\n          attachment = {},\\n          id,\\n          attachment_list = new DOMParser().parseFromString(\\n            response.target.responseText,\\n            \\\"text/xml\\\"\\n          ).querySelectorAll(\\n            \\\"D\\\\\\\\:response, response\\\"\\n          );\\n\\n        // exclude parent folder and browse\\n        for (i = 1; i < attachment_list.length; i += 1) {\\n          // XXX Only get files for now\\n          id = attachment_list[i].querySelector(\\\"D\\\\\\\\:href, href\\\").\\n            textContent.split('/').slice(-1)[0];\\n          // XXX Ugly\\n          if ((id !== undefined) && (id !== \\\"\\\")) {\\n            attachment[id] = {};\\n          }\\n        }\\n        return attachment;\\n\\n      }, function (error) {\\n        if ((error.target !== undefined) &&\\n            (error.target.status === 404)) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        throw error;\\n      });\\n\\n  };\\n\\n\\n  DavStorage.prototype.putAttachment = function (id, name, blob) {\\n    var that = this;\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(that, {\\n          type: \\\"PUT\\\",\\n          url: that._url + id + name,\\n          data: blob\\n        });\\n      })\\n      .push(undefined, function (error) {\\n        if (error.target.status === 403 || error.target.status === 424) {\\n          throw new jIO.util.jIOError(\\\"Cannot access subdocument\\\", 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  DavStorage.prototype.getAttachment = function (id, name) {\\n    var context = this;\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(context, {\\n          type: \\\"GET\\\",\\n          url: context._url + id + name,\\n          dataType: \\\"blob\\\"\\n        });\\n      })\\n      .push(function (response) {\\n        return new Blob(\\n          [response.target.response || response.target.responseText],\\n          {\\\"type\\\": response.target.getResponseHeader('Content-Type') ||\\n                   \\\"application/octet-stream\\\"}\\n        );\\n      }, function (error) {\\n        if ((error.target !== undefined) &&\\n            (error.target.status === 404)) {\\n          throw new jIO.util.jIOError(\\\"Cannot find attachment: \\\"\\n                                      + id + \\\" , \\\" + name,\\n                                      404);\\n        }\\n        throw error;\\n      });\\n\\n  };\\n\\n  DavStorage.prototype.removeAttachment = function (id, name) {\\n    var context = this;\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(context, {\\n          type: \\\"DELETE\\\",\\n          url: context._url + id + name\\n        });\\n      })\\n      .push(undefined, function (error) {\\n        if ((error.target !== undefined) &&\\n            (error.target.status === 404)) {\\n          throw new jIO.util.jIOError(\\\"Cannot find attachment: \\\"\\n                                      + id + \\\" , \\\" + name,\\n                                      404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  // JIO COMMANDS //\\n\\n  // wedDav methods rfc4918 (short summary)\\n  // COPY     Reproduces single resources (files) and collections (directory\\n  //          trees). Will overwrite files (if specified by request) but will\\n  //          respond 209 (Conflict) if it would overwrite a tree\\n  // DELETE   deletes files and directory trees\\n  // GET      just the vanilla HTTP/1.1 behaviour\\n  // HEAD     ditto\\n  // LOCK     locks a resources\\n  // MKCOL    creates a directory\\n  // MOVE     Moves (rename or copy) a file or a directory tree. Will\\n  //          'overwrite' files (if specified by the request) but will respond\\n  //          209 (Conflict) if it would overwrite a tree.\\n  // OPTIONS  If WebDAV is enabled and available for the path this reports the\\n  //          WebDAV extension methods\\n  // PROPFIND Retrieves the requested file characteristics, DAV lock status\\n  //          and 'dead' properties for individual files, a directory and its\\n  //          child files, or a directory tree\\n  // PROPPATCHset and remove 'dead' meta-data properties\\n  // PUT      Update or create resource or collections\\n  // UNLOCK   unlocks a resource\\n\\n  // Notes: all Ajax requests should be CORS (cross-domain)\\n  // adding custom headers triggers preflight OPTIONS request!\\n  // http://remysharp.com/2011/04/21/getting-cors-working/\\n\\n  jIO.addStorage('dav', DavStorage);\\n\\n}(jIO, RSVP, DOMParser, Blob));\\n;/*\\n * Copyright 2015, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n/**\\n * JIO Google Drive Storage. Type = \\\"gdrive\\\".\\n * Google Drive \\\"database\\\" storage.\\n */\\n/*global jIO, Blob, RSVP, UriTemplate, JSON*/\\n/*jslint nomen: true*/\\n\\n(function (jIO, Blob, RSVP, UriTemplate, JSON) {\\n  \\\"use strict\\\";\\n\\n  var UPLOAD_URL = \\\"https://www.googleapis.com{/upload}/drive/v2/files{/id}\\\" +\\n      \\\"{?uploadType,access_token}\\\",\\n    upload_template = UriTemplate.parse(UPLOAD_URL),\\n    REMOVE_URL = \\\"https://www.googleapis.com/drive/v2/\\\" +\\n      \\\"files{/id,trash}{?access_token}\\\",\\n    remove_template = UriTemplate.parse(REMOVE_URL),\\n    LIST_URL = \\\"https://www.googleapis.com/drive/v2/files\\\" +\\n      \\\"?prettyPrint=false{&pageToken}&q=trashed=false\\\" +\\n      \\\"&fields=nextPageToken,items(id){&access_token}\\\",\\n    list_template = UriTemplate.parse(LIST_URL),\\n    GET_URL = \\\"https://www.googleapis.com/drive/v2/files{/id}{?alt}\\\",\\n    get_template = UriTemplate.parse(GET_URL);\\n\\n  function handleError(error, id) {\\n    if (error.target.status === 404) {\\n      throw new jIO.util.jIOError(\\n        \\\"Cannot find document: \\\" + id,\\n        404\\n      );\\n    }\\n    throw error;\\n  }\\n\\n  function listPage(result, token) {\\n    var i,\\n      obj;\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"GET\\\",\\n          \\\"url\\\": list_template.expand({\\n            pageToken : (result.nextPageToken || \\\"\\\"),\\n            access_token: token\\n          })\\n        });\\n      })\\n      .push(function (data) {\\n        obj = JSON.parse(data.target.response || data.target.responseText);\\n        for (i = 0; i < obj.items.length; i += 1) {\\n          obj.items[i].value = {};\\n          result.push(obj.items[i]);\\n        }\\n        result.nextPageToken = obj.nextPageToken;\\n        return result;\\n      }, handleError);\\n  }\\n\\n  function checkName(name) {\\n    if (name !== \\\"enclosure\\\") {\\n      throw new jIO.util.jIOError(\\\"Only support 'enclosure' attachment\\\", 400);\\n    }\\n  }\\n\\n  /**\\n   * The JIO Google Drive Storage extension\\n   *\\n   * @class GdriveStorage\\n   * @constructor\\n   */\\n  function GdriveStorage(spec) {\\n    if (spec === undefined || spec.access_token === undefined ||\\n        typeof spec.access_token !== 'string') {\\n      throw new TypeError(\\\"Access Token must be a string \\\" +\\n                          \\\"which contains more than one character.\\\");\\n    }\\n    if (spec.trashing !== undefined &&\\n        (spec.trashing !== true && spec.trashing !== false)) {\\n      throw new TypeError(\\\"trashing parameter\\\" +\\n                          \\\" must be a boolean (true or false)\\\");\\n    }\\n    this._trashing = spec.trashing || true;\\n    this._access_token = spec.access_token;\\n    return;\\n  }\\n\\n  function recursiveAllDocs(result, accessToken) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return listPage(result, accessToken);\\n      })\\n      .push(function () {\\n        if (result.nextPageToken) {\\n          return recursiveAllDocs(result, accessToken);\\n        }\\n        return result;\\n      });\\n  }\\n\\n  GdriveStorage.prototype.hasCapacity = function (name) {\\n    return (name === \\\"list\\\");\\n  };\\n\\n  GdriveStorage.prototype.buildQuery = function () {\\n    return recursiveAllDocs([], this._access_token);\\n  };\\n\\n  function sendMetaData(id, param, token) {\\n    var boundary = \\\"-------314159265358979323846\\\";\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          \\\"type\\\": id ? \\\"PUT\\\" : \\\"POST\\\",\\n          \\\"url\\\": upload_template.expand({\\n            access_token: token,\\n            id: id || [],\\n            upload: id ? [] : \\\"upload\\\",\\n            uploadType: \\\"multipart\\\"\\n          }),\\n          headers: {\\n            \\\"Content-Type\\\" : 'multipart/related; boundary=\\\"' + boundary + '\\\"'\\n          },\\n          data: '--' + boundary + '\\\\n' +\\n            'Content-Type: application/json; charset=UTF-8\\\\n\\\\n' +\\n            JSON.stringify(param) + '\\\\n\\\\n--' + boundary + \\\"--\\\"\\n        });\\n      })\\n      .push(function (result) {\\n        var obj = JSON.parse(result.target.responseText);\\n\\n        return obj.id;\\n      },\\n            function (error) {handleError(error, id); });\\n  }\\n\\n  GdriveStorage.prototype.put = function (id, param) {\\n    return sendMetaData(id, param, this._access_token);\\n  };\\n\\n  GdriveStorage.prototype.post = function (param) {\\n    return sendMetaData(undefined, param, this._access_token);\\n  };\\n\\n  function sendData(id, blob, token) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"PUT\\\",\\n          \\\"url\\\": upload_template.expand({\\n            access_token: token,\\n            upload: \\\"upload\\\",\\n            id: id,\\n            uploadType: \\\"media\\\"\\n          }),\\n          data: blob\\n        });\\n      })\\n      .push(function (data) {\\n        data = JSON.parse(data.target.responseText);\\n        if (data.mimeType === \\\"application/vnd.google-apps.folder\\\") {\\n          throw new jIO.util.jIOError(\\\"cannot put attachments to folder\\\", 400);\\n        }\\n        return data;\\n      }, function (error) {handleError(error, id); });\\n  }\\n\\n  GdriveStorage.prototype.putAttachment = function (id, name, blob) {\\n    checkName(name);\\n    return sendData(id, blob, this._access_token);\\n  };\\n\\n  GdriveStorage.prototype.remove = function (id) {\\n    var that  = this;\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: that._trashing ? \\\"POST\\\" : \\\"DELETE\\\",\\n          url: remove_template.expand({\\n            id : id,\\n            access_token : that._access_token,\\n            trash : that._trashing ? \\\"trash\\\" : []\\n          })\\n        });\\n      })\\n      .push(undefined, function (error) {handleError(error, id); });\\n  };\\n\\n  function getData(id, attach, token) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"GET\\\",\\n          dataType: attach ? \\\"blob\\\" : \\\"json\\\",\\n          url: get_template.expand({\\n            id: id,\\n            alt: attach ? \\\"media\\\" : [],\\n            access_token: token\\n          }),\\n          headers: {\\n            \\\"Authorization\\\" : \\\"Bearer \\\" + token\\n          }\\n        });\\n      })\\n      .push(function (evt) {\\n        return evt.target.response ||\\n          (attach ? new Blob([evt.target.responseText],\\n                             {\\\"type\\\" :\\n                              evt.target.responseHeaders[\\\"Content-Type\\\"]}) :\\n              JSON.parse(evt.target.responseText));\\n      }, function (error) {handleError(error, id); });\\n  }\\n\\n  GdriveStorage.prototype.get = function (id) {\\n    return getData(id, false, this._access_token);\\n  };\\n\\n  GdriveStorage.prototype.getAttachment = function (id, name) {\\n    checkName(name);\\n    return getData(id, true, this._access_token);\\n  };\\n\\n  GdriveStorage.prototype.allAttachments = function (id) {\\n    var token = this._access_token;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return getData(id, false, token);\\n      })\\n      .push(function (data) {\\n        if (data.mimeType === \\\"application/vnd.google-apps.folder\\\") {\\n          return {};\\n        }\\n        return {\\\"enclosure\\\": {}};\\n      });\\n  };\\n\\n  jIO.addStorage('gdrive', GdriveStorage);\\n\\n}(jIO, Blob, RSVP, UriTemplate, JSON));\\n;/*jslint nomen: true */\\n/*global RSVP*/\\n\\n/**\\n * JIO Union Storage. Type = 'union'.\\n * This provide a unified access other multiple storage.\\n * New document are created in the first sub storage.\\n * Document are searched in each sub storage until it is found.\\n * \\n *\\n * Storage Description:\\n *\\n *     {\\n *       \\\"type\\\": \\\"union\\\",\\n *       \\\"storage_list\\\": [\\n *         sub_storage_description_1,\\n *         sub_storage_description_2,\\n *\\n *         sub_storage_description_X,\\n *       ]\\n *     }\\n *\\n * @class UnionStorage\\n */\\n\\n(function (jIO, RSVP) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The JIO UnionStorage extension\\n   *\\n   * @class UnionStorage\\n   * @constructor\\n   */\\n  function UnionStorage(spec) {\\n    if (!Array.isArray(spec.storage_list)) {\\n      throw new jIO.util.jIOError(\\\"storage_list is not an Array\\\", 400);\\n    }\\n    var i;\\n    this._storage_list = [];\\n    for (i = 0; i < spec.storage_list.length; i += 1) {\\n      this._storage_list.push(jIO.createJIO(spec.storage_list[i]));\\n    }\\n  }\\n\\n  UnionStorage.prototype._getWithStorageIndex = function () {\\n    var i,\\n      index = 0,\\n      context = this,\\n      arg = arguments,\\n      result = this._storage_list[0].get.apply(this._storage_list[0], arg);\\n\\n    function handle404(j) {\\n      result\\n        .push(undefined, function (error) {\\n          if ((error instanceof jIO.util.jIOError) &&\\n              (error.status_code === 404)) {\\n            return context._storage_list[j].get.apply(context._storage_list[j],\\n                                                      arg)\\n              .push(function (doc) {\\n                index = j;\\n                return doc;\\n              });\\n          }\\n          throw error;\\n        });\\n    }\\n\\n    for (i = 1; i < this._storage_list.length; i += 1) {\\n      handle404(i);\\n    }\\n    return result\\n      .push(function (doc) {\\n        return [index, doc];\\n      });\\n  };\\n\\n  /*\\n   * Get a document\\n   * Try on each substorage on after the other\\n   */\\n  UnionStorage.prototype.get = function () {\\n    return this._getWithStorageIndex.apply(this, arguments)\\n      .push(function (result) {\\n        return result[1];\\n      });\\n  };\\n\\n  /*\\n   * Get attachments list\\n   * Try on each substorage on after the other\\n   */\\n  UnionStorage.prototype.allAttachments = function () {\\n    var argument_list = arguments,\\n      context = this;\\n    return this._getWithStorageIndex.apply(this, arguments)\\n      .push(function (result) {\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.allAttachments.apply(sub_storage, argument_list);\\n      });\\n  };\\n\\n  /*\\n   * Post a document\\n   * Simply store on the first substorage\\n   */\\n  UnionStorage.prototype.post = function () {\\n    return this._storage_list[0].post.apply(this._storage_list[0], arguments);\\n  };\\n\\n  /*\\n   * Put a document\\n   * Search the document location, and modify it in its storage.\\n   */\\n  UnionStorage.prototype.put = function () {\\n    var arg = arguments,\\n      context = this;\\n    return this._getWithStorageIndex(arg[0])\\n      .push(undefined, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          // Document does not exist, create in first substorage\\n          return [0];\\n        }\\n        throw error;\\n      })\\n      .push(function (result) {\\n        // Storage found, modify in it directly\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.put.apply(sub_storage, arg);\\n      });\\n  };\\n\\n  /*\\n   * Remove a document\\n   * Search the document location, and remove it from its storage.\\n   */\\n  UnionStorage.prototype.remove = function () {\\n    var arg = arguments,\\n      context = this;\\n    return this._getWithStorageIndex(arg[0])\\n      .push(function (result) {\\n        // Storage found, remove from it directly\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.remove.apply(sub_storage, arg);\\n      });\\n  };\\n\\n  UnionStorage.prototype.buildQuery = function () {\\n    var promise_list = [],\\n      i,\\n      id_dict = {},\\n      len = this._storage_list.length,\\n      sub_storage;\\n    for (i = 0; i < len; i += 1) {\\n      sub_storage = this._storage_list[i];\\n      promise_list.push(sub_storage.buildQuery.apply(sub_storage, arguments));\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return RSVP.all(promise_list);\\n      })\\n      .push(function (result_list) {\\n        var result = [],\\n          sub_result,\\n          sub_result_len,\\n          j;\\n        len = result_list.length;\\n        for (i = 0; i < len; i += 1) {\\n          sub_result = result_list[i];\\n          sub_result_len = sub_result.length;\\n          for (j = 0; j < sub_result_len; j += 1) {\\n            if (!id_dict.hasOwnProperty(sub_result[j].id)) {\\n              id_dict[sub_result[j].id] = null;\\n              result.push(sub_result[j]);\\n            }\\n          }\\n        }\\n        return result;\\n      });\\n  };\\n\\n  UnionStorage.prototype.hasCapacity = function (name) {\\n    var i,\\n      len,\\n      result,\\n      sub_storage;\\n    if ((name === \\\"list\\\") ||\\n            (name === \\\"query\\\") ||\\n            (name === \\\"select\\\")) {\\n      result = true;\\n      len = this._storage_list.length;\\n      for (i = 0; i < len; i += 1) {\\n        sub_storage = this._storage_list[i];\\n        result = result && sub_storage.hasCapacity(name);\\n      }\\n      return result;\\n    }\\n    return false;\\n  };\\n\\n  UnionStorage.prototype.repair = function () {\\n    var i,\\n      promise_list = [];\\n    for (i = 0; i < this._storage_list.length; i += 1) {\\n      promise_list.push(this._storage_list[i].repair.apply(\\n        this._storage_list[i],\\n        arguments\\n      ));\\n    }\\n    return RSVP.all(promise_list);\\n  };\\n\\n  UnionStorage.prototype.getAttachment = function () {\\n    var argument_list = arguments,\\n      context = this;\\n    return this._getWithStorageIndex.apply(this, arguments)\\n      .push(function (result) {\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.getAttachment.apply(sub_storage, argument_list);\\n      });\\n  };\\n\\n  UnionStorage.prototype.putAttachment = function () {\\n    var argument_list = arguments,\\n      context = this;\\n    return this._getWithStorageIndex.apply(this, arguments)\\n      .push(function (result) {\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.putAttachment.apply(sub_storage, argument_list);\\n      });\\n  };\\n\\n  UnionStorage.prototype.removeAttachment = function () {\\n    var argument_list = arguments,\\n      context = this;\\n    return this._getWithStorageIndex.apply(this, arguments)\\n      .push(function (result) {\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.removeAttachment.apply(sub_storage, argument_list);\\n      });\\n  };\\n\\n  jIO.addStorage('union', UnionStorage);\\n\\n}(jIO, RSVP));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n// JIO ERP5 Storage Description :\\n// {\\n//   type: \\\"erp5\\\"\\n//   url: {string}\\n// }\\n\\n/*jslint nomen: true, unparam: true */\\n/*global jIO, UriTemplate, FormData, RSVP, URI, Blob,\\n         SimpleQuery, ComplexQuery*/\\n\\n(function (jIO, UriTemplate, FormData, RSVP, URI, Blob,\\n           SimpleQuery, ComplexQuery) {\\n  \\\"use strict\\\";\\n\\n  function getSiteDocument(storage) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"GET\\\",\\n          \\\"url\\\": storage._url,\\n          \\\"xhrFields\\\": {\\n            withCredentials: true\\n          }\\n        });\\n      })\\n      .push(function (event) {\\n        return JSON.parse(event.target.responseText);\\n      });\\n  }\\n\\n  function getDocumentAndHateoas(storage, id, options) {\\n    if (options === undefined) {\\n      options = {};\\n    }\\n    return getSiteDocument(storage)\\n      .push(function (site_hal) {\\n        // XXX need to get modified metadata\\n        return new RSVP.Queue()\\n          .push(function () {\\n            return jIO.util.ajax({\\n              \\\"type\\\": \\\"GET\\\",\\n              \\\"url\\\": UriTemplate.parse(site_hal._links.traverse.href)\\n                                .expand({\\n                  relative_url: id,\\n                  view: options._view\\n                }),\\n              \\\"xhrFields\\\": {\\n                withCredentials: true\\n              }\\n            });\\n          })\\n          .push(undefined, function (error) {\\n            if ((error.target !== undefined) &&\\n                (error.target.status === 404)) {\\n              throw new jIO.util.jIOError(\\\"Cannot find document: \\\" + id, 404);\\n            }\\n            throw error;\\n          });\\n      });\\n  }\\n\\n  var allowed_field_dict = {\\n    \\\"StringField\\\": null,\\n    \\\"EmailField\\\": null,\\n    \\\"IntegerField\\\": null,\\n    \\\"FloatField\\\": null,\\n    \\\"TextAreaField\\\": null\\n  };\\n\\n  function extractPropertyFromFormJSON(json) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        var form = json._embedded._view,\\n          converted_json = {\\n            portal_type: json._links.type.name\\n          },\\n          form_data_json = {},\\n          field,\\n          key,\\n          prefix_length,\\n          result;\\n\\n        if (json._links.hasOwnProperty('parent')) {\\n          converted_json.parent_relative_url =\\n            new URI(json._links.parent.href).segment(2);\\n        }\\n\\n        form_data_json.form_id = {\\n          \\\"key\\\": [form.form_id.key],\\n          \\\"default\\\": form.form_id[\\\"default\\\"]\\n        };\\n        // XXX How to store datetime\\n        for (key in form) {\\n          if (form.hasOwnProperty(key)) {\\n            field = form[key];\\n            prefix_length = 0;\\n            if (key.indexOf('my_') === 0 && field.editable) {\\n              prefix_length = 3;\\n            }\\n            if (key.indexOf('your_') === 0) {\\n              prefix_length = 5;\\n            }\\n            if ((prefix_length !== 0) &&\\n                (allowed_field_dict.hasOwnProperty(field.type))) {\\n              form_data_json[key.substring(prefix_length)] = {\\n                \\\"default\\\": field[\\\"default\\\"],\\n                \\\"key\\\": field.key\\n              };\\n              converted_json[key.substring(prefix_length)] = field[\\\"default\\\"];\\n            }\\n          }\\n        }\\n\\n        result = {\\n          data: converted_json,\\n          form_data: form_data_json\\n        };\\n        if (form.hasOwnProperty('_actions') &&\\n            form._actions.hasOwnProperty('put')) {\\n          result.action_href = form._actions.put.href;\\n        }\\n        return result;\\n      });\\n  }\\n\\n  function extractPropertyFromForm(context, id) {\\n    return context.getAttachment(id, \\\"view\\\")\\n      .push(function (blob) {\\n        return jIO.util.readBlobAsText(blob);\\n      })\\n      .push(function (evt) {\\n        return JSON.parse(evt.target.result);\\n      })\\n      .push(function (json) {\\n        return extractPropertyFromFormJSON(json);\\n      });\\n  }\\n\\n  // XXX docstring\\n  function ERP5Storage(spec) {\\n    if (typeof spec.url !== \\\"string\\\" || !spec.url) {\\n      throw new TypeError(\\\"ERP5 'url' must be a string \\\" +\\n                          \\\"which contains more than one character.\\\");\\n    }\\n    this._url = spec.url;\\n    this._default_view_reference = spec.default_view_reference;\\n  }\\n\\n  function convertJSONToGet(json) {\\n    var key,\\n      result = json.data;\\n    // Remove all ERP5 hateoas links / convert them into jIO ID\\n    for (key in result) {\\n      if (result.hasOwnProperty(key)) {\\n        if (!result[key]) {\\n          delete result[key];\\n        }\\n      }\\n    }\\n    return result;\\n  }\\n\\n  ERP5Storage.prototype.get = function (id) {\\n    return extractPropertyFromForm(this, id)\\n      .push(function (result) {\\n        return convertJSONToGet(result);\\n      });\\n  };\\n\\n  ERP5Storage.prototype.bulk = function (request_list) {\\n    var i,\\n      storage = this,\\n      bulk_list = [];\\n\\n\\n    for (i = 0; i < request_list.length; i += 1) {\\n      if (request_list[i].method !== \\\"get\\\") {\\n        throw new Error(\\\"ERP5Storage: not supported \\\" +\\n                        request_list[i].method + \\\" in bulk\\\");\\n      }\\n      bulk_list.push({\\n        relative_url: request_list[i].parameter_list[0],\\n        view: storage._default_view_reference\\n      });\\n    }\\n    return getSiteDocument(storage)\\n      .push(function (site_hal) {\\n        var form_data = new FormData();\\n        form_data.append(\\\"bulk_list\\\", JSON.stringify(bulk_list));\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"POST\\\",\\n          \\\"url\\\": site_hal._actions.bulk.href,\\n          \\\"data\\\": form_data,\\n//           \\\"headers\\\": {\\n//             \\\"Content-Type\\\": \\\"application/json\\\"\\n//           },\\n          \\\"xhrFields\\\": {\\n            withCredentials: true\\n          }\\n        });\\n      })\\n      .push(function (response) {\\n        var result_list = [],\\n          hateoas = JSON.parse(response.target.responseText);\\n\\n        function pushResult(json) {\\n          return extractPropertyFromFormJSON(json)\\n            .push(function (json2) {\\n              return convertJSONToGet(json2);\\n            });\\n        }\\n\\n        for (i = 0; i < hateoas.result_list.length; i += 1) {\\n          result_list.push(pushResult(hateoas.result_list[i]));\\n        }\\n        return RSVP.all(result_list);\\n      });\\n  };\\n\\n  ERP5Storage.prototype.post = function (data) {\\n    var context = this,\\n      new_id;\\n\\n    return getSiteDocument(this)\\n      .push(function (site_hal) {\\n        var form_data = new FormData();\\n        form_data.append(\\\"portal_type\\\", data.portal_type);\\n        form_data.append(\\\"parent_relative_url\\\", data.parent_relative_url);\\n        return jIO.util.ajax({\\n          type: \\\"POST\\\",\\n          url: site_hal._actions.add.href,\\n          data: form_data,\\n          xhrFields: {\\n            withCredentials: true\\n          }\\n        });\\n      })\\n      .push(function (evt) {\\n        var location = evt.target.getResponseHeader(\\\"X-Location\\\"),\\n          uri = new URI(location);\\n        new_id = uri.segment(2);\\n        return context.put(new_id, data);\\n      })\\n      .push(function () {\\n        return new_id;\\n      });\\n  };\\n\\n  ERP5Storage.prototype.put = function (id, data) {\\n    var context = this;\\n\\n    return extractPropertyFromForm(context, id)\\n      .push(function (result) {\\n        var key,\\n          json = result.form_data,\\n          form_data = {};\\n        form_data[json.form_id.key] = json.form_id[\\\"default\\\"];\\n\\n        // XXX How to store datetime:!!!!!\\n        for (key in data) {\\n          if (data.hasOwnProperty(key)) {\\n            if (key === \\\"form_id\\\") {\\n              throw new jIO.util.jIOError(\\n                \\\"ERP5: forbidden property: \\\" + key,\\n                400\\n              );\\n            }\\n            if ((key !== \\\"portal_type\\\") && (key !== \\\"parent_relative_url\\\")) {\\n              if (!json.hasOwnProperty(key)) {\\n                throw new jIO.util.jIOError(\\n                  \\\"ERP5: can not store property: \\\" + key,\\n                  400\\n                );\\n              }\\n              form_data[json[key].key] = data[key];\\n            }\\n          }\\n        }\\n        if (!result.hasOwnProperty('action_href')) {\\n          throw new jIO.util.jIOError(\\n            \\\"ERP5: can not modify document: \\\" + id,\\n            403\\n          );\\n        }\\n        return context.putAttachment(\\n          id,\\n          result.action_href,\\n          new Blob([JSON.stringify(form_data)], {type: \\\"application/json\\\"})\\n        );\\n      });\\n  };\\n\\n  ERP5Storage.prototype.allAttachments = function (id) {\\n    var context = this;\\n    return getDocumentAndHateoas(this, id)\\n      .push(function () {\\n        if (context._default_view_reference === undefined) {\\n          return {\\n            links: {}\\n          };\\n        }\\n        return {\\n          view: {},\\n          links: {}\\n        };\\n      });\\n  };\\n\\n  ERP5Storage.prototype.getAttachment = function (id, action, options) {\\n    if (options === undefined) {\\n      options = {};\\n    }\\n    if (action === \\\"view\\\") {\\n      if (this._default_view_reference === undefined) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find attachment view for: \\\" + id,\\n          404\\n        );\\n      }\\n      return getDocumentAndHateoas(this, id,\\n                                   {\\\"_view\\\": this._default_view_reference})\\n        .push(function (response) {\\n          var result = JSON.parse(response.target.responseText);\\n          // Remove all ERP5 hateoas links / convert them into jIO ID\\n\\n          // XXX Change default action to an jio urn with attachment name inside\\n          // if Base_edit, do put URN\\n          // if others, do post URN (ie, unique new attachment name)\\n          // XXX Except this attachment name should be generated when\\n          return new Blob(\\n            [JSON.stringify(result)],\\n            {\\\"type\\\": 'application/hal+json'}\\n          );\\n        });\\n    }\\n    if (action === \\\"links\\\") {\\n      return getDocumentAndHateoas(this, id)\\n        .push(function (response) {\\n          return new Blob(\\n            [JSON.stringify(JSON.parse(response.target.responseText))],\\n            {\\\"type\\\": 'application/hal+json'}\\n          );\\n        });\\n    }\\n    if (action.indexOf(this._url) === 0) {\\n      return new RSVP.Queue()\\n        .push(function () {\\n          var start,\\n            end,\\n            range,\\n            request_options = {\\n              \\\"type\\\": \\\"GET\\\",\\n              \\\"dataType\\\": \\\"blob\\\",\\n              \\\"url\\\": action,\\n              \\\"xhrFields\\\": {\\n                withCredentials: true\\n              }\\n            };\\n          if (options.start !== undefined ||  options.end !== undefined) {\\n            start = options.start || 0;\\n            end = options.end;\\n            if (end !== undefined && end < 0) {\\n              throw new jIO.util.jIOError(\\\"end must be positive\\\",\\n                                          400);\\n            }\\n            if (start < 0) {\\n              range = \\\"bytes=\\\" + start;\\n            } else if (end === undefined) {\\n              range = \\\"bytes=\\\" + start + \\\"-\\\";\\n            } else {\\n              if (start > end) {\\n                throw new jIO.util.jIOError(\\\"start is greater than end\\\",\\n                                            400);\\n              }\\n              range = \\\"bytes=\\\" + start + \\\"-\\\" + end;\\n            }\\n            request_options.headers = {Range: range};\\n          }\\n          return jIO.util.ajax(request_options);\\n        })\\n        .push(function (evt) {\\n          if (evt.target.response === undefined) {\\n            return new Blob(\\n              [evt.target.responseText],\\n              {\\\"type\\\": evt.target.getResponseHeader(\\\"Content-Type\\\")}\\n            );\\n          }\\n          return evt.target.response;\\n        });\\n    }\\n    throw new jIO.util.jIOError(\\\"ERP5: not support get attachment: \\\" + action,\\n                                400);\\n  };\\n\\n  ERP5Storage.prototype.putAttachment = function (id, name, blob) {\\n    // Assert we use a callable on a document from the ERP5 site\\n    if (name.indexOf(this._url) !== 0) {\\n      throw new jIO.util.jIOError(\\\"Can not store outside ERP5: \\\" +\\n                                  name, 400);\\n    }\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.readBlobAsText(blob);\\n      })\\n      .push(function (evt) {\\n        var form_data = JSON.parse(evt.target.result),\\n          data = new FormData(),\\n          array,\\n          i,\\n          key,\\n          value;\\n        for (key in form_data) {\\n          if (form_data.hasOwnProperty(key)) {\\n            if (Array.isArray(form_data[key])) {\\n              array = form_data[key];\\n            } else {\\n              array = [form_data[key]];\\n            }\\n            for (i = 0; i < array.length; i += 1) {\\n              value = array[i];\\n              if (typeof value === \\\"object\\\") {\\n                data.append(key, jIO.util.dataURItoBlob(value.url),\\n                            value.file_name);\\n              } else {\\n                data.append(key, value);\\n              }\\n            }\\n          }\\n        }\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"POST\\\",\\n          \\\"url\\\": name,\\n          \\\"data\\\": data,\\n          \\\"xhrFields\\\": {\\n            withCredentials: true\\n          }\\n        });\\n      });\\n  };\\n\\n  ERP5Storage.prototype.hasCapacity = function (name) {\\n    return ((name === \\\"list\\\") || (name === \\\"query\\\") ||\\n            (name === \\\"select\\\") || (name === \\\"limit\\\") ||\\n            (name === \\\"sort\\\"));\\n  };\\n\\n  function isSingleLocalRoles(parsed_query) {\\n    if ((parsed_query instanceof SimpleQuery) &&\\n        (parsed_query.key === 'local_roles')) {\\n      // local_roles:\\\"Assignee\\\"\\n      return parsed_query.value;\\n    }\\n  }\\n\\n  function isMultipleLocalRoles(parsed_query) {\\n    var i,\\n      sub_query,\\n      is_multiple = true,\\n      local_role_list = [];\\n    if ((parsed_query instanceof ComplexQuery) &&\\n        (parsed_query.operator === 'OR')) {\\n\\n      for (i = 0; i < parsed_query.query_list.length; i += 1) {\\n        sub_query = parsed_query.query_list[i];\\n        if ((sub_query instanceof SimpleQuery) &&\\n            (sub_query.key === 'local_roles')) {\\n          local_role_list.push(sub_query.value);\\n        } else {\\n          is_multiple = false;\\n        }\\n      }\\n      if (is_multiple) {\\n        // local_roles:\\\"Assignee\\\" OR local_roles:\\\"Assignor\\\"\\n        return local_role_list;\\n      }\\n    }\\n  }\\n\\n  ERP5Storage.prototype.buildQuery = function (options) {\\n//     if (typeof options.query !== \\\"string\\\") {\\n//       options.query = (options.query ?\\n//                        jIO.Query.objectToSearchText(options.query) :\\n//                        undefined);\\n//     }\\n    return getSiteDocument(this)\\n      .push(function (site_hal) {\\n        var query = options.query,\\n          i,\\n          parsed_query,\\n          sub_query,\\n          result_list,\\n          local_roles,\\n          sort_list = [];\\n        if (options.query) {\\n          parsed_query = jIO.QueryFactory.create(options.query);\\n\\n          result_list = isSingleLocalRoles(parsed_query);\\n          if (result_list) {\\n            query = undefined;\\n            local_roles = result_list;\\n          } else {\\n\\n            result_list = isMultipleLocalRoles(parsed_query);\\n            if (result_list) {\\n              query = undefined;\\n              local_roles = result_list;\\n            } else if ((parsed_query instanceof ComplexQuery) &&\\n                       (parsed_query.operator === 'AND')) {\\n\\n              // portal_type:\\\"Person\\\" AND local_roles:\\\"Assignee\\\"\\n              for (i = 0; i < parsed_query.query_list.length; i += 1) {\\n                sub_query = parsed_query.query_list[i];\\n\\n                result_list = isSingleLocalRoles(sub_query);\\n                if (result_list) {\\n                  local_roles = result_list;\\n                  parsed_query.query_list.splice(i, 1);\\n                  query = jIO.Query.objectToSearchText(parsed_query);\\n                  i = parsed_query.query_list.length;\\n                } else {\\n                  result_list = isMultipleLocalRoles(sub_query);\\n                  if (result_list) {\\n                    local_roles = result_list;\\n                    parsed_query.query_list.splice(i, 1);\\n                    query = jIO.Query.objectToSearchText(parsed_query);\\n                    i = parsed_query.query_list.length;\\n                  }\\n                }\\n              }\\n            }\\n\\n          }\\n        }\\n\\n        if (options.sort_on) {\\n          for (i = 0; i < options.sort_on.length; i += 1) {\\n            sort_list.push(JSON.stringify(options.sort_on[i]));\\n          }\\n        }\\n\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"GET\\\",\\n          \\\"url\\\": UriTemplate.parse(site_hal._links.raw_search.href)\\n                            .expand({\\n              query: query,\\n              // XXX Force erp5 to return embedded document\\n              select_list: options.select_list || [\\\"title\\\", \\\"reference\\\"],\\n              limit: options.limit,\\n              sort_on: sort_list,\\n              local_roles: local_roles\\n            }),\\n          \\\"xhrFields\\\": {\\n            withCredentials: true\\n          }\\n        });\\n      })\\n      .push(function (response) {\\n        return JSON.parse(response.target.responseText);\\n      })\\n      .push(function (catalog_json) {\\n        var data = catalog_json._embedded.contents,\\n          count = data.length,\\n          i,\\n          uri,\\n          item,\\n          result = [];\\n        for (i = 0; i < count; i += 1) {\\n          item = data[i];\\n          uri = new URI(item._links.self.href);\\n          delete item._links;\\n          result.push({\\n            id: uri.segment(2),\\n            value: item\\n          });\\n        }\\n        return result;\\n      });\\n  };\\n\\n  jIO.addStorage(\\\"erp5\\\", ERP5Storage);\\n\\n}(jIO, UriTemplate, FormData, RSVP, URI, Blob,\\n  SimpleQuery, ComplexQuery));\\n;/*jslint nomen: true*/\\n/*global RSVP*/\\n(function (jIO, RSVP) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The jIO QueryStorage extension\\n   *\\n   * @class QueryStorage\\n   * @constructor\\n   */\\n  function QueryStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n    this._key_schema = spec.key_schema;\\n  }\\n\\n  QueryStorage.prototype.get = function () {\\n    return this._sub_storage.get.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.allAttachments = function () {\\n    return this._sub_storage.allAttachments.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.post = function () {\\n    return this._sub_storage.post.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.put = function () {\\n    return this._sub_storage.put.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.remove = function () {\\n    return this._sub_storage.remove.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.getAttachment = function () {\\n    return this._sub_storage.getAttachment.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.putAttachment = function () {\\n    return this._sub_storage.putAttachment.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.removeAttachment = function () {\\n    return this._sub_storage.removeAttachment.apply(this._sub_storage,\\n                                                    arguments);\\n  };\\n  QueryStorage.prototype.repair = function () {\\n    return this._sub_storage.repair.apply(this._sub_storage, arguments);\\n  };\\n\\n  QueryStorage.prototype.hasCapacity = function (name) {\\n    var this_storage_capacity_list = [\\\"limit\\\",\\n                                      \\\"sort\\\",\\n                                      \\\"select\\\",\\n                                      \\\"query\\\"];\\n\\n    if (this_storage_capacity_list.indexOf(name) !== -1) {\\n      return true;\\n    }\\n    if (name === \\\"list\\\") {\\n      return this._sub_storage.hasCapacity(name);\\n    }\\n    return false;\\n  };\\n  QueryStorage.prototype.buildQuery = function (options) {\\n    var substorage = this._sub_storage,\\n      context = this,\\n      sub_options = {},\\n      is_manual_query_needed = false,\\n      is_manual_include_needed = false;\\n\\n    if (substorage.hasCapacity(\\\"list\\\")) {\\n\\n      // Can substorage handle the queries if needed?\\n      try {\\n        if (((options.query === undefined) ||\\n             (substorage.hasCapacity(\\\"query\\\"))) &&\\n            ((options.sort_on === undefined) ||\\n             (substorage.hasCapacity(\\\"sort\\\"))) &&\\n            ((options.select_list === undefined) ||\\n             (substorage.hasCapacity(\\\"select\\\"))) &&\\n            ((options.limit === undefined) ||\\n             (substorage.hasCapacity(\\\"limit\\\")))) {\\n          sub_options.query = options.query;\\n          sub_options.sort_on = options.sort_on;\\n          sub_options.select_list = options.select_list;\\n          sub_options.limit = options.limit;\\n        }\\n      } catch (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 501)) {\\n          is_manual_query_needed = true;\\n        } else {\\n          throw error;\\n        }\\n      }\\n\\n      // Can substorage include the docs if needed?\\n      try {\\n        if ((is_manual_query_needed ||\\n            (options.include_docs === true)) &&\\n            (substorage.hasCapacity(\\\"include\\\"))) {\\n          sub_options.include_docs = true;\\n        }\\n      } catch (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 501)) {\\n          is_manual_include_needed = true;\\n        } else {\\n          throw error;\\n        }\\n      }\\n\\n      return substorage.buildQuery(sub_options)\\n\\n        // Include docs if needed\\n        .push(function (result) {\\n          var include_query_list = [result],\\n            len,\\n            i;\\n\\n          function safeGet(j) {\\n            var id = result[j].id;\\n            return substorage.get(id)\\n              .push(function (doc) {\\n                // XXX Can delete user data!\\n                doc._id = id;\\n                return doc;\\n              }, function (error) {\\n                // Document may have been dropped after listing\\n                if ((error instanceof jIO.util.jIOError) &&\\n                    (error.status_code === 404)) {\\n                  return;\\n                }\\n                throw error;\\n              });\\n          }\\n\\n          if (is_manual_include_needed) {\\n            len = result.length;\\n            for (i = 0; i < len; i += 1) {\\n              include_query_list.push(safeGet(i));\\n            }\\n            result = RSVP.all(include_query_list);\\n          }\\n          return result;\\n        })\\n        .push(function (result) {\\n          var original_result,\\n            len,\\n            i;\\n          if (is_manual_include_needed) {\\n            original_result = result[0];\\n            len = original_result.length;\\n            for (i = 0; i < len; i += 1) {\\n              original_result[i].doc = result[i + 1];\\n            }\\n            result = original_result;\\n          }\\n          return result;\\n\\n        })\\n\\n        // Manual query if needed\\n        .push(function (result) {\\n          var data_rows = [],\\n            len,\\n            i;\\n          if (is_manual_query_needed) {\\n            len = result.length;\\n            for (i = 0; i < len; i += 1) {\\n              result[i].doc.__id = result[i].id;\\n              data_rows.push(result[i].doc);\\n            }\\n            if (options.select_list) {\\n              options.select_list.push(\\\"__id\\\");\\n            }\\n            result = jIO.QueryFactory.create(options.query || \\\"\\\",\\n                                             context._key_schema).\\n              exec(data_rows, options);\\n          }\\n          return result;\\n        })\\n\\n        // reconstruct filtered rows, preserving the order from docs\\n        .push(function (result) {\\n          var new_result = [],\\n            element,\\n            len,\\n            i;\\n          if (is_manual_query_needed) {\\n            len = result.length;\\n            for (i = 0; i < len; i += 1) {\\n              element = {\\n                id: result[i].__id,\\n                value: options.select_list ? result[i] : {},\\n                doc: {}\\n              };\\n              if (options.select_list) {\\n                // Does not work if user manually request __id\\n                delete element.value.__id;\\n              }\\n              if (options.include_docs) {\\n                // XXX To implement\\n                throw new Error(\\\"QueryStorage does not support include docs\\\");\\n              }\\n              new_result.push(element);\\n            }\\n            result = new_result;\\n          }\\n          return result;\\n        });\\n\\n    }\\n  };\\n\\n  jIO.addStorage('query', QueryStorage);\\n\\n}(jIO, RSVP));\\n;/*jslint nomen: true*/\\n/*global RSVP, Blob*/\\n(function (jIO, RSVP, Blob) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The jIO FileSystemBridgeStorage extension\\n   *\\n   * @class FileSystemBridgeStorage\\n   * @constructor\\n   */\\n  function FileSystemBridgeStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n  }\\n  var DOCUMENT_EXTENSION = \\\".json\\\",\\n    DOCUMENT_KEY = \\\"/.jio_documents/\\\",\\n    ROOT = \\\"/\\\";\\n\\n  function endsWith(str, suffix) {\\n    return str.indexOf(suffix, str.length - suffix.length) !== -1;\\n  }\\n\\n  FileSystemBridgeStorage.prototype.get = function (id) {\\n    var context = this;\\n    return new RSVP.Queue()\\n\\n      // First, try to get explicit reference to the document\\n\\n      .push(function () {\\n        // First get the document itself if it exists\\n        return context._sub_storage.getAttachment(\\n          DOCUMENT_KEY,\\n          id + DOCUMENT_EXTENSION,\\n          {format: \\\"json\\\"}\\n        );\\n      })\\n      .push(undefined, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n\\n          // Second, try to get default attachment\\n          return context._sub_storage.allAttachments(ROOT)\\n            .push(function (attachment_dict) {\\n              if (attachment_dict.hasOwnProperty(id)) {\\n                return {};\\n              }\\n              throw new jIO.util.jIOError(\\\"Cannot find document \\\" + id,\\n                                          404);\\n            });\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  FileSystemBridgeStorage.prototype.allAttachments = function (id) {\\n    var context = this;\\n    return context._sub_storage.allAttachments(ROOT)\\n      .push(function (attachment_dict) {\\n        if (attachment_dict.hasOwnProperty(id)) {\\n          return {\\n            enclosure: {}\\n          };\\n        }\\n        // Second get the document itself if it exists\\n        return context._sub_storage.getAttachment(\\n          DOCUMENT_KEY,\\n          id + DOCUMENT_EXTENSION\\n        )\\n          .push(function () {\\n            return {};\\n          }, function (error) {\\n            if ((error instanceof jIO.util.jIOError) &&\\n                (error.status_code === 404)) {\\n              throw new jIO.util.jIOError(\\\"Cannot find document \\\" + id,\\n                                          404);\\n            }\\n            throw error;\\n          });\\n      });\\n\\n  };\\n\\n  FileSystemBridgeStorage.prototype.put = function (doc_id, param) {\\n    var context = this;\\n    // XXX Handle conflict!\\n\\n    return context._sub_storage.putAttachment(\\n      DOCUMENT_KEY,\\n      doc_id + DOCUMENT_EXTENSION,\\n      new Blob([JSON.stringify(param)], {type: \\\"application/json\\\"})\\n    )\\n      .push(undefined, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          return context._sub_storage.put(DOCUMENT_KEY, {})\\n            .push(function () {\\n              return context._sub_storage.putAttachment(\\n                DOCUMENT_KEY,\\n                doc_id + DOCUMENT_EXTENSION,\\n                new Blob([JSON.stringify(param)],\\n                         {type: \\\"application/json\\\"})\\n              );\\n            });\\n        }\\n        throw error;\\n      })\\n      .push(function () {\\n        return doc_id;\\n      });\\n\\n  };\\n\\n  FileSystemBridgeStorage.prototype.remove = function (doc_id) {\\n    var context = this,\\n      got_error = false;\\n    return new RSVP.Queue()\\n\\n      // First, try to remove enclosure\\n      .push(function () {\\n        return context._sub_storage.removeAttachment(\\n          ROOT,\\n          doc_id\\n        );\\n      })\\n\\n      .push(undefined, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          got_error = true;\\n          return;\\n        }\\n        throw error;\\n      })\\n\\n      // Second, try to remove explicit doc\\n      .push(function () {\\n        return context._sub_storage.removeAttachment(\\n          DOCUMENT_KEY,\\n          doc_id + DOCUMENT_EXTENSION\\n        );\\n      })\\n\\n      .push(undefined, function (error) {\\n        if ((!got_error) && (error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          return doc_id;\\n        }\\n        throw error;\\n      });\\n\\n  };\\n\\n  FileSystemBridgeStorage.prototype.hasCapacity = function (capacity) {\\n    return (capacity === \\\"list\\\");\\n  };\\n\\n  FileSystemBridgeStorage.prototype.buildQuery = function () {\\n    var result_dict = {},\\n      context = this;\\n    return new RSVP.Queue()\\n\\n      // First, get list of explicit documents\\n\\n      .push(function () {\\n        return context._sub_storage.allAttachments(DOCUMENT_KEY);\\n      })\\n      .push(function (result) {\\n        var key;\\n        for (key in result) {\\n          if (result.hasOwnProperty(key)) {\\n            if (endsWith(key, DOCUMENT_EXTENSION)) {\\n              result_dict[key.substring(\\n                0,\\n                key.length - DOCUMENT_EXTENSION.length\\n              )] = null;\\n            }\\n          }\\n        }\\n      }, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          return;\\n        }\\n        throw error;\\n      })\\n\\n      // Second, get list of enclosure\\n\\n      .push(function () {\\n        return context._sub_storage.allAttachments(ROOT);\\n      })\\n      .push(function (result) {\\n        var key;\\n        for (key in result) {\\n          if (result.hasOwnProperty(key)) {\\n            result_dict[key] = null;\\n          }\\n        }\\n      })\\n\\n      // Finally, build the result\\n\\n      .push(function () {\\n        var result = [],\\n          key;\\n        for (key in result_dict) {\\n          if (result_dict.hasOwnProperty(key)) {\\n            result.push({\\n              id: key,\\n              value: {}\\n            });\\n          }\\n        }\\n        return result;\\n      });\\n\\n  };\\n\\n  FileSystemBridgeStorage.prototype.getAttachment = function (id, name) {\\n    if (name !== \\\"enclosure\\\") {\\n      throw new jIO.util.jIOError(\\\"Only support 'enclosure' attachment\\\",\\n                                  400);\\n    }\\n\\n    return this._sub_storage.getAttachment(ROOT, id);\\n  };\\n\\n  FileSystemBridgeStorage.prototype.putAttachment = function (id, name, blob) {\\n    if (name !== \\\"enclosure\\\") {\\n      throw new jIO.util.jIOError(\\\"Only support 'enclosure' attachment\\\",\\n                                  400);\\n    }\\n\\n    return this._sub_storage.putAttachment(\\n      ROOT,\\n      id,\\n      blob\\n    );\\n  };\\n\\n  FileSystemBridgeStorage.prototype.removeAttachment = function (id, name) {\\n    if (name !== \\\"enclosure\\\") {\\n      throw new jIO.util.jIOError(\\\"Only support 'enclosure' attachment\\\",\\n                                  400);\\n    }\\n\\n    return this._sub_storage.removeAttachment(ROOT, id);\\n  };\\n\\n  FileSystemBridgeStorage.prototype.repair = function () {\\n    return this._sub_storage.repair.apply(this._sub_storage, arguments);\\n  };\\n\\n  jIO.addStorage('drivetojiomapping', FileSystemBridgeStorage);\\n\\n}(jIO, RSVP, Blob));\\n;/*jslint nomen: true*/\\n/*global Blob, atob, btoa, RSVP*/\\n(function (jIO, Blob, atob, btoa, RSVP) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The jIO DocumentStorage extension\\n   *\\n   * @class DocumentStorage\\n   * @constructor\\n   */\\n  function DocumentStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n    this._document_id = spec.document_id;\\n    this._repair_attachment = spec.repair_attachment || false;\\n  }\\n\\n  var DOCUMENT_EXTENSION = \\\".json\\\",\\n    DOCUMENT_REGEXP = new RegExp(\\\"^jio_document/([\\\\\\\\w=]+)\\\" +\\n                                 DOCUMENT_EXTENSION + \\\"$\\\"),\\n    ATTACHMENT_REGEXP = new RegExp(\\\"^jio_attachment/([\\\\\\\\w=]+)/([\\\\\\\\w=]+)$\\\");\\n\\n  function getSubAttachmentIdFromParam(id, name) {\\n    if (name === undefined) {\\n      return 'jio_document/' + btoa(id) + DOCUMENT_EXTENSION;\\n    }\\n    return 'jio_attachment/' + btoa(id) + \\\"/\\\" + btoa(name);\\n  }\\n\\n  DocumentStorage.prototype.get = function (id) {\\n    return this._sub_storage.getAttachment(\\n      this._document_id,\\n      getSubAttachmentIdFromParam(id),\\n      {format: \\\"json\\\"}\\n    );\\n  };\\n\\n  DocumentStorage.prototype.allAttachments = function (id) {\\n    return this._sub_storage.allAttachments(this._document_id)\\n      .push(function (result) {\\n        var attachments = {},\\n          exec,\\n          key;\\n        for (key in result) {\\n          if (result.hasOwnProperty(key)) {\\n            if (ATTACHMENT_REGEXP.test(key)) {\\n              exec = ATTACHMENT_REGEXP.exec(key);\\n              try {\\n                if (atob(exec[1]) === id) {\\n                  attachments[atob(exec[2])] = {};\\n                }\\n              } catch (error) {\\n                // Check if unable to decode base64 data\\n                if (!error instanceof ReferenceError) {\\n                  throw error;\\n                }\\n              }\\n            }\\n          }\\n        }\\n        return attachments;\\n      });\\n  };\\n\\n  DocumentStorage.prototype.put = function (doc_id, param) {\\n    return this._sub_storage.putAttachment(\\n      this._document_id,\\n      getSubAttachmentIdFromParam(doc_id),\\n      new Blob([JSON.stringify(param)], {type: \\\"application/json\\\"})\\n    )\\n      .push(function () {\\n        return doc_id;\\n      });\\n\\n  };\\n\\n  DocumentStorage.prototype.remove = function (id) {\\n    var context = this;\\n    return this.allAttachments(id)\\n      .push(function (result) {\\n        var key,\\n          promise_list = [];\\n        for (key in result) {\\n          if (result.hasOwnProperty(key)) {\\n            promise_list.push(context.removeAttachment(id, key));\\n          }\\n        }\\n        return RSVP.all(promise_list);\\n      })\\n      .push(function () {\\n        return context._sub_storage.removeAttachment(\\n          context._document_id,\\n          getSubAttachmentIdFromParam(id)\\n        );\\n      })\\n      .push(function () {\\n        return id;\\n      });\\n  };\\n\\n  DocumentStorage.prototype.repair = function () {\\n    var context = this;\\n    return this._sub_storage.repair.apply(this._sub_storage, arguments)\\n      .push(function (result) {\\n        if (context._repair_attachment) {\\n          return context._sub_storage.allAttachments(context._document_id)\\n            .push(function (result_dict) {\\n              var promise_list = [],\\n                id_dict = {},\\n                attachment_dict = {},\\n                id,\\n                attachment,\\n                exec,\\n                key;\\n              for (key in result_dict) {\\n                if (result_dict.hasOwnProperty(key)) {\\n                  id = undefined;\\n                  attachment = undefined;\\n                  if (DOCUMENT_REGEXP.test(key)) {\\n                    try {\\n                      id = atob(DOCUMENT_REGEXP.exec(key)[1]);\\n                    } catch (error) {\\n                      // Check if unable to decode base64 data\\n                      if (!error instanceof ReferenceError) {\\n                        throw error;\\n                      }\\n                    }\\n                    if (id !== undefined) {\\n                      id_dict[id] = null;\\n                    }\\n                  } else if (ATTACHMENT_REGEXP.test(key)) {\\n                    exec = ATTACHMENT_REGEXP.exec(key);\\n                    try {\\n                      id = atob(exec[1]);\\n                      attachment = atob(exec[2]);\\n                    } catch (error) {\\n                      // Check if unable to decode base64 data\\n                      if (!error instanceof ReferenceError) {\\n                        throw error;\\n                      }\\n                    }\\n                    if (attachment !== undefined) {\\n                      if (!id_dict.hasOwnProperty(id)) {\\n                        if (!attachment_dict.hasOwnProperty(id)) {\\n                          attachment_dict[id] = {};\\n                        }\\n                        attachment_dict[id][attachment] = null;\\n                      }\\n                    }\\n                  }\\n                }\\n              }\\n              for (id in attachment_dict) {\\n                if (attachment_dict.hasOwnProperty(id)) {\\n                  if (!id_dict.hasOwnProperty(id)) {\\n                    for (attachment in attachment_dict[id]) {\\n                      if (attachment_dict[id].hasOwnProperty(attachment)) {\\n                        promise_list.push(context.removeAttachment(\\n                          id,\\n                          attachment\\n                        ));\\n                      }\\n                    }\\n                  }\\n                }\\n              }\\n              return RSVP.all(promise_list);\\n            });\\n        }\\n        return result;\\n      });\\n  };\\n\\n  DocumentStorage.prototype.hasCapacity = function (capacity) {\\n    return (capacity === \\\"list\\\");\\n  };\\n\\n  DocumentStorage.prototype.buildQuery = function () {\\n    return this._sub_storage.allAttachments(this._document_id)\\n      .push(function (attachment_dict) {\\n        var result = [],\\n          key;\\n        for (key in attachment_dict) {\\n          if (attachment_dict.hasOwnProperty(key)) {\\n            if (DOCUMENT_REGEXP.test(key)) {\\n              try {\\n                result.push({\\n                  id: atob(DOCUMENT_REGEXP.exec(key)[1]),\\n                  value: {}\\n                });\\n              } catch (error) {\\n                // Check if unable to decode base64 data\\n                if (!error instanceof ReferenceError) {\\n                  throw error;\\n                }\\n              }\\n            }\\n          }\\n        }\\n        return result;\\n      });\\n  };\\n\\n  DocumentStorage.prototype.getAttachment = function (id, name) {\\n    return this._sub_storage.getAttachment(\\n      this._document_id,\\n      getSubAttachmentIdFromParam(id, name)\\n    );\\n  };\\n\\n  DocumentStorage.prototype.putAttachment = function (id, name, blob) {\\n    return this._sub_storage.putAttachment(\\n      this._document_id,\\n      getSubAttachmentIdFromParam(id, name),\\n      blob\\n    );\\n  };\\n\\n  DocumentStorage.prototype.removeAttachment = function (id, name) {\\n    return this._sub_storage.removeAttachment(\\n      this._document_id,\\n      getSubAttachmentIdFromParam(id, name)\\n    );\\n  };\\n\\n  jIO.addStorage('document', DocumentStorage);\\n\\n}(jIO, Blob, atob, btoa, RSVP));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/*jslint nomen: true*/\\n/*global jIO, sessionStorage, localStorage, RSVP */\\n\\n/**\\n * JIO Local Storage. Type = 'local'.\\n * Local browser \\\"database\\\" storage.\\n *\\n * Storage Description:\\n *\\n *     {\\n *       \\\"type\\\": \\\"local\\\",\\n *       \\\"sessiononly\\\": false\\n *     }\\n *\\n * @class LocalStorage\\n */\\n\\n(function (jIO, sessionStorage, localStorage, RSVP) {\\n  \\\"use strict\\\";\\n\\n  function LocalStorage(spec) {\\n    if (spec.sessiononly === true) {\\n      this._storage = sessionStorage;\\n    } else {\\n      this._storage = localStorage;\\n    }\\n  }\\n\\n  function restrictDocumentId(id) {\\n    if (id !== \\\"/\\\") {\\n      throw new jIO.util.jIOError(\\\"id \\\" + id + \\\" is forbidden (!== /)\\\",\\n                                  400);\\n    }\\n  }\\n\\n  LocalStorage.prototype.get = function (id) {\\n    restrictDocumentId(id);\\n    return {};\\n  };\\n\\n  LocalStorage.prototype.allAttachments = function (id) {\\n    restrictDocumentId(id);\\n\\n    var attachments = {},\\n      key;\\n\\n    for (key in this._storage) {\\n      if (this._storage.hasOwnProperty(key)) {\\n        attachments[key] = {};\\n      }\\n    }\\n    return attachments;\\n  };\\n\\n  LocalStorage.prototype.getAttachment = function (id, name) {\\n    restrictDocumentId(id);\\n\\n    var textstring = this._storage.getItem(name);\\n\\n    if (textstring === null) {\\n      throw new jIO.util.jIOError(\\n        \\\"Cannot find attachment \\\" + name,\\n        404\\n      );\\n    }\\n    return jIO.util.dataURItoBlob(textstring);\\n  };\\n\\n  LocalStorage.prototype.putAttachment = function (id, name, blob) {\\n    var context = this;\\n    restrictDocumentId(id);\\n\\n    // the document already exists\\n    // download data\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.readBlobAsDataURL(blob);\\n      })\\n      .push(function (e) {\\n        context._storage.setItem(name, e.target.result);\\n      });\\n  };\\n\\n  LocalStorage.prototype.removeAttachment = function (id, name) {\\n    restrictDocumentId(id);\\n    return this._storage.removeItem(name);\\n  };\\n\\n\\n  LocalStorage.prototype.hasCapacity = function (name) {\\n    return (name === \\\"list\\\");\\n  };\\n\\n  LocalStorage.prototype.buildQuery = function () {\\n    return [{\\n      id: \\\"/\\\",\\n      value: {}\\n    }];\\n  };\\n\\n  jIO.addStorage('local', LocalStorage);\\n\\n}(jIO, sessionStorage, localStorage, RSVP));\\n;/*\\n * Copyright 2014, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/**\\n * JIO Indexed Database Storage.\\n *\\n * A local browser \\\"database\\\" storage greatly more powerful than localStorage.\\n *\\n * Description:\\n *\\n *    {\\n *      \\\"type\\\": \\\"indexeddb\\\",\\n *      \\\"database\\\": <string>\\n *    }\\n *\\n * The database name will be prefixed by \\\"jio:\\\", so if the database property is\\n * \\\"hello\\\", then you can manually reach this database with\\n * `indexedDB.open(\\\"jio:hello\\\");`. (Or\\n * `indexedDB.deleteDatabase(\\\"jio:hello\\\");`.)\\n *\\n * For more informations:\\n *\\n * - http://www.w3.org/TR/IndexedDB/\\n * - https://developer.mozilla.org/en-US/docs/IndexedDB/Using_IndexedDB\\n */\\n\\n/*jslint nomen: true */\\n/*global indexedDB, jIO, RSVP, Blob, Math, IDBKeyRange, IDBOpenDBRequest,\\n        DOMError, Event*/\\n\\n(function (indexedDB, jIO, RSVP, Blob, Math, IDBKeyRange, IDBOpenDBRequest,\\n           DOMError) {\\n  \\\"use strict\\\";\\n\\n  // Read only as changing it can lead to data corruption\\n  var UNITE = 2000000;\\n\\n  function IndexedDBStorage(description) {\\n    if (typeof description.database !== \\\"string\\\" ||\\n        description.database === \\\"\\\") {\\n      throw new TypeError(\\\"IndexedDBStorage 'database' description property \\\" +\\n                          \\\"must be a non-empty string\\\");\\n    }\\n    this._database_name = \\\"jio:\\\" + description.database;\\n  }\\n\\n  IndexedDBStorage.prototype.hasCapacity = function (name) {\\n    return ((name === \\\"list\\\") || (name === \\\"include\\\"));\\n  };\\n\\n  function buildKeyPath(key_list) {\\n    return key_list.join(\\\"_\\\");\\n  }\\n\\n  function handleUpgradeNeeded(evt) {\\n    var db = evt.target.result,\\n      store;\\n\\n    store = db.createObjectStore(\\\"metadata\\\", {\\n      keyPath: \\\"_id\\\",\\n      autoIncrement: false\\n    });\\n    // It is not possible to use openKeyCursor on keypath directly\\n    // https://www.w3.org/Bugs/Public/show_bug.cgi?id=19955\\n    store.createIndex(\\\"_id\\\", \\\"_id\\\", {unique: true});\\n\\n    store = db.createObjectStore(\\\"attachment\\\", {\\n      keyPath: \\\"_key_path\\\",\\n      autoIncrement: false\\n    });\\n    store.createIndex(\\\"_id\\\", \\\"_id\\\", {unique: false});\\n\\n    store = db.createObjectStore(\\\"blob\\\", {\\n      keyPath: \\\"_key_path\\\",\\n      autoIncrement: false\\n    });\\n    store.createIndex(\\\"_id_attachment\\\",\\n                      [\\\"_id\\\", \\\"_attachment\\\"], {unique: false});\\n    store.createIndex(\\\"_id\\\", \\\"_id\\\", {unique: false});\\n  }\\n\\n  function openIndexedDB(jio_storage) {\\n    var db_name = jio_storage._database_name;\\n    function resolver(resolve, reject) {\\n      // Open DB //\\n      var request = indexedDB.open(db_name);\\n      request.onerror = function (error) {\\n        if (request.result) {\\n          request.result.close();\\n        }\\n        if ((error !== undefined) &&\\n            (error.target instanceof IDBOpenDBRequest) &&\\n            (error.target.error instanceof DOMError)) {\\n          reject(\\\"Connection to: \\\" + db_name + \\\" failed: \\\" +\\n                 error.target.error.message);\\n        } else {\\n          reject(error);\\n        }\\n      };\\n\\n      request.onabort = function () {\\n        request.result.close();\\n        reject(\\\"Aborting connection to: \\\" + db_name);\\n      };\\n\\n      request.ontimeout = function () {\\n        request.result.close();\\n        reject(\\\"Connection to: \\\" + db_name + \\\" timeout\\\");\\n      };\\n\\n      request.onblocked = function () {\\n        request.result.close();\\n        reject(\\\"Connection to: \\\" + db_name + \\\" was blocked\\\");\\n      };\\n\\n      // Create DB if necessary //\\n      request.onupgradeneeded = handleUpgradeNeeded;\\n\\n      request.onversionchange = function () {\\n        request.result.close();\\n        reject(db_name + \\\" was upgraded\\\");\\n      };\\n\\n      request.onsuccess = function () {\\n        resolve(request.result);\\n      };\\n    }\\n    // XXX Canceller???\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return new RSVP.Promise(resolver);\\n      });\\n  }\\n\\n  function openTransaction(db, stores, flag, autoclosedb) {\\n    var tx = db.transaction(stores, flag);\\n    if (autoclosedb !== false) {\\n      tx.oncomplete = function () {\\n        db.close();\\n      };\\n    }\\n    tx.onabort = function () {\\n      db.close();\\n    };\\n    return tx;\\n  }\\n\\n  function handleCursor(request, callback) {\\n    function resolver(resolve, reject) {\\n      // Open DB //\\n      request.onerror = function (error) {\\n        if (request.transaction) {\\n          request.transaction.abort();\\n        }\\n        reject(error);\\n      };\\n\\n      request.onsuccess = function (evt) {\\n        var cursor = evt.target.result;\\n        if (cursor) {\\n          // XXX Wait for result\\n          try {\\n            callback(cursor);\\n          } catch (error) {\\n            reject(error);\\n          }\\n\\n          // continue to next iteration\\n          cursor[\\\"continue\\\"]();\\n        } else {\\n          resolve();\\n        }\\n      };\\n    }\\n    // XXX Canceller???\\n    return new RSVP.Promise(resolver);\\n  }\\n\\n  IndexedDBStorage.prototype.buildQuery = function (options) {\\n    var result_list = [];\\n\\n    function pushIncludedMetadata(cursor) {\\n      result_list.push({\\n        \\\"id\\\": cursor.key,\\n        \\\"value\\\": {},\\n        \\\"doc\\\": cursor.value.doc\\n      });\\n    }\\n\\n    function pushMetadata(cursor) {\\n      result_list.push({\\n        \\\"id\\\": cursor.key,\\n        \\\"value\\\": {}\\n      });\\n    }\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var tx = openTransaction(db, [\\\"metadata\\\"], \\\"readonly\\\");\\n        if (options.include_docs === true) {\\n          return handleCursor(tx.objectStore(\\\"metadata\\\").index(\\\"_id\\\")\\n                              .openCursor(), pushIncludedMetadata);\\n        }\\n        return handleCursor(tx.objectStore(\\\"metadata\\\").index(\\\"_id\\\")\\n                            .openKeyCursor(), pushMetadata);\\n      })\\n      .push(function () {\\n        return result_list;\\n      });\\n\\n  };\\n\\n  function handleGet(request) {\\n    function resolver(resolve, reject) {\\n      request.onerror = reject;\\n      request.onsuccess = function () {\\n        if (request.result) {\\n          resolve(request.result);\\n        }\\n        // XXX How to get ID\\n        reject(new jIO.util.jIOError(\\\"Cannot find document\\\", 404));\\n      };\\n    }\\n    return new RSVP.Promise(resolver);\\n  }\\n\\n  IndexedDBStorage.prototype.get = function (id) {\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var transaction = openTransaction(db, [\\\"metadata\\\"],\\n                                          \\\"readonly\\\");\\n        return handleGet(transaction.objectStore(\\\"metadata\\\").get(id));\\n      })\\n      .push(function (result) {\\n        return result.doc;\\n      });\\n  };\\n\\n  IndexedDBStorage.prototype.allAttachments = function (id) {\\n    var attachment_dict = {};\\n\\n    function addEntry(cursor) {\\n      attachment_dict[cursor.value._attachment] = {};\\n    }\\n\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var transaction = openTransaction(db, [\\\"metadata\\\", \\\"attachment\\\"],\\n                                          \\\"readonly\\\");\\n        return RSVP.all([\\n          handleGet(transaction.objectStore(\\\"metadata\\\").get(id)),\\n          handleCursor(transaction.objectStore(\\\"attachment\\\").index(\\\"_id\\\")\\n                       .openCursor(IDBKeyRange.only(id)), addEntry)\\n        ]);\\n      })\\n      .push(function () {\\n        return attachment_dict;\\n      });\\n  };\\n\\n  function handleRequest(request) {\\n    function resolver(resolve, reject) {\\n      request.onerror = reject;\\n      request.onsuccess = function () {\\n        resolve(request.result);\\n      };\\n    }\\n    return new RSVP.Promise(resolver);\\n  }\\n\\n  IndexedDBStorage.prototype.put = function (id, metadata) {\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var transaction = openTransaction(db, [\\\"metadata\\\"], \\\"readwrite\\\");\\n        return handleRequest(transaction.objectStore(\\\"metadata\\\").put({\\n          \\\"_id\\\": id,\\n          \\\"doc\\\": metadata\\n        }));\\n      });\\n  };\\n\\n  function deleteEntry(cursor) {\\n    cursor[\\\"delete\\\"]();\\n  }\\n\\n  IndexedDBStorage.prototype.remove = function (id) {\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var transaction = openTransaction(db, [\\\"metadata\\\", \\\"attachment\\\",\\n                                          \\\"blob\\\"], \\\"readwrite\\\");\\n        return RSVP.all([\\n          handleRequest(transaction\\n                        .objectStore(\\\"metadata\\\")[\\\"delete\\\"](id)),\\n          // XXX Why not possible to delete with KeyCursor?\\n          handleCursor(transaction.objectStore(\\\"attachment\\\").index(\\\"_id\\\")\\n                       .openCursor(IDBKeyRange.only(id)), deleteEntry),\\n          handleCursor(transaction.objectStore(\\\"blob\\\").index(\\\"_id\\\")\\n                       .openCursor(IDBKeyRange.only(id)), deleteEntry)\\n        ]);\\n      });\\n  };\\n\\n  IndexedDBStorage.prototype.getAttachment = function (id, name, options) {\\n    var transaction,\\n      type,\\n      start,\\n      end;\\n    if (options === undefined) {\\n      options = {};\\n    }\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        transaction = openTransaction(db, [\\\"attachment\\\", \\\"blob\\\"], \\\"readonly\\\");\\n        // XXX Should raise if key is not good\\n        return handleGet(transaction.objectStore(\\\"attachment\\\")\\n                         .get(buildKeyPath([id, name])));\\n      })\\n      .push(function (attachment) {\\n        var total_length = attachment.info.length,\\n          i,\\n          promise_list = [],\\n          store = transaction.objectStore(\\\"blob\\\"),\\n          start_index,\\n          end_index;\\n\\n        type = attachment.info.content_type;\\n        start = options.start || 0;\\n        end = options.end || total_length;\\n        if (end > total_length) {\\n          end = total_length;\\n        }\\n\\n        if (start < 0 || end < 0) {\\n          throw new jIO.util.jIOError(\\\"_start and _end must be positive\\\",\\n                                      400);\\n        }\\n        if (start > end) {\\n          throw new jIO.util.jIOError(\\\"_start is greater than _end\\\",\\n                                      400);\\n        }\\n\\n        start_index = Math.floor(start / UNITE);\\n        end_index =  Math.floor(end / UNITE);\\n        if (end % UNITE === 0) {\\n          end_index -= 1;\\n        }\\n\\n        for (i = start_index; i <= end_index; i += 1) {\\n          promise_list.push(\\n            handleGet(store.get(buildKeyPath([id,\\n                                name, i])))\\n          );\\n        }\\n        return RSVP.all(promise_list);\\n      })\\n      .push(function (result_list) {\\n        var array_buffer_list = [],\\n          blob,\\n          i,\\n          index,\\n          len = result_list.length;\\n        for (i = 0; i < len; i += 1) {\\n          array_buffer_list.push(result_list[i].blob);\\n        }\\n        if ((options.start === undefined) && (options.end === undefined)) {\\n          return new Blob(array_buffer_list, {type: type});\\n        }\\n        index = Math.floor(start / UNITE) * UNITE;\\n        blob = new Blob(array_buffer_list, {type: \\\"application/octet-stream\\\"});\\n        return blob.slice(start - index, end - index,\\n                          \\\"application/octet-stream\\\");\\n      });\\n  };\\n\\n  function removeAttachment(transaction, id, name) {\\n    return RSVP.all([\\n      // XXX How to get the right attachment\\n      handleRequest(transaction.objectStore(\\\"attachment\\\")[\\\"delete\\\"](\\n        buildKeyPath([id, name])\\n      )),\\n      handleCursor(transaction.objectStore(\\\"blob\\\").index(\\\"_id_attachment\\\")\\n                   .openCursor(IDBKeyRange.only(\\n          [id, name]\\n        )),\\n          deleteEntry\\n        )\\n    ]);\\n  }\\n\\n  IndexedDBStorage.prototype.putAttachment = function (id, name, blob) {\\n    var blob_part = [],\\n      transaction,\\n      db;\\n\\n    return openIndexedDB(this)\\n      .push(function (database) {\\n        db = database;\\n\\n        // Split the blob first\\n        return jIO.util.readBlobAsArrayBuffer(blob);\\n      })\\n      .push(function (event) {\\n        var array_buffer = event.target.result,\\n          total_size = blob.size,\\n          handled_size = 0;\\n\\n        while (handled_size < total_size) {\\n          blob_part.push(array_buffer.slice(handled_size,\\n                                            handled_size + UNITE));\\n          handled_size += UNITE;\\n        }\\n\\n        // Remove previous attachment\\n        transaction = openTransaction(db, [\\\"attachment\\\", \\\"blob\\\"], \\\"readwrite\\\");\\n        return removeAttachment(transaction, id, name);\\n      })\\n      .push(function () {\\n\\n        var promise_list = [\\n            handleRequest(transaction.objectStore(\\\"attachment\\\").put({\\n              \\\"_key_path\\\": buildKeyPath([id, name]),\\n              \\\"_id\\\": id,\\n              \\\"_attachment\\\": name,\\n              \\\"info\\\": {\\n                \\\"content_type\\\": blob.type,\\n                \\\"length\\\": blob.size\\n              }\\n            }))\\n          ],\\n          len = blob_part.length,\\n          blob_store = transaction.objectStore(\\\"blob\\\"),\\n          i;\\n        for (i = 0; i < len; i += 1) {\\n          promise_list.push(\\n            handleRequest(blob_store.put({\\n              \\\"_key_path\\\": buildKeyPath([id, name,\\n                                         i]),\\n              \\\"_id\\\" : id,\\n              \\\"_attachment\\\" : name,\\n              \\\"_part\\\" : i,\\n              \\\"blob\\\": blob_part[i]\\n            }))\\n          );\\n        }\\n        // Store all new data\\n        return RSVP.all(promise_list);\\n      });\\n  };\\n\\n  IndexedDBStorage.prototype.removeAttachment = function (id, name) {\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var transaction = openTransaction(db, [\\\"attachment\\\", \\\"blob\\\"],\\n                                          \\\"readwrite\\\");\\n        return removeAttachment(transaction, id, name);\\n      });\\n  };\\n\\n  jIO.addStorage(\\\"indexeddb\\\", IndexedDBStorage);\\n}(indexedDB, jIO, RSVP, Blob, Math, IDBKeyRange, IDBOpenDBRequest, DOMError));\\n;/*\\n * Copyright 2015, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/*jslint nomen: true*/\\n/*global jIO, RSVP, DOMException, Blob, crypto, Uint8Array, ArrayBuffer*/\\n\\n(function (jIO, RSVP, DOMException, Blob, crypto, Uint8Array, ArrayBuffer) {\\n  \\\"use strict\\\";\\n\\n\\n  // you the cryptography system used by this storage is AES-GCM.\\n  // here is an example of how to generate a key to the json format.\\n\\n  // var key,\\n  //     jsonKey;\\n  // crypto.subtle.generateKey({name: \\\"AES-GCM\\\",length: 256},\\n  //                           (true), [\\\"encrypt\\\", \\\"decrypt\\\"])\\n  // .then(function(res){key = res;});\\n  //\\n  // window.crypto.subtle.exportKey(\\\"jwk\\\", key)\\n  // .then(function(res){jsonKey = val})\\n  //\\n  //var storage = jIO.createJIO({type: \\\"crypt\\\", key: jsonKey,\\n  //                             sub_storage: {...}});\\n\\n  // find more informations about this cryptography system on\\n  // https://github.com/diafygi/webcrypto-examples#aes-gcm\\n\\n  /**\\n   * The JIO Cryptography Storage extension\\n   *\\n   * @class CryptStorage\\n   * @constructor\\n   */\\n\\n  var MIME_TYPE = \\\"application/x-jio-aes-gcm-encryption\\\";\\n\\n  function CryptStorage(spec) {\\n    this._key = spec.key;\\n    this._jsonKey = true;\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n  }\\n\\n  function convertKey(that) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return crypto.subtle.importKey(\\\"jwk\\\", that._key,\\n                                       \\\"AES-GCM\\\", false,\\n                                       [\\\"encrypt\\\", \\\"decrypt\\\"]);\\n      })\\n      .push(function (res) {\\n        that._key = res;\\n        that._jsonKey = false;\\n        return;\\n      });\\n  }\\n\\n  CryptStorage.prototype.get = function () {\\n    return this._sub_storage.get.apply(this._sub_storage,\\n                                       arguments);\\n  };\\n\\n  CryptStorage.prototype.post = function () {\\n    return this._sub_storage.post.apply(this._sub_storage,\\n                                        arguments);\\n  };\\n\\n  CryptStorage.prototype.put = function () {\\n    return this._sub_storage.put.apply(this._sub_storage,\\n                                       arguments);\\n  };\\n\\n  CryptStorage.prototype.remove = function () {\\n    return this._sub_storage.remove.apply(this._sub_storage,\\n                                          arguments);\\n  };\\n\\n  CryptStorage.prototype.hasCapacity = function () {\\n    return this._sub_storage.hasCapacity.apply(this._sub_storage,\\n                                               arguments);\\n  };\\n\\n  CryptStorage.prototype.buildQuery = function () {\\n    return this._sub_storage.buildQuery.apply(this._sub_storage,\\n                                              arguments);\\n  };\\n\\n\\n  CryptStorage.prototype.putAttachment = function (id, name, blob) {\\n    var initializaton_vector = crypto.getRandomValues(new Uint8Array(12)),\\n      that = this;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        if (that._jsonKey === true) {\\n          return convertKey(that);\\n        }\\n        return;\\n      })\\n      .push(function () {\\n        return jIO.util.readBlobAsDataURL(blob);\\n      })\\n      .push(function (dataURL) {\\n        //string->arraybuffer\\n        var strLen = dataURL.currentTarget.result.length,\\n          buf = new ArrayBuffer(strLen),\\n          bufView = new Uint8Array(buf),\\n          i;\\n\\n        dataURL = dataURL.currentTarget.result;\\n        for (i = 0; i < strLen; i += 1) {\\n          bufView[i] = dataURL.charCodeAt(i);\\n        }\\n        return crypto.subtle.encrypt({\\n          name : \\\"AES-GCM\\\",\\n          iv : initializaton_vector\\n        },\\n                                     that._key, buf);\\n      })\\n      .push(function (coded) {\\n        var blob = new Blob([initializaton_vector, coded], {type: MIME_TYPE});\\n        return that._sub_storage.putAttachment(id, name, blob);\\n      });\\n  };\\n\\n  CryptStorage.prototype.getAttachment = function (id, name) {\\n    var that = this;\\n\\n    return that._sub_storage.getAttachment(id, name)\\n      .push(function (blob) {\\n        if (blob.type !== MIME_TYPE) {\\n          return blob;\\n        }\\n        return new RSVP.Queue()\\n          .push(function () {\\n            if (that._jsonKey === true) {\\n              return convertKey(that);\\n            }\\n            return;\\n          })\\n          .push(function () {\\n            return jIO.util.readBlobAsArrayBuffer(blob);\\n          })\\n          .push(function (coded) {\\n            var initializaton_vector;\\n\\n            coded = coded.currentTarget.result;\\n            initializaton_vector = new Uint8Array(coded.slice(0, 12));\\n            return new RSVP.Queue()\\n              .push(function () {\\n                return crypto.subtle.decrypt({\\n                  name : \\\"AES-GCM\\\",\\n                  iv : initializaton_vector\\n                },\\n                                             that._key, coded.slice(12));\\n              })\\n              .push(function (arr) {\\n                //arraybuffer->string\\n                arr = String.fromCharCode.apply(null, new Uint8Array(arr));\\n                return jIO.util.dataURItoBlob(arr);\\n              })\\n              .push(undefined, function (error) {\\n                if (error instanceof DOMException) {\\n                  return blob;\\n                }\\n                throw error;\\n              });\\n          });\\n      });\\n  };\\n\\n  CryptStorage.prototype.removeAttachment = function () {\\n    return this._sub_storage.removeAttachment.apply(this._sub_storage,\\n                                                    arguments);\\n  };\\n\\n  CryptStorage.prototype.allAttachments = function () {\\n    return this._sub_storage.allAttachments.apply(this._sub_storage,\\n                                                  arguments);\\n  };\\n\\n  jIO.addStorage('crypt', CryptStorage);\\n\\n}(jIO, RSVP, DOMException, Blob, crypto, Uint8Array, ArrayBuffer));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n/**\\n * JIO Websql Storage. Type = \\\"websql\\\".\\n * websql \\\"database\\\" storage.\\n */\\n/*global Blob, jIO, RSVP, openDatabase*/\\n/*jslint nomen: true*/\\n\\n(function (jIO, RSVP, Blob, openDatabase) {\\n\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The JIO Websql Storage extension\\n   *\\n   * @class WebSQLStorage\\n   * @constructor\\n   */\\n\\n  function queueSql(db, query_list, argument_list) {\\n    return new RSVP.Promise(function (resolve, reject) {\\n      /*jslint unparam: true*/\\n      db.transaction(function (tx) {\\n        var len = query_list.length,\\n          result_list = [],\\n          i;\\n\\n        function resolveTransaction(tx, result) {\\n          result_list.push(result);\\n          if (result_list.length === len) {\\n            resolve(result_list);\\n          }\\n        }\\n        function rejectTransaction(tx, error) {\\n          reject(error);\\n          return true;\\n        }\\n        for (i = 0; i < len; i += 1) {\\n          tx.executeSql(query_list[i], argument_list[i], resolveTransaction,\\n                        rejectTransaction);\\n        }\\n      }, function (tx, error) {\\n        reject(error);\\n      });\\n      /*jslint unparam: false*/\\n    });\\n  }\\n\\n  function initDatabase(db) {\\n    var query_list = [\\n      \\\"CREATE TABLE IF NOT EXISTS document\\\" +\\n        \\\"(id VARCHAR PRIMARY KEY NOT NULL, data TEXT)\\\",\\n      \\\"CREATE TABLE IF NOT EXISTS attachment\\\" +\\n        \\\"(id VARCHAR, attachment VARCHAR, part INT, blob TEXT)\\\",\\n      \\\"CREATE TRIGGER IF NOT EXISTS removeAttachment \\\" +\\n        \\\"BEFORE DELETE ON document FOR EACH ROW \\\" +\\n        \\\"BEGIN DELETE from attachment WHERE id = OLD.id;END;\\\",\\n      \\\"CREATE INDEX IF NOT EXISTS index_document ON document (id);\\\",\\n      \\\"CREATE INDEX IF NOT EXISTS index_attachment \\\" +\\n        \\\"ON attachment (id, attachment);\\\"\\n    ];\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return queueSql(db, query_list, []);\\n      });\\n  }\\n\\n  function WebSQLStorage(spec) {\\n    if (typeof spec.database !== 'string' || !spec.database) {\\n      throw new TypeError(\\\"database must be a string \\\" +\\n                          \\\"which contains more than one character.\\\");\\n    }\\n    this._database = openDatabase(\\\"jio:\\\" + spec.database,\\n                                  '1.0', '', 2 * 1024 * 1024);\\n    if (spec.blob_length &&\\n        (typeof spec.blob_length !== \\\"number\\\" ||\\n         spec.blob_length < 20)) {\\n      throw new TypeError(\\\"blob_len parameter must be a number >= 20\\\");\\n    }\\n    this._blob_length = spec.blob_length || 2000000;\\n    this._init_db_promise = initDatabase(this._database);\\n  }\\n\\n  WebSQLStorage.prototype.put = function (id, param) {\\n    var db = this._database,\\n      that = this,\\n      data_string = JSON.stringify(param);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\\"INSERT OR REPLACE INTO \\\" +\\n                            \\\"document(id, data) VALUES(?,?)\\\"],\\n                       [[id, data_string]]);\\n      })\\n      .push(function () {\\n        return id;\\n      });\\n  };\\n\\n  WebSQLStorage.prototype.remove = function (id) {\\n    var db = this._database,\\n      that = this;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\\"DELETE FROM document WHERE id = ?\\\"], [[id]]);\\n      })\\n      .push(function (result_list) {\\n        if (result_list[0].rowsAffected === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        return id;\\n      });\\n\\n  };\\n\\n  WebSQLStorage.prototype.get = function (id) {\\n    var db = this._database,\\n      that = this;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\\"SELECT data FROM document WHERE id = ?\\\"],\\n                        [[id]]);\\n      })\\n      .push(function (result_list) {\\n        if (result_list[0].rows.length === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        return JSON.parse(result_list[0].rows[0].data);\\n      });\\n  };\\n\\n  WebSQLStorage.prototype.allAttachments = function (id) {\\n    var db = this._database,\\n      that = this;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\n          \\\"SELECT id FROM document WHERE id = ?\\\",\\n          \\\"SELECT DISTINCT attachment FROM attachment WHERE id = ?\\\"\\n        ], [[id], [id]]);\\n      })\\n      .push(function (result_list) {\\n        if (result_list[0].rows.length === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n\\n        var len = result_list[1].rows.length,\\n          obj = {},\\n          i;\\n\\n        for (i = 0; i < len; i += 1) {\\n          obj[result_list[1].rows[i].attachment] = {};\\n        }\\n        return obj;\\n      });\\n  };\\n\\n  function sendBlobPart(blob, argument_list, index, queue) {\\n    queue.push(function () {\\n      return jIO.util.readBlobAsDataURL(blob);\\n    })\\n      .push(function (strBlob) {\\n        argument_list[index + 2].push(strBlob.currentTarget.result);\\n        return;\\n      });\\n  }\\n\\n  WebSQLStorage.prototype.putAttachment = function (id, name, blob) {\\n    var db = this._database,\\n      that = this,\\n      part_size = this._blob_length;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\\"SELECT id FROM document WHERE id = ?\\\"], [[id]]);\\n      })\\n      .push(function (result) {\\n        var query_list = [],\\n          argument_list = [],\\n          blob_size = blob.size,\\n          queue = new RSVP.Queue(),\\n          i,\\n          index;\\n\\n        if (result[0].rows.length === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot access subdocument\\\", 404);\\n        }\\n        query_list.push(\\\"DELETE FROM attachment WHERE id = ? \\\" +\\n                        \\\"AND attachment = ?\\\");\\n        argument_list.push([id, name]);\\n        query_list.push(\\\"INSERT INTO attachment(id, attachment, part, blob)\\\" +\\n                     \\\"VALUES(?, ?, ?, ?)\\\");\\n        argument_list.push([id, name, -1,\\n                            blob.type || \\\"application/octet-stream\\\"]);\\n\\n        for (i = 0, index = 0; i < blob_size; i += part_size, index += 1) {\\n          query_list.push(\\\"INSERT INTO attachment(id, attachment, part, blob)\\\" +\\n                       \\\"VALUES(?, ?, ?, ?)\\\");\\n          argument_list.push([id, name, index]);\\n          sendBlobPart(blob.slice(i, i + part_size), argument_list, index,\\n                       queue);\\n        }\\n        queue.push(function () {\\n          return queueSql(db, query_list, argument_list);\\n        });\\n        return queue;\\n      });\\n  };\\n\\n  WebSQLStorage.prototype.getAttachment = function (id, name, options) {\\n    var db = this._database,\\n      that = this,\\n      part_size = this._blob_length,\\n      start,\\n      end,\\n      start_index,\\n      end_index;\\n\\n    if (options === undefined) { options = {}; }\\n    start = options.start || 0;\\n    end = options.end || -1;\\n\\n    if (start < 0 || (options.end !== undefined && options.end < 0)) {\\n      throw new jIO.util.jIOError(\\\"_start and _end must be positive\\\",\\n                                  400);\\n    }\\n    if (start > end && end !== -1) {\\n      throw new jIO.util.jIOError(\\\"_start is greater than _end\\\",\\n                                  400);\\n    }\\n\\n    start_index = Math.floor(start / part_size);\\n    if (start === 0) { start_index -= 1; }\\n    end_index =  Math.floor(end / part_size);\\n    if (end % part_size === 0) {\\n      end_index -= 1;\\n    }\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        var command = \\\"SELECT part, blob FROM attachment WHERE id = ? AND \\\" +\\n          \\\"attachment = ? AND part >= ?\\\",\\n          argument_list = [id, name, start_index];\\n\\n        if (end !== -1) {\\n          command += \\\" AND part <= ?\\\";\\n          argument_list.push(end_index);\\n        }\\n        return queueSql(db, [command], [argument_list]);\\n      })\\n      .push(function (response_list) {\\n        var i,\\n          response,\\n          blob_array = [],\\n          blob,\\n          type;\\n\\n        response = response_list[0].rows;\\n        if (response.length === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        for (i = 0; i < response.length; i += 1) {\\n          if (response[i].part === -1) {\\n            type = response[i].blob;\\n            start_index += 1;\\n          } else {\\n            blob_array.push(jIO.util.dataURItoBlob(response[i].blob));\\n          }\\n        }\\n        if ((start === 0) && (options.end === undefined)) {\\n          return new Blob(blob_array, {type: type});\\n        }\\n        blob = new Blob(blob_array, {});\\n        return blob.slice(start - (start_index * part_size),\\n                          end === -1 ? blob.size :\\n                          end - (start_index * part_size),\\n                          \\\"application/octet-stream\\\");\\n      });\\n  };\\n\\n  WebSQLStorage.prototype.removeAttachment = function (id, name) {\\n    var db = this._database,\\n      that = this;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\\"DELETE FROM attachment WHERE \\\" +\\n                            \\\"id = ? AND attachment = ?\\\"], [[id, name]]);\\n      })\\n      .push(function (result) {\\n        if (result[0].rowsAffected === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        return name;\\n      });\\n  };\\n\\n  WebSQLStorage.prototype.hasCapacity = function (name) {\\n    return (name === \\\"list\\\" || (name === \\\"include\\\"));\\n  };\\n\\n  WebSQLStorage.prototype.buildQuery = function (options) {\\n    var db = this._database,\\n      that = this,\\n      query =  \\\"SELECT id\\\";\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        if (options === undefined) { options = {}; }\\n        if (options.include_docs === true) {\\n          query += \\\", data AS doc\\\";\\n        }\\n        query += \\\" FROM document\\\";\\n        return queueSql(db, [query], [[]]);\\n      })\\n      .push(function (result) {\\n        var array = [],\\n          len = result[0].rows.length,\\n          i;\\n\\n        for (i = 0; i < len; i += 1) {\\n          array.push(result[0].rows[i]);\\n          array[i].value = {};\\n          if (array[i].doc !== undefined) {\\n            array[i].doc = JSON.parse(array[i].doc);\\n          }\\n        }\\n        return array;\\n      });\\n  };\\n\\n  jIO.addStorage('websql', WebSQLStorage);\\n\\n}(jIO, RSVP, Blob, openDatabase));\\n\"\n\n/***/ }),\n\n/***/ 724:\n/***/ (function(module, exports) {\n\nmodule.exports = \"/*! loglevel - v1.4.1 - https://github.com/pimterry/loglevel - (c) 2016 Tim Perry - licensed MIT */\\n!function(a,b){\\\"use strict\\\";\\\"function\\\"==typeof define&&define.amd?define(b):\\\"object\\\"==typeof module&&module.exports?module.exports=b():a.log=b()}(this,function(){\\\"use strict\\\";function a(a){return typeof console===h?!1:void 0!==console[a]?b(console,a):void 0!==console.log?b(console,\\\"log\\\"):g}function b(a,b){var c=a[b];if(\\\"function\\\"==typeof c.bind)return c.bind(a);try{return Function.prototype.bind.call(c,a)}catch(d){return function(){return Function.prototype.apply.apply(c,[a,arguments])}}}function c(a,b,c){return function(){typeof console!==h&&(d.call(this,b,c),this[a].apply(this,arguments))}}function d(a,b){for(var c=0;c<i.length;c++){var d=i[c];this[d]=a>c?g:this.methodFactory(d,a,b)}}function e(b,d,e){return a(b)||c.apply(this,arguments)}function f(a,b,c){function f(a){var b=(i[a]||\\\"silent\\\").toUpperCase();try{return void(window.localStorage[l]=b)}catch(c){}try{window.document.cookie=encodeURIComponent(l)+\\\"=\\\"+b+\\\";\\\"}catch(c){}}function g(){var a;try{a=window.localStorage[l]}catch(b){}if(typeof a===h)try{var c=window.document.cookie,d=c.indexOf(encodeURIComponent(l)+\\\"=\\\");d&&(a=/^([^;]+)/.exec(c.slice(d))[1])}catch(b){}return void 0===k.levels[a]&&(a=void 0),a}var j,k=this,l=\\\"loglevel\\\";a&&(l+=\\\":\\\"+a),k.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},k.methodFactory=c||e,k.getLevel=function(){return j},k.setLevel=function(b,c){if(\\\"string\\\"==typeof b&&void 0!==k.levels[b.toUpperCase()]&&(b=k.levels[b.toUpperCase()]),!(\\\"number\\\"==typeof b&&b>=0&&b<=k.levels.SILENT))throw\\\"log.setLevel() called with invalid level: \\\"+b;return j=b,c!==!1&&f(b),d.call(k,b,a),typeof console===h&&b<k.levels.SILENT?\\\"No console available for logging\\\":void 0},k.setDefaultLevel=function(a){g()||k.setLevel(a,!1)},k.enableAll=function(a){k.setLevel(k.levels.TRACE,a)},k.disableAll=function(a){k.setLevel(k.levels.SILENT,a)};var m=g();null==m&&(m=null==b?\\\"WARN\\\":b),k.setLevel(m,!1)}var g=function(){},h=\\\"undefined\\\",i=[\\\"trace\\\",\\\"debug\\\",\\\"info\\\",\\\"warn\\\",\\\"error\\\"],j=new f,k={};j.getLogger=function(a){if(\\\"string\\\"!=typeof a||\\\"\\\"===a)throw new TypeError(\\\"You must supply a name when creating a logger.\\\");var b=k[a];return b||(b=k[a]=new f(a,j.getLevel(),j.methodFactory)),b};var l=typeof window!==h?window.log:void 0;return j.noConflict=function(){return typeof window!==h&&window.log===j&&(window.log=l),j},j});\"\n\n/***/ }),\n\n/***/ 725:\n/***/ (function(module, exports) {\n\nmodule.exports = \"(function(globals) {\\nvar define, requireModule;\\n\\n(function() {\\n  var registry = {}, seen = {};\\n\\n  define = function(name, deps, callback) {\\n    registry[name] = { deps: deps, callback: callback };\\n  };\\n\\n  requireModule = function(name) {\\n    if (seen[name]) { return seen[name]; }\\n    seen[name] = {};\\n\\n    var mod = registry[name];\\n    if (!mod) {\\n      throw new Error(\\\"Module '\\\" + name + \\\"' not found.\\\");\\n    }\\n\\n    var deps = mod.deps,\\n        callback = mod.callback,\\n        reified = [],\\n        exports;\\n\\n    for (var i=0, l=deps.length; i<l; i++) {\\n      if (deps[i] === 'exports') {\\n        reified.push(exports = {});\\n      } else {\\n        reified.push(requireModule(deps[i]));\\n      }\\n    }\\n\\n    var value = callback.apply(this, reified);\\n    return seen[name] = exports || value;\\n  };\\n})();\\n\\ndefine(\\\"rsvp/all\\\",\\n  [\\\"rsvp/promise\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n    /* global toString */\\n\\n\\n    function promiseAtLeast(expected_count, promises) {\\n      if (Object.prototype.toString.call(promises) !== \\\"[object Array]\\\") {\\n        throw new TypeError('You must pass an array to all.');\\n      }\\n\\n      function canceller() {\\n        var promise;\\n        for (var i = 0; i < promises.length; i++) {\\n          promise = promises[i];\\n\\n          if (promise && typeof promise.then === 'function' &&\\n              typeof promise.cancel === 'function') {\\n            promise.cancel();\\n          }\\n        }\\n      }\\n\\n      return new Promise(function(resolve, reject, notify) {\\n        var results = [], remaining = promises.length,\\n        promise, remaining_count = promises.length - expected_count;\\n\\n        if (remaining === 0) {\\n          if (expected_count === 1) {\\n            resolve();\\n          } else {\\n            resolve([]);\\n          }\\n        }\\n\\n        function resolver(index) {\\n          return function(value) {\\n            resolveAll(index, value);\\n          };\\n        }\\n\\n        function resolveAll(index, value) {\\n          results[index] = value;\\n          if (--remaining === remaining_count) {\\n            if (remaining_count === 0) {\\n              resolve(results);\\n            } else {\\n              resolve(value);\\n              canceller();\\n            }\\n          }\\n        }\\n\\n        function notifier(index) {\\n          return function(value) {\\n            notify({\\\"index\\\": index, \\\"value\\\": value});\\n          };\\n        }\\n\\n        function cancelAll(rejectionValue) {\\n          reject(rejectionValue);\\n          canceller();\\n        }\\n\\n        for (var i = 0; i < promises.length; i++) {\\n          promise = promises[i];\\n\\n          if (promise && typeof promise.then === 'function') {\\n            promise.then(resolver(i), cancelAll, notifier(i));\\n          } else {\\n            resolveAll(i, promise);\\n          }\\n        }\\n      }, canceller\\n      );\\n    }\\n\\n    function all(promises) {\\n      return promiseAtLeast(promises.length, promises);\\n    }\\n\\n    function any(promises) {\\n      return promiseAtLeast(1, promises);\\n    }\\n\\n\\n    __exports__.all = all;\\n    __exports__.any = any;\\n  });\\ndefine(\\\"rsvp/async\\\",\\n  [\\\"exports\\\"],\\n  function(__exports__) {\\n    \\\"use strict\\\";\\n    var browserGlobal = (typeof window !== 'undefined') ? window : {};\\n    var BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;\\n    var async;\\n    var local = (typeof global !== 'undefined') ? global : this;\\n\\n    function checkNativePromise() {\\n      if (typeof Promise === \\\"function\\\" &&\\n          typeof Promise.resolve === \\\"function\\\") {\\n        try {\\n          /* global Promise */\\n          var promise = new Promise(function(){});\\n          if ({}.toString.call(promise) === \\\"[object Promise]\\\") {\\n            return true;\\n          }\\n        } catch (e) {}\\n      }\\n      return false;\\n    }\\n\\n    function useNativePromise() {\\n      var nativePromise = Promise.resolve();\\n      return function(callback, arg) {\\n        nativePromise.then(function () {\\n          callback(arg);\\n        });\\n      };\\n    }\\n\\n    // old node\\n    function useNextTick() {\\n      return function(callback, arg) {\\n        process.nextTick(function() {\\n          callback(arg);\\n        });\\n      };\\n    }\\n\\n    // node >= 0.10.x\\n    function useSetImmediate() {\\n      return function(callback, arg) {\\n        /* global  setImmediate */\\n        setImmediate(function(){\\n          callback(arg);\\n        });\\n      };\\n    }\\n\\n    function useMutationObserver() {\\n      var queue = [];\\n\\n      var observer = new BrowserMutationObserver(function() {\\n        var toProcess = queue.slice();\\n        queue = [];\\n\\n        toProcess.forEach(function(tuple) {\\n          var callback = tuple[0], arg= tuple[1];\\n          callback(arg);\\n        });\\n      });\\n\\n      var element = document.createElement('div');\\n      observer.observe(element, { attributes: true });\\n\\n      // Chrome Memory Leak: https://bugs.webkit.org/show_bug.cgi?id=93661\\n      window.addEventListener('unload', function(){\\n        observer.disconnect();\\n        observer = null;\\n      }, false);\\n\\n      return function(callback, arg) {\\n        queue.push([callback, arg]);\\n        element.setAttribute('drainQueue', 'drainQueue');\\n      };\\n    }\\n\\n    function useSetTimeout() {\\n      return function(callback, arg) {\\n        local.setTimeout(function() {\\n          callback(arg);\\n        }, 1);\\n      };\\n    }\\n\\n    if (typeof setImmediate === 'function') {\\n      async = useSetImmediate();\\n    } else if (typeof process !== 'undefined' && {}.toString.call(process) === '[object process]') {\\n      async = useNextTick();\\n    } else if (BrowserMutationObserver) {\\n      async = useMutationObserver();\\n    } else if (checkNativePromise()) {\\n      async = useNativePromise();\\n    } else {\\n      async = useSetTimeout();\\n    }\\n\\n\\n    __exports__.async = async;\\n  });\\ndefine(\\\"rsvp/cancellation_error\\\",\\n  [\\\"exports\\\"],\\n  function(__exports__) {\\n    \\\"use strict\\\";\\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error\\n    function CancellationError(message) {\\n      this.name = \\\"cancel\\\";\\n      if ((message !== undefined) && (typeof message !== \\\"string\\\")) {\\n        throw new TypeError('You must pass a string.');\\n      }\\n      this.message = message || \\\"Default Message\\\";\\n    }\\n    CancellationError.prototype = new Error();\\n    CancellationError.prototype.constructor = CancellationError;\\n\\n\\n    __exports__.CancellationError = CancellationError;\\n  });\\ndefine(\\\"rsvp/config\\\",\\n  [\\\"rsvp/async\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var async = __dependency1__.async;\\n\\n    var config = {};\\n    config.async = async;\\n\\n\\n    __exports__.config = config;\\n  });\\ndefine(\\\"rsvp/defer\\\",\\n  [\\\"rsvp/promise\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n\\n    function defer() {\\n      var deferred = {\\n        // pre-allocate shape\\n        resolve: undefined,\\n        reject:  undefined,\\n        promise: undefined\\n      };\\n\\n      deferred.promise = new Promise(function(resolve, reject) {\\n        deferred.resolve = resolve;\\n        deferred.reject = reject;\\n      });\\n\\n      return deferred;\\n    }\\n\\n\\n    __exports__.defer = defer;\\n  });\\ndefine(\\\"rsvp/events\\\",\\n  [\\\"exports\\\"],\\n  function(__exports__) {\\n    \\\"use strict\\\";\\n    var Event = function(type, options) {\\n      this.type = type;\\n\\n      for (var option in options) {\\n        if (!options.hasOwnProperty(option)) { continue; }\\n\\n        this[option] = options[option];\\n      }\\n    };\\n\\n    var indexOf = function(callbacks, callback) {\\n      for (var i=0, l=callbacks.length; i<l; i++) {\\n        if (callbacks[i][0] === callback) { return i; }\\n      }\\n\\n      return -1;\\n    };\\n\\n    var callbacksFor = function(object) {\\n      var callbacks = object._promiseCallbacks;\\n\\n      if (!callbacks) {\\n        callbacks = object._promiseCallbacks = {};\\n      }\\n\\n      return callbacks;\\n    };\\n\\n    var EventTarget = {\\n      mixin: function(object) {\\n        object.on = this.on;\\n        object.off = this.off;\\n        object.trigger = this.trigger;\\n        return object;\\n      },\\n\\n      on: function(eventNames, callback, binding) {\\n        var allCallbacks = callbacksFor(this), callbacks, eventName;\\n        eventNames = eventNames.split(/\\\\s+/);\\n        binding = binding || this;\\n\\n        while (eventName = eventNames.shift()) {\\n          callbacks = allCallbacks[eventName];\\n\\n          if (!callbacks) {\\n            callbacks = allCallbacks[eventName] = [];\\n          }\\n\\n          if (indexOf(callbacks, callback) === -1) {\\n            callbacks.push([callback, binding]);\\n          }\\n        }\\n      },\\n\\n      off: function(eventNames, callback) {\\n        var allCallbacks = callbacksFor(this), callbacks, eventName, index;\\n        eventNames = eventNames.split(/\\\\s+/);\\n\\n        while (eventName = eventNames.shift()) {\\n          if (!callback) {\\n            allCallbacks[eventName] = [];\\n            continue;\\n          }\\n\\n          callbacks = allCallbacks[eventName];\\n\\n          index = indexOf(callbacks, callback);\\n\\n          if (index !== -1) { callbacks.splice(index, 1); }\\n        }\\n      },\\n\\n      trigger: function(eventName, options) {\\n        var allCallbacks = callbacksFor(this),\\n            callbacks, callbackTuple, callback, binding, event;\\n\\n        if (callbacks = allCallbacks[eventName]) {\\n          // Don't cache the callbacks.length since it may grow\\n          for (var i=0; i<callbacks.length; i++) {\\n            callbackTuple = callbacks[i];\\n            callback = callbackTuple[0];\\n            binding = callbackTuple[1];\\n\\n            if (typeof options !== 'object') {\\n              options = { detail: options };\\n            }\\n\\n            event = new Event(eventName, options);\\n            callback.call(binding, event);\\n          }\\n        }\\n      }\\n    };\\n\\n\\n    __exports__.EventTarget = EventTarget;\\n  });\\ndefine(\\\"rsvp/hash\\\",\\n  [\\\"rsvp/defer\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var defer = __dependency1__.defer;\\n\\n    function size(object) {\\n      var s = 0;\\n\\n      for (var prop in object) {\\n        s++;\\n      }\\n\\n      return s;\\n    }\\n\\n    function hash(promises) {\\n      var results = {}, deferred = defer(), remaining = size(promises);\\n\\n      if (remaining === 0) {\\n        deferred.resolve({});\\n      }\\n\\n      var resolver = function(prop) {\\n        return function(value) {\\n          resolveAll(prop, value);\\n        };\\n      };\\n\\n      var resolveAll = function(prop, value) {\\n        results[prop] = value;\\n        if (--remaining === 0) {\\n          deferred.resolve(results);\\n        }\\n      };\\n\\n      var rejectAll = function(error) {\\n        deferred.reject(error);\\n      };\\n\\n      for (var prop in promises) {\\n        if (promises[prop] && typeof promises[prop].then === 'function') {\\n          promises[prop].then(resolver(prop), rejectAll);\\n        } else {\\n          resolveAll(prop, promises[prop]);\\n        }\\n      }\\n\\n      return deferred.promise;\\n    }\\n\\n\\n    __exports__.hash = hash;\\n  });\\ndefine(\\\"rsvp/node\\\",\\n  [\\\"rsvp/promise\\\",\\\"rsvp/all\\\",\\\"exports\\\"],\\n  function(__dependency1__, __dependency2__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n    var all = __dependency2__.all;\\n\\n    function makeNodeCallbackFor(resolve, reject) {\\n      return function (error, value) {\\n        if (error) {\\n          reject(error);\\n        } else if (arguments.length > 2) {\\n          resolve(Array.prototype.slice.call(arguments, 1));\\n        } else {\\n          resolve(value);\\n        }\\n      };\\n    }\\n\\n    function denodeify(nodeFunc) {\\n      return function()  {\\n        var nodeArgs = Array.prototype.slice.call(arguments), resolve, reject;\\n        var thisArg = this;\\n\\n        var promise = new Promise(function(nodeResolve, nodeReject) {\\n          resolve = nodeResolve;\\n          reject = nodeReject;\\n        });\\n\\n        all(nodeArgs).then(function(nodeArgs) {\\n          nodeArgs.push(makeNodeCallbackFor(resolve, reject));\\n\\n          try {\\n            nodeFunc.apply(thisArg, nodeArgs);\\n          } catch(e) {\\n            reject(e);\\n          }\\n        });\\n\\n        return promise;\\n      };\\n    }\\n\\n\\n    __exports__.denodeify = denodeify;\\n  });\\ndefine(\\\"rsvp/promise\\\",\\n  [\\\"rsvp/config\\\",\\\"rsvp/events\\\",\\\"rsvp/cancellation_error\\\",\\\"exports\\\"],\\n  function(__dependency1__, __dependency2__, __dependency3__, __exports__) {\\n    \\\"use strict\\\";\\n    var config = __dependency1__.config;\\n    var EventTarget = __dependency2__.EventTarget;\\n    var CancellationError = __dependency3__.CancellationError;\\n\\n    function objectOrFunction(x) {\\n      return isFunction(x) || (typeof x === \\\"object\\\" && x !== null);\\n    }\\n\\n    function isFunction(x){\\n      return typeof x === \\\"function\\\";\\n    }\\n\\n    var Promise = function(resolver, canceller) {\\n      var promise = this,\\n      resolved = false;\\n\\n      if (typeof resolver !== 'function') {\\n        throw new TypeError('You must pass a resolver function as the sole argument to the promise constructor');\\n      }\\n\\n      if ((canceller !== undefined) && (typeof canceller !== 'function')) {\\n        throw new TypeError('You can only pass a canceller function' +\\n          ' as the second argument to the promise constructor');\\n      }\\n\\n      if (!(promise instanceof Promise)) {\\n        return new Promise(resolver, canceller);\\n      }\\n\\n      var resolvePromise = function(value) {\\n        if (resolved) { return; }\\n        resolved = true;\\n        resolve(promise, value);\\n      };\\n\\n      var rejectPromise = function(value) {\\n        if (resolved) { return; }\\n        resolved = true;\\n        reject(promise, value);\\n      };\\n\\n      var notifyPromise = function(value) {\\n        if (resolved) { return; }\\n        notify(promise, value);\\n      };\\n\\n      this.on('promise:failed', function(event) {\\n        this.trigger('error', { detail: event.detail });\\n      }, this);\\n\\n      this.on('error', onerror);\\n\\n      this.cancel = function () {\\n        // For now, simply reject the promise and does not propagate the cancel\\n        // to parent or children\\n        if (resolved) { return; }\\n        if (canceller !== undefined) {\\n          try {\\n            canceller();\\n          } catch (e) {\\n            rejectPromise(e);\\n            return;\\n          }\\n        }\\n        // Trigger cancel?\\n        rejectPromise(new CancellationError());\\n      };\\n\\n      try {\\n        resolver(resolvePromise, rejectPromise, notifyPromise);\\n      } catch(e) {\\n        rejectPromise(e);\\n      }\\n    };\\n\\n    function onerror(event) {\\n      if (config.onerror) {\\n        config.onerror(event.detail);\\n      }\\n    }\\n\\n    var invokeCallback = function(type, promise, callback, event) {\\n      var hasCallback = isFunction(callback),\\n          value, error, succeeded, failed;\\n\\n      if (promise.isFulfilled) { return; }\\n      if (promise.isRejected) { return; }\\n\\n      if (hasCallback) {\\n        try {\\n          value = callback(event.detail);\\n          succeeded = true;\\n        } catch(e) {\\n          failed = true;\\n          error = e;\\n        }\\n      } else {\\n        value = event.detail;\\n        succeeded = true;\\n      }\\n\\n      if (handleThenable(promise, value)) {\\n        return;\\n      } else if (hasCallback && succeeded) {\\n        resolve(promise, value);\\n      } else if (failed) {\\n        reject(promise, error);\\n      } else if (type === 'resolve') {\\n        resolve(promise, value);\\n      } else if (type === 'reject') {\\n        reject(promise, value);\\n      }\\n    };\\n\\n\\n    var invokeNotifyCallback = function(promise, callback, event) {\\n      var value;\\n      if (typeof callback === 'function') {\\n        try {\\n          value = callback(event.detail);\\n        } catch (e) {\\n          // stop propagating\\n          return;\\n        }\\n        notify(promise, value);\\n      } else {\\n        notify(promise, event.detail);\\n      }\\n    };\\n\\n    Promise.prototype = {\\n      constructor: Promise,\\n\\n      isRejected: undefined,\\n      isFulfilled: undefined,\\n      rejectedReason: undefined,\\n      fulfillmentValue: undefined,\\n\\n      then: function(done, fail, progress) {\\n        this.off('error', onerror);\\n\\n        var thenPromise = new this.constructor(function() {},\\n            function () {\\n              thenPromise.trigger('promise:cancelled', {});\\n            });\\n\\n        if (this.isFulfilled) {\\n          config.async(function(promise) {\\n            invokeCallback('resolve', thenPromise, done, { detail: promise.fulfillmentValue });\\n          }, this);\\n        }\\n\\n        if (this.isRejected) {\\n          config.async(function(promise) {\\n            invokeCallback('reject', thenPromise, fail, { detail: promise.rejectedReason });\\n          }, this);\\n        }\\n\\n        this.on('promise:resolved', function(event) {\\n          invokeCallback('resolve', thenPromise, done, event);\\n        });\\n\\n        this.on('promise:failed', function(event) {\\n          invokeCallback('reject', thenPromise, fail, event);\\n        });\\n\\n        this.on('promise:notified', function (event) {\\n          invokeNotifyCallback(thenPromise, progress, event);\\n        });\\n\\n        return thenPromise;\\n      },\\n\\n      fail: function(fail) {\\n        return this.then(null, fail);\\n      },\\n\\n      always: function(fail) {\\n        return this.then(fail, fail);\\n      }\\n    };\\n\\n    EventTarget.mixin(Promise.prototype);\\n\\n    function resolve(promise, value) {\\n      if (promise === value) {\\n        fulfill(promise, value);\\n      } else if (!handleThenable(promise, value)) {\\n        fulfill(promise, value);\\n      }\\n    }\\n\\n    function handleThenable(promise, value) {\\n      var then = null,\\n      resolved;\\n\\n      try {\\n        if (promise === value) {\\n          throw new TypeError(\\\"A promises callback cannot return that same promise.\\\");\\n        }\\n\\n        if (objectOrFunction(value)) {\\n          then = value.then;\\n\\n          if (isFunction(then)) {\\n            if (isFunction(value.on)) {\\n              value.on('promise:notified', function (event) {\\n                notify(promise, event.detail);\\n              });\\n            }\\n            promise.on('promise:cancelled', function(event) {\\n              if (isFunction(value.cancel)) {\\n                value.cancel();\\n              }\\n            });\\n            then.call(value, function(val) {\\n              if (resolved) { return true; }\\n              resolved = true;\\n\\n              if (value !== val) {\\n                resolve(promise, val);\\n              } else {\\n                fulfill(promise, val);\\n              }\\n            }, function(val) {\\n              if (resolved) { return true; }\\n              resolved = true;\\n\\n              reject(promise, val);\\n            });\\n\\n            return true;\\n          }\\n        }\\n      } catch (error) {\\n        reject(promise, error);\\n        return true;\\n      }\\n\\n      return false;\\n    }\\n\\n    function fulfill(promise, value) {\\n      config.async(function() {\\n        if (promise.isFulfilled) { return; }\\n        if (promise.isRejected) { return; }\\n        promise.trigger('promise:resolved', { detail: value });\\n        promise.isFulfilled = true;\\n        promise.fulfillmentValue = value;\\n      });\\n    }\\n\\n    function reject(promise, value) {\\n      config.async(function() {\\n        if (promise.isFulfilled) { return; }\\n        if (promise.isRejected) { return; }\\n        promise.trigger('promise:failed', { detail: value });\\n        promise.isRejected = true;\\n        promise.rejectedReason = value;\\n      });\\n    }\\n\\n    function notify(promise, value) {\\n      config.async(function() {\\n        promise.trigger('promise:notified', { detail: value });\\n      });\\n    }\\n\\n\\n    __exports__.Promise = Promise;\\n  });\\ndefine(\\\"rsvp/queue\\\",\\n  [\\\"rsvp/promise\\\",\\\"rsvp/resolve\\\",\\\"exports\\\"],\\n  function(__dependency1__, __dependency2__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n    var resolve = __dependency2__.resolve;\\n\\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error\\n    function ResolvedQueueError(message) {\\n      this.name = \\\"resolved\\\";\\n      if ((message !== undefined) && (typeof message !== \\\"string\\\")) {\\n        throw new TypeError('You must pass a string.');\\n      }\\n      this.message = message || \\\"Default Message\\\";\\n    }\\n    ResolvedQueueError.prototype = new Error();\\n    ResolvedQueueError.prototype.constructor = ResolvedQueueError;\\n\\n    var Queue = function() {\\n      var queue = this,\\n        promise_list = [],\\n        promise,\\n        fulfill,\\n        reject,\\n        notify,\\n        resolved;\\n\\n      if (!(this instanceof Queue)) {\\n        return new Queue();\\n      }\\n\\n      function canceller() {\\n        for (var i = 0; i < 2; i++) {\\n          promise_list[i].cancel();\\n        }\\n      }\\n\\n      promise = new Promise(function(done, fail, progress) {\\n        fulfill = function (fulfillmentValue) {\\n          if (resolved) {return;}\\n          queue.isFulfilled = true;\\n          queue.fulfillmentValue = fulfillmentValue;\\n          resolved = true;\\n          return done(fulfillmentValue);\\n        };\\n        reject = function (rejectedReason) {\\n          if (resolved) {return;}\\n          queue.isRejected = true;\\n          queue.rejectedReason = rejectedReason ;\\n          resolved = true;\\n          return fail(rejectedReason);\\n        };\\n        notify = progress;\\n      }, canceller);\\n\\n      promise_list.push(resolve());\\n      promise_list.push(promise_list[0].then(function () {\\n        promise_list.splice(0, 2);\\n        if (promise_list.length === 0) {\\n          fulfill();\\n        }\\n      }));\\n\\n      queue.cancel = function () {\\n        if (resolved) {return;}\\n        resolved = true;\\n        promise.cancel();\\n        promise.fail(function (rejectedReason) {\\n          queue.isRejected = true;\\n          queue.rejectedReason = rejectedReason;\\n        });\\n      };\\n      queue.then = function () {\\n        return promise.then.apply(promise, arguments);\\n      };\\n\\n      queue.push = function(done, fail, progress) {\\n        var last_promise = promise_list[promise_list.length - 1],\\n          next_promise;\\n\\n        if (resolved) {\\n          throw new ResolvedQueueError();\\n        }\\n\\n        next_promise = last_promise.then(done, fail, progress);\\n        promise_list.push(next_promise);\\n\\n        // Handle pop\\n        last_promise = next_promise.then(function (fulfillmentValue) {\\n          promise_list.splice(0, 2);\\n          if (promise_list.length === 0) {\\n            fulfill(fulfillmentValue);\\n          } else {\\n            return fulfillmentValue;\\n          }\\n        }, function (rejectedReason) {\\n          promise_list.splice(0, 2);\\n          if (promise_list.length === 0) {\\n            reject(rejectedReason);\\n          } else {\\n            throw rejectedReason;\\n          }\\n        }, function (notificationValue) {\\n          if (promise_list[promise_list.length - 1] === last_promise) {\\n            notify(notificationValue);\\n          }\\n          return notificationValue;\\n        });\\n        promise_list.push(last_promise);\\n\\n        return this;\\n      };\\n    };\\n\\n    Queue.prototype = Object.create(Promise.prototype);\\n    Queue.prototype.constructor = Queue;\\n\\n\\n    __exports__.Queue = Queue;\\n    __exports__.ResolvedQueueError = ResolvedQueueError;\\n  });\\ndefine(\\\"rsvp/reject\\\",\\n  [\\\"rsvp/promise\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n\\n    function reject(reason) {\\n      return new Promise(function (resolve, reject) {\\n        reject(reason);\\n      });\\n    }\\n\\n\\n    __exports__.reject = reject;\\n  });\\ndefine(\\\"rsvp/resolve\\\",\\n  [\\\"rsvp/promise\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n\\n    function resolve(thenable) {\\n      return new Promise(function(resolve, reject) {\\n        if (typeof thenable === \\\"object\\\" && thenable !== null) {\\n          var then = thenable.then;\\n          if ((then !== undefined) && (typeof then === \\\"function\\\")) {\\n            return then.apply(thenable, [resolve, reject]);\\n          }\\n        }\\n        return resolve(thenable);\\n      }, function () {\\n        if ((thenable !== undefined) && (thenable.cancel !== undefined)) {\\n          thenable.cancel();\\n        }\\n      });\\n    }\\n\\n\\n    __exports__.resolve = resolve;\\n  });\\ndefine(\\\"rsvp/rethrow\\\",\\n  [\\\"exports\\\"],\\n  function(__exports__) {\\n    \\\"use strict\\\";\\n    var local = (typeof global === \\\"undefined\\\") ? this : global;\\n\\n    function rethrow(reason) {\\n      local.setTimeout(function() {\\n        throw reason;\\n      });\\n      throw reason;\\n    }\\n\\n\\n    __exports__.rethrow = rethrow;\\n  });\\ndefine(\\\"rsvp/timeout\\\",\\n  [\\\"rsvp/promise\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n\\n    function promiseSetTimeout(millisecond, should_reject, message) {\\n      var timeout_id;\\n\\n      function resolver(resolve, reject) {\\n        timeout_id = setTimeout(function () {\\n          if (should_reject) {\\n            reject(message);\\n          } else {\\n            resolve(message);\\n          }\\n        }, millisecond);\\n      }\\n      function canceller() {\\n        clearTimeout(timeout_id);\\n      }\\n      return new Promise(resolver, canceller);\\n    }\\n\\n    function delay(millisecond, message) {\\n      return promiseSetTimeout(millisecond, false, message);\\n    }\\n\\n    function timeout(millisecond) {\\n      return promiseSetTimeout(millisecond, true,\\n                               \\\"Timed out after \\\" + millisecond + \\\" ms\\\");\\n    }\\n\\n    Promise.prototype.delay = function(millisecond) {\\n      return this.then(function (fulfillmentValue) {\\n        return delay(millisecond, fulfillmentValue);\\n      });\\n    };\\n\\n\\n    __exports__.delay = delay;\\n    __exports__.timeout = timeout;\\n  });\\ndefine(\\\"rsvp\\\",\\n  [\\\"rsvp/events\\\",\\\"rsvp/cancellation_error\\\",\\\"rsvp/promise\\\",\\\"rsvp/node\\\",\\\"rsvp/all\\\",\\\"rsvp/queue\\\",\\\"rsvp/timeout\\\",\\\"rsvp/hash\\\",\\\"rsvp/rethrow\\\",\\\"rsvp/defer\\\",\\\"rsvp/config\\\",\\\"rsvp/resolve\\\",\\\"rsvp/reject\\\",\\\"exports\\\"],\\n  function(__dependency1__, __dependency2__, __dependency3__, __dependency4__, __dependency5__, __dependency6__, __dependency7__, __dependency8__, __dependency9__, __dependency10__, __dependency11__, __dependency12__, __dependency13__, __exports__) {\\n    \\\"use strict\\\";\\n    var EventTarget = __dependency1__.EventTarget;\\n    var CancellationError = __dependency2__.CancellationError;\\n    var Promise = __dependency3__.Promise;\\n    var denodeify = __dependency4__.denodeify;\\n    var all = __dependency5__.all;\\n    var any = __dependency5__.any;\\n    var Queue = __dependency6__.Queue;\\n    var ResolvedQueueError = __dependency6__.ResolvedQueueError;\\n    var delay = __dependency7__.delay;\\n    var timeout = __dependency7__.timeout;\\n    var hash = __dependency8__.hash;\\n    var rethrow = __dependency9__.rethrow;\\n    var defer = __dependency10__.defer;\\n    var config = __dependency11__.config;\\n    var resolve = __dependency12__.resolve;\\n    var reject = __dependency13__.reject;\\n\\n    function configure(name, value) {\\n      config[name] = value;\\n    }\\n\\n\\n    __exports__.CancellationError = CancellationError;\\n    __exports__.Promise = Promise;\\n    __exports__.EventTarget = EventTarget;\\n    __exports__.all = all;\\n    __exports__.any = any;\\n    __exports__.Queue = Queue;\\n    __exports__.ResolvedQueueError = ResolvedQueueError;\\n    __exports__.delay = delay;\\n    __exports__.timeout = timeout;\\n    __exports__.hash = hash;\\n    __exports__.rethrow = rethrow;\\n    __exports__.defer = defer;\\n    __exports__.denodeify = denodeify;\\n    __exports__.configure = configure;\\n    __exports__.resolve = resolve;\\n    __exports__.reject = reject;\\n  });\\nwindow.RSVP = requireModule(\\\"rsvp\\\");\\n})(window);\"\n\n/***/ }),\n\n/***/ 988:\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(521);\n__webpack_require__(519);\n__webpack_require__(522);\nmodule.exports = __webpack_require__(520);\n\n\n/***/ })\n\n},[988]);\n\n\n// WEBPACK FOOTER //\n// scripts.bundle.js","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nmodule.exports = function(src) {\r\n\tif (typeof execScript !== \"undefined\")\r\n\t\texecScript(src);\r\n\telse\r\n\t\teval.call(null, src);\r\n}\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/script-loader/addScript.js\n// module id = 226\n// module chunks = 2","require(\"!!/home/philippe/workspace/mute/node_modules/script-loader/addScript.js\")(require(\"!!/home/philippe/workspace/mute/node_modules/raw-loader/index.js!/home/philippe/workspace/mute/node_modules/bragi-browser/dist/bragi.min.js\"))\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/bragi-browser/dist/bragi.min.js\n// module id = 519\n// module chunks = 2","require(\"!!/home/philippe/workspace/mute/node_modules/script-loader/addScript.js\")(require(\"!!/home/philippe/workspace/mute/node_modules/raw-loader/index.js!/home/philippe/workspace/mute/node_modules/jio/dist/jio-latest.js\"))\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/jio/dist/jio-latest.js\n// module id = 520\n// module chunks = 2","require(\"!!/home/philippe/workspace/mute/node_modules/script-loader/addScript.js\")(require(\"!!/home/philippe/workspace/mute/node_modules/raw-loader/index.js!/home/philippe/workspace/mute/node_modules/loglevel/dist/loglevel.min.js\"))\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/loglevel/dist/loglevel.min.js\n// module id = 521\n// module chunks = 2","require(\"!!/home/philippe/workspace/mute/node_modules/script-loader/addScript.js\")(require(\"!!/home/philippe/workspace/mute/node_modules/raw-loader/index.js!/home/philippe/workspace/mute/node_modules/rsvp/dist/rsvp-2.0.4.js\"))\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/rsvp/dist/rsvp-2.0.4.js\n// module id = 522\n// module chunks = 2","module.exports = \"(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\\\"function\\\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\\\"Cannot find module '\\\"+o+\\\"'\\\");throw f.code=\\\"MODULE_NOT_FOUND\\\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\\\"function\\\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var util=require(\\\"util\\\");var canLog=require(\\\"./bragi/canLog\\\");var Transports=require(\\\"./bragi/transports/Transports\\\");var transports=require(\\\"./bragi/transports\\\");var STYLES=require(\\\"./bragi/styles\\\");var SYMBOLS=require(\\\"./bragi/symbols\\\");(function(root,factory){if(typeof define===\\\"function\\\"&&define.amd){define([\\\"exports\\\"],function(exports){root=factory(root,exports);return root})}else if(typeof exports!==\\\"undefined\\\"){factory(root,exports);module.exports=factory()}else{root.logger=factory(root,{})}})(this,function(root,logger){var LOGGER={util:{},canLog:canLog};LOGGER.util.__stack=function(){var stack=null;try{var orig=Error.prepareStackTrace;Error.prepareStackTrace=function(_,stack){return stack};var err=new Error;Error.captureStackTrace(err,arguments.callee);stack=err.stack;Error.prepareStackTrace=orig}catch(e){}return stack};LOGGER.util.colors=STYLES.colors;LOGGER.util.symbols=SYMBOLS;LOGGER.options={groupsEnabled:true,groupsDisabled:[],storeStackTrace:false};LOGGER.transports=new Transports;var _defaultTransports=[new transports.Console({showMeta:true,showStackTrace:false})];for(var i=0;i<_defaultTransports.length;i++){LOGGER.transports.add(_defaultTransports[i])}LOGGER.transportClasses=transports;LOGGER.addGroup=function addGroup(group){var groupsEnabled=LOGGER.options.groupsEnabled;if(groupsEnabled===true||groupsEnabled===false){LOGGER.options.groupsEnabled=groupsEnabled=[]}var i=0,len=groupsEnabled.length;for(i=0;i<len;i++){if(groupsEnabled[i].toString()===group.toString()){return LOGGER}}groupsEnabled.push(group);return LOGGER};LOGGER.removeGroup=function removeGroup(group){var groupsEnabled=LOGGER.options.groupsEnabled;if(groupsEnabled===true||groupsEnabled===false){LOGGER.options.groupsEnabled=groupsEnabled=[]}var i=0,len=groupsEnabled.length;var groupsEnabledWithoutGroup=[];for(i=0;i<len;i++){if(groupsEnabled[i].toString()!==group.toString()){groupsEnabledWithoutGroup.push(groupsEnabled[i])}}LOGGER.options.groupsEnabled=groupsEnabledWithoutGroup;return LOGGER};LOGGER.util.print=function print(message,color){color=color?color:\\\"black\\\";return LOGGER.util.colors[color]+message+LOGGER.util.colors.reset};LOGGER.log=function loggerLog(group,message){var groupsEnabled,groupsDisabled,currentTransport;var transportFuncsToCall=[];for(var transport in LOGGER.transports._transports){currentTransport=LOGGER.transports._transports[transport];groupsEnabled=LOGGER.options.groupsEnabled;groupsDisabled=LOGGER.options.groupsDisabled;if(currentTransport.groupsEnabled!==undefined){groupsEnabled=currentTransport.groupsEnabled}if(currentTransport.groupsDisabled!==undefined){groupsDisabled=currentTransport.groupsDisabled}if(canLog(group,groupsEnabled,groupsDisabled)){transportFuncsToCall.push(currentTransport)}}if(transportFuncsToCall.length<1){if(!LOGGER.options.storeAllHistory){return false}}var extraArgs=Array.prototype.slice.call(arguments,2);var loggedObject={};var caller=null;if(LOGGER.options.storeStackTrace){caller=\\\"global scope\\\";if(loggerLog.caller&&loggerLog.caller.name){caller=loggerLog.caller.name}else if((loggerLog.caller+\\\"\\\").indexOf(\\\"function ()\\\")===0){caller=\\\"anonymous function\\\"}}loggedObject.properties={};loggedObject.originalArgs=[];for(var i=0;i<extraArgs.length;i++){if(!(extraArgs[i]instanceof Array)&&typeof extraArgs[i]===\\\"object\\\"){for(var key in extraArgs[i]){loggedObject.properties[key]=extraArgs[i][key]}}else{loggedObject.properties[\\\"_argument\\\"+i]=extraArgs[i]}loggedObject.originalArgs.push(extraArgs[i])}loggedObject.meta={caller:caller,date:(new Date).toJSON()};loggedObject.unixTimestamp=(new Date).getTime()/1e3;var stack=false;if(LOGGER.options.storeStackTrace){stack=LOGGER.util.__stack();if(stack){var stackLength=stack.length;var trace=[];for(i=1;i<stack.length;i++){trace.push(stack[i]+\\\"\\\")}loggedObject.meta.file=stack[1].getFileName();loggedObject.meta.line=stack[1].getLineNumber();loggedObject.meta.column=stack[1].getColumnNumber();loggedObject.meta.trace=trace}}loggedObject.group=group;loggedObject.message=message;for(i=0,len=transportFuncsToCall.length;i<len;i++){transportFuncsToCall[i].log.call(transportFuncsToCall[i],loggedObject)}};if(!(typeof define===\\\"function\\\"&&define.amd)){window.BRAGI=LOGGER}return LOGGER})},{\\\"./bragi/canLog\\\":2,\\\"./bragi/styles\\\":3,\\\"./bragi/symbols\\\":4,\\\"./bragi/transports\\\":5,\\\"./bragi/transports/Transports\\\":8,util:13}],2:[function(require,module,exports){function canLog(group,groupsEnabled,groupsDisabled){if(groupsEnabled===undefined){groupsEnabled=true}var i,len;var canLogIt=true;if(groupsEnabled===true){canLogIt=true}else if(groupsEnabled===false||groupsEnabled===null){canLogIt=false}else if(groupsEnabled instanceof Array){canLogIt=false;for(i=0,len=groupsEnabled.length;i<len;i++){if(groupsEnabled[i]instanceof RegExp){if(groupsEnabled[i].test(group)){canLogIt=true;break}}else if(group.indexOf(groupsEnabled[i])===0){canLogIt=true;break}}}if(group.indexOf(\\\"error\\\")===0||group.indexOf(\\\"warn\\\")===0){canLogIt=true}if(groupsDisabled&&groupsDisabled instanceof Array){for(i=0,len=groupsDisabled.length;i<len;i++){if(groupsDisabled[i]instanceof RegExp){if(groupsDisabled[i].test(group)){canLogIt=false;break}}else if(group.indexOf(groupsDisabled[i])===0){canLogIt=false;break}}}return canLogIt}module.exports=canLog},{}],3:[function(require,module,exports){module.exports={colors:{white:\\\"\\u001b[37m\\\",grey:\\\"\\u001b[90m\\\",gray:\\\"\\u001b[90m\\\",black:\\\"\\u001b[30m\\\",blue:\\\"\\u001b[34m\\\",cyan:\\\"\\u001b[36m\\\",green:\\\"\\u001b[32m\\\",magenta:\\\"\\u001b[35m\\\",red:\\\"\\u001b[31m\\\",yellow:\\\"\\u001b[33m\\\",reset:\\\"\\u001b[0m\\\"},styles:{blink:\\\"\\u001b[49;5;8m\\\",underline:\\\"\\u001b[4m\\\",bold:\\\"\\u001b[1m\\\"},backgrounds:{white:\\\"\\u001b[47m\\\",black:\\\"\\u001b[40m\\\",blue:\\\"\\u001b[44m\\\",cyan:\\\"\\u001b[46m\\\",green:\\\"\\u001b[42m\\\",magenta:\\\"\\u001b[45m\\\",red:\\\"\\u001b[41m\\\",yellow:\\\"\\u001b[43m\\\"}}},{}],4:[function(require,module,exports){var STYLES=require(\\\"./styles\\\");module.exports={success:STYLES.colors.green+\\\"✔︎ \\\"+STYLES.colors.reset,error:STYLES.colors.red+\\\"✘ \\\"+STYLES.colors.reset,warn:STYLES.colors.yellow+\\\"⚑ \\\"+STYLES.colors.reset,arrow:\\\"➤ \\\",star:\\\"☆ \\\",box:STYLES.colors.yellow+\\\"☐ \\\"+STYLES.colors.reset,boxSuccess:STYLES.colors.green+\\\"☑︎ \\\"+STYLES.colors.reset,boxError:STYLES.colors.red+\\\"☒ \\\"+STYLES.colors.reset,circle:\\\"◯ \\\",circleFilled:\\\"◉ \\\",asterisk:\\\"✢\\\",floral:\\\"❧\\\",snowflake:\\\"❄︎\\\",fourDiamond:\\\"❖\\\",spade:\\\"♠︎\\\",club:\\\"♣︎\\\",heart:\\\"♥︎\\\",diamond:\\\"♦︎\\\",queen:\\\"♛\\\",rook:\\\"♜\\\",pawn:\\\"♟\\\",atom:\\\"⚛\\\"}},{\\\"./styles\\\":3}],5:[function(require,module,exports){var files=require(\\\"./transports/index\\\");var transports={};for(var file in files){transports[file]=files[file]}module.exports=transports},{\\\"./transports/index\\\":9}],6:[function(require,module,exports){var STYLES=require(\\\"../styles\\\");var SYMBOLS=require(\\\"../symbols\\\");if(window.console&&window.console.log){if(typeof window.console.log!==\\\"function\\\"){window.console.log=function(){}}}else{window.console={};window.console.log=function(){}}GROUP_COLORS=[[\\\"#3182bd\\\",\\\"#ffffff\\\",\\\"#225588\\\"],[\\\"#f38630\\\",\\\"#ffffff\\\"],[\\\"#e0e4cc\\\",\\\"#000000\\\",\\\"#c8cbb6\\\"],[\\\"#8c510a\\\",\\\"#ffffff\\\"],[\\\"#35978f\\\",\\\"#ffffff\\\",\\\"#13756d\\\"],[\\\"#c51b7d\\\",\\\"#ffffff\\\"],[\\\"#c6dbef\\\",\\\"#000000\\\"],[\\\"#af8dc3\\\",\\\"#000000\\\"],[\\\"#543005\\\",\\\"#ffffff\\\",\\\"#321002\\\"],[\\\"#7fbf7b\\\",\\\"#000000\\\"],[\\\"#dfc27d\\\",\\\"#000000\\\",\\\"#bda05b\\\"],[\\\"#f5f5f5\\\",\\\"#000000\\\"],[\\\"#e9a3c9\\\",\\\"#000000\\\"],[\\\"#59323C\\\",\\\"#ffffff\\\"],[\\\"#66c2a5\\\",\\\"#000000\\\"],[\\\"#f6e8c3\\\",\\\"#000000\\\"],[\\\"#606060\\\",\\\"#f0f0f0\\\"],[\\\"#8c510a\\\",\\\"#ffffff\\\"],[\\\"#80cdc1\\\",\\\"#000000\\\"],[\\\"#542788\\\",\\\"#ffffff\\\"],[\\\"#FB8AFE\\\",\\\"#343434\\\"],[\\\"#003c30\\\",\\\"#ffffff\\\"],[\\\"#e6f598\\\",\\\"#000000\\\"],[\\\"#c7eae5\\\",\\\"#000000\\\"],[\\\"#000000\\\",\\\"#f0f0f0\\\"],[\\\"#C3FF0E\\\",\\\"#343434\\\"]];OVERFLOW_SYMBOLS=[\\\"asterisk\\\",\\\"floral\\\",\\\"snowflake\\\",\\\"fourDiamond\\\",\\\"spade\\\",\\\"club\\\",\\\"heart\\\",\\\"diamond\\\",\\\"queen\\\",\\\"rook\\\",\\\"pawn\\\",\\\"atom\\\"];var BASE_CSS=\\\"padding: 2px; margin:2px; line-height: 1.8em;\\\";var META_STYLE=BASE_CSS+\\\"font-size:0.9em; color: #cdcdcd; padding-left:30px;\\\";function TransportConsole(options){options=options||{};this.groupsEnabled=options.groupsEnabled;this.groupsDisabled=options.groupsDisabled;this.addLineBreak=options.addLineBreak!==undefined?options.addLineBreak:false;this.showMeta=options.showMeta!==undefined?options.showMeta:false;this.showStackTrace=options.showStackTrace!==undefined?options.showStackTrace:true;this.showColors=options.showColors===undefined?true:options.showColor;this._foundColors=[];this._colorDict={error:BASE_CSS+\\\"background: #ff0000; color: #ffffff; font-style: bold; border: 4px solid #cc0000;\\\",warn:BASE_CSS+\\\"padding: 2px; background: #ffff00; color: #343434; font-style: bold; border: 4px solid #cccc00;\\\"};this.curSymbolIndex=0;return this}TransportConsole.prototype.getColor=function getColor(group){var color=\\\"\\\";var baseColor=\\\"\\\";var curSymbol;var cssString=\\\"\\\";group=group.split(\\\":\\\")[0];if(this._colorDict[group]){return this._colorDict[group]}if(this._foundColors.length>=GROUP_COLORS.length){color=GROUP_COLORS[this._foundColors.length%GROUP_COLORS.length];baseColor=color;cssString+=\\\"font-style: italic;\\\"}else{color=GROUP_COLORS[this._foundColors.length]}var borderColor=color[2];if(!color[2]){borderColor=\\\"#\\\";for(var i=1;i<color[0].length;i++){borderColor+=Math.max(0,parseInt(color[0][i],16)-2).toString(16)}}cssString+=BASE_CSS+\\\"background: \\\"+color[0]+\\\";\\\"+\\\"border: 1px solid \\\"+borderColor+\\\";\\\"+\\\"color: \\\"+color[1]+\\\";\\\";this._foundColors.push(color);this._colorDict[group]=cssString;return cssString};TransportConsole.prototype.name=\\\"Console\\\";TransportConsole.prototype.log=function transportConsoleLog(loggedObject){var consoleMessage=\\\"\\\";if(this.showColors){consoleMessage+=\\\"%c\\\"}consoleMessage+=\\\"[ \\\"+loggedObject.group+\\\" \\\"+\\\" ] \\t\\\";consoleMessage+=loggedObject.message+\\\" \\t\\\";if(this.addLineBreak){consoleMessage+=\\\"\\\\n\\\"}var toLogArray=[];toLogArray.push(consoleMessage);if(this.showColors){toLogArray.push(this.getColor(loggedObject.group))}toLogArray=toLogArray.concat(loggedObject.originalArgs);console.log.apply(console,toLogArray);var metaConsoleMessage=\\\"\\\";var metaLogArray=[];if(this.showMeta){if(this.showColors){metaConsoleMessage+=\\\"%c\\\"}metaConsoleMessage+=(new Date).toJSON()+\\\" \\t \\t \\\";if(loggedObject.meta.caller){metaConsoleMessage+=\\\"caller: \\\"+loggedObject.meta.caller+\\\" \\t \\t \\\"}if(loggedObject.meta.file&&loggedObject.meta.line){metaConsoleMessage+=loggedObject.meta.file+\\\":\\\"+loggedObject.meta.line+\\\":\\\"+loggedObject.meta.column+\\\"\\\"}}if(this.showMeta&&this.showStackTrace&&loggedObject.meta.trace){metaConsoleMessage+=\\\"\\\\n\\\"+\\\"(Stack Trace)\\\"+\\\"\\\\n\\\";for(i=0;i<loggedObject.meta.trace.length;i++){metaConsoleMessage+=\\\"\\t\\\"+loggedObject.meta.trace[i]+\\\"\\\\n\\\"}}if(this.showMeta&&this.showColors){metaLogArray.push(metaConsoleMessage);metaLogArray.push(META_STYLE)}if(metaLogArray.length>0){console.log.apply(console,metaLogArray)}return this};module.exports=TransportConsole},{\\\"../styles\\\":3,\\\"../symbols\\\":4}],7:[function(require,module,exports){function TransportHistory(options){options=options||{};this.groupsEnabled=options.groupsEnabled;this.groupsDisabled=options.groupsDisabled;this.storeEverything=false;if(options.storeEverything===true){this.storeEverything=true;this.groupsEnabled=true}this.historySize=options.historySize!==undefined?options.historySize:200;this.history={};return this}TransportHistory.prototype.name=\\\"History\\\";TransportHistory.prototype.log=function transportHistoryLog(loggedObject){var group=loggedObject.group.split(\\\":\\\")[0];if(this.history[group]===undefined){this.history[group]=[]}this.history[group].push(loggedObject);if(this.historySize>0&&this.history[group].length>this.historySize){this.history[group].shift()}return this};module.exports=TransportHistory},{}],8:[function(require,module,exports){function Transports(){this._transports={};this._transportCount={};return this}Transports.prototype.get=function get(transportName){var returnedTransportObjects=new Array;for(var key in this._transports){if(key.toLowerCase().indexOf(transportName.toLowerCase())>-1){returnedTransportObjects.push(this._transports[key])}}returnedTransportObjects.property=function transportProperty(keyOrObject,value){var i=0;var len=this.length;if(typeof keyOrObject===\\\"string\\\"&&value===undefined){var vals=[];for(i=0;i<len;i++){vals.push(this[i][keyOrObject])}return vals}else if(typeof keyOrObject===\\\"string\\\"&&value!==undefined){for(i=0;i<len;i++){this[i][keyOrObject]=value}}else if(typeof keyOrObject===\\\"object\\\"){for(i=0;i<len;i++){for(var keyName in keyOrObject){this[i][keyName]=keyOrObject[keyName]}}}return this};return returnedTransportObjects};Transports.prototype.add=function add(transport){if(this._transportCount[transport.name]===undefined){this._transportCount[transport.name]=1;this._transports[transport.name]=transport}else{this._transportCount[transport.name]+=1;this._transports[transport.name+\\\"\\\"+(this._transportCount[transport.name]-1)]=transport}return this};Transports.prototype.remove=function remove(transportName,index){transportName=transportName;if(transportName.name){transportName=transportName.name}for(var key in this._transports){if(index!==undefined){if(transportName+\\\"\\\"+index===key){delete this._transports[key]}}else{if(key.indexOf(transportName)>-1){delete this._transports[key]}}}return this};Transports.prototype.empty=function empty(){for(var key in this._transports){delete this._transports[key]}return this};module.exports=Transports},{}],9:[function(require,module,exports){module.exports.Console=require(\\\"./Console\\\");module.exports.History=require(\\\"./History\\\")},{\\\"./Console\\\":6,\\\"./History\\\":7}],10:[function(require,module,exports){if(typeof Object.create===\\\"function\\\"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],11:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!==\\\"undefined\\\"&&window.setImmediate;var canPost=typeof window!==\\\"undefined\\\"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener(\\\"message\\\",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data===\\\"process-tick\\\"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage(\\\"process-tick\\\",\\\"*\\\")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title=\\\"browser\\\";process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error(\\\"process.binding is not supported\\\")};process.cwd=function(){return\\\"/\\\"};process.chdir=function(dir){throw new Error(\\\"process.chdir is not supported\\\")}},{}],12:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg===\\\"object\\\"&&typeof arg.copy===\\\"function\\\"&&typeof arg.fill===\\\"function\\\"&&typeof arg.readUInt8===\\\"function\\\"}},{}],13:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(\\\" \\\")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x===\\\"%%\\\")return\\\"%\\\";if(i>=len)return x;switch(x){case\\\"%s\\\":return String(args[i++]);case\\\"%d\\\":return Number(args[i++]);case\\\"%j\\\":try{return JSON.stringify(args[i++])}catch(_){return\\\"[Circular]\\\"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=\\\" \\\"+x}else{str+=\\\" \\\"+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||\\\"\\\";set=set.toUpperCase();if(!debugs[set]){if(new RegExp(\\\"\\\\\\\\b\\\"+set+\\\"\\\\\\\\b\\\",\\\"i\\\").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error(\\\"%s %d: %s\\\",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:\\\"cyan\\\",number:\\\"yellow\\\",\\\"boolean\\\":\\\"yellow\\\",undefined:\\\"grey\\\",\\\"null\\\":\\\"bold\\\",string:\\\"green\\\",date:\\\"magenta\\\",regexp:\\\"red\\\"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return\\\"\\u001b[\\\"+inspect.colors[style][0]+\\\"m\\\"+str+\\\"\\u001b[\\\"+inspect.colors[style][1]+\\\"m\\\"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf(\\\"message\\\")>=0||keys.indexOf(\\\"description\\\")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?\\\": \\\"+value.name:\\\"\\\";return ctx.stylize(\\\"[Function\\\"+name+\\\"]\\\",\\\"special\\\")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),\\\"regexp\\\")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),\\\"date\\\")}if(isError(value)){return formatError(value)}}var base=\\\"\\\",array=false,braces=[\\\"{\\\",\\\"}\\\"];if(isArray(value)){array=true;braces=[\\\"[\\\",\\\"]\\\"]}if(isFunction(value)){var n=value.name?\\\": \\\"+value.name:\\\"\\\";base=\\\" [Function\\\"+n+\\\"]\\\"}if(isRegExp(value)){base=\\\" \\\"+RegExp.prototype.toString.call(value)}if(isDate(value)){base=\\\" \\\"+Date.prototype.toUTCString.call(value)}if(isError(value)){base=\\\" \\\"+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),\\\"regexp\\\")}else{return ctx.stylize(\\\"[Object]\\\",\\\"special\\\")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize(\\\"undefined\\\",\\\"undefined\\\");if(isString(value)){var simple=\\\"'\\\"+JSON.stringify(value).replace(/^\\\"|\\\"$/g,\\\"\\\").replace(/'/g,\\\"\\\\\\\\'\\\").replace(/\\\\\\\\\\\"/g,'\\\"')+\\\"'\\\";return ctx.stylize(simple,\\\"string\\\")}if(isNumber(value))return ctx.stylize(\\\"\\\"+value,\\\"number\\\");if(isBoolean(value))return ctx.stylize(\\\"\\\"+value,\\\"boolean\\\");if(isNull(value))return ctx.stylize(\\\"null\\\",\\\"null\\\")}function formatError(value){return\\\"[\\\"+Error.prototype.toString.call(value)+\\\"]\\\"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push(\\\"\\\")}}keys.forEach(function(key){if(!key.match(/^\\\\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize(\\\"[Getter/Setter]\\\",\\\"special\\\")}else{str=ctx.stylize(\\\"[Getter]\\\",\\\"special\\\")}}else{if(desc.set){str=ctx.stylize(\\\"[Setter]\\\",\\\"special\\\")}}if(!hasOwnProperty(visibleKeys,key)){name=\\\"[\\\"+key+\\\"]\\\"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf(\\\"\\\\n\\\")>-1){if(array){str=str.split(\\\"\\\\n\\\").map(function(line){return\\\"  \\\"+line}).join(\\\"\\\\n\\\").substr(2)}else{str=\\\"\\\\n\\\"+str.split(\\\"\\\\n\\\").map(function(line){return\\\"   \\\"+line}).join(\\\"\\\\n\\\")}}}else{str=ctx.stylize(\\\"[Circular]\\\",\\\"special\\\")}}if(isUndefined(name)){if(array&&key.match(/^\\\\d+$/)){return str}name=JSON.stringify(\\\"\\\"+key);if(name.match(/^\\\"([a-zA-Z_][a-zA-Z_0-9]*)\\\"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,\\\"name\\\")}else{name=name.replace(/'/g,\\\"\\\\\\\\'\\\").replace(/\\\\\\\\\\\"/g,'\\\"').replace(/(^\\\"|\\\"$)/g,\\\"'\\\");name=ctx.stylize(name,\\\"string\\\")}}return name+\\\": \\\"+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf(\\\"\\\\n\\\")>=0)numLinesEst++;return prev+cur.replace(/\\\\u001b\\\\[\\\\d\\\\d?m/g,\\\"\\\").length+1},0);if(length>60){return braces[0]+(base===\\\"\\\"?\\\"\\\":base+\\\"\\\\n \\\")+\\\" \\\"+output.join(\\\",\\\\n  \\\")+\\\" \\\"+braces[1]}return braces[0]+base+\\\" \\\"+output.join(\\\", \\\")+\\\" \\\"+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg===\\\"boolean\\\"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg===\\\"number\\\"}exports.isNumber=isNumber;function isString(arg){return typeof arg===\\\"string\\\"}exports.isString=isString;function isSymbol(arg){return typeof arg===\\\"symbol\\\"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)===\\\"[object RegExp]\\\"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg===\\\"object\\\"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)===\\\"[object Date]\\\"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)===\\\"[object Error]\\\"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg===\\\"function\\\"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg===\\\"boolean\\\"||typeof arg===\\\"number\\\"||typeof arg===\\\"string\\\"||typeof arg===\\\"symbol\\\"||typeof arg===\\\"undefined\\\"}exports.isPrimitive=isPrimitive;exports.isBuffer=require(\\\"./support/isBuffer\\\");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?\\\"0\\\"+n.toString(10):n.toString(10)}var months=[\\\"Jan\\\",\\\"Feb\\\",\\\"Mar\\\",\\\"Apr\\\",\\\"May\\\",\\\"Jun\\\",\\\"Jul\\\",\\\"Aug\\\",\\\"Sep\\\",\\\"Oct\\\",\\\"Nov\\\",\\\"Dec\\\"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(\\\":\\\");return[d.getDate(),months[d.getMonth()],time].join(\\\" \\\")}exports.log=function(){console.log(\\\"%s - %s\\\",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require(\\\"inherits\\\");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require(\\\"_process\\\"),typeof global!==\\\"undefined\\\"?global:typeof self!==\\\"undefined\\\"?self:typeof window!==\\\"undefined\\\"?window:{})},{\\\"./support/isBuffer\\\":12,_process:11,inherits:10}]},{},[1]);\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/raw-loader!./~/bragi-browser/dist/bragi.min.js\n// module id = 722\n// module chunks = 2","module.exports = \"/*! URI.js v1.12.0 http://medialize.github.com/URI.js/ */\\n/* build contains: IPv6.js, punycode.js, SecondLevelDomains.js, URI.js, URI.fragmentQuery.js */\\n(function(e,k){\\\"object\\\"===typeof exports?module.exports=k():\\\"function\\\"===typeof define&&define.amd?define(k):e.IPv6=k(e)})(this,function(e){var k=e&&e.IPv6;return{best:function(e){e=e.toLowerCase().split(\\\":\\\");var k=e.length,d=8;\\\"\\\"===e[0]&&\\\"\\\"===e[1]&&\\\"\\\"===e[2]?(e.shift(),e.shift()):\\\"\\\"===e[0]&&\\\"\\\"===e[1]?e.shift():\\\"\\\"===e[k-1]&&\\\"\\\"===e[k-2]&&e.pop();k=e.length;-1!==e[k-1].indexOf(\\\".\\\")&&(d=7);var g;for(g=0;g<k&&\\\"\\\"!==e[g];g++);if(g<d)for(e.splice(g,1,\\\"0000\\\");e.length<d;)e.splice(g,0,\\\"0000\\\");for(g=0;g<d;g++){for(var k=\\ne[g].split(\\\"\\\"),q=0;3>q;q++)if(\\\"0\\\"===k[0]&&1<k.length)k.splice(0,1);else break;e[g]=k.join(\\\"\\\")}var k=-1,l=q=0,r=-1,z=!1;for(g=0;g<d;g++)z?\\\"0\\\"===e[g]?l+=1:(z=!1,l>q&&(k=r,q=l)):\\\"0\\\"==e[g]&&(z=!0,r=g,l=1);l>q&&(k=r,q=l);1<q&&e.splice(k,q,\\\"\\\");k=e.length;d=\\\"\\\";\\\"\\\"===e[0]&&(beststr=\\\":\\\");for(g=0;g<k;g++){d+=e[g];if(g===k-1)break;d+=\\\":\\\"}\\\"\\\"===e[k-1]&&(d+=\\\":\\\");return d},noConflict:function(){e.IPv6===this&&(e.IPv6=k);return this}}});\\n(function(e){function k(a){throw RangeError(p[a]);}function u(a,b){for(var c=a.length;c--;)a[c]=b(a[c]);return a}function m(a,b){return u(a.split(h),b).join(\\\".\\\")}function d(a){for(var b=[],c=0,d=a.length,h,p;c<d;)h=a.charCodeAt(c++),55296<=h&&56319>=h&&c<d?(p=a.charCodeAt(c++),56320==(p&64512)?b.push(((h&1023)<<10)+(p&1023)+65536):(b.push(h),c--)):b.push(h);return b}function g(a){return u(a,function(a){var b=\\\"\\\";65535<a&&(a-=65536,b+=x(a>>>10&1023|55296),a=56320|a&1023);return b+=x(a)}).join(\\\"\\\")}function q(a,\\nb){return a+22+75*(26>a)-((0!=b)<<5)}function l(a,b,c){var d=0;a=c?A(a/H):a>>1;for(a+=A(a/b);a>n*y>>1;d+=s)a=A(a/n);return A(d+(n+1)*a/(a+I))}function r(b){var c=[],d=b.length,h,p=0,e=F,f=G,n,x,q,t,m;n=b.lastIndexOf(a);0>n&&(n=0);for(x=0;x<n;++x)128<=b.charCodeAt(x)&&k(\\\"not-basic\\\"),c.push(b.charCodeAt(x));for(n=0<n?n+1:0;n<d;){x=p;h=1;for(q=s;;q+=s){n>=d&&k(\\\"invalid-input\\\");t=b.charCodeAt(n++);t=10>t-48?t-22:26>t-65?t-65:26>t-97?t-97:s;(t>=s||t>A((w-p)/h))&&k(\\\"overflow\\\");p+=t*h;m=q<=f?v:q>=f+y?y:\\nq-f;if(t<m)break;t=s-m;h>A(w/t)&&k(\\\"overflow\\\");h*=t}h=c.length+1;f=l(p-x,h,0==x);A(p/h)>w-e&&k(\\\"overflow\\\");e+=A(p/h);p%=h;c.splice(p++,0,e)}return g(c)}function z(b){var c,h,p,e,f,n,g,m,r,t=[],B,u,z;b=d(b);B=b.length;c=F;h=0;f=G;for(n=0;n<B;++n)r=b[n],128>r&&t.push(x(r));for((p=e=t.length)&&t.push(a);p<B;){g=w;for(n=0;n<B;++n)r=b[n],r>=c&&r<g&&(g=r);u=p+1;g-c>A((w-h)/u)&&k(\\\"overflow\\\");h+=(g-c)*u;c=g;for(n=0;n<B;++n)if(r=b[n],r<c&&++h>w&&k(\\\"overflow\\\"),r==c){m=h;for(g=s;;g+=s){r=g<=f?v:g>=f+y?y:g-f;\\nif(m<r)break;z=m-r;m=s-r;t.push(x(q(r+z%m,0)));m=A(z/m)}t.push(x(q(m,0)));f=l(h,u,p==e);h=0;++p}++h;++c}return t.join(\\\"\\\")}var D=\\\"object\\\"==typeof exports&&exports,E=\\\"object\\\"==typeof module&&module&&module.exports==D&&module,C=\\\"object\\\"==typeof global&&global;if(C.global===C||C.window===C)e=C;var f,w=2147483647,s=36,v=1,y=26,I=38,H=700,G=72,F=128,a=\\\"-\\\",b=/^xn--/,c=/[^ -~]/,h=/\\\\x2E|\\\\u3002|\\\\uFF0E|\\\\uFF61/g,p={overflow:\\\"Overflow: input needs wider integers to process\\\",\\\"not-basic\\\":\\\"Illegal input >= 0x80 (not a basic code point)\\\",\\n\\\"invalid-input\\\":\\\"Invalid input\\\"},n=s-v,A=Math.floor,x=String.fromCharCode,B;f={version:\\\"1.2.3\\\",ucs2:{decode:d,encode:g},decode:r,encode:z,toASCII:function(a){return m(a,function(a){return c.test(a)?\\\"xn--\\\"+z(a):a})},toUnicode:function(a){return m(a,function(a){return b.test(a)?r(a.slice(4).toLowerCase()):a})}};if(\\\"function\\\"==typeof define&&\\\"object\\\"==typeof define.amd&&define.amd)define(function(){return f});else if(D&&!D.nodeType)if(E)E.exports=f;else for(B in f)f.hasOwnProperty(B)&&(D[B]=f[B]);else e.punycode=\\nf})(this);\\n(function(e,k){\\\"object\\\"===typeof exports?module.exports=k():\\\"function\\\"===typeof define&&define.amd?define(k):e.SecondLevelDomains=k(e)})(this,function(e){var k=e&&e.SecondLevelDomains,u=Object.prototype.hasOwnProperty,m={list:{ac:\\\"com|gov|mil|net|org\\\",ae:\\\"ac|co|gov|mil|name|net|org|pro|sch\\\",af:\\\"com|edu|gov|net|org\\\",al:\\\"com|edu|gov|mil|net|org\\\",ao:\\\"co|ed|gv|it|og|pb\\\",ar:\\\"com|edu|gob|gov|int|mil|net|org|tur\\\",at:\\\"ac|co|gv|or\\\",au:\\\"asn|com|csiro|edu|gov|id|net|org\\\",ba:\\\"co|com|edu|gov|mil|net|org|rs|unbi|unmo|unsa|untz|unze\\\",bb:\\\"biz|co|com|edu|gov|info|net|org|store|tv\\\",\\nbh:\\\"biz|cc|com|edu|gov|info|net|org\\\",bn:\\\"com|edu|gov|net|org\\\",bo:\\\"com|edu|gob|gov|int|mil|net|org|tv\\\",br:\\\"adm|adv|agr|am|arq|art|ato|b|bio|blog|bmd|cim|cng|cnt|com|coop|ecn|edu|eng|esp|etc|eti|far|flog|fm|fnd|fot|fst|g12|ggf|gov|imb|ind|inf|jor|jus|lel|mat|med|mil|mus|net|nom|not|ntr|odo|org|ppg|pro|psc|psi|qsl|rec|slg|srv|tmp|trd|tur|tv|vet|vlog|wiki|zlg\\\",bs:\\\"com|edu|gov|net|org\\\",bz:\\\"du|et|om|ov|rg\\\",ca:\\\"ab|bc|mb|nb|nf|nl|ns|nt|nu|on|pe|qc|sk|yk\\\",ck:\\\"biz|co|edu|gen|gov|info|net|org\\\",cn:\\\"ac|ah|bj|com|cq|edu|fj|gd|gov|gs|gx|gz|ha|hb|he|hi|hl|hn|jl|js|jx|ln|mil|net|nm|nx|org|qh|sc|sd|sh|sn|sx|tj|tw|xj|xz|yn|zj\\\",\\nco:\\\"com|edu|gov|mil|net|nom|org\\\",cr:\\\"ac|c|co|ed|fi|go|or|sa\\\",cy:\\\"ac|biz|com|ekloges|gov|ltd|name|net|org|parliament|press|pro|tm\\\",\\\"do\\\":\\\"art|com|edu|gob|gov|mil|net|org|sld|web\\\",dz:\\\"art|asso|com|edu|gov|net|org|pol\\\",ec:\\\"com|edu|fin|gov|info|med|mil|net|org|pro\\\",eg:\\\"com|edu|eun|gov|mil|name|net|org|sci\\\",er:\\\"com|edu|gov|ind|mil|net|org|rochest|w\\\",es:\\\"com|edu|gob|nom|org\\\",et:\\\"biz|com|edu|gov|info|name|net|org\\\",fj:\\\"ac|biz|com|info|mil|name|net|org|pro\\\",fk:\\\"ac|co|gov|net|nom|org\\\",fr:\\\"asso|com|f|gouv|nom|prd|presse|tm\\\",\\ngg:\\\"co|net|org\\\",gh:\\\"com|edu|gov|mil|org\\\",gn:\\\"ac|com|gov|net|org\\\",gr:\\\"com|edu|gov|mil|net|org\\\",gt:\\\"com|edu|gob|ind|mil|net|org\\\",gu:\\\"com|edu|gov|net|org\\\",hk:\\\"com|edu|gov|idv|net|org\\\",id:\\\"ac|co|go|mil|net|or|sch|web\\\",il:\\\"ac|co|gov|idf|k12|muni|net|org\\\",\\\"in\\\":\\\"ac|co|edu|ernet|firm|gen|gov|i|ind|mil|net|nic|org|res\\\",iq:\\\"com|edu|gov|i|mil|net|org\\\",ir:\\\"ac|co|dnssec|gov|i|id|net|org|sch\\\",it:\\\"edu|gov\\\",je:\\\"co|net|org\\\",jo:\\\"com|edu|gov|mil|name|net|org|sch\\\",jp:\\\"ac|ad|co|ed|go|gr|lg|ne|or\\\",ke:\\\"ac|co|go|info|me|mobi|ne|or|sc\\\",\\nkh:\\\"com|edu|gov|mil|net|org|per\\\",ki:\\\"biz|com|de|edu|gov|info|mob|net|org|tel\\\",km:\\\"asso|com|coop|edu|gouv|k|medecin|mil|nom|notaires|pharmaciens|presse|tm|veterinaire\\\",kn:\\\"edu|gov|net|org\\\",kr:\\\"ac|busan|chungbuk|chungnam|co|daegu|daejeon|es|gangwon|go|gwangju|gyeongbuk|gyeonggi|gyeongnam|hs|incheon|jeju|jeonbuk|jeonnam|k|kg|mil|ms|ne|or|pe|re|sc|seoul|ulsan\\\",kw:\\\"com|edu|gov|net|org\\\",ky:\\\"com|edu|gov|net|org\\\",kz:\\\"com|edu|gov|mil|net|org\\\",lb:\\\"com|edu|gov|net|org\\\",lk:\\\"assn|com|edu|gov|grp|hotel|int|ltd|net|ngo|org|sch|soc|web\\\",\\nlr:\\\"com|edu|gov|net|org\\\",lv:\\\"asn|com|conf|edu|gov|id|mil|net|org\\\",ly:\\\"com|edu|gov|id|med|net|org|plc|sch\\\",ma:\\\"ac|co|gov|m|net|org|press\\\",mc:\\\"asso|tm\\\",me:\\\"ac|co|edu|gov|its|net|org|priv\\\",mg:\\\"com|edu|gov|mil|nom|org|prd|tm\\\",mk:\\\"com|edu|gov|inf|name|net|org|pro\\\",ml:\\\"com|edu|gov|net|org|presse\\\",mn:\\\"edu|gov|org\\\",mo:\\\"com|edu|gov|net|org\\\",mt:\\\"com|edu|gov|net|org\\\",mv:\\\"aero|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro\\\",mw:\\\"ac|co|com|coop|edu|gov|int|museum|net|org\\\",mx:\\\"com|edu|gob|net|org\\\",my:\\\"com|edu|gov|mil|name|net|org|sch\\\",\\nnf:\\\"arts|com|firm|info|net|other|per|rec|store|web\\\",ng:\\\"biz|com|edu|gov|mil|mobi|name|net|org|sch\\\",ni:\\\"ac|co|com|edu|gob|mil|net|nom|org\\\",np:\\\"com|edu|gov|mil|net|org\\\",nr:\\\"biz|com|edu|gov|info|net|org\\\",om:\\\"ac|biz|co|com|edu|gov|med|mil|museum|net|org|pro|sch\\\",pe:\\\"com|edu|gob|mil|net|nom|org|sld\\\",ph:\\\"com|edu|gov|i|mil|net|ngo|org\\\",pk:\\\"biz|com|edu|fam|gob|gok|gon|gop|gos|gov|net|org|web\\\",pl:\\\"art|bialystok|biz|com|edu|gda|gdansk|gorzow|gov|info|katowice|krakow|lodz|lublin|mil|net|ngo|olsztyn|org|poznan|pwr|radom|slupsk|szczecin|torun|warszawa|waw|wroc|wroclaw|zgora\\\",\\npr:\\\"ac|biz|com|edu|est|gov|info|isla|name|net|org|pro|prof\\\",ps:\\\"com|edu|gov|net|org|plo|sec\\\",pw:\\\"belau|co|ed|go|ne|or\\\",ro:\\\"arts|com|firm|info|nom|nt|org|rec|store|tm|www\\\",rs:\\\"ac|co|edu|gov|in|org\\\",sb:\\\"com|edu|gov|net|org\\\",sc:\\\"com|edu|gov|net|org\\\",sh:\\\"co|com|edu|gov|net|nom|org\\\",sl:\\\"com|edu|gov|net|org\\\",st:\\\"co|com|consulado|edu|embaixada|gov|mil|net|org|principe|saotome|store\\\",sv:\\\"com|edu|gob|org|red\\\",sz:\\\"ac|co|org\\\",tr:\\\"av|bbs|bel|biz|com|dr|edu|gen|gov|info|k12|name|net|org|pol|tel|tsk|tv|web\\\",tt:\\\"aero|biz|cat|co|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel\\\",\\ntw:\\\"club|com|ebiz|edu|game|gov|idv|mil|net|org\\\",mu:\\\"ac|co|com|gov|net|or|org\\\",mz:\\\"ac|co|edu|gov|org\\\",na:\\\"co|com\\\",nz:\\\"ac|co|cri|geek|gen|govt|health|iwi|maori|mil|net|org|parliament|school\\\",pa:\\\"abo|ac|com|edu|gob|ing|med|net|nom|org|sld\\\",pt:\\\"com|edu|gov|int|net|nome|org|publ\\\",py:\\\"com|edu|gov|mil|net|org\\\",qa:\\\"com|edu|gov|mil|net|org\\\",re:\\\"asso|com|nom\\\",ru:\\\"ac|adygeya|altai|amur|arkhangelsk|astrakhan|bashkiria|belgorod|bir|bryansk|buryatia|cbg|chel|chelyabinsk|chita|chukotka|chuvashia|com|dagestan|e-burg|edu|gov|grozny|int|irkutsk|ivanovo|izhevsk|jar|joshkar-ola|kalmykia|kaluga|kamchatka|karelia|kazan|kchr|kemerovo|khabarovsk|khakassia|khv|kirov|koenig|komi|kostroma|kranoyarsk|kuban|kurgan|kursk|lipetsk|magadan|mari|mari-el|marine|mil|mordovia|mosreg|msk|murmansk|nalchik|net|nnov|nov|novosibirsk|nsk|omsk|orenburg|org|oryol|penza|perm|pp|pskov|ptz|rnd|ryazan|sakhalin|samara|saratov|simbirsk|smolensk|spb|stavropol|stv|surgut|tambov|tatarstan|tom|tomsk|tsaritsyn|tsk|tula|tuva|tver|tyumen|udm|udmurtia|ulan-ude|vladikavkaz|vladimir|vladivostok|volgograd|vologda|voronezh|vrn|vyatka|yakutia|yamal|yekaterinburg|yuzhno-sakhalinsk\\\",\\nrw:\\\"ac|co|com|edu|gouv|gov|int|mil|net\\\",sa:\\\"com|edu|gov|med|net|org|pub|sch\\\",sd:\\\"com|edu|gov|info|med|net|org|tv\\\",se:\\\"a|ac|b|bd|c|d|e|f|g|h|i|k|l|m|n|o|org|p|parti|pp|press|r|s|t|tm|u|w|x|y|z\\\",sg:\\\"com|edu|gov|idn|net|org|per\\\",sn:\\\"art|com|edu|gouv|org|perso|univ\\\",sy:\\\"com|edu|gov|mil|net|news|org\\\",th:\\\"ac|co|go|in|mi|net|or\\\",tj:\\\"ac|biz|co|com|edu|go|gov|info|int|mil|name|net|nic|org|test|web\\\",tn:\\\"agrinet|com|defense|edunet|ens|fin|gov|ind|info|intl|mincom|nat|net|org|perso|rnrt|rns|rnu|tourism\\\",tz:\\\"ac|co|go|ne|or\\\",\\nua:\\\"biz|cherkassy|chernigov|chernovtsy|ck|cn|co|com|crimea|cv|dn|dnepropetrovsk|donetsk|dp|edu|gov|if|in|ivano-frankivsk|kh|kharkov|kherson|khmelnitskiy|kiev|kirovograd|km|kr|ks|kv|lg|lugansk|lutsk|lviv|me|mk|net|nikolaev|od|odessa|org|pl|poltava|pp|rovno|rv|sebastopol|sumy|te|ternopil|uzhgorod|vinnica|vn|zaporizhzhe|zhitomir|zp|zt\\\",ug:\\\"ac|co|go|ne|or|org|sc\\\",uk:\\\"ac|bl|british-library|co|cym|gov|govt|icnet|jet|lea|ltd|me|mil|mod|national-library-scotland|nel|net|nhs|nic|nls|org|orgn|parliament|plc|police|sch|scot|soc\\\",\\nus:\\\"dni|fed|isa|kids|nsn\\\",uy:\\\"com|edu|gub|mil|net|org\\\",ve:\\\"co|com|edu|gob|info|mil|net|org|web\\\",vi:\\\"co|com|k12|net|org\\\",vn:\\\"ac|biz|com|edu|gov|health|info|int|name|net|org|pro\\\",ye:\\\"co|com|gov|ltd|me|net|org|plc\\\",yu:\\\"ac|co|edu|gov|org\\\",za:\\\"ac|agric|alt|bourse|city|co|cybernet|db|edu|gov|grondar|iaccess|imt|inca|landesign|law|mil|net|ngo|nis|nom|olivetti|org|pix|school|tm|web\\\",zm:\\\"ac|co|com|edu|gov|net|org|sch\\\"},has_expression:null,is_expression:null,has:function(d){return!!d.match(m.has_expression)},\\nis:function(d){return!!d.match(m.is_expression)},get:function(d){return(d=d.match(m.has_expression))&&d[1]||null},noConflict:function(){e.SecondLevelDomains===this&&(e.SecondLevelDomains=k);return this},init:function(){var d=\\\"\\\",e;for(e in m.list)u.call(m.list,e)&&(d+=\\\"|(\\\"+(\\\"(\\\"+m.list[e]+\\\").\\\"+e)+\\\")\\\");m.has_expression=RegExp(\\\"\\\\\\\\.(\\\"+d.substr(1)+\\\")$\\\",\\\"i\\\");m.is_expression=RegExp(\\\"^(\\\"+d.substr(1)+\\\")$\\\",\\\"i\\\")}};m.init();return m});\\n(function(e,k){\\\"object\\\"===typeof exports?module.exports=k(require(\\\"./punycode\\\"),require(\\\"./IPv6\\\"),require(\\\"./SecondLevelDomains\\\")):\\\"function\\\"===typeof define&&define.amd?define([\\\"./punycode\\\",\\\"./IPv6\\\",\\\"./SecondLevelDomains\\\"],k):e.URI=k(e.punycode,e.IPv6,e.SecondLevelDomains,e)})(this,function(e,k,u,m){function d(a,b){if(!(this instanceof d))return new d(a,b);void 0===a&&(a=\\\"undefined\\\"!==typeof location?location.href+\\\"\\\":\\\"\\\");this.href(a);return void 0!==b?this.absoluteTo(b):this}function g(a){return a.replace(/([.*+?^=!:${}()|[\\\\]\\\\/\\\\\\\\])/g,\\n\\\"\\\\\\\\$1\\\")}function q(a){return void 0===a?\\\"Undefined\\\":String(Object.prototype.toString.call(a)).slice(8,-1)}function l(a){return\\\"Array\\\"===q(a)}function r(a,b){var c,d;if(l(b)){c=0;for(d=b.length;c<d;c++)if(!r(a,b[c]))return!1;return!0}var p=q(b);c=0;for(d=a.length;c<d;c++)if(\\\"RegExp\\\"===p){if(\\\"string\\\"===typeof a[c]&&a[c].match(b))return!0}else if(a[c]===b)return!0;return!1}function z(a,b){if(!l(a)||!l(b)||a.length!==b.length)return!1;a.sort();b.sort();for(var c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;\\nreturn!0}function D(a){return escape(a)}function E(a){return encodeURIComponent(a).replace(/[!'()*]/g,D).replace(/\\\\*/g,\\\"%2A\\\")}var C=m&&m.URI;d.version=\\\"1.12.0\\\";var f=d.prototype,w=Object.prototype.hasOwnProperty;d._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:d.duplicateQueryParameters,escapeQuerySpace:d.escapeQuerySpace}};d.duplicateQueryParameters=!1;d.escapeQuerySpace=!0;d.protocol_expression=\\n/^[a-z][a-z0-9.+-]*$/i;d.idn_expression=/[^a-z0-9\\\\.-]/i;d.punycode_expression=/(xn--)/i;d.ip4_expression=/^\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}$/;d.ip6_expression=/^\\\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)(\\\\.(25[0-5]|2[0-4]\\\\d|1\\\\d\\\\d|[1-9]?\\\\d)){3}))|:)))(%.+)?\\\\s*$/;\\nd.find_uri_expression=/\\\\b((?:[a-z][\\\\w-]+:(?:\\\\/{1,3}|[a-z0-9%])|www\\\\d{0,3}[.]|[a-z0-9.\\\\-]+[.][a-z]{2,4}\\\\/)(?:[^\\\\s()<>]+|\\\\(([^\\\\s()<>]+|(\\\\([^\\\\s()<>]+\\\\)))*\\\\))+(?:\\\\(([^\\\\s()<>]+|(\\\\([^\\\\s()<>]+\\\\)))*\\\\)|[^\\\\s`!()\\\\[\\\\]{};:'\\\".,<>?\\\\u00ab\\\\u00bb\\\\u201c\\\\u201d\\\\u2018\\\\u2019]))/ig;d.findUri={start:/\\\\b(?:([a-z][a-z0-9.+-]*:\\\\/\\\\/)|www\\\\.)/gi,end:/[\\\\s\\\\r\\\\n]|$/,trim:/[`!()\\\\[\\\\]{};:'\\\".,<>?\\\\u00ab\\\\u00bb\\\\u201c\\\\u201d\\\\u201e\\\\u2018\\\\u2019]+$/};d.defaultPorts={http:\\\"80\\\",https:\\\"443\\\",ftp:\\\"21\\\",gopher:\\\"70\\\",ws:\\\"80\\\",wss:\\\"443\\\"};d.invalid_hostname_characters=\\n/[^a-zA-Z0-9\\\\.-]/;d.domAttributes={a:\\\"href\\\",blockquote:\\\"cite\\\",link:\\\"href\\\",base:\\\"href\\\",script:\\\"src\\\",form:\\\"action\\\",img:\\\"src\\\",area:\\\"href\\\",iframe:\\\"src\\\",embed:\\\"src\\\",source:\\\"src\\\",track:\\\"src\\\",input:\\\"src\\\"};d.getDomAttribute=function(a){if(a&&a.nodeName){var b=a.nodeName.toLowerCase();return\\\"input\\\"===b&&\\\"image\\\"!==a.type?void 0:d.domAttributes[b]}};d.encode=E;d.decode=decodeURIComponent;d.iso8859=function(){d.encode=escape;d.decode=unescape};d.unicode=function(){d.encode=E;d.decode=decodeURIComponent};d.characters=\\n{pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{\\\"%24\\\":\\\"$\\\",\\\"%26\\\":\\\"&\\\",\\\"%2B\\\":\\\"+\\\",\\\"%2C\\\":\\\",\\\",\\\"%3B\\\":\\\";\\\",\\\"%3D\\\":\\\"=\\\",\\\"%3A\\\":\\\":\\\",\\\"%40\\\":\\\"@\\\"}},decode:{expression:/[\\\\/\\\\?#]/g,map:{\\\"/\\\":\\\"%2F\\\",\\\"?\\\":\\\"%3F\\\",\\\"#\\\":\\\"%23\\\"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{\\\"%3A\\\":\\\":\\\",\\\"%2F\\\":\\\"/\\\",\\\"%3F\\\":\\\"?\\\",\\\"%23\\\":\\\"#\\\",\\\"%5B\\\":\\\"[\\\",\\\"%5D\\\":\\\"]\\\",\\\"%40\\\":\\\"@\\\",\\\"%21\\\":\\\"!\\\",\\\"%24\\\":\\\"$\\\",\\\"%26\\\":\\\"&\\\",\\\"%27\\\":\\\"'\\\",\\\"%28\\\":\\\"(\\\",\\\"%29\\\":\\\")\\\",\\\"%2A\\\":\\\"*\\\",\\\"%2B\\\":\\\"+\\\",\\\"%2C\\\":\\\",\\\",\\\"%3B\\\":\\\";\\\",\\\"%3D\\\":\\\"=\\\"}}}};d.encodeQuery=\\nfunction(a,b){var c=d.encode(a+\\\"\\\");return b?c.replace(/%20/g,\\\"+\\\"):c};d.decodeQuery=function(a,b){a+=\\\"\\\";try{return d.decode(b?a.replace(/\\\\+/g,\\\"%20\\\"):a)}catch(c){return a}};d.recodePath=function(a){a=(a+\\\"\\\").split(\\\"/\\\");for(var b=0,c=a.length;b<c;b++)a[b]=d.encodePathSegment(d.decode(a[b]));return a.join(\\\"/\\\")};d.decodePath=function(a){a=(a+\\\"\\\").split(\\\"/\\\");for(var b=0,c=a.length;b<c;b++)a[b]=d.decodePathSegment(a[b]);return a.join(\\\"/\\\")};var s={encode:\\\"encode\\\",decode:\\\"decode\\\"},v,y=function(a,b){return function(c){return d[b](c+\\n\\\"\\\").replace(d.characters[a][b].expression,function(c){return d.characters[a][b].map[c]})}};for(v in s)d[v+\\\"PathSegment\\\"]=y(\\\"pathname\\\",s[v]);d.encodeReserved=y(\\\"reserved\\\",\\\"encode\\\");d.parse=function(a,b){var c;b||(b={});c=a.indexOf(\\\"#\\\");-1<c&&(b.fragment=a.substring(c+1)||null,a=a.substring(0,c));c=a.indexOf(\\\"?\\\");-1<c&&(b.query=a.substring(c+1)||null,a=a.substring(0,c));\\\"//\\\"===a.substring(0,2)?(b.protocol=null,a=a.substring(2),a=d.parseAuthority(a,b)):(c=a.indexOf(\\\":\\\"),-1<c&&(b.protocol=a.substring(0,\\nc)||null,b.protocol&&!b.protocol.match(d.protocol_expression)?b.protocol=void 0:\\\"file\\\"===b.protocol?a=a.substring(c+3):\\\"//\\\"===a.substring(c+1,c+3)?(a=a.substring(c+3),a=d.parseAuthority(a,b)):(a=a.substring(c+1),b.urn=!0)));b.path=a;return b};d.parseHost=function(a,b){var c=a.indexOf(\\\"/\\\"),d;-1===c&&(c=a.length);\\\"[\\\"===a.charAt(0)?(d=a.indexOf(\\\"]\\\"),b.hostname=a.substring(1,d)||null,b.port=a.substring(d+2,c)||null):a.indexOf(\\\":\\\")!==a.lastIndexOf(\\\":\\\")?(b.hostname=a.substring(0,c)||null,b.port=null):(d=\\na.substring(0,c).split(\\\":\\\"),b.hostname=d[0]||null,b.port=d[1]||null);b.hostname&&\\\"/\\\"!==a.substring(c).charAt(0)&&(c++,a=\\\"/\\\"+a);return a.substring(c)||\\\"/\\\"};d.parseAuthority=function(a,b){a=d.parseUserinfo(a,b);return d.parseHost(a,b)};d.parseUserinfo=function(a,b){var c=a.indexOf(\\\"/\\\"),h=-1<c?a.lastIndexOf(\\\"@\\\",c):a.indexOf(\\\"@\\\");-1<h&&(-1===c||h<c)?(c=a.substring(0,h).split(\\\":\\\"),b.username=c[0]?d.decode(c[0]):null,c.shift(),b.password=c[0]?d.decode(c.join(\\\":\\\")):null,a=a.substring(h+1)):(b.username=null,\\nb.password=null);return a};d.parseQuery=function(a,b){if(!a)return{};a=a.replace(/&+/g,\\\"&\\\").replace(/^\\\\?*&*|&+$/g,\\\"\\\");if(!a)return{};for(var c={},h=a.split(\\\"&\\\"),p=h.length,n,e,f=0;f<p;f++)n=h[f].split(\\\"=\\\"),e=d.decodeQuery(n.shift(),b),n=n.length?d.decodeQuery(n.join(\\\"=\\\"),b):null,c[e]?(\\\"string\\\"===typeof c[e]&&(c[e]=[c[e]]),c[e].push(n)):c[e]=n;return c};d.build=function(a){var b=\\\"\\\";a.protocol&&(b+=a.protocol+\\\":\\\");a.urn||!b&&!a.hostname||(b+=\\\"//\\\");b+=d.buildAuthority(a)||\\\"\\\";\\\"string\\\"===typeof a.path&&\\n(\\\"/\\\"!==a.path.charAt(0)&&\\\"string\\\"===typeof a.hostname&&(b+=\\\"/\\\"),b+=a.path);\\\"string\\\"===typeof a.query&&a.query&&(b+=\\\"?\\\"+a.query);\\\"string\\\"===typeof a.fragment&&a.fragment&&(b+=\\\"#\\\"+a.fragment);return b};d.buildHost=function(a){var b=\\\"\\\";if(a.hostname)d.ip6_expression.test(a.hostname)?b=a.port?b+(\\\"[\\\"+a.hostname+\\\"]:\\\"+a.port):b+a.hostname:(b+=a.hostname,a.port&&(b+=\\\":\\\"+a.port));else return\\\"\\\";return b};d.buildAuthority=function(a){return d.buildUserinfo(a)+d.buildHost(a)};d.buildUserinfo=function(a){var b=\\n\\\"\\\";a.username&&(b+=d.encode(a.username),a.password&&(b+=\\\":\\\"+d.encode(a.password)),b+=\\\"@\\\");return b};d.buildQuery=function(a,b,c){var h=\\\"\\\",p,e,f,k;for(e in a)if(w.call(a,e)&&e)if(l(a[e]))for(p={},f=0,k=a[e].length;f<k;f++)void 0!==a[e][f]&&void 0===p[a[e][f]+\\\"\\\"]&&(h+=\\\"&\\\"+d.buildQueryParameter(e,a[e][f],c),!0!==b&&(p[a[e][f]+\\\"\\\"]=!0));else void 0!==a[e]&&(h+=\\\"&\\\"+d.buildQueryParameter(e,a[e],c));return h.substring(1)};d.buildQueryParameter=function(a,b,c){return d.encodeQuery(a,c)+(null!==b?\\\"=\\\"+d.encodeQuery(b,\\nc):\\\"\\\")};d.addQuery=function(a,b,c){if(\\\"object\\\"===typeof b)for(var h in b)w.call(b,h)&&d.addQuery(a,h,b[h]);else if(\\\"string\\\"===typeof b)void 0===a[b]?a[b]=c:(\\\"string\\\"===typeof a[b]&&(a[b]=[a[b]]),l(c)||(c=[c]),a[b]=a[b].concat(c));else throw new TypeError(\\\"URI.addQuery() accepts an object, string as the name parameter\\\");};d.removeQuery=function(a,b,c){var h;if(l(b))for(c=0,h=b.length;c<h;c++)a[b[c]]=void 0;else if(\\\"object\\\"===typeof b)for(h in b)w.call(b,h)&&d.removeQuery(a,h,b[h]);else if(\\\"string\\\"===\\ntypeof b)if(void 0!==c)if(a[b]===c)a[b]=void 0;else{if(l(a[b])){h=a[b];var p={},e,f;if(l(c))for(e=0,f=c.length;e<f;e++)p[c[e]]=!0;else p[c]=!0;e=0;for(f=h.length;e<f;e++)void 0!==p[h[e]]&&(h.splice(e,1),f--,e--);a[b]=h}}else a[b]=void 0;else throw new TypeError(\\\"URI.addQuery() accepts an object, string as the first parameter\\\");};d.hasQuery=function(a,b,c,h){if(\\\"object\\\"===typeof b){for(var e in b)if(w.call(b,e)&&!d.hasQuery(a,e,b[e]))return!1;return!0}if(\\\"string\\\"!==typeof b)throw new TypeError(\\\"URI.hasQuery() accepts an object, string as the name parameter\\\");\\nswitch(q(c)){case \\\"Undefined\\\":return b in a;case \\\"Boolean\\\":return a=Boolean(l(a[b])?a[b].length:a[b]),c===a;case \\\"Function\\\":return!!c(a[b],b,a);case \\\"Array\\\":return l(a[b])?(h?r:z)(a[b],c):!1;case \\\"RegExp\\\":return l(a[b])?h?r(a[b],c):!1:Boolean(a[b]&&a[b].match(c));case \\\"Number\\\":c=String(c);case \\\"String\\\":return l(a[b])?h?r(a[b],c):!1:a[b]===c;default:throw new TypeError(\\\"URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter\\\");}};d.commonPath=function(a,b){var c=\\nMath.min(a.length,b.length),d;for(d=0;d<c;d++)if(a.charAt(d)!==b.charAt(d)){d--;break}if(1>d)return a.charAt(0)===b.charAt(0)&&\\\"/\\\"===a.charAt(0)?\\\"/\\\":\\\"\\\";if(\\\"/\\\"!==a.charAt(d)||\\\"/\\\"!==b.charAt(d))d=a.substring(0,d).lastIndexOf(\\\"/\\\");return a.substring(0,d+1)};d.withinString=function(a,b,c){c||(c={});var h=c.start||d.findUri.start,e=c.end||d.findUri.end,f=c.trim||d.findUri.trim,k=/[a-z0-9-]=[\\\"']?$/i;for(h.lastIndex=0;;){var g=h.exec(a);if(!g)break;g=g.index;if(c.ignoreHtml){var l=a.slice(Math.max(g-3,0),\\ng);if(l&&k.test(l))continue}var l=g+a.slice(g).search(e),q=a.slice(g,l).replace(f,\\\"\\\");c.ignore&&c.ignore.test(q)||(l=g+q.length,q=b(q,g,l,a),a=a.slice(0,g)+q+a.slice(l),h.lastIndex=g+q.length)}h.lastIndex=0;return a};d.ensureValidHostname=function(a){if(a.match(d.invalid_hostname_characters)){if(!e)throw new TypeError(\\\"Hostname '\\\"+a+\\\"' contains characters other than [A-Z0-9.-] and Punycode.js is not available\\\");if(e.toASCII(a).match(d.invalid_hostname_characters))throw new TypeError(\\\"Hostname '\\\"+\\na+\\\"' contains characters other than [A-Z0-9.-]\\\");}};d.noConflict=function(a){if(a)return a={URI:this.noConflict()},URITemplate&&\\\"function\\\"==typeof URITemplate.noConflict&&(a.URITemplate=URITemplate.noConflict()),k&&\\\"function\\\"==typeof k.noConflict&&(a.IPv6=k.noConflict()),SecondLevelDomains&&\\\"function\\\"==typeof SecondLevelDomains.noConflict&&(a.SecondLevelDomains=SecondLevelDomains.noConflict()),a;m.URI===this&&(m.URI=C);return this};f.build=function(a){if(!0===a)this._deferred_build=!0;else if(void 0===\\na||this._deferred_build)this._string=d.build(this._parts),this._deferred_build=!1;return this};f.clone=function(){return new d(this)};f.valueOf=f.toString=function(){return this.build(!1)._string};s={protocol:\\\"protocol\\\",username:\\\"username\\\",password:\\\"password\\\",hostname:\\\"hostname\\\",port:\\\"port\\\"};y=function(a){return function(b,c){if(void 0===b)return this._parts[a]||\\\"\\\";this._parts[a]=b||null;this.build(!c);return this}};for(v in s)f[v]=y(s[v]);s={query:\\\"?\\\",fragment:\\\"#\\\"};y=function(a,b){return function(c,\\nd){if(void 0===c)return this._parts[a]||\\\"\\\";null!==c&&(c+=\\\"\\\",c.charAt(0)===b&&(c=c.substring(1)));this._parts[a]=c;this.build(!d);return this}};for(v in s)f[v]=y(v,s[v]);s={search:[\\\"?\\\",\\\"query\\\"],hash:[\\\"#\\\",\\\"fragment\\\"]};y=function(a,b){return function(c,d){var e=this[a](c,d);return\\\"string\\\"===typeof e&&e.length?b+e:e}};for(v in s)f[v]=y(s[v][1],s[v][0]);f.pathname=function(a,b){if(void 0===a||!0===a){var c=this._parts.path||(this._parts.hostname?\\\"/\\\":\\\"\\\");return a?d.decodePath(c):c}this._parts.path=a?d.recodePath(a):\\n\\\"/\\\";this.build(!b);return this};f.path=f.pathname;f.href=function(a,b){var c;if(void 0===a)return this.toString();this._string=\\\"\\\";this._parts=d._parts();var h=a instanceof d,e=\\\"object\\\"===typeof a&&(a.hostname||a.path||a.pathname);a.nodeName&&(e=d.getDomAttribute(a),a=a[e]||\\\"\\\",e=!1);!h&&e&&void 0!==a.pathname&&(a=a.toString());if(\\\"string\\\"===typeof a)this._parts=d.parse(a,this._parts);else if(h||e)for(c in h=h?a._parts:a,h)w.call(this._parts,c)&&(this._parts[c]=h[c]);else throw new TypeError(\\\"invalid input\\\");\\nthis.build(!b);return this};f.is=function(a){var b=!1,c=!1,h=!1,e=!1,f=!1,g=!1,k=!1,l=!this._parts.urn;this._parts.hostname&&(l=!1,c=d.ip4_expression.test(this._parts.hostname),h=d.ip6_expression.test(this._parts.hostname),b=c||h,f=(e=!b)&&u&&u.has(this._parts.hostname),g=e&&d.idn_expression.test(this._parts.hostname),k=e&&d.punycode_expression.test(this._parts.hostname));switch(a.toLowerCase()){case \\\"relative\\\":return l;case \\\"absolute\\\":return!l;case \\\"domain\\\":case \\\"name\\\":return e;case \\\"sld\\\":return f;\\ncase \\\"ip\\\":return b;case \\\"ip4\\\":case \\\"ipv4\\\":case \\\"inet4\\\":return c;case \\\"ip6\\\":case \\\"ipv6\\\":case \\\"inet6\\\":return h;case \\\"idn\\\":return g;case \\\"url\\\":return!this._parts.urn;case \\\"urn\\\":return!!this._parts.urn;case \\\"punycode\\\":return k}return null};var I=f.protocol,H=f.port,G=f.hostname;f.protocol=function(a,b){if(void 0!==a&&a&&(a=a.replace(/:(\\\\/\\\\/)?$/,\\\"\\\"),!a.match(d.protocol_expression)))throw new TypeError(\\\"Protocol '\\\"+a+\\\"' contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]\\\");return I.call(this,\\na,b)};f.scheme=f.protocol;f.port=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0!==a&&(0===a&&(a=null),a&&(a+=\\\"\\\",\\\":\\\"===a.charAt(0)&&(a=a.substring(1)),a.match(/[^0-9]/))))throw new TypeError(\\\"Port '\\\"+a+\\\"' contains characters other than [0-9]\\\");return H.call(this,a,b)};f.hostname=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0!==a){var c={};d.parseHost(a,c);a=c.hostname}return G.call(this,a,b)};f.host=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;\\nif(void 0===a)return this._parts.hostname?d.buildHost(this._parts):\\\"\\\";d.parseHost(a,this._parts);this.build(!b);return this};f.authority=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a)return this._parts.hostname?d.buildAuthority(this._parts):\\\"\\\";d.parseAuthority(a,this._parts);this.build(!b);return this};f.userinfo=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a){if(!this._parts.username)return\\\"\\\";var c=d.buildUserinfo(this._parts);return c.substring(0,\\nc.length-1)}\\\"@\\\"!==a[a.length-1]&&(a+=\\\"@\\\");d.parseUserinfo(a,this._parts);this.build(!b);return this};f.resource=function(a,b){var c;if(void 0===a)return this.path()+this.search()+this.hash();c=d.parse(a);this._parts.path=c.path;this._parts.query=c.query;this._parts.fragment=c.fragment;this.build(!b);return this};f.subdomain=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a){if(!this._parts.hostname||this.is(\\\"IP\\\"))return\\\"\\\";var c=this._parts.hostname.length-this.domain().length-\\n1;return this._parts.hostname.substring(0,c)||\\\"\\\"}c=this._parts.hostname.length-this.domain().length;c=this._parts.hostname.substring(0,c);c=RegExp(\\\"^\\\"+g(c));a&&\\\".\\\"!==a.charAt(a.length-1)&&(a+=\\\".\\\");a&&d.ensureValidHostname(a);this._parts.hostname=this._parts.hostname.replace(c,a);this.build(!b);return this};f.domain=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;\\\"boolean\\\"===typeof a&&(b=a,a=void 0);if(void 0===a){if(!this._parts.hostname||this.is(\\\"IP\\\"))return\\\"\\\";var c=this._parts.hostname.match(/\\\\./g);\\nif(c&&2>c.length)return this._parts.hostname;c=this._parts.hostname.length-this.tld(b).length-1;c=this._parts.hostname.lastIndexOf(\\\".\\\",c-1)+1;return this._parts.hostname.substring(c)||\\\"\\\"}if(!a)throw new TypeError(\\\"cannot set domain empty\\\");d.ensureValidHostname(a);!this._parts.hostname||this.is(\\\"IP\\\")?this._parts.hostname=a:(c=RegExp(g(this.domain())+\\\"$\\\"),this._parts.hostname=this._parts.hostname.replace(c,a));this.build(!b);return this};f.tld=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":\\nthis;\\\"boolean\\\"===typeof a&&(b=a,a=void 0);if(void 0===a){if(!this._parts.hostname||this.is(\\\"IP\\\"))return\\\"\\\";var c=this._parts.hostname.lastIndexOf(\\\".\\\"),c=this._parts.hostname.substring(c+1);return!0!==b&&u&&u.list[c.toLowerCase()]?u.get(this._parts.hostname)||c:c}if(a)if(a.match(/[^a-zA-Z0-9-]/))if(u&&u.is(a))c=RegExp(g(this.tld())+\\\"$\\\"),this._parts.hostname=this._parts.hostname.replace(c,a);else throw new TypeError(\\\"TLD '\\\"+a+\\\"' contains characters other than [A-Z0-9]\\\");else{if(!this._parts.hostname||\\nthis.is(\\\"IP\\\"))throw new ReferenceError(\\\"cannot set TLD on non-domain host\\\");c=RegExp(g(this.tld())+\\\"$\\\");this._parts.hostname=this._parts.hostname.replace(c,a)}else throw new TypeError(\\\"cannot set TLD empty\\\");this.build(!b);return this};f.directory=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a||!0===a){if(!this._parts.path&&!this._parts.hostname)return\\\"\\\";if(\\\"/\\\"===this._parts.path)return\\\"/\\\";var c=this._parts.path.length-this.filename().length-1,c=this._parts.path.substring(0,\\nc)||(this._parts.hostname?\\\"/\\\":\\\"\\\");return a?d.decodePath(c):c}c=this._parts.path.length-this.filename().length;c=this._parts.path.substring(0,c);c=RegExp(\\\"^\\\"+g(c));this.is(\\\"relative\\\")||(a||(a=\\\"/\\\"),\\\"/\\\"!==a.charAt(0)&&(a=\\\"/\\\"+a));a&&\\\"/\\\"!==a.charAt(a.length-1)&&(a+=\\\"/\\\");a=d.recodePath(a);this._parts.path=this._parts.path.replace(c,a);this.build(!b);return this};f.filename=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a||!0===a){if(!this._parts.path||\\\"/\\\"===this._parts.path)return\\\"\\\";\\nvar c=this._parts.path.lastIndexOf(\\\"/\\\"),c=this._parts.path.substring(c+1);return a?d.decodePathSegment(c):c}c=!1;\\\"/\\\"===a.charAt(0)&&(a=a.substring(1));a.match(/\\\\.?\\\\//)&&(c=!0);var h=RegExp(g(this.filename())+\\\"$\\\");a=d.recodePath(a);this._parts.path=this._parts.path.replace(h,a);c?this.normalizePath(b):this.build(!b);return this};f.suffix=function(a,b){if(this._parts.urn)return void 0===a?\\\"\\\":this;if(void 0===a||!0===a){if(!this._parts.path||\\\"/\\\"===this._parts.path)return\\\"\\\";var c=this.filename(),h=c.lastIndexOf(\\\".\\\");\\nif(-1===h)return\\\"\\\";c=c.substring(h+1);c=/^[a-z0-9%]+$/i.test(c)?c:\\\"\\\";return a?d.decodePathSegment(c):c}\\\".\\\"===a.charAt(0)&&(a=a.substring(1));if(c=this.suffix())h=a?RegExp(g(c)+\\\"$\\\"):RegExp(g(\\\".\\\"+c)+\\\"$\\\");else{if(!a)return this;this._parts.path+=\\\".\\\"+d.recodePath(a)}h&&(a=d.recodePath(a),this._parts.path=this._parts.path.replace(h,a));this.build(!b);return this};f.segment=function(a,b,c){var d=this._parts.urn?\\\":\\\":\\\"/\\\",e=this.path(),f=\\\"/\\\"===e.substring(0,1),e=e.split(d);void 0!==a&&\\\"number\\\"!==typeof a&&\\n(c=b,b=a,a=void 0);if(void 0!==a&&\\\"number\\\"!==typeof a)throw Error(\\\"Bad segment '\\\"+a+\\\"', must be 0-based integer\\\");f&&e.shift();0>a&&(a=Math.max(e.length+a,0));if(void 0===b)return void 0===a?e:e[a];if(null===a||void 0===e[a])if(l(b)){e=[];a=0;for(var g=b.length;a<g;a++)if(b[a].length||e.length&&e[e.length-1].length)e.length&&!e[e.length-1].length&&e.pop(),e.push(b[a])}else{if(b||\\\"string\\\"===typeof b)\\\"\\\"===e[e.length-1]?e[e.length-1]=b:e.push(b)}else b||\\\"string\\\"===typeof b&&b.length?e[a]=b:e.splice(a,\\n1);f&&e.unshift(\\\"\\\");return this.path(e.join(d),c)};f.segmentCoded=function(a,b,c){var e,f;\\\"number\\\"!==typeof a&&(c=b,b=a,a=void 0);if(void 0===b){a=this.segment(a,b,c);if(l(a))for(e=0,f=a.length;e<f;e++)a[e]=d.decode(a[e]);else a=void 0!==a?d.decode(a):void 0;return a}if(l(b))for(e=0,f=b.length;e<f;e++)b[e]=d.decode(b[e]);else b=\\\"string\\\"===typeof b?d.encode(b):b;return this.segment(a,b,c)};var F=f.query;f.query=function(a,b){if(!0===a)return d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);\\nif(\\\"function\\\"===typeof a){var c=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace),e=a.call(this,c);this._parts.query=d.buildQuery(e||c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!b);return this}return void 0!==a&&\\\"string\\\"!==typeof a?(this._parts.query=d.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):F.call(this,a,b)};f.setQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);\\nif(\\\"object\\\"===typeof a)for(var f in a)w.call(a,f)&&(e[f]=a[f]);else if(\\\"string\\\"===typeof a)e[a]=void 0!==b?b:null;else throw new TypeError(\\\"URI.addQuery() accepts an object, string as the name parameter\\\");this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);\\\"string\\\"!==typeof a&&(c=b);this.build(!c);return this};f.addQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);d.addQuery(e,a,void 0===b?null:b);this._parts.query=\\nd.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);\\\"string\\\"!==typeof a&&(c=b);this.build(!c);return this};f.removeQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);d.removeQuery(e,a,b);this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);\\\"string\\\"!==typeof a&&(c=b);this.build(!c);return this};f.hasQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);\\nreturn d.hasQuery(e,a,b,c)};f.setSearch=f.setQuery;f.addSearch=f.addQuery;f.removeSearch=f.removeQuery;f.hasSearch=f.hasQuery;f.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()};f.normalizeProtocol=function(a){\\\"string\\\"===typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),\\nthis.build(!a));return this};f.normalizeHostname=function(a){this._parts.hostname&&(this.is(\\\"IDN\\\")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is(\\\"IPv6\\\")&&k&&(this._parts.hostname=k.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!a));return this};f.normalizePort=function(a){\\\"string\\\"===typeof this._parts.protocol&&this._parts.port===d.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a));return this};f.normalizePath=\\nfunction(a){if(this._parts.urn||!this._parts.path||\\\"/\\\"===this._parts.path)return this;var b,c=this._parts.path,e=\\\"\\\",f,g;\\\"/\\\"!==c.charAt(0)&&(b=!0,c=\\\"/\\\"+c);c=c.replace(/(\\\\/(\\\\.\\\\/)+)|(\\\\/\\\\.$)/g,\\\"/\\\").replace(/\\\\/{2,}/g,\\\"/\\\");b&&(e=c.substring(1).match(/^(\\\\.\\\\.\\\\/)+/)||\\\"\\\")&&(e=e[0]);for(;;){f=c.indexOf(\\\"/..\\\");if(-1===f)break;else if(0===f){c=c.substring(3);continue}g=c.substring(0,f).lastIndexOf(\\\"/\\\");-1===g&&(g=f);c=c.substring(0,g)+c.substring(f+3)}b&&this.is(\\\"relative\\\")&&(c=e+c.substring(1));c=d.recodePath(c);\\nthis._parts.path=c;this.build(!a);return this};f.normalizePathname=f.normalizePath;f.normalizeQuery=function(a){\\\"string\\\"===typeof this._parts.query&&(this._parts.query.length?this.query(d.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a));return this};f.normalizeFragment=function(a){this._parts.fragment||(this._parts.fragment=null,this.build(!a));return this};f.normalizeSearch=f.normalizeQuery;f.normalizeHash=f.normalizeFragment;f.iso8859=function(){var a=\\nd.encode,b=d.decode;d.encode=escape;d.decode=decodeURIComponent;this.normalize();d.encode=a;d.decode=b;return this};f.unicode=function(){var a=d.encode,b=d.decode;d.encode=E;d.decode=unescape;this.normalize();d.encode=a;d.decode=b;return this};f.readable=function(){var a=this.clone();a.username(\\\"\\\").password(\\\"\\\").normalize();var b=\\\"\\\";a._parts.protocol&&(b+=a._parts.protocol+\\\"://\\\");a._parts.hostname&&(a.is(\\\"punycode\\\")&&e?(b+=e.toUnicode(a._parts.hostname),a._parts.port&&(b+=\\\":\\\"+a._parts.port)):b+=a.host());\\na._parts.hostname&&a._parts.path&&\\\"/\\\"!==a._parts.path.charAt(0)&&(b+=\\\"/\\\");b+=a.path(!0);if(a._parts.query){for(var c=\\\"\\\",f=0,g=a._parts.query.split(\\\"&\\\"),k=g.length;f<k;f++){var l=(g[f]||\\\"\\\").split(\\\"=\\\"),c=c+(\\\"&\\\"+d.decodeQuery(l[0],this._parts.escapeQuerySpace).replace(/&/g,\\\"%26\\\"));void 0!==l[1]&&(c+=\\\"=\\\"+d.decodeQuery(l[1],this._parts.escapeQuerySpace).replace(/&/g,\\\"%26\\\"))}b+=\\\"?\\\"+c.substring(1)}return b+=d.decodeQuery(a.hash(),!0)};f.absoluteTo=function(a){var b=this.clone(),c=[\\\"protocol\\\",\\\"username\\\",\\n\\\"password\\\",\\\"hostname\\\",\\\"port\\\"],e,f;if(this._parts.urn)throw Error(\\\"URNs do not have any generally defined hierarchical components\\\");a instanceof d||(a=new d(a));b._parts.protocol||(b._parts.protocol=a._parts.protocol);if(this._parts.hostname)return b;for(e=0;f=c[e];e++)b._parts[f]=a._parts[f];b._parts.path?\\\"..\\\"===b._parts.path.substring(-2)&&(b._parts.path+=\\\"/\\\"):(b._parts.path=a._parts.path,b._parts.query||(b._parts.query=a._parts.query));\\\"/\\\"!==b.path().charAt(0)&&(a=a.directory(),b._parts.path=(a?\\na+\\\"/\\\":\\\"\\\")+b._parts.path,b.normalizePath());b.build();return b};f.relativeTo=function(a){var b=this.clone().normalize(),c,e,f,g;if(b._parts.urn)throw Error(\\\"URNs do not have any generally defined hierarchical components\\\");a=(new d(a)).normalize();c=b._parts;e=a._parts;f=b.path();g=a.path();if(\\\"/\\\"!==f.charAt(0))throw Error(\\\"URI is already relative\\\");if(\\\"/\\\"!==g.charAt(0))throw Error(\\\"Cannot calculate a URI relative to another relative URI\\\");c.protocol===e.protocol&&(c.protocol=null);if(c.username===\\ne.username&&c.password===e.password&&null===c.protocol&&null===c.username&&null===c.password&&c.hostname===e.hostname&&c.port===e.port)c.hostname=null,c.port=null;else return b.build();if(f===g)return c.path=\\\"\\\",b.build();a=d.commonPath(b.path(),a.path());if(!a)return b.build();e=e.path.substring(a.length).replace(/[^\\\\/]*$/,\\\"\\\").replace(/.*?\\\\//g,\\\"../\\\");c.path=e+c.path.substring(a.length);return b.build()};f.equals=function(a){var b=this.clone();a=new d(a);var c={},e={},f={},g;b.normalize();a.normalize();\\nif(b.toString()===a.toString())return!0;c=b.query();e=a.query();b.query(\\\"\\\");a.query(\\\"\\\");if(b.toString()!==a.toString()||c.length!==e.length)return!1;c=d.parseQuery(c,this._parts.escapeQuerySpace);e=d.parseQuery(e,this._parts.escapeQuerySpace);for(g in c)if(w.call(c,g)){if(!l(c[g])){if(c[g]!==e[g])return!1}else if(!z(c[g],e[g]))return!1;f[g]=!0}for(g in e)if(w.call(e,g)&&!f[g])return!1;return!0};f.duplicateQueryParameters=function(a){this._parts.duplicateQueryParameters=!!a;return this};f.escapeQuerySpace=\\nfunction(a){this._parts.escapeQuerySpace=!!a;return this};return d});\\n(function(e,k){\\\"object\\\"===typeof exports?module.exports=k(require(\\\"./URI\\\")):\\\"function\\\"===typeof define&&define.amd?define([\\\"./URI\\\"],k):k(e.URI)})(this,function(e){var k=e.prototype,u=k.fragment;e.fragmentPrefix=\\\"?\\\";var m=e._parts;e._parts=function(){var d=m();d.fragmentPrefix=e.fragmentPrefix;return d};k.fragmentPrefix=function(d){this._parts.fragmentPrefix=d;return this};k.fragment=function(d,g){var k=this._parts.fragmentPrefix,l=this._parts.fragment||\\\"\\\";return!0===d?l.substring(0,k.length)!==k?\\n{}:e.parseQuery(l.substring(k.length)):void 0!==d&&\\\"string\\\"!==typeof d?(this._parts.fragment=k+e.buildQuery(d),this.build(!g),this):u.call(this,d,g)};k.addFragment=function(d,g,k){var l=this._parts.fragmentPrefix,m=e.parseQuery((this._parts.fragment||\\\"\\\").substring(l.length));e.addQuery(m,d,g);this._parts.fragment=l+e.buildQuery(m);\\\"string\\\"!==typeof d&&(k=g);this.build(!k);return this};k.removeFragment=function(d,g,k){var l=this._parts.fragmentPrefix,m=e.parseQuery((this._parts.fragment||\\\"\\\").substring(l.length));\\ne.removeQuery(m,d,g);this._parts.fragment=l+e.buildQuery(m);\\\"string\\\"!==typeof d&&(k=g);this.build(!k);return this};k.addHash=k.addFragment;k.removeHash=k.removeFragment;return{}});\\n;/*global unescape, module, define, window, global*/\\n\\n/*\\n UriTemplate Copyright (c) 2012-2013 Franz Antesberger. All Rights Reserved.\\n Available via the MIT license.\\n*/\\n\\n(function (exportCallback) {\\n    \\\"use strict\\\";\\n\\nvar UriTemplateError = (function () {\\n\\n    function UriTemplateError (options) {\\n        this.options = options;\\n    }\\n\\n    UriTemplateError.prototype.toString = function () {\\n        if (JSON && JSON.stringify) {\\n            return JSON.stringify(this.options);\\n        }\\n        else {\\n            return this.options;\\n        }\\n    };\\n\\n    return UriTemplateError;\\n}());\\n\\nvar objectHelper = (function () {\\n    function isArray (value) {\\n        return Object.prototype.toString.apply(value) === '[object Array]';\\n    }\\n\\n    function isString (value) {\\n        return Object.prototype.toString.apply(value) === '[object String]';\\n    }\\n    \\n    function isNumber (value) {\\n        return Object.prototype.toString.apply(value) === '[object Number]';\\n    }\\n    \\n    function isBoolean (value) {\\n        return Object.prototype.toString.apply(value) === '[object Boolean]';\\n    }\\n    \\n    function join (arr, separator) {\\n        var\\n            result = '',\\n            first = true,\\n            index;\\n        for (index = 0; index < arr.length; index += 1) {\\n            if (first) {\\n                first = false;\\n            }\\n            else {\\n                result += separator;\\n            }\\n            result += arr[index];\\n        }\\n        return result;\\n    }\\n\\n    function map (arr, mapper) {\\n        var\\n            result = [],\\n            index = 0;\\n        for (; index < arr.length; index += 1) {\\n            result.push(mapper(arr[index]));\\n        }\\n        return result;\\n    }\\n\\n    function filter (arr, predicate) {\\n        var\\n            result = [],\\n            index = 0;\\n        for (; index < arr.length; index += 1) {\\n            if (predicate(arr[index])) {\\n                result.push(arr[index]);\\n            }\\n        }\\n        return result;\\n    }\\n\\n    function deepFreezeUsingObjectFreeze (object) {\\n        if (typeof object !== \\\"object\\\" || object === null) {\\n            return object;\\n        }\\n        Object.freeze(object);\\n        var property, propertyName;\\n        for (propertyName in object) {\\n            if (object.hasOwnProperty(propertyName)) {\\n                property = object[propertyName];\\n                // be aware, arrays are 'object', too\\n                if ((typeof property === \\\"object\\\") && !(property instanceof RegExp)) {\\n                    deepFreeze(property);\\n                }\\n            }\\n        }\\n        return object;\\n    }\\n\\n    function deepFreeze (object) {\\n        if (typeof Object.freeze === 'function') {\\n            return deepFreezeUsingObjectFreeze(object);\\n        }\\n        return object;\\n    }\\n\\n\\n    return {\\n        isArray: isArray,\\n        isString: isString,\\n        isNumber: isNumber,\\n        isBoolean: isBoolean,\\n        join: join,\\n        map: map,\\n        filter: filter,\\n        deepFreeze: deepFreeze\\n    };\\n}());\\n\\nvar charHelper = (function () {\\n\\n    function isAlpha (chr) {\\n        return (chr >= 'a' && chr <= 'z') || ((chr >= 'A' && chr <= 'Z'));\\n    }\\n\\n    function isDigit (chr) {\\n        return chr >= '0' && chr <= '9';\\n    }\\n\\n    function isHexDigit (chr) {\\n        return isDigit(chr) || (chr >= 'a' && chr <= 'f') || (chr >= 'A' && chr <= 'F');\\n    }\\n\\n    return {\\n        isAlpha: isAlpha,\\n        isDigit: isDigit,\\n        isHexDigit: isHexDigit\\n    };\\n}());\\n\\nvar pctEncoder = (function () {\\n    var utf8 = {\\n        encode: function (chr) {\\n            // see http://ecmanaut.blogspot.de/2006/07/encoding-decoding-utf8-in-javascript.html\\n            return unescape(encodeURIComponent(chr));\\n        },\\n        numBytes: function (firstCharCode) {\\n            if (firstCharCode <= 0x7F) {\\n                return 1;\\n            }\\n            else if (0xC2 <= firstCharCode && firstCharCode <= 0xDF) {\\n                return 2;\\n            }\\n            else if (0xE0 <= firstCharCode && firstCharCode <= 0xEF) {\\n                return 3;\\n            }\\n            else if (0xF0 <= firstCharCode && firstCharCode <= 0xF4) {\\n                return 4;\\n            }\\n            // no valid first octet\\n            return 0;\\n        },\\n        isValidFollowingCharCode: function (charCode) {\\n            return 0x80 <= charCode && charCode <= 0xBF;\\n        }\\n    };\\n\\n    /**\\n     * encodes a character, if needed or not.\\n     * @param chr\\n     * @return pct-encoded character\\n     */\\n    function encodeCharacter (chr) {\\n        var\\n            result = '',\\n            octets = utf8.encode(chr),\\n            octet,\\n            index;\\n        for (index = 0; index < octets.length; index += 1) {\\n            octet = octets.charCodeAt(index);\\n            result += '%' + (octet < 0x10 ? '0' : '') + octet.toString(16).toUpperCase();\\n        }\\n        return result;\\n    }\\n\\n    /**\\n     * Returns, whether the given text at start is in the form 'percent hex-digit hex-digit', like '%3F'\\n     * @param text\\n     * @param start\\n     * @return {boolean|*|*}\\n     */\\n    function isPercentDigitDigit (text, start) {\\n        return text.charAt(start) === '%' && charHelper.isHexDigit(text.charAt(start + 1)) && charHelper.isHexDigit(text.charAt(start + 2));\\n    }\\n\\n    /**\\n     * Parses a hex number from start with length 2.\\n     * @param text a string\\n     * @param start the start index of the 2-digit hex number\\n     * @return {Number}\\n     */\\n    function parseHex2 (text, start) {\\n        return parseInt(text.substr(start, 2), 16);\\n    }\\n\\n    /**\\n     * Returns whether or not the given char sequence is a correctly pct-encoded sequence.\\n     * @param chr\\n     * @return {boolean}\\n     */\\n    function isPctEncoded (chr) {\\n        if (!isPercentDigitDigit(chr, 0)) {\\n            return false;\\n        }\\n        var firstCharCode = parseHex2(chr, 1);\\n        var numBytes = utf8.numBytes(firstCharCode);\\n        if (numBytes === 0) {\\n            return false;\\n        }\\n        for (var byteNumber = 1; byteNumber < numBytes; byteNumber += 1) {\\n            if (!isPercentDigitDigit(chr, 3*byteNumber) || !utf8.isValidFollowingCharCode(parseHex2(chr, 3*byteNumber + 1))) {\\n                return false;\\n            }\\n        }\\n        return true;\\n    }\\n\\n    /**\\n     * Reads as much as needed from the text, e.g. '%20' or '%C3%B6'. It does not decode!\\n     * @param text\\n     * @param startIndex\\n     * @return the character or pct-string of the text at startIndex\\n     */\\n    function pctCharAt(text, startIndex) {\\n        var chr = text.charAt(startIndex);\\n        if (!isPercentDigitDigit(text, startIndex)) {\\n            return chr;\\n        }\\n        var utf8CharCode = parseHex2(text, startIndex + 1);\\n        var numBytes = utf8.numBytes(utf8CharCode);\\n        if (numBytes === 0) {\\n            return chr;\\n        }\\n        for (var byteNumber = 1; byteNumber < numBytes; byteNumber += 1) {\\n            if (!isPercentDigitDigit(text, startIndex + 3 * byteNumber) || !utf8.isValidFollowingCharCode(parseHex2(text, startIndex + 3 * byteNumber + 1))) {\\n                return chr;\\n            }\\n        }\\n        return text.substr(startIndex, 3 * numBytes);\\n    }\\n\\n    return {\\n        encodeCharacter: encodeCharacter,\\n        isPctEncoded: isPctEncoded,\\n        pctCharAt: pctCharAt\\n    };\\n}());\\n\\nvar rfcCharHelper = (function () {\\n\\n    /**\\n     * Returns if an character is an varchar character according 2.3 of rfc 6570\\n     * @param chr\\n     * @return (Boolean)\\n     */\\n    function isVarchar (chr) {\\n        return charHelper.isAlpha(chr) || charHelper.isDigit(chr) || chr === '_' || pctEncoder.isPctEncoded(chr);\\n    }\\n\\n    /**\\n     * Returns if chr is an unreserved character according 1.5 of rfc 6570\\n     * @param chr\\n     * @return {Boolean}\\n     */\\n    function isUnreserved (chr) {\\n        return charHelper.isAlpha(chr) || charHelper.isDigit(chr) || chr === '-' || chr === '.' || chr === '_' || chr === '~';\\n    }\\n\\n    /**\\n     * Returns if chr is an reserved character according 1.5 of rfc 6570\\n     * or the percent character mentioned in 3.2.1.\\n     * @param chr\\n     * @return {Boolean}\\n     */\\n    function isReserved (chr) {\\n        return chr === ':' || chr === '/' || chr === '?' || chr === '#' || chr === '[' || chr === ']' || chr === '@' || chr === '!' || chr === '$' || chr === '&' || chr === '(' ||\\n            chr === ')' || chr === '*' || chr === '+' || chr === ',' || chr === ';' || chr === '=' || chr === \\\"'\\\";\\n    }\\n\\n    return {\\n        isVarchar: isVarchar,\\n        isUnreserved: isUnreserved,\\n        isReserved: isReserved\\n    };\\n\\n}());\\n\\n/**\\n * encoding of rfc 6570\\n */\\nvar encodingHelper = (function () {\\n\\n    function encode (text, passReserved) {\\n        var\\n            result = '',\\n            index,\\n            chr = '';\\n        if (typeof text === \\\"number\\\" || typeof text === \\\"boolean\\\") {\\n            text = text.toString();\\n        }\\n        for (index = 0; index < text.length; index += chr.length) {\\n            chr = text.charAt(index);\\n            result += rfcCharHelper.isUnreserved(chr) || (passReserved && rfcCharHelper.isReserved(chr)) ? chr : pctEncoder.encodeCharacter(chr);\\n        }\\n        return result;\\n    }\\n\\n    function encodePassReserved (text) {\\n        return encode(text, true);\\n    }\\n\\n    function encodeLiteralCharacter (literal, index) {\\n        var chr = pctEncoder.pctCharAt(literal, index);\\n        if (chr.length > 1) {\\n            return chr;\\n        }\\n        else {\\n            return rfcCharHelper.isReserved(chr) || rfcCharHelper.isUnreserved(chr) ? chr : pctEncoder.encodeCharacter(chr);\\n        }\\n    }\\n\\n    function encodeLiteral (literal) {\\n        var\\n            result = '',\\n            index,\\n            chr = '';\\n        for (index = 0; index < literal.length; index += chr.length) {\\n            chr = pctEncoder.pctCharAt(literal, index);\\n            if (chr.length > 1) {\\n                result += chr;\\n            }\\n            else {\\n                result += rfcCharHelper.isReserved(chr) || rfcCharHelper.isUnreserved(chr) ? chr : pctEncoder.encodeCharacter(chr);\\n            }\\n        }\\n        return result;\\n    }\\n\\n    return {\\n        encode: encode,\\n        encodePassReserved: encodePassReserved,\\n        encodeLiteral: encodeLiteral,\\n        encodeLiteralCharacter: encodeLiteralCharacter\\n    };\\n\\n}());\\n\\n\\n// the operators defined by rfc 6570\\nvar operators = (function () {\\n\\n    var\\n        bySymbol = {};\\n\\n    function create (symbol) {\\n        bySymbol[symbol] = {\\n            symbol: symbol,\\n            separator: (symbol === '?') ? '&' : (symbol === '' || symbol === '+' || symbol === '#') ? ',' : symbol,\\n            named: symbol === ';' || symbol === '&' || symbol === '?',\\n            ifEmpty: (symbol === '&' || symbol === '?') ? '=' : '',\\n            first: (symbol === '+' ) ? '' : symbol,\\n            encode: (symbol === '+' || symbol === '#') ? encodingHelper.encodePassReserved : encodingHelper.encode,\\n            toString: function () {\\n                return this.symbol;\\n            }\\n        };\\n    }\\n\\n    create('');\\n    create('+');\\n    create('#');\\n    create('.');\\n    create('/');\\n    create(';');\\n    create('?');\\n    create('&');\\n    return {\\n        valueOf: function (chr) {\\n            if (bySymbol[chr]) {\\n                return bySymbol[chr];\\n            }\\n            if (\\\"=,!@|\\\".indexOf(chr) >= 0) {\\n                return null;\\n            }\\n            return bySymbol[''];\\n        }\\n    };\\n}());\\n\\n\\n/**\\n * Detects, whether a given element is defined in the sense of rfc 6570\\n * Section 2.3 of the RFC makes clear defintions:\\n * * undefined and null are not defined.\\n * * the empty string is defined\\n * * an array (\\\"list\\\") is defined, if it is not empty (even if all elements are not defined)\\n * * an object (\\\"map\\\") is defined, if it contains at least one property with defined value\\n * @param object\\n * @return {Boolean}\\n */\\nfunction isDefined (object) {\\n    var\\n        propertyName;\\n    if (object === null || object === undefined) {\\n        return false;\\n    }\\n    if (objectHelper.isArray(object)) {\\n        // Section 2.3: A variable defined as a list value is considered undefined if the list contains zero members\\n        return object.length > 0;\\n    }\\n    if (typeof object === \\\"string\\\" || typeof object === \\\"number\\\" || typeof object === \\\"boolean\\\") {\\n        // falsy values like empty strings, false or 0 are \\\"defined\\\"\\n        return true;\\n    }\\n    // else Object\\n    for (propertyName in object) {\\n        if (object.hasOwnProperty(propertyName) && isDefined(object[propertyName])) {\\n            return true;\\n        }\\n    }\\n    return false;\\n}\\n\\nvar LiteralExpression = (function () {\\n    function LiteralExpression (literal) {\\n        this.literal = encodingHelper.encodeLiteral(literal);\\n    }\\n\\n    LiteralExpression.prototype.expand = function () {\\n        return this.literal;\\n    };\\n\\n    LiteralExpression.prototype.toString = LiteralExpression.prototype.expand;\\n\\n    return LiteralExpression;\\n}());\\n\\nvar parse = (function () {\\n\\n    function parseExpression (expressionText) {\\n        var\\n            operator,\\n            varspecs = [],\\n            varspec = null,\\n            varnameStart = null,\\n            maxLengthStart = null,\\n            index,\\n            chr = '';\\n\\n        function closeVarname () {\\n            var varname = expressionText.substring(varnameStart, index);\\n            if (varname.length === 0) {\\n                throw new UriTemplateError({expressionText: expressionText, message: \\\"a varname must be specified\\\", position: index});\\n            }\\n            varspec = {varname: varname, exploded: false, maxLength: null};\\n            varnameStart = null;\\n        }\\n\\n        function closeMaxLength () {\\n            if (maxLengthStart === index) {\\n                throw new UriTemplateError({expressionText: expressionText, message: \\\"after a ':' you have to specify the length\\\", position: index});\\n            }\\n            varspec.maxLength = parseInt(expressionText.substring(maxLengthStart, index), 10);\\n            maxLengthStart = null;\\n        }\\n\\n        operator = (function (operatorText) {\\n            var op = operators.valueOf(operatorText);\\n            if (op === null) {\\n                throw new UriTemplateError({expressionText: expressionText, message: \\\"illegal use of reserved operator\\\", position: index, operator: operatorText});\\n            }\\n            return op;\\n        }(expressionText.charAt(0)));\\n        index = operator.symbol.length;\\n\\n        varnameStart = index;\\n\\n        for (; index < expressionText.length; index += chr.length) {\\n            chr = pctEncoder.pctCharAt(expressionText, index);\\n\\n            if (varnameStart !== null) {\\n                // the spec says: varname =  varchar *( [\\\".\\\"] varchar )\\n                // so a dot is allowed except for the first char\\n                if (chr === '.') {\\n                    if (varnameStart === index) {\\n                        throw new UriTemplateError({expressionText: expressionText, message: \\\"a varname MUST NOT start with a dot\\\", position: index});\\n                    }\\n                    continue;\\n                }\\n                if (rfcCharHelper.isVarchar(chr)) {\\n                    continue;\\n                }\\n                closeVarname();\\n            }\\n            if (maxLengthStart !== null) {\\n                if (index === maxLengthStart && chr === '0') {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"A :prefix must not start with digit 0\\\", position: index});\\n                }\\n                if (charHelper.isDigit(chr)) {\\n                    if (index - maxLengthStart >= 4) {\\n                        throw new UriTemplateError({expressionText: expressionText, message: \\\"A :prefix must have max 4 digits\\\", position: index});\\n                    }\\n                    continue;\\n                }\\n                closeMaxLength();\\n            }\\n            if (chr === ':') {\\n                if (varspec.maxLength !== null) {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"only one :maxLength is allowed per varspec\\\", position: index});\\n                }\\n                if (varspec.exploded) {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"an exploeded varspec MUST NOT be varspeced\\\", position: index});\\n                }\\n                maxLengthStart = index + 1;\\n                continue;\\n            }\\n            if (chr === '*') {\\n                if (varspec === null) {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"exploded without varspec\\\", position: index});\\n                }\\n                if (varspec.exploded) {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"exploded twice\\\", position: index});\\n                }\\n                if (varspec.maxLength) {\\n                    throw new UriTemplateError({expressionText: expressionText, message: \\\"an explode (*) MUST NOT follow to a prefix\\\", position: index});\\n                }\\n                varspec.exploded = true;\\n                continue;\\n            }\\n            // the only legal character now is the comma\\n            if (chr === ',') {\\n                varspecs.push(varspec);\\n                varspec = null;\\n                varnameStart = index + 1;\\n                continue;\\n            }\\n            throw new UriTemplateError({expressionText: expressionText, message: \\\"illegal character\\\", character: chr, position: index});\\n        } // for chr\\n        if (varnameStart !== null) {\\n            closeVarname();\\n        }\\n        if (maxLengthStart !== null) {\\n            closeMaxLength();\\n        }\\n        varspecs.push(varspec);\\n        return new VariableExpression(expressionText, operator, varspecs);\\n    }\\n\\n    function escape_regexp_string(string) {\\n      // http://simonwillison.net/2006/Jan/20/escape/\\n      return string.replace(/[\\\\-\\\\[\\\\]{}()*+?.,\\\\\\\\\\\\^$|#\\\\s]/g, \\\"\\\\\\\\$&\\\");\\n    }\\n\\n    function parse (uriTemplateText) {\\n        // assert filled string\\n        var\\n            index,\\n            chr,\\n            expressions = [],\\n            expression,\\n            braceOpenIndex = null,\\n            regexp_string = '',\\n            can_match = true,\\n            literalStart = 0;\\n        for (index = 0; index < uriTemplateText.length; index += 1) {\\n            chr = uriTemplateText.charAt(index);\\n            if (literalStart !== null) {\\n                if (chr === '}') {\\n                    throw new UriTemplateError({templateText: uriTemplateText, message: \\\"unopened brace closed\\\", position: index});\\n                }\\n                if (chr === '{') {\\n                    if (literalStart < index) {\\n                        expression = new LiteralExpression(uriTemplateText.substring(literalStart, index));\\n                        expressions.push(expression);\\n                        regexp_string += escape_regexp_string(\\n                            expression.literal);\\n                    }\\n                    literalStart = null;\\n                    braceOpenIndex = index;\\n                }\\n                continue;\\n            }\\n\\n            if (braceOpenIndex !== null) {\\n                // here just { is forbidden\\n                if (chr === '{') {\\n                    throw new UriTemplateError({templateText: uriTemplateText, message: \\\"brace already opened\\\", position: index});\\n                }\\n                if (chr === '}') {\\n                    if (braceOpenIndex + 1 === index) {\\n                        throw new UriTemplateError({templateText: uriTemplateText, message: \\\"empty braces\\\", position: braceOpenIndex});\\n                    }\\n                    try {\\n                        expression = parseExpression(uriTemplateText.substring(braceOpenIndex + 1, index));\\n                    }\\n                    catch (error) {\\n                        if (error.prototype === UriTemplateError.prototype) {\\n                            throw new UriTemplateError({templateText: uriTemplateText, message: error.options.message, position: braceOpenIndex + error.options.position, details: error.options});\\n                        }\\n                        throw error;\\n                    }\\n                    expressions.push(expression);\\n                    if (expression.operator.symbol.length === 0) {\\n                      regexp_string += \\\"([^/]+)\\\";\\n                    } else {\\n                      can_match = false;\\n                    }\\n                    braceOpenIndex = null;\\n                    literalStart = index + 1;\\n                }\\n                continue;\\n            }\\n            throw new Error('reached unreachable code');\\n        }\\n        if (braceOpenIndex !== null) {\\n            throw new UriTemplateError({templateText: uriTemplateText, message: \\\"unclosed brace\\\", position: braceOpenIndex});\\n        }\\n        if (literalStart < uriTemplateText.length) {\\n            expression = new LiteralExpression(uriTemplateText.substring(literalStart));\\n            expressions.push(expression);\\n            regexp_string += escape_regexp_string(expression.literal);\\n        }\\n        if (can_match === false) {\\n          regexp_string = undefined;\\n        }\\n        return new UriTemplate(uriTemplateText, expressions, regexp_string);\\n    }\\n\\n    return parse;\\n}());\\n\\nvar VariableExpression = (function () {\\n    // helper function if JSON is not available\\n    function prettyPrint (value) {\\n        return (JSON && JSON.stringify) ? JSON.stringify(value) : value;\\n    }\\n\\n    function isEmpty (value) {\\n        if (!isDefined(value)) {\\n            return true;\\n        }\\n        if (objectHelper.isString(value)) {\\n            return value === '';\\n        }\\n        if (objectHelper.isNumber(value) || objectHelper.isBoolean(value)) {\\n            return false;\\n        }\\n        if (objectHelper.isArray(value)) {\\n            return value.length === 0;\\n        }\\n        for (var propertyName in value) {\\n            if (value.hasOwnProperty(propertyName)) {\\n                return false;\\n            }\\n        }\\n        return true;\\n    }\\n\\n    function propertyArray (object) {\\n        var\\n            result = [],\\n            propertyName;\\n        for (propertyName in object) {\\n            if (object.hasOwnProperty(propertyName)) {\\n                result.push({name: propertyName, value: object[propertyName]});\\n            }\\n        }\\n        return result;\\n    }\\n\\n    function VariableExpression (templateText, operator, varspecs) {\\n        this.templateText = templateText;\\n        this.operator = operator;\\n        this.varspecs = varspecs;\\n    }\\n\\n    VariableExpression.prototype.toString = function () {\\n        return this.templateText;\\n    };\\n\\n    function expandSimpleValue(varspec, operator, value) {\\n        var result = '';\\n        value = value.toString();\\n        if (operator.named) {\\n            result += encodingHelper.encodeLiteral(varspec.varname);\\n            if (value === '') {\\n                result += operator.ifEmpty;\\n                return result;\\n            }\\n            result += '=';\\n        }\\n        if (varspec.maxLength !== null) {\\n            value = value.substr(0, varspec.maxLength);\\n        }\\n        result += operator.encode(value);\\n        return result;\\n    }\\n\\n    function valueDefined (nameValue) {\\n        return isDefined(nameValue.value);\\n    }\\n\\n    function expandNotExploded(varspec, operator, value) {\\n        var\\n            arr = [],\\n            result = '';\\n        if (operator.named) {\\n            result += encodingHelper.encodeLiteral(varspec.varname);\\n            if (isEmpty(value)) {\\n                result += operator.ifEmpty;\\n                return result;\\n            }\\n            result += '=';\\n        }\\n        if (objectHelper.isArray(value)) {\\n            arr = value;\\n            arr = objectHelper.filter(arr, isDefined);\\n            arr = objectHelper.map(arr, operator.encode);\\n            result += objectHelper.join(arr, ',');\\n        }\\n        else {\\n            arr = propertyArray(value);\\n            arr = objectHelper.filter(arr, valueDefined);\\n            arr = objectHelper.map(arr, function (nameValue) {\\n                return operator.encode(nameValue.name) + ',' + operator.encode(nameValue.value);\\n            });\\n            result += objectHelper.join(arr, ',');\\n        }\\n        return result;\\n    }\\n\\n    function expandExplodedNamed (varspec, operator, value) {\\n        var\\n            isArray = objectHelper.isArray(value),\\n            arr = [];\\n        if (isArray) {\\n            arr = value;\\n            arr = objectHelper.filter(arr, isDefined);\\n            arr = objectHelper.map(arr, function (listElement) {\\n                var tmp = encodingHelper.encodeLiteral(varspec.varname);\\n                if (isEmpty(listElement)) {\\n                    tmp += operator.ifEmpty;\\n                }\\n                else {\\n                    tmp += '=' + operator.encode(listElement);\\n                }\\n                return tmp;\\n            });\\n        }\\n        else {\\n            arr = propertyArray(value);\\n            arr = objectHelper.filter(arr, valueDefined);\\n            arr = objectHelper.map(arr, function (nameValue) {\\n                var tmp = encodingHelper.encodeLiteral(nameValue.name);\\n                if (isEmpty(nameValue.value)) {\\n                    tmp += operator.ifEmpty;\\n                }\\n                else {\\n                    tmp += '=' + operator.encode(nameValue.value);\\n                }\\n                return tmp;\\n            });\\n        }\\n        return objectHelper.join(arr, operator.separator);\\n    }\\n\\n    function expandExplodedUnnamed (operator, value) {\\n        var\\n            arr = [],\\n            result = '';\\n        if (objectHelper.isArray(value)) {\\n            arr = value;\\n            arr = objectHelper.filter(arr, isDefined);\\n            arr = objectHelper.map(arr, operator.encode);\\n            result += objectHelper.join(arr, operator.separator);\\n        }\\n        else {\\n            arr = propertyArray(value);\\n            arr = objectHelper.filter(arr, function (nameValue) {\\n                return isDefined(nameValue.value);\\n            });\\n            arr = objectHelper.map(arr, function (nameValue) {\\n                return operator.encode(nameValue.name) + '=' + operator.encode(nameValue.value);\\n            });\\n            result += objectHelper.join(arr, operator.separator);\\n        }\\n        return result;\\n    }\\n\\n\\n    VariableExpression.prototype.expand = function (variables) {\\n        var\\n            expanded = [],\\n            index,\\n            varspec,\\n            value,\\n            valueIsArr,\\n            oneExploded = false,\\n            operator = this.operator;\\n\\n        // expand each varspec and join with operator's separator\\n        for (index = 0; index < this.varspecs.length; index += 1) {\\n            varspec = this.varspecs[index];\\n            value = variables[varspec.varname];\\n            // if (!isDefined(value)) {\\n            // if (variables.hasOwnProperty(varspec.name)) {\\n            if (value === null || value === undefined) {\\n                continue;\\n            }\\n            if (varspec.exploded) {\\n                oneExploded = true;\\n            }\\n            valueIsArr = objectHelper.isArray(value);\\n            if (typeof value === \\\"string\\\" || typeof value === \\\"number\\\" || typeof value === \\\"boolean\\\") {\\n                expanded.push(expandSimpleValue(varspec, operator, value));\\n            }\\n            else if (varspec.maxLength && isDefined(value)) {\\n                // 2.4.1 of the spec says: \\\"Prefix modifiers are not applicable to variables that have composite values.\\\"\\n                throw new Error('Prefix modifiers are not applicable to variables that have composite values. You tried to expand ' + this + \\\" with \\\" + prettyPrint(value));\\n            }\\n            else if (!varspec.exploded) {\\n                if (operator.named || !isEmpty(value)) {\\n                    expanded.push(expandNotExploded(varspec, operator, value));\\n                }\\n            }\\n            else if (isDefined(value)) {\\n                if (operator.named) {\\n                    expanded.push(expandExplodedNamed(varspec, operator, value));\\n                }\\n                else {\\n                    expanded.push(expandExplodedUnnamed(operator, value));\\n                }\\n            }\\n        }\\n\\n        if (expanded.length === 0) {\\n            return \\\"\\\";\\n        }\\n        else {\\n            return operator.first + objectHelper.join(expanded, operator.separator);\\n        }\\n    };\\n\\n    return VariableExpression;\\n}());\\n\\nvar UriTemplate = (function () {\\n    function UriTemplate (templateText, expressions, regexp_string) {\\n        this.templateText = templateText;\\n        this.expressions = expressions;\\n\\n        if (regexp_string !== undefined) {\\n          this.regexp = new RegExp(\\\"^\\\" + regexp_string + \\\"$\\\");\\n        }\\n\\n        objectHelper.deepFreeze(this);\\n    }\\n\\n    UriTemplate.prototype.toString = function () {\\n        return this.templateText;\\n    };\\n\\n    UriTemplate.prototype.expand = function (variables) {\\n        // this.expressions.map(function (expression) {return expression.expand(variables);}).join('');\\n        var\\n            index,\\n            result = '';\\n        for (index = 0; index < this.expressions.length; index += 1) {\\n            result += this.expressions[index].expand(variables);\\n        }\\n        return result;\\n    };\\n\\n    UriTemplate.prototype.extract = function (text) {\\n      var expression_index,\\n          extracted_index = 1,\\n          expression,\\n          varspec,\\n          matched = true,\\n          variables = {},\\n          result;\\n\\n      if ((this.regexp !== undefined) && (this.regexp.test(text))) {\\n        result = this.regexp.exec(text);\\n        for (expression_index = 0; expression_index < this.expressions.length; expression_index += 1) {\\n          expression = this.expressions[expression_index];\\n          if (expression.literal === undefined) {\\n            if ((expression.operator !== undefined) && (expression.operator.symbol.length === 0) && (expression.varspecs.length === 1)) {\\n              varspec = expression.varspecs[0];\\n              if ((varspec.exploded === false) && (varspec.maxLength === null)) {\\n                if (result[extracted_index].indexOf(',') === -1) {\\n                  variables[varspec.varname] = decodeURIComponent(result[extracted_index]);\\n                  extracted_index += 1;\\n                } else {\\n                  matched = false;\\n                }\\n              } else {\\n                matched = false;\\n              }\\n            } else {\\n              matched = false;\\n            }\\n          }\\n        }\\n        if (matched) {\\n          return variables;\\n        }\\n      }\\n      return false;\\n    };\\n\\n    UriTemplate.parse = parse;\\n    UriTemplate.UriTemplateError = UriTemplateError;\\n    return UriTemplate;\\n}());\\n\\n    exportCallback(UriTemplate);\\n\\n}(function (UriTemplate) {\\n        \\\"use strict\\\";\\n        // export UriTemplate, when module is present, or pass it to window or global\\n        if (typeof module !== \\\"undefined\\\") {\\n            module.exports = UriTemplate;\\n        }\\n        else if (typeof define === \\\"function\\\") {\\n            define([],function() {\\n                return UriTemplate;\\n            });\\n        }\\n        else if (typeof window !== \\\"undefined\\\") {\\n            window.UriTemplate = UriTemplate;\\n        }\\n        else {\\n            global.UriTemplate = UriTemplate;\\n        }\\n    }\\n));\\n;// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\\n// This work is free. You can redistribute it and/or modify it\\n// under the terms of the WTFPL, Version 2\\n// For more information see LICENSE.txt or http://www.wtfpl.net/\\n//\\n// For more information, the home page:\\n// http://pieroxy.net/blog/pages/lz-string/testing.html\\n//\\n// LZ-based compression algorithm, version 1.4.4\\nvar LZString = (function() {\\n\\n// private property\\nvar f = String.fromCharCode;\\nvar keyStrBase64 = \\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\\\";\\nvar keyStrUriSafe = \\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\\\";\\nvar baseReverseDic = {};\\n\\nfunction getBaseValue(alphabet, character) {\\n  if (!baseReverseDic[alphabet]) {\\n    baseReverseDic[alphabet] = {};\\n    for (var i=0 ; i<alphabet.length ; i++) {\\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\\n    }\\n  }\\n  return baseReverseDic[alphabet][character];\\n}\\n\\nvar LZString = {\\n  compressToBase64 : function (input) {\\n    if (input == null) return \\\"\\\";\\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\\n    switch (res.length % 4) { // To produce valid Base64\\n    default: // When could this happen ?\\n    case 0 : return res;\\n    case 1 : return res+\\\"===\\\";\\n    case 2 : return res+\\\"==\\\";\\n    case 3 : return res+\\\"=\\\";\\n    }\\n  },\\n\\n  decompressFromBase64 : function (input) {\\n    if (input == null) return \\\"\\\";\\n    if (input == \\\"\\\") return null;\\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\\n  },\\n\\n  compressToUTF16 : function (input) {\\n    if (input == null) return \\\"\\\";\\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \\\" \\\";\\n  },\\n\\n  decompressFromUTF16: function (compressed) {\\n    if (compressed == null) return \\\"\\\";\\n    if (compressed == \\\"\\\") return null;\\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\\n  },\\n\\n  //compress into uint8array (UCS-2 big endian format)\\n  compressToUint8Array: function (uncompressed) {\\n    var compressed = LZString.compress(uncompressed);\\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\\n\\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\\n      var current_value = compressed.charCodeAt(i);\\n      buf[i*2] = current_value >>> 8;\\n      buf[i*2+1] = current_value % 256;\\n    }\\n    return buf;\\n  },\\n\\n  //decompress from uint8array (UCS-2 big endian format)\\n  decompressFromUint8Array:function (compressed) {\\n    if (compressed===null || compressed===undefined){\\n        return LZString.decompress(compressed);\\n    } else {\\n        var buf=new Array(compressed.length/2); // 2 bytes per character\\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\\n        }\\n\\n        var result = [];\\n        buf.forEach(function (c) {\\n          result.push(f(c));\\n        });\\n        return LZString.decompress(result.join(''));\\n\\n    }\\n\\n  },\\n\\n\\n  //compress into a string that is already URI encoded\\n  compressToEncodedURIComponent: function (input) {\\n    if (input == null) return \\\"\\\";\\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\\n  },\\n\\n  //decompress from an output of compressToEncodedURIComponent\\n  decompressFromEncodedURIComponent:function (input) {\\n    if (input == null) return \\\"\\\";\\n    if (input == \\\"\\\") return null;\\n    input = input.replace(/ /g, \\\"+\\\");\\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\\n  },\\n\\n  compress: function (uncompressed) {\\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\\n  },\\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\\n    if (uncompressed == null) return \\\"\\\";\\n    var i, value,\\n        context_dictionary= {},\\n        context_dictionaryToCreate= {},\\n        context_c=\\\"\\\",\\n        context_wc=\\\"\\\",\\n        context_w=\\\"\\\",\\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\\n        context_dictSize= 3,\\n        context_numBits= 2,\\n        context_data=[],\\n        context_data_val=0,\\n        context_data_position=0,\\n        ii;\\n\\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\\n      context_c = uncompressed.charAt(ii);\\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\\n        context_dictionary[context_c] = context_dictSize++;\\n        context_dictionaryToCreate[context_c] = true;\\n      }\\n\\n      context_wc = context_w + context_c;\\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\\n        context_w = context_wc;\\n      } else {\\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\\n          if (context_w.charCodeAt(0)<256) {\\n            for (i=0 ; i<context_numBits ; i++) {\\n              context_data_val = (context_data_val << 1);\\n              if (context_data_position == bitsPerChar-1) {\\n                context_data_position = 0;\\n                context_data.push(getCharFromInt(context_data_val));\\n                context_data_val = 0;\\n              } else {\\n                context_data_position++;\\n              }\\n            }\\n            value = context_w.charCodeAt(0);\\n            for (i=0 ; i<8 ; i++) {\\n              context_data_val = (context_data_val << 1) | (value&1);\\n              if (context_data_position == bitsPerChar-1) {\\n                context_data_position = 0;\\n                context_data.push(getCharFromInt(context_data_val));\\n                context_data_val = 0;\\n              } else {\\n                context_data_position++;\\n              }\\n              value = value >> 1;\\n            }\\n          } else {\\n            value = 1;\\n            for (i=0 ; i<context_numBits ; i++) {\\n              context_data_val = (context_data_val << 1) | value;\\n              if (context_data_position ==bitsPerChar-1) {\\n                context_data_position = 0;\\n                context_data.push(getCharFromInt(context_data_val));\\n                context_data_val = 0;\\n              } else {\\n                context_data_position++;\\n              }\\n              value = 0;\\n            }\\n            value = context_w.charCodeAt(0);\\n            for (i=0 ; i<16 ; i++) {\\n              context_data_val = (context_data_val << 1) | (value&1);\\n              if (context_data_position == bitsPerChar-1) {\\n                context_data_position = 0;\\n                context_data.push(getCharFromInt(context_data_val));\\n                context_data_val = 0;\\n              } else {\\n                context_data_position++;\\n              }\\n              value = value >> 1;\\n            }\\n          }\\n          context_enlargeIn--;\\n          if (context_enlargeIn == 0) {\\n            context_enlargeIn = Math.pow(2, context_numBits);\\n            context_numBits++;\\n          }\\n          delete context_dictionaryToCreate[context_w];\\n        } else {\\n          value = context_dictionary[context_w];\\n          for (i=0 ; i<context_numBits ; i++) {\\n            context_data_val = (context_data_val << 1) | (value&1);\\n            if (context_data_position == bitsPerChar-1) {\\n              context_data_position = 0;\\n              context_data.push(getCharFromInt(context_data_val));\\n              context_data_val = 0;\\n            } else {\\n              context_data_position++;\\n            }\\n            value = value >> 1;\\n          }\\n\\n\\n        }\\n        context_enlargeIn--;\\n        if (context_enlargeIn == 0) {\\n          context_enlargeIn = Math.pow(2, context_numBits);\\n          context_numBits++;\\n        }\\n        // Add wc to the dictionary.\\n        context_dictionary[context_wc] = context_dictSize++;\\n        context_w = String(context_c);\\n      }\\n    }\\n\\n    // Output the code for w.\\n    if (context_w !== \\\"\\\") {\\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\\n        if (context_w.charCodeAt(0)<256) {\\n          for (i=0 ; i<context_numBits ; i++) {\\n            context_data_val = (context_data_val << 1);\\n            if (context_data_position == bitsPerChar-1) {\\n              context_data_position = 0;\\n              context_data.push(getCharFromInt(context_data_val));\\n              context_data_val = 0;\\n            } else {\\n              context_data_position++;\\n            }\\n          }\\n          value = context_w.charCodeAt(0);\\n          for (i=0 ; i<8 ; i++) {\\n            context_data_val = (context_data_val << 1) | (value&1);\\n            if (context_data_position == bitsPerChar-1) {\\n              context_data_position = 0;\\n              context_data.push(getCharFromInt(context_data_val));\\n              context_data_val = 0;\\n            } else {\\n              context_data_position++;\\n            }\\n            value = value >> 1;\\n          }\\n        } else {\\n          value = 1;\\n          for (i=0 ; i<context_numBits ; i++) {\\n            context_data_val = (context_data_val << 1) | value;\\n            if (context_data_position == bitsPerChar-1) {\\n              context_data_position = 0;\\n              context_data.push(getCharFromInt(context_data_val));\\n              context_data_val = 0;\\n            } else {\\n              context_data_position++;\\n            }\\n            value = 0;\\n          }\\n          value = context_w.charCodeAt(0);\\n          for (i=0 ; i<16 ; i++) {\\n            context_data_val = (context_data_val << 1) | (value&1);\\n            if (context_data_position == bitsPerChar-1) {\\n              context_data_position = 0;\\n              context_data.push(getCharFromInt(context_data_val));\\n              context_data_val = 0;\\n            } else {\\n              context_data_position++;\\n            }\\n            value = value >> 1;\\n          }\\n        }\\n        context_enlargeIn--;\\n        if (context_enlargeIn == 0) {\\n          context_enlargeIn = Math.pow(2, context_numBits);\\n          context_numBits++;\\n        }\\n        delete context_dictionaryToCreate[context_w];\\n      } else {\\n        value = context_dictionary[context_w];\\n        for (i=0 ; i<context_numBits ; i++) {\\n          context_data_val = (context_data_val << 1) | (value&1);\\n          if (context_data_position == bitsPerChar-1) {\\n            context_data_position = 0;\\n            context_data.push(getCharFromInt(context_data_val));\\n            context_data_val = 0;\\n          } else {\\n            context_data_position++;\\n          }\\n          value = value >> 1;\\n        }\\n\\n\\n      }\\n      context_enlargeIn--;\\n      if (context_enlargeIn == 0) {\\n        context_enlargeIn = Math.pow(2, context_numBits);\\n        context_numBits++;\\n      }\\n    }\\n\\n    // Mark the end of the stream\\n    value = 2;\\n    for (i=0 ; i<context_numBits ; i++) {\\n      context_data_val = (context_data_val << 1) | (value&1);\\n      if (context_data_position == bitsPerChar-1) {\\n        context_data_position = 0;\\n        context_data.push(getCharFromInt(context_data_val));\\n        context_data_val = 0;\\n      } else {\\n        context_data_position++;\\n      }\\n      value = value >> 1;\\n    }\\n\\n    // Flush the last char\\n    while (true) {\\n      context_data_val = (context_data_val << 1);\\n      if (context_data_position == bitsPerChar-1) {\\n        context_data.push(getCharFromInt(context_data_val));\\n        break;\\n      }\\n      else context_data_position++;\\n    }\\n    return context_data.join('');\\n  },\\n\\n  decompress: function (compressed) {\\n    if (compressed == null) return \\\"\\\";\\n    if (compressed == \\\"\\\") return null;\\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\\n  },\\n\\n  _decompress: function (length, resetValue, getNextValue) {\\n    var dictionary = [],\\n        next,\\n        enlargeIn = 4,\\n        dictSize = 4,\\n        numBits = 3,\\n        entry = \\\"\\\",\\n        result = [],\\n        i,\\n        w,\\n        bits, resb, maxpower, power,\\n        c,\\n        data = {val:getNextValue(0), position:resetValue, index:1};\\n\\n    for (i = 0; i < 3; i += 1) {\\n      dictionary[i] = i;\\n    }\\n\\n    bits = 0;\\n    maxpower = Math.pow(2,2);\\n    power=1;\\n    while (power!=maxpower) {\\n      resb = data.val & data.position;\\n      data.position >>= 1;\\n      if (data.position == 0) {\\n        data.position = resetValue;\\n        data.val = getNextValue(data.index++);\\n      }\\n      bits |= (resb>0 ? 1 : 0) * power;\\n      power <<= 1;\\n    }\\n\\n    switch (next = bits) {\\n      case 0:\\n          bits = 0;\\n          maxpower = Math.pow(2,8);\\n          power=1;\\n          while (power!=maxpower) {\\n            resb = data.val & data.position;\\n            data.position >>= 1;\\n            if (data.position == 0) {\\n              data.position = resetValue;\\n              data.val = getNextValue(data.index++);\\n            }\\n            bits |= (resb>0 ? 1 : 0) * power;\\n            power <<= 1;\\n          }\\n        c = f(bits);\\n        break;\\n      case 1:\\n          bits = 0;\\n          maxpower = Math.pow(2,16);\\n          power=1;\\n          while (power!=maxpower) {\\n            resb = data.val & data.position;\\n            data.position >>= 1;\\n            if (data.position == 0) {\\n              data.position = resetValue;\\n              data.val = getNextValue(data.index++);\\n            }\\n            bits |= (resb>0 ? 1 : 0) * power;\\n            power <<= 1;\\n          }\\n        c = f(bits);\\n        break;\\n      case 2:\\n        return \\\"\\\";\\n    }\\n    dictionary[3] = c;\\n    w = c;\\n    result.push(c);\\n    while (true) {\\n      if (data.index > length) {\\n        return \\\"\\\";\\n      }\\n\\n      bits = 0;\\n      maxpower = Math.pow(2,numBits);\\n      power=1;\\n      while (power!=maxpower) {\\n        resb = data.val & data.position;\\n        data.position >>= 1;\\n        if (data.position == 0) {\\n          data.position = resetValue;\\n          data.val = getNextValue(data.index++);\\n        }\\n        bits |= (resb>0 ? 1 : 0) * power;\\n        power <<= 1;\\n      }\\n\\n      switch (c = bits) {\\n        case 0:\\n          bits = 0;\\n          maxpower = Math.pow(2,8);\\n          power=1;\\n          while (power!=maxpower) {\\n            resb = data.val & data.position;\\n            data.position >>= 1;\\n            if (data.position == 0) {\\n              data.position = resetValue;\\n              data.val = getNextValue(data.index++);\\n            }\\n            bits |= (resb>0 ? 1 : 0) * power;\\n            power <<= 1;\\n          }\\n\\n          dictionary[dictSize++] = f(bits);\\n          c = dictSize-1;\\n          enlargeIn--;\\n          break;\\n        case 1:\\n          bits = 0;\\n          maxpower = Math.pow(2,16);\\n          power=1;\\n          while (power!=maxpower) {\\n            resb = data.val & data.position;\\n            data.position >>= 1;\\n            if (data.position == 0) {\\n              data.position = resetValue;\\n              data.val = getNextValue(data.index++);\\n            }\\n            bits |= (resb>0 ? 1 : 0) * power;\\n            power <<= 1;\\n          }\\n          dictionary[dictSize++] = f(bits);\\n          c = dictSize-1;\\n          enlargeIn--;\\n          break;\\n        case 2:\\n          return result.join('');\\n      }\\n\\n      if (enlargeIn == 0) {\\n        enlargeIn = Math.pow(2, numBits);\\n        numBits++;\\n      }\\n\\n      if (dictionary[c]) {\\n        entry = dictionary[c];\\n      } else {\\n        if (c === dictSize) {\\n          entry = w + w.charAt(0);\\n        } else {\\n          return null;\\n        }\\n      }\\n      result.push(entry);\\n\\n      // Add w+entry[0] to the dictionary.\\n      dictionary[dictSize++] = w + entry.charAt(0);\\n      enlargeIn--;\\n\\n      w = entry;\\n\\n      if (enlargeIn == 0) {\\n        enlargeIn = Math.pow(2, numBits);\\n        numBits++;\\n      }\\n\\n    }\\n  }\\n};\\n  return LZString;\\n})();\\n\\nif (typeof define === 'function' && define.amd) {\\n  define(function () { return LZString; });\\n} else if( typeof module !== 'undefined' && module != null ) {\\n  module.exports = LZString\\n}\\n;//! moment.js\\n//! version : 2.13.0\\n//! authors : Tim Wood, Iskren Chernev, Moment.js contributors\\n//! license : MIT\\n//! momentjs.com\\n\\n;(function (global, factory) {\\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\\n    typeof define === 'function' && define.amd ? define(factory) :\\n    global.moment = factory()\\n}(this, function () { 'use strict';\\n\\n    var hookCallback;\\n\\n    function utils_hooks__hooks () {\\n        return hookCallback.apply(null, arguments);\\n    }\\n\\n    // This is done to register the method called with moment()\\n    // without creating circular dependencies.\\n    function setHookCallback (callback) {\\n        hookCallback = callback;\\n    }\\n\\n    function isArray(input) {\\n        return input instanceof Array || Object.prototype.toString.call(input) === '[object Array]';\\n    }\\n\\n    function isDate(input) {\\n        return input instanceof Date || Object.prototype.toString.call(input) === '[object Date]';\\n    }\\n\\n    function map(arr, fn) {\\n        var res = [], i;\\n        for (i = 0; i < arr.length; ++i) {\\n            res.push(fn(arr[i], i));\\n        }\\n        return res;\\n    }\\n\\n    function hasOwnProp(a, b) {\\n        return Object.prototype.hasOwnProperty.call(a, b);\\n    }\\n\\n    function extend(a, b) {\\n        for (var i in b) {\\n            if (hasOwnProp(b, i)) {\\n                a[i] = b[i];\\n            }\\n        }\\n\\n        if (hasOwnProp(b, 'toString')) {\\n            a.toString = b.toString;\\n        }\\n\\n        if (hasOwnProp(b, 'valueOf')) {\\n            a.valueOf = b.valueOf;\\n        }\\n\\n        return a;\\n    }\\n\\n    function create_utc__createUTC (input, format, locale, strict) {\\n        return createLocalOrUTC(input, format, locale, strict, true).utc();\\n    }\\n\\n    function defaultParsingFlags() {\\n        // We need to deep clone this object.\\n        return {\\n            empty           : false,\\n            unusedTokens    : [],\\n            unusedInput     : [],\\n            overflow        : -2,\\n            charsLeftOver   : 0,\\n            nullInput       : false,\\n            invalidMonth    : null,\\n            invalidFormat   : false,\\n            userInvalidated : false,\\n            iso             : false,\\n            parsedDateParts : [],\\n            meridiem        : null\\n        };\\n    }\\n\\n    function getParsingFlags(m) {\\n        if (m._pf == null) {\\n            m._pf = defaultParsingFlags();\\n        }\\n        return m._pf;\\n    }\\n\\n    var some;\\n    if (Array.prototype.some) {\\n        some = Array.prototype.some;\\n    } else {\\n        some = function (fun) {\\n            var t = Object(this);\\n            var len = t.length >>> 0;\\n\\n            for (var i = 0; i < len; i++) {\\n                if (i in t && fun.call(this, t[i], i, t)) {\\n                    return true;\\n                }\\n            }\\n\\n            return false;\\n        };\\n    }\\n\\n    function valid__isValid(m) {\\n        if (m._isValid == null) {\\n            var flags = getParsingFlags(m);\\n            var parsedParts = some.call(flags.parsedDateParts, function (i) {\\n                return i != null;\\n            });\\n            m._isValid = !isNaN(m._d.getTime()) &&\\n                flags.overflow < 0 &&\\n                !flags.empty &&\\n                !flags.invalidMonth &&\\n                !flags.invalidWeekday &&\\n                !flags.nullInput &&\\n                !flags.invalidFormat &&\\n                !flags.userInvalidated &&\\n                (!flags.meridiem || (flags.meridiem && parsedParts));\\n\\n            if (m._strict) {\\n                m._isValid = m._isValid &&\\n                    flags.charsLeftOver === 0 &&\\n                    flags.unusedTokens.length === 0 &&\\n                    flags.bigHour === undefined;\\n            }\\n        }\\n        return m._isValid;\\n    }\\n\\n    function valid__createInvalid (flags) {\\n        var m = create_utc__createUTC(NaN);\\n        if (flags != null) {\\n            extend(getParsingFlags(m), flags);\\n        }\\n        else {\\n            getParsingFlags(m).userInvalidated = true;\\n        }\\n\\n        return m;\\n    }\\n\\n    function isUndefined(input) {\\n        return input === void 0;\\n    }\\n\\n    // Plugins that add properties should also add the key here (null value),\\n    // so we can properly clone ourselves.\\n    var momentProperties = utils_hooks__hooks.momentProperties = [];\\n\\n    function copyConfig(to, from) {\\n        var i, prop, val;\\n\\n        if (!isUndefined(from._isAMomentObject)) {\\n            to._isAMomentObject = from._isAMomentObject;\\n        }\\n        if (!isUndefined(from._i)) {\\n            to._i = from._i;\\n        }\\n        if (!isUndefined(from._f)) {\\n            to._f = from._f;\\n        }\\n        if (!isUndefined(from._l)) {\\n            to._l = from._l;\\n        }\\n        if (!isUndefined(from._strict)) {\\n            to._strict = from._strict;\\n        }\\n        if (!isUndefined(from._tzm)) {\\n            to._tzm = from._tzm;\\n        }\\n        if (!isUndefined(from._isUTC)) {\\n            to._isUTC = from._isUTC;\\n        }\\n        if (!isUndefined(from._offset)) {\\n            to._offset = from._offset;\\n        }\\n        if (!isUndefined(from._pf)) {\\n            to._pf = getParsingFlags(from);\\n        }\\n        if (!isUndefined(from._locale)) {\\n            to._locale = from._locale;\\n        }\\n\\n        if (momentProperties.length > 0) {\\n            for (i in momentProperties) {\\n                prop = momentProperties[i];\\n                val = from[prop];\\n                if (!isUndefined(val)) {\\n                    to[prop] = val;\\n                }\\n            }\\n        }\\n\\n        return to;\\n    }\\n\\n    var updateInProgress = false;\\n\\n    // Moment prototype object\\n    function Moment(config) {\\n        copyConfig(this, config);\\n        this._d = new Date(config._d != null ? config._d.getTime() : NaN);\\n        // Prevent infinite loop in case updateOffset creates new moment\\n        // objects.\\n        if (updateInProgress === false) {\\n            updateInProgress = true;\\n            utils_hooks__hooks.updateOffset(this);\\n            updateInProgress = false;\\n        }\\n    }\\n\\n    function isMoment (obj) {\\n        return obj instanceof Moment || (obj != null && obj._isAMomentObject != null);\\n    }\\n\\n    function absFloor (number) {\\n        if (number < 0) {\\n            return Math.ceil(number);\\n        } else {\\n            return Math.floor(number);\\n        }\\n    }\\n\\n    function toInt(argumentForCoercion) {\\n        var coercedNumber = +argumentForCoercion,\\n            value = 0;\\n\\n        if (coercedNumber !== 0 && isFinite(coercedNumber)) {\\n            value = absFloor(coercedNumber);\\n        }\\n\\n        return value;\\n    }\\n\\n    // compare two arrays, return the number of differences\\n    function compareArrays(array1, array2, dontConvert) {\\n        var len = Math.min(array1.length, array2.length),\\n            lengthDiff = Math.abs(array1.length - array2.length),\\n            diffs = 0,\\n            i;\\n        for (i = 0; i < len; i++) {\\n            if ((dontConvert && array1[i] !== array2[i]) ||\\n                (!dontConvert && toInt(array1[i]) !== toInt(array2[i]))) {\\n                diffs++;\\n            }\\n        }\\n        return diffs + lengthDiff;\\n    }\\n\\n    function warn(msg) {\\n        if (utils_hooks__hooks.suppressDeprecationWarnings === false &&\\n                (typeof console !==  'undefined') && console.warn) {\\n            console.warn('Deprecation warning: ' + msg);\\n        }\\n    }\\n\\n    function deprecate(msg, fn) {\\n        var firstTime = true;\\n\\n        return extend(function () {\\n            if (utils_hooks__hooks.deprecationHandler != null) {\\n                utils_hooks__hooks.deprecationHandler(null, msg);\\n            }\\n            if (firstTime) {\\n                warn(msg + '\\\\nArguments: ' + Array.prototype.slice.call(arguments).join(', ') + '\\\\n' + (new Error()).stack);\\n                firstTime = false;\\n            }\\n            return fn.apply(this, arguments);\\n        }, fn);\\n    }\\n\\n    var deprecations = {};\\n\\n    function deprecateSimple(name, msg) {\\n        if (utils_hooks__hooks.deprecationHandler != null) {\\n            utils_hooks__hooks.deprecationHandler(name, msg);\\n        }\\n        if (!deprecations[name]) {\\n            warn(msg);\\n            deprecations[name] = true;\\n        }\\n    }\\n\\n    utils_hooks__hooks.suppressDeprecationWarnings = false;\\n    utils_hooks__hooks.deprecationHandler = null;\\n\\n    function isFunction(input) {\\n        return input instanceof Function || Object.prototype.toString.call(input) === '[object Function]';\\n    }\\n\\n    function isObject(input) {\\n        return Object.prototype.toString.call(input) === '[object Object]';\\n    }\\n\\n    function locale_set__set (config) {\\n        var prop, i;\\n        for (i in config) {\\n            prop = config[i];\\n            if (isFunction(prop)) {\\n                this[i] = prop;\\n            } else {\\n                this['_' + i] = prop;\\n            }\\n        }\\n        this._config = config;\\n        // Lenient ordinal parsing accepts just a number in addition to\\n        // number + (possibly) stuff coming from _ordinalParseLenient.\\n        this._ordinalParseLenient = new RegExp(this._ordinalParse.source + '|' + (/\\\\d{1,2}/).source);\\n    }\\n\\n    function mergeConfigs(parentConfig, childConfig) {\\n        var res = extend({}, parentConfig), prop;\\n        for (prop in childConfig) {\\n            if (hasOwnProp(childConfig, prop)) {\\n                if (isObject(parentConfig[prop]) && isObject(childConfig[prop])) {\\n                    res[prop] = {};\\n                    extend(res[prop], parentConfig[prop]);\\n                    extend(res[prop], childConfig[prop]);\\n                } else if (childConfig[prop] != null) {\\n                    res[prop] = childConfig[prop];\\n                } else {\\n                    delete res[prop];\\n                }\\n            }\\n        }\\n        return res;\\n    }\\n\\n    function Locale(config) {\\n        if (config != null) {\\n            this.set(config);\\n        }\\n    }\\n\\n    var keys;\\n\\n    if (Object.keys) {\\n        keys = Object.keys;\\n    } else {\\n        keys = function (obj) {\\n            var i, res = [];\\n            for (i in obj) {\\n                if (hasOwnProp(obj, i)) {\\n                    res.push(i);\\n                }\\n            }\\n            return res;\\n        };\\n    }\\n\\n    // internal storage for locale config files\\n    var locales = {};\\n    var globalLocale;\\n\\n    function normalizeLocale(key) {\\n        return key ? key.toLowerCase().replace('_', '-') : key;\\n    }\\n\\n    // pick the locale from the array\\n    // try ['en-au', 'en-gb'] as 'en-au', 'en-gb', 'en', as in move through the list trying each\\n    // substring from most specific to least, but move to the next array item if it's a more specific variant than the current root\\n    function chooseLocale(names) {\\n        var i = 0, j, next, locale, split;\\n\\n        while (i < names.length) {\\n            split = normalizeLocale(names[i]).split('-');\\n            j = split.length;\\n            next = normalizeLocale(names[i + 1]);\\n            next = next ? next.split('-') : null;\\n            while (j > 0) {\\n                locale = loadLocale(split.slice(0, j).join('-'));\\n                if (locale) {\\n                    return locale;\\n                }\\n                if (next && next.length >= j && compareArrays(split, next, true) >= j - 1) {\\n                    //the next array item is better than a shallower substring of this one\\n                    break;\\n                }\\n                j--;\\n            }\\n            i++;\\n        }\\n        return null;\\n    }\\n\\n    function loadLocale(name) {\\n        var oldLocale = null;\\n        // TODO: Find a better way to register and load all the locales in Node\\n        if (!locales[name] && (typeof module !== 'undefined') &&\\n                module && module.exports) {\\n            try {\\n                oldLocale = globalLocale._abbr;\\n                require('./locale/' + name);\\n                // because defineLocale currently also sets the global locale, we\\n                // want to undo that for lazy loaded locales\\n                locale_locales__getSetGlobalLocale(oldLocale);\\n            } catch (e) { }\\n        }\\n        return locales[name];\\n    }\\n\\n    // This function will load locale and then set the global locale.  If\\n    // no arguments are passed in, it will simply return the current global\\n    // locale key.\\n    function locale_locales__getSetGlobalLocale (key, values) {\\n        var data;\\n        if (key) {\\n            if (isUndefined(values)) {\\n                data = locale_locales__getLocale(key);\\n            }\\n            else {\\n                data = defineLocale(key, values);\\n            }\\n\\n            if (data) {\\n                // moment.duration._locale = moment._locale = data;\\n                globalLocale = data;\\n            }\\n        }\\n\\n        return globalLocale._abbr;\\n    }\\n\\n    function defineLocale (name, config) {\\n        if (config !== null) {\\n            config.abbr = name;\\n            if (locales[name] != null) {\\n                deprecateSimple('defineLocaleOverride',\\n                        'use moment.updateLocale(localeName, config) to change ' +\\n                        'an existing locale. moment.defineLocale(localeName, ' +\\n                        'config) should only be used for creating a new locale');\\n                config = mergeConfigs(locales[name]._config, config);\\n            } else if (config.parentLocale != null) {\\n                if (locales[config.parentLocale] != null) {\\n                    config = mergeConfigs(locales[config.parentLocale]._config, config);\\n                } else {\\n                    // treat as if there is no base config\\n                    deprecateSimple('parentLocaleUndefined',\\n                            'specified parentLocale is not defined yet');\\n                }\\n            }\\n            locales[name] = new Locale(config);\\n\\n            // backwards compat for now: also set the locale\\n            locale_locales__getSetGlobalLocale(name);\\n\\n            return locales[name];\\n        } else {\\n            // useful for testing\\n            delete locales[name];\\n            return null;\\n        }\\n    }\\n\\n    function updateLocale(name, config) {\\n        if (config != null) {\\n            var locale;\\n            if (locales[name] != null) {\\n                config = mergeConfigs(locales[name]._config, config);\\n            }\\n            locale = new Locale(config);\\n            locale.parentLocale = locales[name];\\n            locales[name] = locale;\\n\\n            // backwards compat for now: also set the locale\\n            locale_locales__getSetGlobalLocale(name);\\n        } else {\\n            // pass null for config to unupdate, useful for tests\\n            if (locales[name] != null) {\\n                if (locales[name].parentLocale != null) {\\n                    locales[name] = locales[name].parentLocale;\\n                } else if (locales[name] != null) {\\n                    delete locales[name];\\n                }\\n            }\\n        }\\n        return locales[name];\\n    }\\n\\n    // returns locale data\\n    function locale_locales__getLocale (key) {\\n        var locale;\\n\\n        if (key && key._locale && key._locale._abbr) {\\n            key = key._locale._abbr;\\n        }\\n\\n        if (!key) {\\n            return globalLocale;\\n        }\\n\\n        if (!isArray(key)) {\\n            //short-circuit everything else\\n            locale = loadLocale(key);\\n            if (locale) {\\n                return locale;\\n            }\\n            key = [key];\\n        }\\n\\n        return chooseLocale(key);\\n    }\\n\\n    function locale_locales__listLocales() {\\n        return keys(locales);\\n    }\\n\\n    var aliases = {};\\n\\n    function addUnitAlias (unit, shorthand) {\\n        var lowerCase = unit.toLowerCase();\\n        aliases[lowerCase] = aliases[lowerCase + 's'] = aliases[shorthand] = unit;\\n    }\\n\\n    function normalizeUnits(units) {\\n        return typeof units === 'string' ? aliases[units] || aliases[units.toLowerCase()] : undefined;\\n    }\\n\\n    function normalizeObjectUnits(inputObject) {\\n        var normalizedInput = {},\\n            normalizedProp,\\n            prop;\\n\\n        for (prop in inputObject) {\\n            if (hasOwnProp(inputObject, prop)) {\\n                normalizedProp = normalizeUnits(prop);\\n                if (normalizedProp) {\\n                    normalizedInput[normalizedProp] = inputObject[prop];\\n                }\\n            }\\n        }\\n\\n        return normalizedInput;\\n    }\\n\\n    function makeGetSet (unit, keepTime) {\\n        return function (value) {\\n            if (value != null) {\\n                get_set__set(this, unit, value);\\n                utils_hooks__hooks.updateOffset(this, keepTime);\\n                return this;\\n            } else {\\n                return get_set__get(this, unit);\\n            }\\n        };\\n    }\\n\\n    function get_set__get (mom, unit) {\\n        return mom.isValid() ?\\n            mom._d['get' + (mom._isUTC ? 'UTC' : '') + unit]() : NaN;\\n    }\\n\\n    function get_set__set (mom, unit, value) {\\n        if (mom.isValid()) {\\n            mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](value);\\n        }\\n    }\\n\\n    // MOMENTS\\n\\n    function getSet (units, value) {\\n        var unit;\\n        if (typeof units === 'object') {\\n            for (unit in units) {\\n                this.set(unit, units[unit]);\\n            }\\n        } else {\\n            units = normalizeUnits(units);\\n            if (isFunction(this[units])) {\\n                return this[units](value);\\n            }\\n        }\\n        return this;\\n    }\\n\\n    function zeroFill(number, targetLength, forceSign) {\\n        var absNumber = '' + Math.abs(number),\\n            zerosToFill = targetLength - absNumber.length,\\n            sign = number >= 0;\\n        return (sign ? (forceSign ? '+' : '') : '-') +\\n            Math.pow(10, Math.max(0, zerosToFill)).toString().substr(1) + absNumber;\\n    }\\n\\n    var formattingTokens = /(\\\\[[^\\\\[]*\\\\])|(\\\\\\\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;\\n\\n    var localFormattingTokens = /(\\\\[[^\\\\[]*\\\\])|(\\\\\\\\)?(LTS|LT|LL?L?L?|l{1,4})/g;\\n\\n    var formatFunctions = {};\\n\\n    var formatTokenFunctions = {};\\n\\n    // token:    'M'\\n    // padded:   ['MM', 2]\\n    // ordinal:  'Mo'\\n    // callback: function () { this.month() + 1 }\\n    function addFormatToken (token, padded, ordinal, callback) {\\n        var func = callback;\\n        if (typeof callback === 'string') {\\n            func = function () {\\n                return this[callback]();\\n            };\\n        }\\n        if (token) {\\n            formatTokenFunctions[token] = func;\\n        }\\n        if (padded) {\\n            formatTokenFunctions[padded[0]] = function () {\\n                return zeroFill(func.apply(this, arguments), padded[1], padded[2]);\\n            };\\n        }\\n        if (ordinal) {\\n            formatTokenFunctions[ordinal] = function () {\\n                return this.localeData().ordinal(func.apply(this, arguments), token);\\n            };\\n        }\\n    }\\n\\n    function removeFormattingTokens(input) {\\n        if (input.match(/\\\\[[\\\\s\\\\S]/)) {\\n            return input.replace(/^\\\\[|\\\\]$/g, '');\\n        }\\n        return input.replace(/\\\\\\\\/g, '');\\n    }\\n\\n    function makeFormatFunction(format) {\\n        var array = format.match(formattingTokens), i, length;\\n\\n        for (i = 0, length = array.length; i < length; i++) {\\n            if (formatTokenFunctions[array[i]]) {\\n                array[i] = formatTokenFunctions[array[i]];\\n            } else {\\n                array[i] = removeFormattingTokens(array[i]);\\n            }\\n        }\\n\\n        return function (mom) {\\n            var output = '', i;\\n            for (i = 0; i < length; i++) {\\n                output += array[i] instanceof Function ? array[i].call(mom, format) : array[i];\\n            }\\n            return output;\\n        };\\n    }\\n\\n    // format date using native date object\\n    function formatMoment(m, format) {\\n        if (!m.isValid()) {\\n            return m.localeData().invalidDate();\\n        }\\n\\n        format = expandFormat(format, m.localeData());\\n        formatFunctions[format] = formatFunctions[format] || makeFormatFunction(format);\\n\\n        return formatFunctions[format](m);\\n    }\\n\\n    function expandFormat(format, locale) {\\n        var i = 5;\\n\\n        function replaceLongDateFormatTokens(input) {\\n            return locale.longDateFormat(input) || input;\\n        }\\n\\n        localFormattingTokens.lastIndex = 0;\\n        while (i >= 0 && localFormattingTokens.test(format)) {\\n            format = format.replace(localFormattingTokens, replaceLongDateFormatTokens);\\n            localFormattingTokens.lastIndex = 0;\\n            i -= 1;\\n        }\\n\\n        return format;\\n    }\\n\\n    var match1         = /\\\\d/;            //       0 - 9\\n    var match2         = /\\\\d\\\\d/;          //      00 - 99\\n    var match3         = /\\\\d{3}/;         //     000 - 999\\n    var match4         = /\\\\d{4}/;         //    0000 - 9999\\n    var match6         = /[+-]?\\\\d{6}/;    // -999999 - 999999\\n    var match1to2      = /\\\\d\\\\d?/;         //       0 - 99\\n    var match3to4      = /\\\\d\\\\d\\\\d\\\\d?/;     //     999 - 9999\\n    var match5to6      = /\\\\d\\\\d\\\\d\\\\d\\\\d\\\\d?/; //   99999 - 999999\\n    var match1to3      = /\\\\d{1,3}/;       //       0 - 999\\n    var match1to4      = /\\\\d{1,4}/;       //       0 - 9999\\n    var match1to6      = /[+-]?\\\\d{1,6}/;  // -999999 - 999999\\n\\n    var matchUnsigned  = /\\\\d+/;           //       0 - inf\\n    var matchSigned    = /[+-]?\\\\d+/;      //    -inf - inf\\n\\n    var matchOffset    = /Z|[+-]\\\\d\\\\d:?\\\\d\\\\d/gi; // +00:00 -00:00 +0000 -0000 or Z\\n    var matchShortOffset = /Z|[+-]\\\\d\\\\d(?::?\\\\d\\\\d)?/gi; // +00 -00 +00:00 -00:00 +0000 -0000 or Z\\n\\n    var matchTimestamp = /[+-]?\\\\d+(\\\\.\\\\d{1,3})?/; // 123456789 123456789.123\\n\\n    // any word (or two) characters or numbers including two/three word month in arabic.\\n    // includes scottish gaelic two word and hyphenated months\\n    var matchWord = /[0-9]*['a-z\\\\u00A0-\\\\u05FF\\\\u0700-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF]+|[\\\\u0600-\\\\u06FF\\\\/]+(\\\\s*?[\\\\u0600-\\\\u06FF]+){1,2}/i;\\n\\n\\n    var regexes = {};\\n\\n    function addRegexToken (token, regex, strictRegex) {\\n        regexes[token] = isFunction(regex) ? regex : function (isStrict, localeData) {\\n            return (isStrict && strictRegex) ? strictRegex : regex;\\n        };\\n    }\\n\\n    function getParseRegexForToken (token, config) {\\n        if (!hasOwnProp(regexes, token)) {\\n            return new RegExp(unescapeFormat(token));\\n        }\\n\\n        return regexes[token](config._strict, config._locale);\\n    }\\n\\n    // Code from http://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript\\n    function unescapeFormat(s) {\\n        return regexEscape(s.replace('\\\\\\\\', '').replace(/\\\\\\\\(\\\\[)|\\\\\\\\(\\\\])|\\\\[([^\\\\]\\\\[]*)\\\\]|\\\\\\\\(.)/g, function (matched, p1, p2, p3, p4) {\\n            return p1 || p2 || p3 || p4;\\n        }));\\n    }\\n\\n    function regexEscape(s) {\\n        return s.replace(/[-\\\\/\\\\\\\\^$*+?.()|[\\\\]{}]/g, '\\\\\\\\$&');\\n    }\\n\\n    var tokens = {};\\n\\n    function addParseToken (token, callback) {\\n        var i, func = callback;\\n        if (typeof token === 'string') {\\n            token = [token];\\n        }\\n        if (typeof callback === 'number') {\\n            func = function (input, array) {\\n                array[callback] = toInt(input);\\n            };\\n        }\\n        for (i = 0; i < token.length; i++) {\\n            tokens[token[i]] = func;\\n        }\\n    }\\n\\n    function addWeekParseToken (token, callback) {\\n        addParseToken(token, function (input, array, config, token) {\\n            config._w = config._w || {};\\n            callback(input, config._w, config, token);\\n        });\\n    }\\n\\n    function addTimeToArrayFromToken(token, input, config) {\\n        if (input != null && hasOwnProp(tokens, token)) {\\n            tokens[token](input, config._a, config, token);\\n        }\\n    }\\n\\n    var YEAR = 0;\\n    var MONTH = 1;\\n    var DATE = 2;\\n    var HOUR = 3;\\n    var MINUTE = 4;\\n    var SECOND = 5;\\n    var MILLISECOND = 6;\\n    var WEEK = 7;\\n    var WEEKDAY = 8;\\n\\n    var indexOf;\\n\\n    if (Array.prototype.indexOf) {\\n        indexOf = Array.prototype.indexOf;\\n    } else {\\n        indexOf = function (o) {\\n            // I know\\n            var i;\\n            for (i = 0; i < this.length; ++i) {\\n                if (this[i] === o) {\\n                    return i;\\n                }\\n            }\\n            return -1;\\n        };\\n    }\\n\\n    function daysInMonth(year, month) {\\n        return new Date(Date.UTC(year, month + 1, 0)).getUTCDate();\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('M', ['MM', 2], 'Mo', function () {\\n        return this.month() + 1;\\n    });\\n\\n    addFormatToken('MMM', 0, 0, function (format) {\\n        return this.localeData().monthsShort(this, format);\\n    });\\n\\n    addFormatToken('MMMM', 0, 0, function (format) {\\n        return this.localeData().months(this, format);\\n    });\\n\\n    // ALIASES\\n\\n    addUnitAlias('month', 'M');\\n\\n    // PARSING\\n\\n    addRegexToken('M',    match1to2);\\n    addRegexToken('MM',   match1to2, match2);\\n    addRegexToken('MMM',  function (isStrict, locale) {\\n        return locale.monthsShortRegex(isStrict);\\n    });\\n    addRegexToken('MMMM', function (isStrict, locale) {\\n        return locale.monthsRegex(isStrict);\\n    });\\n\\n    addParseToken(['M', 'MM'], function (input, array) {\\n        array[MONTH] = toInt(input) - 1;\\n    });\\n\\n    addParseToken(['MMM', 'MMMM'], function (input, array, config, token) {\\n        var month = config._locale.monthsParse(input, token, config._strict);\\n        // if we didn't find a month name, mark the date as invalid.\\n        if (month != null) {\\n            array[MONTH] = month;\\n        } else {\\n            getParsingFlags(config).invalidMonth = input;\\n        }\\n    });\\n\\n    // LOCALES\\n\\n    var MONTHS_IN_FORMAT = /D[oD]?(\\\\[[^\\\\[\\\\]]*\\\\]|\\\\s+)+MMMM?/;\\n    var defaultLocaleMonths = 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_');\\n    function localeMonths (m, format) {\\n        return isArray(this._months) ? this._months[m.month()] :\\n            this._months[MONTHS_IN_FORMAT.test(format) ? 'format' : 'standalone'][m.month()];\\n    }\\n\\n    var defaultLocaleMonthsShort = 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_');\\n    function localeMonthsShort (m, format) {\\n        return isArray(this._monthsShort) ? this._monthsShort[m.month()] :\\n            this._monthsShort[MONTHS_IN_FORMAT.test(format) ? 'format' : 'standalone'][m.month()];\\n    }\\n\\n    function units_month__handleStrictParse(monthName, format, strict) {\\n        var i, ii, mom, llc = monthName.toLocaleLowerCase();\\n        if (!this._monthsParse) {\\n            // this is not used\\n            this._monthsParse = [];\\n            this._longMonthsParse = [];\\n            this._shortMonthsParse = [];\\n            for (i = 0; i < 12; ++i) {\\n                mom = create_utc__createUTC([2000, i]);\\n                this._shortMonthsParse[i] = this.monthsShort(mom, '').toLocaleLowerCase();\\n                this._longMonthsParse[i] = this.months(mom, '').toLocaleLowerCase();\\n            }\\n        }\\n\\n        if (strict) {\\n            if (format === 'MMM') {\\n                ii = indexOf.call(this._shortMonthsParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else {\\n                ii = indexOf.call(this._longMonthsParse, llc);\\n                return ii !== -1 ? ii : null;\\n            }\\n        } else {\\n            if (format === 'MMM') {\\n                ii = indexOf.call(this._shortMonthsParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._longMonthsParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else {\\n                ii = indexOf.call(this._longMonthsParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._shortMonthsParse, llc);\\n                return ii !== -1 ? ii : null;\\n            }\\n        }\\n    }\\n\\n    function localeMonthsParse (monthName, format, strict) {\\n        var i, mom, regex;\\n\\n        if (this._monthsParseExact) {\\n            return units_month__handleStrictParse.call(this, monthName, format, strict);\\n        }\\n\\n        if (!this._monthsParse) {\\n            this._monthsParse = [];\\n            this._longMonthsParse = [];\\n            this._shortMonthsParse = [];\\n        }\\n\\n        // TODO: add sorting\\n        // Sorting makes sure if one month (or abbr) is a prefix of another\\n        // see sorting in computeMonthsParse\\n        for (i = 0; i < 12; i++) {\\n            // make the regex if we don't have it already\\n            mom = create_utc__createUTC([2000, i]);\\n            if (strict && !this._longMonthsParse[i]) {\\n                this._longMonthsParse[i] = new RegExp('^' + this.months(mom, '').replace('.', '') + '$', 'i');\\n                this._shortMonthsParse[i] = new RegExp('^' + this.monthsShort(mom, '').replace('.', '') + '$', 'i');\\n            }\\n            if (!strict && !this._monthsParse[i]) {\\n                regex = '^' + this.months(mom, '') + '|^' + this.monthsShort(mom, '');\\n                this._monthsParse[i] = new RegExp(regex.replace('.', ''), 'i');\\n            }\\n            // test the regex\\n            if (strict && format === 'MMMM' && this._longMonthsParse[i].test(monthName)) {\\n                return i;\\n            } else if (strict && format === 'MMM' && this._shortMonthsParse[i].test(monthName)) {\\n                return i;\\n            } else if (!strict && this._monthsParse[i].test(monthName)) {\\n                return i;\\n            }\\n        }\\n    }\\n\\n    // MOMENTS\\n\\n    function setMonth (mom, value) {\\n        var dayOfMonth;\\n\\n        if (!mom.isValid()) {\\n            // No op\\n            return mom;\\n        }\\n\\n        if (typeof value === 'string') {\\n            if (/^\\\\d+$/.test(value)) {\\n                value = toInt(value);\\n            } else {\\n                value = mom.localeData().monthsParse(value);\\n                // TODO: Another silent failure?\\n                if (typeof value !== 'number') {\\n                    return mom;\\n                }\\n            }\\n        }\\n\\n        dayOfMonth = Math.min(mom.date(), daysInMonth(mom.year(), value));\\n        mom._d['set' + (mom._isUTC ? 'UTC' : '') + 'Month'](value, dayOfMonth);\\n        return mom;\\n    }\\n\\n    function getSetMonth (value) {\\n        if (value != null) {\\n            setMonth(this, value);\\n            utils_hooks__hooks.updateOffset(this, true);\\n            return this;\\n        } else {\\n            return get_set__get(this, 'Month');\\n        }\\n    }\\n\\n    function getDaysInMonth () {\\n        return daysInMonth(this.year(), this.month());\\n    }\\n\\n    var defaultMonthsShortRegex = matchWord;\\n    function monthsShortRegex (isStrict) {\\n        if (this._monthsParseExact) {\\n            if (!hasOwnProp(this, '_monthsRegex')) {\\n                computeMonthsParse.call(this);\\n            }\\n            if (isStrict) {\\n                return this._monthsShortStrictRegex;\\n            } else {\\n                return this._monthsShortRegex;\\n            }\\n        } else {\\n            return this._monthsShortStrictRegex && isStrict ?\\n                this._monthsShortStrictRegex : this._monthsShortRegex;\\n        }\\n    }\\n\\n    var defaultMonthsRegex = matchWord;\\n    function monthsRegex (isStrict) {\\n        if (this._monthsParseExact) {\\n            if (!hasOwnProp(this, '_monthsRegex')) {\\n                computeMonthsParse.call(this);\\n            }\\n            if (isStrict) {\\n                return this._monthsStrictRegex;\\n            } else {\\n                return this._monthsRegex;\\n            }\\n        } else {\\n            return this._monthsStrictRegex && isStrict ?\\n                this._monthsStrictRegex : this._monthsRegex;\\n        }\\n    }\\n\\n    function computeMonthsParse () {\\n        function cmpLenRev(a, b) {\\n            return b.length - a.length;\\n        }\\n\\n        var shortPieces = [], longPieces = [], mixedPieces = [],\\n            i, mom;\\n        for (i = 0; i < 12; i++) {\\n            // make the regex if we don't have it already\\n            mom = create_utc__createUTC([2000, i]);\\n            shortPieces.push(this.monthsShort(mom, ''));\\n            longPieces.push(this.months(mom, ''));\\n            mixedPieces.push(this.months(mom, ''));\\n            mixedPieces.push(this.monthsShort(mom, ''));\\n        }\\n        // Sorting makes sure if one month (or abbr) is a prefix of another it\\n        // will match the longer piece.\\n        shortPieces.sort(cmpLenRev);\\n        longPieces.sort(cmpLenRev);\\n        mixedPieces.sort(cmpLenRev);\\n        for (i = 0; i < 12; i++) {\\n            shortPieces[i] = regexEscape(shortPieces[i]);\\n            longPieces[i] = regexEscape(longPieces[i]);\\n            mixedPieces[i] = regexEscape(mixedPieces[i]);\\n        }\\n\\n        this._monthsRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');\\n        this._monthsShortRegex = this._monthsRegex;\\n        this._monthsStrictRegex = new RegExp('^(' + longPieces.join('|') + ')', 'i');\\n        this._monthsShortStrictRegex = new RegExp('^(' + shortPieces.join('|') + ')', 'i');\\n    }\\n\\n    function checkOverflow (m) {\\n        var overflow;\\n        var a = m._a;\\n\\n        if (a && getParsingFlags(m).overflow === -2) {\\n            overflow =\\n                a[MONTH]       < 0 || a[MONTH]       > 11  ? MONTH :\\n                a[DATE]        < 1 || a[DATE]        > daysInMonth(a[YEAR], a[MONTH]) ? DATE :\\n                a[HOUR]        < 0 || a[HOUR]        > 24 || (a[HOUR] === 24 && (a[MINUTE] !== 0 || a[SECOND] !== 0 || a[MILLISECOND] !== 0)) ? HOUR :\\n                a[MINUTE]      < 0 || a[MINUTE]      > 59  ? MINUTE :\\n                a[SECOND]      < 0 || a[SECOND]      > 59  ? SECOND :\\n                a[MILLISECOND] < 0 || a[MILLISECOND] > 999 ? MILLISECOND :\\n                -1;\\n\\n            if (getParsingFlags(m)._overflowDayOfYear && (overflow < YEAR || overflow > DATE)) {\\n                overflow = DATE;\\n            }\\n            if (getParsingFlags(m)._overflowWeeks && overflow === -1) {\\n                overflow = WEEK;\\n            }\\n            if (getParsingFlags(m)._overflowWeekday && overflow === -1) {\\n                overflow = WEEKDAY;\\n            }\\n\\n            getParsingFlags(m).overflow = overflow;\\n        }\\n\\n        return m;\\n    }\\n\\n    // iso 8601 regex\\n    // 0000-00-00 0000-W00 or 0000-W00-0 + T + 00 or 00:00 or 00:00:00 or 00:00:00.000 + +00:00 or +0000 or +00)\\n    var extendedIsoRegex = /^\\\\s*((?:[+-]\\\\d{6}|\\\\d{4})-(?:\\\\d\\\\d-\\\\d\\\\d|W\\\\d\\\\d-\\\\d|W\\\\d\\\\d|\\\\d\\\\d\\\\d|\\\\d\\\\d))(?:(T| )(\\\\d\\\\d(?::\\\\d\\\\d(?::\\\\d\\\\d(?:[.,]\\\\d+)?)?)?)([\\\\+\\\\-]\\\\d\\\\d(?::?\\\\d\\\\d)?|\\\\s*Z)?)?/;\\n    var basicIsoRegex = /^\\\\s*((?:[+-]\\\\d{6}|\\\\d{4})(?:\\\\d\\\\d\\\\d\\\\d|W\\\\d\\\\d\\\\d|W\\\\d\\\\d|\\\\d\\\\d\\\\d|\\\\d\\\\d))(?:(T| )(\\\\d\\\\d(?:\\\\d\\\\d(?:\\\\d\\\\d(?:[.,]\\\\d+)?)?)?)([\\\\+\\\\-]\\\\d\\\\d(?::?\\\\d\\\\d)?|\\\\s*Z)?)?/;\\n\\n    var tzRegex = /Z|[+-]\\\\d\\\\d(?::?\\\\d\\\\d)?/;\\n\\n    var isoDates = [\\n        ['YYYYYY-MM-DD', /[+-]\\\\d{6}-\\\\d\\\\d-\\\\d\\\\d/],\\n        ['YYYY-MM-DD', /\\\\d{4}-\\\\d\\\\d-\\\\d\\\\d/],\\n        ['GGGG-[W]WW-E', /\\\\d{4}-W\\\\d\\\\d-\\\\d/],\\n        ['GGGG-[W]WW', /\\\\d{4}-W\\\\d\\\\d/, false],\\n        ['YYYY-DDD', /\\\\d{4}-\\\\d{3}/],\\n        ['YYYY-MM', /\\\\d{4}-\\\\d\\\\d/, false],\\n        ['YYYYYYMMDD', /[+-]\\\\d{10}/],\\n        ['YYYYMMDD', /\\\\d{8}/],\\n        // YYYYMM is NOT allowed by the standard\\n        ['GGGG[W]WWE', /\\\\d{4}W\\\\d{3}/],\\n        ['GGGG[W]WW', /\\\\d{4}W\\\\d{2}/, false],\\n        ['YYYYDDD', /\\\\d{7}/]\\n    ];\\n\\n    // iso time formats and regexes\\n    var isoTimes = [\\n        ['HH:mm:ss.SSSS', /\\\\d\\\\d:\\\\d\\\\d:\\\\d\\\\d\\\\.\\\\d+/],\\n        ['HH:mm:ss,SSSS', /\\\\d\\\\d:\\\\d\\\\d:\\\\d\\\\d,\\\\d+/],\\n        ['HH:mm:ss', /\\\\d\\\\d:\\\\d\\\\d:\\\\d\\\\d/],\\n        ['HH:mm', /\\\\d\\\\d:\\\\d\\\\d/],\\n        ['HHmmss.SSSS', /\\\\d\\\\d\\\\d\\\\d\\\\d\\\\d\\\\.\\\\d+/],\\n        ['HHmmss,SSSS', /\\\\d\\\\d\\\\d\\\\d\\\\d\\\\d,\\\\d+/],\\n        ['HHmmss', /\\\\d\\\\d\\\\d\\\\d\\\\d\\\\d/],\\n        ['HHmm', /\\\\d\\\\d\\\\d\\\\d/],\\n        ['HH', /\\\\d\\\\d/]\\n    ];\\n\\n    var aspNetJsonRegex = /^\\\\/?Date\\\\((\\\\-?\\\\d+)/i;\\n\\n    // date from iso format\\n    function configFromISO(config) {\\n        var i, l,\\n            string = config._i,\\n            match = extendedIsoRegex.exec(string) || basicIsoRegex.exec(string),\\n            allowTime, dateFormat, timeFormat, tzFormat;\\n\\n        if (match) {\\n            getParsingFlags(config).iso = true;\\n\\n            for (i = 0, l = isoDates.length; i < l; i++) {\\n                if (isoDates[i][1].exec(match[1])) {\\n                    dateFormat = isoDates[i][0];\\n                    allowTime = isoDates[i][2] !== false;\\n                    break;\\n                }\\n            }\\n            if (dateFormat == null) {\\n                config._isValid = false;\\n                return;\\n            }\\n            if (match[3]) {\\n                for (i = 0, l = isoTimes.length; i < l; i++) {\\n                    if (isoTimes[i][1].exec(match[3])) {\\n                        // match[2] should be 'T' or space\\n                        timeFormat = (match[2] || ' ') + isoTimes[i][0];\\n                        break;\\n                    }\\n                }\\n                if (timeFormat == null) {\\n                    config._isValid = false;\\n                    return;\\n                }\\n            }\\n            if (!allowTime && timeFormat != null) {\\n                config._isValid = false;\\n                return;\\n            }\\n            if (match[4]) {\\n                if (tzRegex.exec(match[4])) {\\n                    tzFormat = 'Z';\\n                } else {\\n                    config._isValid = false;\\n                    return;\\n                }\\n            }\\n            config._f = dateFormat + (timeFormat || '') + (tzFormat || '');\\n            configFromStringAndFormat(config);\\n        } else {\\n            config._isValid = false;\\n        }\\n    }\\n\\n    // date from iso format or fallback\\n    function configFromString(config) {\\n        var matched = aspNetJsonRegex.exec(config._i);\\n\\n        if (matched !== null) {\\n            config._d = new Date(+matched[1]);\\n            return;\\n        }\\n\\n        configFromISO(config);\\n        if (config._isValid === false) {\\n            delete config._isValid;\\n            utils_hooks__hooks.createFromInputFallback(config);\\n        }\\n    }\\n\\n    utils_hooks__hooks.createFromInputFallback = deprecate(\\n        'moment construction falls back to js Date. This is ' +\\n        'discouraged and will be removed in upcoming major ' +\\n        'release. Please refer to ' +\\n        'https://github.com/moment/moment/issues/1407 for more info.',\\n        function (config) {\\n            config._d = new Date(config._i + (config._useUTC ? ' UTC' : ''));\\n        }\\n    );\\n\\n    function createDate (y, m, d, h, M, s, ms) {\\n        //can't just apply() to create a date:\\n        //http://stackoverflow.com/questions/181348/instantiating-a-javascript-object-by-calling-prototype-constructor-apply\\n        var date = new Date(y, m, d, h, M, s, ms);\\n\\n        //the date constructor remaps years 0-99 to 1900-1999\\n        if (y < 100 && y >= 0 && isFinite(date.getFullYear())) {\\n            date.setFullYear(y);\\n        }\\n        return date;\\n    }\\n\\n    function createUTCDate (y) {\\n        var date = new Date(Date.UTC.apply(null, arguments));\\n\\n        //the Date.UTC function remaps years 0-99 to 1900-1999\\n        if (y < 100 && y >= 0 && isFinite(date.getUTCFullYear())) {\\n            date.setUTCFullYear(y);\\n        }\\n        return date;\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('Y', 0, 0, function () {\\n        var y = this.year();\\n        return y <= 9999 ? '' + y : '+' + y;\\n    });\\n\\n    addFormatToken(0, ['YY', 2], 0, function () {\\n        return this.year() % 100;\\n    });\\n\\n    addFormatToken(0, ['YYYY',   4],       0, 'year');\\n    addFormatToken(0, ['YYYYY',  5],       0, 'year');\\n    addFormatToken(0, ['YYYYYY', 6, true], 0, 'year');\\n\\n    // ALIASES\\n\\n    addUnitAlias('year', 'y');\\n\\n    // PARSING\\n\\n    addRegexToken('Y',      matchSigned);\\n    addRegexToken('YY',     match1to2, match2);\\n    addRegexToken('YYYY',   match1to4, match4);\\n    addRegexToken('YYYYY',  match1to6, match6);\\n    addRegexToken('YYYYYY', match1to6, match6);\\n\\n    addParseToken(['YYYYY', 'YYYYYY'], YEAR);\\n    addParseToken('YYYY', function (input, array) {\\n        array[YEAR] = input.length === 2 ? utils_hooks__hooks.parseTwoDigitYear(input) : toInt(input);\\n    });\\n    addParseToken('YY', function (input, array) {\\n        array[YEAR] = utils_hooks__hooks.parseTwoDigitYear(input);\\n    });\\n    addParseToken('Y', function (input, array) {\\n        array[YEAR] = parseInt(input, 10);\\n    });\\n\\n    // HELPERS\\n\\n    function daysInYear(year) {\\n        return isLeapYear(year) ? 366 : 365;\\n    }\\n\\n    function isLeapYear(year) {\\n        return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;\\n    }\\n\\n    // HOOKS\\n\\n    utils_hooks__hooks.parseTwoDigitYear = function (input) {\\n        return toInt(input) + (toInt(input) > 68 ? 1900 : 2000);\\n    };\\n\\n    // MOMENTS\\n\\n    var getSetYear = makeGetSet('FullYear', true);\\n\\n    function getIsLeapYear () {\\n        return isLeapYear(this.year());\\n    }\\n\\n    // start-of-first-week - start-of-year\\n    function firstWeekOffset(year, dow, doy) {\\n        var // first-week day -- which january is always in the first week (4 for iso, 1 for other)\\n            fwd = 7 + dow - doy,\\n            // first-week day local weekday -- which local weekday is fwd\\n            fwdlw = (7 + createUTCDate(year, 0, fwd).getUTCDay() - dow) % 7;\\n\\n        return -fwdlw + fwd - 1;\\n    }\\n\\n    //http://en.wikipedia.org/wiki/ISO_week_date#Calculating_a_date_given_the_year.2C_week_number_and_weekday\\n    function dayOfYearFromWeeks(year, week, weekday, dow, doy) {\\n        var localWeekday = (7 + weekday - dow) % 7,\\n            weekOffset = firstWeekOffset(year, dow, doy),\\n            dayOfYear = 1 + 7 * (week - 1) + localWeekday + weekOffset,\\n            resYear, resDayOfYear;\\n\\n        if (dayOfYear <= 0) {\\n            resYear = year - 1;\\n            resDayOfYear = daysInYear(resYear) + dayOfYear;\\n        } else if (dayOfYear > daysInYear(year)) {\\n            resYear = year + 1;\\n            resDayOfYear = dayOfYear - daysInYear(year);\\n        } else {\\n            resYear = year;\\n            resDayOfYear = dayOfYear;\\n        }\\n\\n        return {\\n            year: resYear,\\n            dayOfYear: resDayOfYear\\n        };\\n    }\\n\\n    function weekOfYear(mom, dow, doy) {\\n        var weekOffset = firstWeekOffset(mom.year(), dow, doy),\\n            week = Math.floor((mom.dayOfYear() - weekOffset - 1) / 7) + 1,\\n            resWeek, resYear;\\n\\n        if (week < 1) {\\n            resYear = mom.year() - 1;\\n            resWeek = week + weeksInYear(resYear, dow, doy);\\n        } else if (week > weeksInYear(mom.year(), dow, doy)) {\\n            resWeek = week - weeksInYear(mom.year(), dow, doy);\\n            resYear = mom.year() + 1;\\n        } else {\\n            resYear = mom.year();\\n            resWeek = week;\\n        }\\n\\n        return {\\n            week: resWeek,\\n            year: resYear\\n        };\\n    }\\n\\n    function weeksInYear(year, dow, doy) {\\n        var weekOffset = firstWeekOffset(year, dow, doy),\\n            weekOffsetNext = firstWeekOffset(year + 1, dow, doy);\\n        return (daysInYear(year) - weekOffset + weekOffsetNext) / 7;\\n    }\\n\\n    // Pick the first defined of two or three arguments.\\n    function defaults(a, b, c) {\\n        if (a != null) {\\n            return a;\\n        }\\n        if (b != null) {\\n            return b;\\n        }\\n        return c;\\n    }\\n\\n    function currentDateArray(config) {\\n        // hooks is actually the exported moment object\\n        var nowValue = new Date(utils_hooks__hooks.now());\\n        if (config._useUTC) {\\n            return [nowValue.getUTCFullYear(), nowValue.getUTCMonth(), nowValue.getUTCDate()];\\n        }\\n        return [nowValue.getFullYear(), nowValue.getMonth(), nowValue.getDate()];\\n    }\\n\\n    // convert an array to a date.\\n    // the array should mirror the parameters below\\n    // note: all values past the year are optional and will default to the lowest possible value.\\n    // [year, month, day , hour, minute, second, millisecond]\\n    function configFromArray (config) {\\n        var i, date, input = [], currentDate, yearToUse;\\n\\n        if (config._d) {\\n            return;\\n        }\\n\\n        currentDate = currentDateArray(config);\\n\\n        //compute day of the year from weeks and weekdays\\n        if (config._w && config._a[DATE] == null && config._a[MONTH] == null) {\\n            dayOfYearFromWeekInfo(config);\\n        }\\n\\n        //if the day of the year is set, figure out what it is\\n        if (config._dayOfYear) {\\n            yearToUse = defaults(config._a[YEAR], currentDate[YEAR]);\\n\\n            if (config._dayOfYear > daysInYear(yearToUse)) {\\n                getParsingFlags(config)._overflowDayOfYear = true;\\n            }\\n\\n            date = createUTCDate(yearToUse, 0, config._dayOfYear);\\n            config._a[MONTH] = date.getUTCMonth();\\n            config._a[DATE] = date.getUTCDate();\\n        }\\n\\n        // Default to current date.\\n        // * if no year, month, day of month are given, default to today\\n        // * if day of month is given, default month and year\\n        // * if month is given, default only year\\n        // * if year is given, don't default anything\\n        for (i = 0; i < 3 && config._a[i] == null; ++i) {\\n            config._a[i] = input[i] = currentDate[i];\\n        }\\n\\n        // Zero out whatever was not defaulted, including time\\n        for (; i < 7; i++) {\\n            config._a[i] = input[i] = (config._a[i] == null) ? (i === 2 ? 1 : 0) : config._a[i];\\n        }\\n\\n        // Check for 24:00:00.000\\n        if (config._a[HOUR] === 24 &&\\n                config._a[MINUTE] === 0 &&\\n                config._a[SECOND] === 0 &&\\n                config._a[MILLISECOND] === 0) {\\n            config._nextDay = true;\\n            config._a[HOUR] = 0;\\n        }\\n\\n        config._d = (config._useUTC ? createUTCDate : createDate).apply(null, input);\\n        // Apply timezone offset from input. The actual utcOffset can be changed\\n        // with parseZone.\\n        if (config._tzm != null) {\\n            config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);\\n        }\\n\\n        if (config._nextDay) {\\n            config._a[HOUR] = 24;\\n        }\\n    }\\n\\n    function dayOfYearFromWeekInfo(config) {\\n        var w, weekYear, week, weekday, dow, doy, temp, weekdayOverflow;\\n\\n        w = config._w;\\n        if (w.GG != null || w.W != null || w.E != null) {\\n            dow = 1;\\n            doy = 4;\\n\\n            // TODO: We need to take the current isoWeekYear, but that depends on\\n            // how we interpret now (local, utc, fixed offset). So create\\n            // a now version of current config (take local/utc/offset flags, and\\n            // create now).\\n            weekYear = defaults(w.GG, config._a[YEAR], weekOfYear(local__createLocal(), 1, 4).year);\\n            week = defaults(w.W, 1);\\n            weekday = defaults(w.E, 1);\\n            if (weekday < 1 || weekday > 7) {\\n                weekdayOverflow = true;\\n            }\\n        } else {\\n            dow = config._locale._week.dow;\\n            doy = config._locale._week.doy;\\n\\n            weekYear = defaults(w.gg, config._a[YEAR], weekOfYear(local__createLocal(), dow, doy).year);\\n            week = defaults(w.w, 1);\\n\\n            if (w.d != null) {\\n                // weekday -- low day numbers are considered next week\\n                weekday = w.d;\\n                if (weekday < 0 || weekday > 6) {\\n                    weekdayOverflow = true;\\n                }\\n            } else if (w.e != null) {\\n                // local weekday -- counting starts from begining of week\\n                weekday = w.e + dow;\\n                if (w.e < 0 || w.e > 6) {\\n                    weekdayOverflow = true;\\n                }\\n            } else {\\n                // default to begining of week\\n                weekday = dow;\\n            }\\n        }\\n        if (week < 1 || week > weeksInYear(weekYear, dow, doy)) {\\n            getParsingFlags(config)._overflowWeeks = true;\\n        } else if (weekdayOverflow != null) {\\n            getParsingFlags(config)._overflowWeekday = true;\\n        } else {\\n            temp = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy);\\n            config._a[YEAR] = temp.year;\\n            config._dayOfYear = temp.dayOfYear;\\n        }\\n    }\\n\\n    // constant that refers to the ISO standard\\n    utils_hooks__hooks.ISO_8601 = function () {};\\n\\n    // date from string and format string\\n    function configFromStringAndFormat(config) {\\n        // TODO: Move this to another part of the creation flow to prevent circular deps\\n        if (config._f === utils_hooks__hooks.ISO_8601) {\\n            configFromISO(config);\\n            return;\\n        }\\n\\n        config._a = [];\\n        getParsingFlags(config).empty = true;\\n\\n        // This array is used to make a Date, either with `new Date` or `Date.UTC`\\n        var string = '' + config._i,\\n            i, parsedInput, tokens, token, skipped,\\n            stringLength = string.length,\\n            totalParsedInputLength = 0;\\n\\n        tokens = expandFormat(config._f, config._locale).match(formattingTokens) || [];\\n\\n        for (i = 0; i < tokens.length; i++) {\\n            token = tokens[i];\\n            parsedInput = (string.match(getParseRegexForToken(token, config)) || [])[0];\\n            // console.log('token', token, 'parsedInput', parsedInput,\\n            //         'regex', getParseRegexForToken(token, config));\\n            if (parsedInput) {\\n                skipped = string.substr(0, string.indexOf(parsedInput));\\n                if (skipped.length > 0) {\\n                    getParsingFlags(config).unusedInput.push(skipped);\\n                }\\n                string = string.slice(string.indexOf(parsedInput) + parsedInput.length);\\n                totalParsedInputLength += parsedInput.length;\\n            }\\n            // don't parse if it's not a known token\\n            if (formatTokenFunctions[token]) {\\n                if (parsedInput) {\\n                    getParsingFlags(config).empty = false;\\n                }\\n                else {\\n                    getParsingFlags(config).unusedTokens.push(token);\\n                }\\n                addTimeToArrayFromToken(token, parsedInput, config);\\n            }\\n            else if (config._strict && !parsedInput) {\\n                getParsingFlags(config).unusedTokens.push(token);\\n            }\\n        }\\n\\n        // add remaining unparsed input length to the string\\n        getParsingFlags(config).charsLeftOver = stringLength - totalParsedInputLength;\\n        if (string.length > 0) {\\n            getParsingFlags(config).unusedInput.push(string);\\n        }\\n\\n        // clear _12h flag if hour is <= 12\\n        if (getParsingFlags(config).bigHour === true &&\\n                config._a[HOUR] <= 12 &&\\n                config._a[HOUR] > 0) {\\n            getParsingFlags(config).bigHour = undefined;\\n        }\\n\\n        getParsingFlags(config).parsedDateParts = config._a.slice(0);\\n        getParsingFlags(config).meridiem = config._meridiem;\\n        // handle meridiem\\n        config._a[HOUR] = meridiemFixWrap(config._locale, config._a[HOUR], config._meridiem);\\n\\n        configFromArray(config);\\n        checkOverflow(config);\\n    }\\n\\n\\n    function meridiemFixWrap (locale, hour, meridiem) {\\n        var isPm;\\n\\n        if (meridiem == null) {\\n            // nothing to do\\n            return hour;\\n        }\\n        if (locale.meridiemHour != null) {\\n            return locale.meridiemHour(hour, meridiem);\\n        } else if (locale.isPM != null) {\\n            // Fallback\\n            isPm = locale.isPM(meridiem);\\n            if (isPm && hour < 12) {\\n                hour += 12;\\n            }\\n            if (!isPm && hour === 12) {\\n                hour = 0;\\n            }\\n            return hour;\\n        } else {\\n            // this is not supposed to happen\\n            return hour;\\n        }\\n    }\\n\\n    // date from string and array of format strings\\n    function configFromStringAndArray(config) {\\n        var tempConfig,\\n            bestMoment,\\n\\n            scoreToBeat,\\n            i,\\n            currentScore;\\n\\n        if (config._f.length === 0) {\\n            getParsingFlags(config).invalidFormat = true;\\n            config._d = new Date(NaN);\\n            return;\\n        }\\n\\n        for (i = 0; i < config._f.length; i++) {\\n            currentScore = 0;\\n            tempConfig = copyConfig({}, config);\\n            if (config._useUTC != null) {\\n                tempConfig._useUTC = config._useUTC;\\n            }\\n            tempConfig._f = config._f[i];\\n            configFromStringAndFormat(tempConfig);\\n\\n            if (!valid__isValid(tempConfig)) {\\n                continue;\\n            }\\n\\n            // if there is any input that was not parsed add a penalty for that format\\n            currentScore += getParsingFlags(tempConfig).charsLeftOver;\\n\\n            //or tokens\\n            currentScore += getParsingFlags(tempConfig).unusedTokens.length * 10;\\n\\n            getParsingFlags(tempConfig).score = currentScore;\\n\\n            if (scoreToBeat == null || currentScore < scoreToBeat) {\\n                scoreToBeat = currentScore;\\n                bestMoment = tempConfig;\\n            }\\n        }\\n\\n        extend(config, bestMoment || tempConfig);\\n    }\\n\\n    function configFromObject(config) {\\n        if (config._d) {\\n            return;\\n        }\\n\\n        var i = normalizeObjectUnits(config._i);\\n        config._a = map([i.year, i.month, i.day || i.date, i.hour, i.minute, i.second, i.millisecond], function (obj) {\\n            return obj && parseInt(obj, 10);\\n        });\\n\\n        configFromArray(config);\\n    }\\n\\n    function createFromConfig (config) {\\n        var res = new Moment(checkOverflow(prepareConfig(config)));\\n        if (res._nextDay) {\\n            // Adding is smart enough around DST\\n            res.add(1, 'd');\\n            res._nextDay = undefined;\\n        }\\n\\n        return res;\\n    }\\n\\n    function prepareConfig (config) {\\n        var input = config._i,\\n            format = config._f;\\n\\n        config._locale = config._locale || locale_locales__getLocale(config._l);\\n\\n        if (input === null || (format === undefined && input === '')) {\\n            return valid__createInvalid({nullInput: true});\\n        }\\n\\n        if (typeof input === 'string') {\\n            config._i = input = config._locale.preparse(input);\\n        }\\n\\n        if (isMoment(input)) {\\n            return new Moment(checkOverflow(input));\\n        } else if (isArray(format)) {\\n            configFromStringAndArray(config);\\n        } else if (format) {\\n            configFromStringAndFormat(config);\\n        } else if (isDate(input)) {\\n            config._d = input;\\n        } else {\\n            configFromInput(config);\\n        }\\n\\n        if (!valid__isValid(config)) {\\n            config._d = null;\\n        }\\n\\n        return config;\\n    }\\n\\n    function configFromInput(config) {\\n        var input = config._i;\\n        if (input === undefined) {\\n            config._d = new Date(utils_hooks__hooks.now());\\n        } else if (isDate(input)) {\\n            config._d = new Date(input.valueOf());\\n        } else if (typeof input === 'string') {\\n            configFromString(config);\\n        } else if (isArray(input)) {\\n            config._a = map(input.slice(0), function (obj) {\\n                return parseInt(obj, 10);\\n            });\\n            configFromArray(config);\\n        } else if (typeof(input) === 'object') {\\n            configFromObject(config);\\n        } else if (typeof(input) === 'number') {\\n            // from milliseconds\\n            config._d = new Date(input);\\n        } else {\\n            utils_hooks__hooks.createFromInputFallback(config);\\n        }\\n    }\\n\\n    function createLocalOrUTC (input, format, locale, strict, isUTC) {\\n        var c = {};\\n\\n        if (typeof(locale) === 'boolean') {\\n            strict = locale;\\n            locale = undefined;\\n        }\\n        // object construction must be done this way.\\n        // https://github.com/moment/moment/issues/1423\\n        c._isAMomentObject = true;\\n        c._useUTC = c._isUTC = isUTC;\\n        c._l = locale;\\n        c._i = input;\\n        c._f = format;\\n        c._strict = strict;\\n\\n        return createFromConfig(c);\\n    }\\n\\n    function local__createLocal (input, format, locale, strict) {\\n        return createLocalOrUTC(input, format, locale, strict, false);\\n    }\\n\\n    var prototypeMin = deprecate(\\n         'moment().min is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548',\\n         function () {\\n             var other = local__createLocal.apply(null, arguments);\\n             if (this.isValid() && other.isValid()) {\\n                 return other < this ? this : other;\\n             } else {\\n                 return valid__createInvalid();\\n             }\\n         }\\n     );\\n\\n    var prototypeMax = deprecate(\\n        'moment().max is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548',\\n        function () {\\n            var other = local__createLocal.apply(null, arguments);\\n            if (this.isValid() && other.isValid()) {\\n                return other > this ? this : other;\\n            } else {\\n                return valid__createInvalid();\\n            }\\n        }\\n    );\\n\\n    // Pick a moment m from moments so that m[fn](other) is true for all\\n    // other. This relies on the function fn to be transitive.\\n    //\\n    // moments should either be an array of moment objects or an array, whose\\n    // first element is an array of moment objects.\\n    function pickBy(fn, moments) {\\n        var res, i;\\n        if (moments.length === 1 && isArray(moments[0])) {\\n            moments = moments[0];\\n        }\\n        if (!moments.length) {\\n            return local__createLocal();\\n        }\\n        res = moments[0];\\n        for (i = 1; i < moments.length; ++i) {\\n            if (!moments[i].isValid() || moments[i][fn](res)) {\\n                res = moments[i];\\n            }\\n        }\\n        return res;\\n    }\\n\\n    // TODO: Use [].sort instead?\\n    function min () {\\n        var args = [].slice.call(arguments, 0);\\n\\n        return pickBy('isBefore', args);\\n    }\\n\\n    function max () {\\n        var args = [].slice.call(arguments, 0);\\n\\n        return pickBy('isAfter', args);\\n    }\\n\\n    var now = function () {\\n        return Date.now ? Date.now() : +(new Date());\\n    };\\n\\n    function Duration (duration) {\\n        var normalizedInput = normalizeObjectUnits(duration),\\n            years = normalizedInput.year || 0,\\n            quarters = normalizedInput.quarter || 0,\\n            months = normalizedInput.month || 0,\\n            weeks = normalizedInput.week || 0,\\n            days = normalizedInput.day || 0,\\n            hours = normalizedInput.hour || 0,\\n            minutes = normalizedInput.minute || 0,\\n            seconds = normalizedInput.second || 0,\\n            milliseconds = normalizedInput.millisecond || 0;\\n\\n        // representation for dateAddRemove\\n        this._milliseconds = +milliseconds +\\n            seconds * 1e3 + // 1000\\n            minutes * 6e4 + // 1000 * 60\\n            hours * 1000 * 60 * 60; //using 1000 * 60 * 60 instead of 36e5 to avoid floating point rounding errors https://github.com/moment/moment/issues/2978\\n        // Because of dateAddRemove treats 24 hours as different from a\\n        // day when working around DST, we need to store them separately\\n        this._days = +days +\\n            weeks * 7;\\n        // It is impossible translate months into days without knowing\\n        // which months you are are talking about, so we have to store\\n        // it separately.\\n        this._months = +months +\\n            quarters * 3 +\\n            years * 12;\\n\\n        this._data = {};\\n\\n        this._locale = locale_locales__getLocale();\\n\\n        this._bubble();\\n    }\\n\\n    function isDuration (obj) {\\n        return obj instanceof Duration;\\n    }\\n\\n    // FORMATTING\\n\\n    function offset (token, separator) {\\n        addFormatToken(token, 0, 0, function () {\\n            var offset = this.utcOffset();\\n            var sign = '+';\\n            if (offset < 0) {\\n                offset = -offset;\\n                sign = '-';\\n            }\\n            return sign + zeroFill(~~(offset / 60), 2) + separator + zeroFill(~~(offset) % 60, 2);\\n        });\\n    }\\n\\n    offset('Z', ':');\\n    offset('ZZ', '');\\n\\n    // PARSING\\n\\n    addRegexToken('Z',  matchShortOffset);\\n    addRegexToken('ZZ', matchShortOffset);\\n    addParseToken(['Z', 'ZZ'], function (input, array, config) {\\n        config._useUTC = true;\\n        config._tzm = offsetFromString(matchShortOffset, input);\\n    });\\n\\n    // HELPERS\\n\\n    // timezone chunker\\n    // '+10:00' > ['10',  '00']\\n    // '-1530'  > ['-15', '30']\\n    var chunkOffset = /([\\\\+\\\\-]|\\\\d\\\\d)/gi;\\n\\n    function offsetFromString(matcher, string) {\\n        var matches = ((string || '').match(matcher) || []);\\n        var chunk   = matches[matches.length - 1] || [];\\n        var parts   = (chunk + '').match(chunkOffset) || ['-', 0, 0];\\n        var minutes = +(parts[1] * 60) + toInt(parts[2]);\\n\\n        return parts[0] === '+' ? minutes : -minutes;\\n    }\\n\\n    // Return a moment from input, that is local/utc/zone equivalent to model.\\n    function cloneWithOffset(input, model) {\\n        var res, diff;\\n        if (model._isUTC) {\\n            res = model.clone();\\n            diff = (isMoment(input) || isDate(input) ? input.valueOf() : local__createLocal(input).valueOf()) - res.valueOf();\\n            // Use low-level api, because this fn is low-level api.\\n            res._d.setTime(res._d.valueOf() + diff);\\n            utils_hooks__hooks.updateOffset(res, false);\\n            return res;\\n        } else {\\n            return local__createLocal(input).local();\\n        }\\n    }\\n\\n    function getDateOffset (m) {\\n        // On Firefox.24 Date#getTimezoneOffset returns a floating point.\\n        // https://github.com/moment/moment/pull/1871\\n        return -Math.round(m._d.getTimezoneOffset() / 15) * 15;\\n    }\\n\\n    // HOOKS\\n\\n    // This function will be called whenever a moment is mutated.\\n    // It is intended to keep the offset in sync with the timezone.\\n    utils_hooks__hooks.updateOffset = function () {};\\n\\n    // MOMENTS\\n\\n    // keepLocalTime = true means only change the timezone, without\\n    // affecting the local hour. So 5:31:26 +0300 --[utcOffset(2, true)]-->\\n    // 5:31:26 +0200 It is possible that 5:31:26 doesn't exist with offset\\n    // +0200, so we adjust the time as needed, to be valid.\\n    //\\n    // Keeping the time actually adds/subtracts (one hour)\\n    // from the actual represented time. That is why we call updateOffset\\n    // a second time. In case it wants us to change the offset again\\n    // _changeInProgress == true case, then we have to adjust, because\\n    // there is no such time in the given timezone.\\n    function getSetOffset (input, keepLocalTime) {\\n        var offset = this._offset || 0,\\n            localAdjust;\\n        if (!this.isValid()) {\\n            return input != null ? this : NaN;\\n        }\\n        if (input != null) {\\n            if (typeof input === 'string') {\\n                input = offsetFromString(matchShortOffset, input);\\n            } else if (Math.abs(input) < 16) {\\n                input = input * 60;\\n            }\\n            if (!this._isUTC && keepLocalTime) {\\n                localAdjust = getDateOffset(this);\\n            }\\n            this._offset = input;\\n            this._isUTC = true;\\n            if (localAdjust != null) {\\n                this.add(localAdjust, 'm');\\n            }\\n            if (offset !== input) {\\n                if (!keepLocalTime || this._changeInProgress) {\\n                    add_subtract__addSubtract(this, create__createDuration(input - offset, 'm'), 1, false);\\n                } else if (!this._changeInProgress) {\\n                    this._changeInProgress = true;\\n                    utils_hooks__hooks.updateOffset(this, true);\\n                    this._changeInProgress = null;\\n                }\\n            }\\n            return this;\\n        } else {\\n            return this._isUTC ? offset : getDateOffset(this);\\n        }\\n    }\\n\\n    function getSetZone (input, keepLocalTime) {\\n        if (input != null) {\\n            if (typeof input !== 'string') {\\n                input = -input;\\n            }\\n\\n            this.utcOffset(input, keepLocalTime);\\n\\n            return this;\\n        } else {\\n            return -this.utcOffset();\\n        }\\n    }\\n\\n    function setOffsetToUTC (keepLocalTime) {\\n        return this.utcOffset(0, keepLocalTime);\\n    }\\n\\n    function setOffsetToLocal (keepLocalTime) {\\n        if (this._isUTC) {\\n            this.utcOffset(0, keepLocalTime);\\n            this._isUTC = false;\\n\\n            if (keepLocalTime) {\\n                this.subtract(getDateOffset(this), 'm');\\n            }\\n        }\\n        return this;\\n    }\\n\\n    function setOffsetToParsedOffset () {\\n        if (this._tzm) {\\n            this.utcOffset(this._tzm);\\n        } else if (typeof this._i === 'string') {\\n            this.utcOffset(offsetFromString(matchOffset, this._i));\\n        }\\n        return this;\\n    }\\n\\n    function hasAlignedHourOffset (input) {\\n        if (!this.isValid()) {\\n            return false;\\n        }\\n        input = input ? local__createLocal(input).utcOffset() : 0;\\n\\n        return (this.utcOffset() - input) % 60 === 0;\\n    }\\n\\n    function isDaylightSavingTime () {\\n        return (\\n            this.utcOffset() > this.clone().month(0).utcOffset() ||\\n            this.utcOffset() > this.clone().month(5).utcOffset()\\n        );\\n    }\\n\\n    function isDaylightSavingTimeShifted () {\\n        if (!isUndefined(this._isDSTShifted)) {\\n            return this._isDSTShifted;\\n        }\\n\\n        var c = {};\\n\\n        copyConfig(c, this);\\n        c = prepareConfig(c);\\n\\n        if (c._a) {\\n            var other = c._isUTC ? create_utc__createUTC(c._a) : local__createLocal(c._a);\\n            this._isDSTShifted = this.isValid() &&\\n                compareArrays(c._a, other.toArray()) > 0;\\n        } else {\\n            this._isDSTShifted = false;\\n        }\\n\\n        return this._isDSTShifted;\\n    }\\n\\n    function isLocal () {\\n        return this.isValid() ? !this._isUTC : false;\\n    }\\n\\n    function isUtcOffset () {\\n        return this.isValid() ? this._isUTC : false;\\n    }\\n\\n    function isUtc () {\\n        return this.isValid() ? this._isUTC && this._offset === 0 : false;\\n    }\\n\\n    // ASP.NET json date format regex\\n    var aspNetRegex = /^(\\\\-)?(?:(\\\\d*)[. ])?(\\\\d+)\\\\:(\\\\d+)(?:\\\\:(\\\\d+)\\\\.?(\\\\d{3})?\\\\d*)?$/;\\n\\n    // from http://docs.closure-library.googlecode.com/git/closure_goog_date_date.js.source.html\\n    // somewhat more in line with 4.4.3.2 2004 spec, but allows decimal anywhere\\n    // and further modified to allow for strings containing both week and day\\n    var isoRegex = /^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;\\n\\n    function create__createDuration (input, key) {\\n        var duration = input,\\n            // matching against regexp is expensive, do it on demand\\n            match = null,\\n            sign,\\n            ret,\\n            diffRes;\\n\\n        if (isDuration(input)) {\\n            duration = {\\n                ms : input._milliseconds,\\n                d  : input._days,\\n                M  : input._months\\n            };\\n        } else if (typeof input === 'number') {\\n            duration = {};\\n            if (key) {\\n                duration[key] = input;\\n            } else {\\n                duration.milliseconds = input;\\n            }\\n        } else if (!!(match = aspNetRegex.exec(input))) {\\n            sign = (match[1] === '-') ? -1 : 1;\\n            duration = {\\n                y  : 0,\\n                d  : toInt(match[DATE])        * sign,\\n                h  : toInt(match[HOUR])        * sign,\\n                m  : toInt(match[MINUTE])      * sign,\\n                s  : toInt(match[SECOND])      * sign,\\n                ms : toInt(match[MILLISECOND]) * sign\\n            };\\n        } else if (!!(match = isoRegex.exec(input))) {\\n            sign = (match[1] === '-') ? -1 : 1;\\n            duration = {\\n                y : parseIso(match[2], sign),\\n                M : parseIso(match[3], sign),\\n                w : parseIso(match[4], sign),\\n                d : parseIso(match[5], sign),\\n                h : parseIso(match[6], sign),\\n                m : parseIso(match[7], sign),\\n                s : parseIso(match[8], sign)\\n            };\\n        } else if (duration == null) {// checks for null or undefined\\n            duration = {};\\n        } else if (typeof duration === 'object' && ('from' in duration || 'to' in duration)) {\\n            diffRes = momentsDifference(local__createLocal(duration.from), local__createLocal(duration.to));\\n\\n            duration = {};\\n            duration.ms = diffRes.milliseconds;\\n            duration.M = diffRes.months;\\n        }\\n\\n        ret = new Duration(duration);\\n\\n        if (isDuration(input) && hasOwnProp(input, '_locale')) {\\n            ret._locale = input._locale;\\n        }\\n\\n        return ret;\\n    }\\n\\n    create__createDuration.fn = Duration.prototype;\\n\\n    function parseIso (inp, sign) {\\n        // We'd normally use ~~inp for this, but unfortunately it also\\n        // converts floats to ints.\\n        // inp may be undefined, so careful calling replace on it.\\n        var res = inp && parseFloat(inp.replace(',', '.'));\\n        // apply sign while we're at it\\n        return (isNaN(res) ? 0 : res) * sign;\\n    }\\n\\n    function positiveMomentsDifference(base, other) {\\n        var res = {milliseconds: 0, months: 0};\\n\\n        res.months = other.month() - base.month() +\\n            (other.year() - base.year()) * 12;\\n        if (base.clone().add(res.months, 'M').isAfter(other)) {\\n            --res.months;\\n        }\\n\\n        res.milliseconds = +other - +(base.clone().add(res.months, 'M'));\\n\\n        return res;\\n    }\\n\\n    function momentsDifference(base, other) {\\n        var res;\\n        if (!(base.isValid() && other.isValid())) {\\n            return {milliseconds: 0, months: 0};\\n        }\\n\\n        other = cloneWithOffset(other, base);\\n        if (base.isBefore(other)) {\\n            res = positiveMomentsDifference(base, other);\\n        } else {\\n            res = positiveMomentsDifference(other, base);\\n            res.milliseconds = -res.milliseconds;\\n            res.months = -res.months;\\n        }\\n\\n        return res;\\n    }\\n\\n    function absRound (number) {\\n        if (number < 0) {\\n            return Math.round(-1 * number) * -1;\\n        } else {\\n            return Math.round(number);\\n        }\\n    }\\n\\n    // TODO: remove 'name' arg after deprecation is removed\\n    function createAdder(direction, name) {\\n        return function (val, period) {\\n            var dur, tmp;\\n            //invert the arguments, but complain about it\\n            if (period !== null && !isNaN(+period)) {\\n                deprecateSimple(name, 'moment().' + name  + '(period, number) is deprecated. Please use moment().' + name + '(number, period).');\\n                tmp = val; val = period; period = tmp;\\n            }\\n\\n            val = typeof val === 'string' ? +val : val;\\n            dur = create__createDuration(val, period);\\n            add_subtract__addSubtract(this, dur, direction);\\n            return this;\\n        };\\n    }\\n\\n    function add_subtract__addSubtract (mom, duration, isAdding, updateOffset) {\\n        var milliseconds = duration._milliseconds,\\n            days = absRound(duration._days),\\n            months = absRound(duration._months);\\n\\n        if (!mom.isValid()) {\\n            // No op\\n            return;\\n        }\\n\\n        updateOffset = updateOffset == null ? true : updateOffset;\\n\\n        if (milliseconds) {\\n            mom._d.setTime(mom._d.valueOf() + milliseconds * isAdding);\\n        }\\n        if (days) {\\n            get_set__set(mom, 'Date', get_set__get(mom, 'Date') + days * isAdding);\\n        }\\n        if (months) {\\n            setMonth(mom, get_set__get(mom, 'Month') + months * isAdding);\\n        }\\n        if (updateOffset) {\\n            utils_hooks__hooks.updateOffset(mom, days || months);\\n        }\\n    }\\n\\n    var add_subtract__add      = createAdder(1, 'add');\\n    var add_subtract__subtract = createAdder(-1, 'subtract');\\n\\n    function moment_calendar__calendar (time, formats) {\\n        // We want to compare the start of today, vs this.\\n        // Getting start-of-today depends on whether we're local/utc/offset or not.\\n        var now = time || local__createLocal(),\\n            sod = cloneWithOffset(now, this).startOf('day'),\\n            diff = this.diff(sod, 'days', true),\\n            format = diff < -6 ? 'sameElse' :\\n                diff < -1 ? 'lastWeek' :\\n                diff < 0 ? 'lastDay' :\\n                diff < 1 ? 'sameDay' :\\n                diff < 2 ? 'nextDay' :\\n                diff < 7 ? 'nextWeek' : 'sameElse';\\n\\n        var output = formats && (isFunction(formats[format]) ? formats[format]() : formats[format]);\\n\\n        return this.format(output || this.localeData().calendar(format, this, local__createLocal(now)));\\n    }\\n\\n    function clone () {\\n        return new Moment(this);\\n    }\\n\\n    function isAfter (input, units) {\\n        var localInput = isMoment(input) ? input : local__createLocal(input);\\n        if (!(this.isValid() && localInput.isValid())) {\\n            return false;\\n        }\\n        units = normalizeUnits(!isUndefined(units) ? units : 'millisecond');\\n        if (units === 'millisecond') {\\n            return this.valueOf() > localInput.valueOf();\\n        } else {\\n            return localInput.valueOf() < this.clone().startOf(units).valueOf();\\n        }\\n    }\\n\\n    function isBefore (input, units) {\\n        var localInput = isMoment(input) ? input : local__createLocal(input);\\n        if (!(this.isValid() && localInput.isValid())) {\\n            return false;\\n        }\\n        units = normalizeUnits(!isUndefined(units) ? units : 'millisecond');\\n        if (units === 'millisecond') {\\n            return this.valueOf() < localInput.valueOf();\\n        } else {\\n            return this.clone().endOf(units).valueOf() < localInput.valueOf();\\n        }\\n    }\\n\\n    function isBetween (from, to, units, inclusivity) {\\n        inclusivity = inclusivity || '()';\\n        return (inclusivity[0] === '(' ? this.isAfter(from, units) : !this.isBefore(from, units)) &&\\n            (inclusivity[1] === ')' ? this.isBefore(to, units) : !this.isAfter(to, units));\\n    }\\n\\n    function isSame (input, units) {\\n        var localInput = isMoment(input) ? input : local__createLocal(input),\\n            inputMs;\\n        if (!(this.isValid() && localInput.isValid())) {\\n            return false;\\n        }\\n        units = normalizeUnits(units || 'millisecond');\\n        if (units === 'millisecond') {\\n            return this.valueOf() === localInput.valueOf();\\n        } else {\\n            inputMs = localInput.valueOf();\\n            return this.clone().startOf(units).valueOf() <= inputMs && inputMs <= this.clone().endOf(units).valueOf();\\n        }\\n    }\\n\\n    function isSameOrAfter (input, units) {\\n        return this.isSame(input, units) || this.isAfter(input,units);\\n    }\\n\\n    function isSameOrBefore (input, units) {\\n        return this.isSame(input, units) || this.isBefore(input,units);\\n    }\\n\\n    function diff (input, units, asFloat) {\\n        var that,\\n            zoneDelta,\\n            delta, output;\\n\\n        if (!this.isValid()) {\\n            return NaN;\\n        }\\n\\n        that = cloneWithOffset(input, this);\\n\\n        if (!that.isValid()) {\\n            return NaN;\\n        }\\n\\n        zoneDelta = (that.utcOffset() - this.utcOffset()) * 6e4;\\n\\n        units = normalizeUnits(units);\\n\\n        if (units === 'year' || units === 'month' || units === 'quarter') {\\n            output = monthDiff(this, that);\\n            if (units === 'quarter') {\\n                output = output / 3;\\n            } else if (units === 'year') {\\n                output = output / 12;\\n            }\\n        } else {\\n            delta = this - that;\\n            output = units === 'second' ? delta / 1e3 : // 1000\\n                units === 'minute' ? delta / 6e4 : // 1000 * 60\\n                units === 'hour' ? delta / 36e5 : // 1000 * 60 * 60\\n                units === 'day' ? (delta - zoneDelta) / 864e5 : // 1000 * 60 * 60 * 24, negate dst\\n                units === 'week' ? (delta - zoneDelta) / 6048e5 : // 1000 * 60 * 60 * 24 * 7, negate dst\\n                delta;\\n        }\\n        return asFloat ? output : absFloor(output);\\n    }\\n\\n    function monthDiff (a, b) {\\n        // difference in months\\n        var wholeMonthDiff = ((b.year() - a.year()) * 12) + (b.month() - a.month()),\\n            // b is in (anchor - 1 month, anchor + 1 month)\\n            anchor = a.clone().add(wholeMonthDiff, 'months'),\\n            anchor2, adjust;\\n\\n        if (b - anchor < 0) {\\n            anchor2 = a.clone().add(wholeMonthDiff - 1, 'months');\\n            // linear across the month\\n            adjust = (b - anchor) / (anchor - anchor2);\\n        } else {\\n            anchor2 = a.clone().add(wholeMonthDiff + 1, 'months');\\n            // linear across the month\\n            adjust = (b - anchor) / (anchor2 - anchor);\\n        }\\n\\n        //check for negative zero, return zero if negative zero\\n        return -(wholeMonthDiff + adjust) || 0;\\n    }\\n\\n    utils_hooks__hooks.defaultFormat = 'YYYY-MM-DDTHH:mm:ssZ';\\n    utils_hooks__hooks.defaultFormatUtc = 'YYYY-MM-DDTHH:mm:ss[Z]';\\n\\n    function toString () {\\n        return this.clone().locale('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ');\\n    }\\n\\n    function moment_format__toISOString () {\\n        var m = this.clone().utc();\\n        if (0 < m.year() && m.year() <= 9999) {\\n            if (isFunction(Date.prototype.toISOString)) {\\n                // native implementation is ~50x faster, use it when we can\\n                return this.toDate().toISOString();\\n            } else {\\n                return formatMoment(m, 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]');\\n            }\\n        } else {\\n            return formatMoment(m, 'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]');\\n        }\\n    }\\n\\n    function format (inputString) {\\n        if (!inputString) {\\n            inputString = this.isUtc() ? utils_hooks__hooks.defaultFormatUtc : utils_hooks__hooks.defaultFormat;\\n        }\\n        var output = formatMoment(this, inputString);\\n        return this.localeData().postformat(output);\\n    }\\n\\n    function from (time, withoutSuffix) {\\n        if (this.isValid() &&\\n                ((isMoment(time) && time.isValid()) ||\\n                 local__createLocal(time).isValid())) {\\n            return create__createDuration({to: this, from: time}).locale(this.locale()).humanize(!withoutSuffix);\\n        } else {\\n            return this.localeData().invalidDate();\\n        }\\n    }\\n\\n    function fromNow (withoutSuffix) {\\n        return this.from(local__createLocal(), withoutSuffix);\\n    }\\n\\n    function to (time, withoutSuffix) {\\n        if (this.isValid() &&\\n                ((isMoment(time) && time.isValid()) ||\\n                 local__createLocal(time).isValid())) {\\n            return create__createDuration({from: this, to: time}).locale(this.locale()).humanize(!withoutSuffix);\\n        } else {\\n            return this.localeData().invalidDate();\\n        }\\n    }\\n\\n    function toNow (withoutSuffix) {\\n        return this.to(local__createLocal(), withoutSuffix);\\n    }\\n\\n    // If passed a locale key, it will set the locale for this\\n    // instance.  Otherwise, it will return the locale configuration\\n    // variables for this instance.\\n    function locale (key) {\\n        var newLocaleData;\\n\\n        if (key === undefined) {\\n            return this._locale._abbr;\\n        } else {\\n            newLocaleData = locale_locales__getLocale(key);\\n            if (newLocaleData != null) {\\n                this._locale = newLocaleData;\\n            }\\n            return this;\\n        }\\n    }\\n\\n    var lang = deprecate(\\n        'moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.',\\n        function (key) {\\n            if (key === undefined) {\\n                return this.localeData();\\n            } else {\\n                return this.locale(key);\\n            }\\n        }\\n    );\\n\\n    function localeData () {\\n        return this._locale;\\n    }\\n\\n    function startOf (units) {\\n        units = normalizeUnits(units);\\n        // the following switch intentionally omits break keywords\\n        // to utilize falling through the cases.\\n        switch (units) {\\n        case 'year':\\n            this.month(0);\\n            /* falls through */\\n        case 'quarter':\\n        case 'month':\\n            this.date(1);\\n            /* falls through */\\n        case 'week':\\n        case 'isoWeek':\\n        case 'day':\\n        case 'date':\\n            this.hours(0);\\n            /* falls through */\\n        case 'hour':\\n            this.minutes(0);\\n            /* falls through */\\n        case 'minute':\\n            this.seconds(0);\\n            /* falls through */\\n        case 'second':\\n            this.milliseconds(0);\\n        }\\n\\n        // weeks are a special case\\n        if (units === 'week') {\\n            this.weekday(0);\\n        }\\n        if (units === 'isoWeek') {\\n            this.isoWeekday(1);\\n        }\\n\\n        // quarters are also special\\n        if (units === 'quarter') {\\n            this.month(Math.floor(this.month() / 3) * 3);\\n        }\\n\\n        return this;\\n    }\\n\\n    function endOf (units) {\\n        units = normalizeUnits(units);\\n        if (units === undefined || units === 'millisecond') {\\n            return this;\\n        }\\n\\n        // 'date' is an alias for 'day', so it should be considered as such.\\n        if (units === 'date') {\\n            units = 'day';\\n        }\\n\\n        return this.startOf(units).add(1, (units === 'isoWeek' ? 'week' : units)).subtract(1, 'ms');\\n    }\\n\\n    function to_type__valueOf () {\\n        return this._d.valueOf() - ((this._offset || 0) * 60000);\\n    }\\n\\n    function unix () {\\n        return Math.floor(this.valueOf() / 1000);\\n    }\\n\\n    function toDate () {\\n        return this._offset ? new Date(this.valueOf()) : this._d;\\n    }\\n\\n    function toArray () {\\n        var m = this;\\n        return [m.year(), m.month(), m.date(), m.hour(), m.minute(), m.second(), m.millisecond()];\\n    }\\n\\n    function toObject () {\\n        var m = this;\\n        return {\\n            years: m.year(),\\n            months: m.month(),\\n            date: m.date(),\\n            hours: m.hours(),\\n            minutes: m.minutes(),\\n            seconds: m.seconds(),\\n            milliseconds: m.milliseconds()\\n        };\\n    }\\n\\n    function toJSON () {\\n        // new Date(NaN).toJSON() === null\\n        return this.isValid() ? this.toISOString() : null;\\n    }\\n\\n    function moment_valid__isValid () {\\n        return valid__isValid(this);\\n    }\\n\\n    function parsingFlags () {\\n        return extend({}, getParsingFlags(this));\\n    }\\n\\n    function invalidAt () {\\n        return getParsingFlags(this).overflow;\\n    }\\n\\n    function creationData() {\\n        return {\\n            input: this._i,\\n            format: this._f,\\n            locale: this._locale,\\n            isUTC: this._isUTC,\\n            strict: this._strict\\n        };\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken(0, ['gg', 2], 0, function () {\\n        return this.weekYear() % 100;\\n    });\\n\\n    addFormatToken(0, ['GG', 2], 0, function () {\\n        return this.isoWeekYear() % 100;\\n    });\\n\\n    function addWeekYearFormatToken (token, getter) {\\n        addFormatToken(0, [token, token.length], 0, getter);\\n    }\\n\\n    addWeekYearFormatToken('gggg',     'weekYear');\\n    addWeekYearFormatToken('ggggg',    'weekYear');\\n    addWeekYearFormatToken('GGGG',  'isoWeekYear');\\n    addWeekYearFormatToken('GGGGG', 'isoWeekYear');\\n\\n    // ALIASES\\n\\n    addUnitAlias('weekYear', 'gg');\\n    addUnitAlias('isoWeekYear', 'GG');\\n\\n    // PARSING\\n\\n    addRegexToken('G',      matchSigned);\\n    addRegexToken('g',      matchSigned);\\n    addRegexToken('GG',     match1to2, match2);\\n    addRegexToken('gg',     match1to2, match2);\\n    addRegexToken('GGGG',   match1to4, match4);\\n    addRegexToken('gggg',   match1to4, match4);\\n    addRegexToken('GGGGG',  match1to6, match6);\\n    addRegexToken('ggggg',  match1to6, match6);\\n\\n    addWeekParseToken(['gggg', 'ggggg', 'GGGG', 'GGGGG'], function (input, week, config, token) {\\n        week[token.substr(0, 2)] = toInt(input);\\n    });\\n\\n    addWeekParseToken(['gg', 'GG'], function (input, week, config, token) {\\n        week[token] = utils_hooks__hooks.parseTwoDigitYear(input);\\n    });\\n\\n    // MOMENTS\\n\\n    function getSetWeekYear (input) {\\n        return getSetWeekYearHelper.call(this,\\n                input,\\n                this.week(),\\n                this.weekday(),\\n                this.localeData()._week.dow,\\n                this.localeData()._week.doy);\\n    }\\n\\n    function getSetISOWeekYear (input) {\\n        return getSetWeekYearHelper.call(this,\\n                input, this.isoWeek(), this.isoWeekday(), 1, 4);\\n    }\\n\\n    function getISOWeeksInYear () {\\n        return weeksInYear(this.year(), 1, 4);\\n    }\\n\\n    function getWeeksInYear () {\\n        var weekInfo = this.localeData()._week;\\n        return weeksInYear(this.year(), weekInfo.dow, weekInfo.doy);\\n    }\\n\\n    function getSetWeekYearHelper(input, week, weekday, dow, doy) {\\n        var weeksTarget;\\n        if (input == null) {\\n            return weekOfYear(this, dow, doy).year;\\n        } else {\\n            weeksTarget = weeksInYear(input, dow, doy);\\n            if (week > weeksTarget) {\\n                week = weeksTarget;\\n            }\\n            return setWeekAll.call(this, input, week, weekday, dow, doy);\\n        }\\n    }\\n\\n    function setWeekAll(weekYear, week, weekday, dow, doy) {\\n        var dayOfYearData = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy),\\n            date = createUTCDate(dayOfYearData.year, 0, dayOfYearData.dayOfYear);\\n\\n        this.year(date.getUTCFullYear());\\n        this.month(date.getUTCMonth());\\n        this.date(date.getUTCDate());\\n        return this;\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('Q', 0, 'Qo', 'quarter');\\n\\n    // ALIASES\\n\\n    addUnitAlias('quarter', 'Q');\\n\\n    // PARSING\\n\\n    addRegexToken('Q', match1);\\n    addParseToken('Q', function (input, array) {\\n        array[MONTH] = (toInt(input) - 1) * 3;\\n    });\\n\\n    // MOMENTS\\n\\n    function getSetQuarter (input) {\\n        return input == null ? Math.ceil((this.month() + 1) / 3) : this.month((input - 1) * 3 + this.month() % 3);\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('w', ['ww', 2], 'wo', 'week');\\n    addFormatToken('W', ['WW', 2], 'Wo', 'isoWeek');\\n\\n    // ALIASES\\n\\n    addUnitAlias('week', 'w');\\n    addUnitAlias('isoWeek', 'W');\\n\\n    // PARSING\\n\\n    addRegexToken('w',  match1to2);\\n    addRegexToken('ww', match1to2, match2);\\n    addRegexToken('W',  match1to2);\\n    addRegexToken('WW', match1to2, match2);\\n\\n    addWeekParseToken(['w', 'ww', 'W', 'WW'], function (input, week, config, token) {\\n        week[token.substr(0, 1)] = toInt(input);\\n    });\\n\\n    // HELPERS\\n\\n    // LOCALES\\n\\n    function localeWeek (mom) {\\n        return weekOfYear(mom, this._week.dow, this._week.doy).week;\\n    }\\n\\n    var defaultLocaleWeek = {\\n        dow : 0, // Sunday is the first day of the week.\\n        doy : 6  // The week that contains Jan 1st is the first week of the year.\\n    };\\n\\n    function localeFirstDayOfWeek () {\\n        return this._week.dow;\\n    }\\n\\n    function localeFirstDayOfYear () {\\n        return this._week.doy;\\n    }\\n\\n    // MOMENTS\\n\\n    function getSetWeek (input) {\\n        var week = this.localeData().week(this);\\n        return input == null ? week : this.add((input - week) * 7, 'd');\\n    }\\n\\n    function getSetISOWeek (input) {\\n        var week = weekOfYear(this, 1, 4).week;\\n        return input == null ? week : this.add((input - week) * 7, 'd');\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('D', ['DD', 2], 'Do', 'date');\\n\\n    // ALIASES\\n\\n    addUnitAlias('date', 'D');\\n\\n    // PARSING\\n\\n    addRegexToken('D',  match1to2);\\n    addRegexToken('DD', match1to2, match2);\\n    addRegexToken('Do', function (isStrict, locale) {\\n        return isStrict ? locale._ordinalParse : locale._ordinalParseLenient;\\n    });\\n\\n    addParseToken(['D', 'DD'], DATE);\\n    addParseToken('Do', function (input, array) {\\n        array[DATE] = toInt(input.match(match1to2)[0], 10);\\n    });\\n\\n    // MOMENTS\\n\\n    var getSetDayOfMonth = makeGetSet('Date', true);\\n\\n    // FORMATTING\\n\\n    addFormatToken('d', 0, 'do', 'day');\\n\\n    addFormatToken('dd', 0, 0, function (format) {\\n        return this.localeData().weekdaysMin(this, format);\\n    });\\n\\n    addFormatToken('ddd', 0, 0, function (format) {\\n        return this.localeData().weekdaysShort(this, format);\\n    });\\n\\n    addFormatToken('dddd', 0, 0, function (format) {\\n        return this.localeData().weekdays(this, format);\\n    });\\n\\n    addFormatToken('e', 0, 0, 'weekday');\\n    addFormatToken('E', 0, 0, 'isoWeekday');\\n\\n    // ALIASES\\n\\n    addUnitAlias('day', 'd');\\n    addUnitAlias('weekday', 'e');\\n    addUnitAlias('isoWeekday', 'E');\\n\\n    // PARSING\\n\\n    addRegexToken('d',    match1to2);\\n    addRegexToken('e',    match1to2);\\n    addRegexToken('E',    match1to2);\\n    addRegexToken('dd',   function (isStrict, locale) {\\n        return locale.weekdaysMinRegex(isStrict);\\n    });\\n    addRegexToken('ddd',   function (isStrict, locale) {\\n        return locale.weekdaysShortRegex(isStrict);\\n    });\\n    addRegexToken('dddd',   function (isStrict, locale) {\\n        return locale.weekdaysRegex(isStrict);\\n    });\\n\\n    addWeekParseToken(['dd', 'ddd', 'dddd'], function (input, week, config, token) {\\n        var weekday = config._locale.weekdaysParse(input, token, config._strict);\\n        // if we didn't get a weekday name, mark the date as invalid\\n        if (weekday != null) {\\n            week.d = weekday;\\n        } else {\\n            getParsingFlags(config).invalidWeekday = input;\\n        }\\n    });\\n\\n    addWeekParseToken(['d', 'e', 'E'], function (input, week, config, token) {\\n        week[token] = toInt(input);\\n    });\\n\\n    // HELPERS\\n\\n    function parseWeekday(input, locale) {\\n        if (typeof input !== 'string') {\\n            return input;\\n        }\\n\\n        if (!isNaN(input)) {\\n            return parseInt(input, 10);\\n        }\\n\\n        input = locale.weekdaysParse(input);\\n        if (typeof input === 'number') {\\n            return input;\\n        }\\n\\n        return null;\\n    }\\n\\n    // LOCALES\\n\\n    var defaultLocaleWeekdays = 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_');\\n    function localeWeekdays (m, format) {\\n        return isArray(this._weekdays) ? this._weekdays[m.day()] :\\n            this._weekdays[this._weekdays.isFormat.test(format) ? 'format' : 'standalone'][m.day()];\\n    }\\n\\n    var defaultLocaleWeekdaysShort = 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_');\\n    function localeWeekdaysShort (m) {\\n        return this._weekdaysShort[m.day()];\\n    }\\n\\n    var defaultLocaleWeekdaysMin = 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_');\\n    function localeWeekdaysMin (m) {\\n        return this._weekdaysMin[m.day()];\\n    }\\n\\n    function day_of_week__handleStrictParse(weekdayName, format, strict) {\\n        var i, ii, mom, llc = weekdayName.toLocaleLowerCase();\\n        if (!this._weekdaysParse) {\\n            this._weekdaysParse = [];\\n            this._shortWeekdaysParse = [];\\n            this._minWeekdaysParse = [];\\n\\n            for (i = 0; i < 7; ++i) {\\n                mom = create_utc__createUTC([2000, 1]).day(i);\\n                this._minWeekdaysParse[i] = this.weekdaysMin(mom, '').toLocaleLowerCase();\\n                this._shortWeekdaysParse[i] = this.weekdaysShort(mom, '').toLocaleLowerCase();\\n                this._weekdaysParse[i] = this.weekdays(mom, '').toLocaleLowerCase();\\n            }\\n        }\\n\\n        if (strict) {\\n            if (format === 'dddd') {\\n                ii = indexOf.call(this._weekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else if (format === 'ddd') {\\n                ii = indexOf.call(this._shortWeekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else {\\n                ii = indexOf.call(this._minWeekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            }\\n        } else {\\n            if (format === 'dddd') {\\n                ii = indexOf.call(this._weekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._shortWeekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._minWeekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else if (format === 'ddd') {\\n                ii = indexOf.call(this._shortWeekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._weekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._minWeekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            } else {\\n                ii = indexOf.call(this._minWeekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._weekdaysParse, llc);\\n                if (ii !== -1) {\\n                    return ii;\\n                }\\n                ii = indexOf.call(this._shortWeekdaysParse, llc);\\n                return ii !== -1 ? ii : null;\\n            }\\n        }\\n    }\\n\\n    function localeWeekdaysParse (weekdayName, format, strict) {\\n        var i, mom, regex;\\n\\n        if (this._weekdaysParseExact) {\\n            return day_of_week__handleStrictParse.call(this, weekdayName, format, strict);\\n        }\\n\\n        if (!this._weekdaysParse) {\\n            this._weekdaysParse = [];\\n            this._minWeekdaysParse = [];\\n            this._shortWeekdaysParse = [];\\n            this._fullWeekdaysParse = [];\\n        }\\n\\n        for (i = 0; i < 7; i++) {\\n            // make the regex if we don't have it already\\n\\n            mom = create_utc__createUTC([2000, 1]).day(i);\\n            if (strict && !this._fullWeekdaysParse[i]) {\\n                this._fullWeekdaysParse[i] = new RegExp('^' + this.weekdays(mom, '').replace('.', '\\\\.?') + '$', 'i');\\n                this._shortWeekdaysParse[i] = new RegExp('^' + this.weekdaysShort(mom, '').replace('.', '\\\\.?') + '$', 'i');\\n                this._minWeekdaysParse[i] = new RegExp('^' + this.weekdaysMin(mom, '').replace('.', '\\\\.?') + '$', 'i');\\n            }\\n            if (!this._weekdaysParse[i]) {\\n                regex = '^' + this.weekdays(mom, '') + '|^' + this.weekdaysShort(mom, '') + '|^' + this.weekdaysMin(mom, '');\\n                this._weekdaysParse[i] = new RegExp(regex.replace('.', ''), 'i');\\n            }\\n            // test the regex\\n            if (strict && format === 'dddd' && this._fullWeekdaysParse[i].test(weekdayName)) {\\n                return i;\\n            } else if (strict && format === 'ddd' && this._shortWeekdaysParse[i].test(weekdayName)) {\\n                return i;\\n            } else if (strict && format === 'dd' && this._minWeekdaysParse[i].test(weekdayName)) {\\n                return i;\\n            } else if (!strict && this._weekdaysParse[i].test(weekdayName)) {\\n                return i;\\n            }\\n        }\\n    }\\n\\n    // MOMENTS\\n\\n    function getSetDayOfWeek (input) {\\n        if (!this.isValid()) {\\n            return input != null ? this : NaN;\\n        }\\n        var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();\\n        if (input != null) {\\n            input = parseWeekday(input, this.localeData());\\n            return this.add(input - day, 'd');\\n        } else {\\n            return day;\\n        }\\n    }\\n\\n    function getSetLocaleDayOfWeek (input) {\\n        if (!this.isValid()) {\\n            return input != null ? this : NaN;\\n        }\\n        var weekday = (this.day() + 7 - this.localeData()._week.dow) % 7;\\n        return input == null ? weekday : this.add(input - weekday, 'd');\\n    }\\n\\n    function getSetISODayOfWeek (input) {\\n        if (!this.isValid()) {\\n            return input != null ? this : NaN;\\n        }\\n        // behaves the same as moment#day except\\n        // as a getter, returns 7 instead of 0 (1-7 range instead of 0-6)\\n        // as a setter, sunday should belong to the previous week.\\n        return input == null ? this.day() || 7 : this.day(this.day() % 7 ? input : input - 7);\\n    }\\n\\n    var defaultWeekdaysRegex = matchWord;\\n    function weekdaysRegex (isStrict) {\\n        if (this._weekdaysParseExact) {\\n            if (!hasOwnProp(this, '_weekdaysRegex')) {\\n                computeWeekdaysParse.call(this);\\n            }\\n            if (isStrict) {\\n                return this._weekdaysStrictRegex;\\n            } else {\\n                return this._weekdaysRegex;\\n            }\\n        } else {\\n            return this._weekdaysStrictRegex && isStrict ?\\n                this._weekdaysStrictRegex : this._weekdaysRegex;\\n        }\\n    }\\n\\n    var defaultWeekdaysShortRegex = matchWord;\\n    function weekdaysShortRegex (isStrict) {\\n        if (this._weekdaysParseExact) {\\n            if (!hasOwnProp(this, '_weekdaysRegex')) {\\n                computeWeekdaysParse.call(this);\\n            }\\n            if (isStrict) {\\n                return this._weekdaysShortStrictRegex;\\n            } else {\\n                return this._weekdaysShortRegex;\\n            }\\n        } else {\\n            return this._weekdaysShortStrictRegex && isStrict ?\\n                this._weekdaysShortStrictRegex : this._weekdaysShortRegex;\\n        }\\n    }\\n\\n    var defaultWeekdaysMinRegex = matchWord;\\n    function weekdaysMinRegex (isStrict) {\\n        if (this._weekdaysParseExact) {\\n            if (!hasOwnProp(this, '_weekdaysRegex')) {\\n                computeWeekdaysParse.call(this);\\n            }\\n            if (isStrict) {\\n                return this._weekdaysMinStrictRegex;\\n            } else {\\n                return this._weekdaysMinRegex;\\n            }\\n        } else {\\n            return this._weekdaysMinStrictRegex && isStrict ?\\n                this._weekdaysMinStrictRegex : this._weekdaysMinRegex;\\n        }\\n    }\\n\\n\\n    function computeWeekdaysParse () {\\n        function cmpLenRev(a, b) {\\n            return b.length - a.length;\\n        }\\n\\n        var minPieces = [], shortPieces = [], longPieces = [], mixedPieces = [],\\n            i, mom, minp, shortp, longp;\\n        for (i = 0; i < 7; i++) {\\n            // make the regex if we don't have it already\\n            mom = create_utc__createUTC([2000, 1]).day(i);\\n            minp = this.weekdaysMin(mom, '');\\n            shortp = this.weekdaysShort(mom, '');\\n            longp = this.weekdays(mom, '');\\n            minPieces.push(minp);\\n            shortPieces.push(shortp);\\n            longPieces.push(longp);\\n            mixedPieces.push(minp);\\n            mixedPieces.push(shortp);\\n            mixedPieces.push(longp);\\n        }\\n        // Sorting makes sure if one weekday (or abbr) is a prefix of another it\\n        // will match the longer piece.\\n        minPieces.sort(cmpLenRev);\\n        shortPieces.sort(cmpLenRev);\\n        longPieces.sort(cmpLenRev);\\n        mixedPieces.sort(cmpLenRev);\\n        for (i = 0; i < 7; i++) {\\n            shortPieces[i] = regexEscape(shortPieces[i]);\\n            longPieces[i] = regexEscape(longPieces[i]);\\n            mixedPieces[i] = regexEscape(mixedPieces[i]);\\n        }\\n\\n        this._weekdaysRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');\\n        this._weekdaysShortRegex = this._weekdaysRegex;\\n        this._weekdaysMinRegex = this._weekdaysRegex;\\n\\n        this._weekdaysStrictRegex = new RegExp('^(' + longPieces.join('|') + ')', 'i');\\n        this._weekdaysShortStrictRegex = new RegExp('^(' + shortPieces.join('|') + ')', 'i');\\n        this._weekdaysMinStrictRegex = new RegExp('^(' + minPieces.join('|') + ')', 'i');\\n    }\\n\\n    // FORMATTING\\n\\n    addFormatToken('DDD', ['DDDD', 3], 'DDDo', 'dayOfYear');\\n\\n    // ALIASES\\n\\n    addUnitAlias('dayOfYear', 'DDD');\\n\\n    // PARSING\\n\\n    addRegexToken('DDD',  match1to3);\\n    addRegexToken('DDDD', match3);\\n    addParseToken(['DDD', 'DDDD'], function (input, array, config) {\\n        config._dayOfYear = toInt(input);\\n    });\\n\\n    // HELPERS\\n\\n    // MOMENTS\\n\\n    function getSetDayOfYear (input) {\\n        var dayOfYear = Math.round((this.clone().startOf('day') - this.clone().startOf('year')) / 864e5) + 1;\\n        return input == null ? dayOfYear : this.add((input - dayOfYear), 'd');\\n    }\\n\\n    // FORMATTING\\n\\n    function hFormat() {\\n        return this.hours() % 12 || 12;\\n    }\\n\\n    function kFormat() {\\n        return this.hours() || 24;\\n    }\\n\\n    addFormatToken('H', ['HH', 2], 0, 'hour');\\n    addFormatToken('h', ['hh', 2], 0, hFormat);\\n    addFormatToken('k', ['kk', 2], 0, kFormat);\\n\\n    addFormatToken('hmm', 0, 0, function () {\\n        return '' + hFormat.apply(this) + zeroFill(this.minutes(), 2);\\n    });\\n\\n    addFormatToken('hmmss', 0, 0, function () {\\n        return '' + hFormat.apply(this) + zeroFill(this.minutes(), 2) +\\n            zeroFill(this.seconds(), 2);\\n    });\\n\\n    addFormatToken('Hmm', 0, 0, function () {\\n        return '' + this.hours() + zeroFill(this.minutes(), 2);\\n    });\\n\\n    addFormatToken('Hmmss', 0, 0, function () {\\n        return '' + this.hours() + zeroFill(this.minutes(), 2) +\\n            zeroFill(this.seconds(), 2);\\n    });\\n\\n    function meridiem (token, lowercase) {\\n        addFormatToken(token, 0, 0, function () {\\n            return this.localeData().meridiem(this.hours(), this.minutes(), lowercase);\\n        });\\n    }\\n\\n    meridiem('a', true);\\n    meridiem('A', false);\\n\\n    // ALIASES\\n\\n    addUnitAlias('hour', 'h');\\n\\n    // PARSING\\n\\n    function matchMeridiem (isStrict, locale) {\\n        return locale._meridiemParse;\\n    }\\n\\n    addRegexToken('a',  matchMeridiem);\\n    addRegexToken('A',  matchMeridiem);\\n    addRegexToken('H',  match1to2);\\n    addRegexToken('h',  match1to2);\\n    addRegexToken('HH', match1to2, match2);\\n    addRegexToken('hh', match1to2, match2);\\n\\n    addRegexToken('hmm', match3to4);\\n    addRegexToken('hmmss', match5to6);\\n    addRegexToken('Hmm', match3to4);\\n    addRegexToken('Hmmss', match5to6);\\n\\n    addParseToken(['H', 'HH'], HOUR);\\n    addParseToken(['a', 'A'], function (input, array, config) {\\n        config._isPm = config._locale.isPM(input);\\n        config._meridiem = input;\\n    });\\n    addParseToken(['h', 'hh'], function (input, array, config) {\\n        array[HOUR] = toInt(input);\\n        getParsingFlags(config).bigHour = true;\\n    });\\n    addParseToken('hmm', function (input, array, config) {\\n        var pos = input.length - 2;\\n        array[HOUR] = toInt(input.substr(0, pos));\\n        array[MINUTE] = toInt(input.substr(pos));\\n        getParsingFlags(config).bigHour = true;\\n    });\\n    addParseToken('hmmss', function (input, array, config) {\\n        var pos1 = input.length - 4;\\n        var pos2 = input.length - 2;\\n        array[HOUR] = toInt(input.substr(0, pos1));\\n        array[MINUTE] = toInt(input.substr(pos1, 2));\\n        array[SECOND] = toInt(input.substr(pos2));\\n        getParsingFlags(config).bigHour = true;\\n    });\\n    addParseToken('Hmm', function (input, array, config) {\\n        var pos = input.length - 2;\\n        array[HOUR] = toInt(input.substr(0, pos));\\n        array[MINUTE] = toInt(input.substr(pos));\\n    });\\n    addParseToken('Hmmss', function (input, array, config) {\\n        var pos1 = input.length - 4;\\n        var pos2 = input.length - 2;\\n        array[HOUR] = toInt(input.substr(0, pos1));\\n        array[MINUTE] = toInt(input.substr(pos1, 2));\\n        array[SECOND] = toInt(input.substr(pos2));\\n    });\\n\\n    // LOCALES\\n\\n    function localeIsPM (input) {\\n        // IE8 Quirks Mode & IE7 Standards Mode do not allow accessing strings like arrays\\n        // Using charAt should be more compatible.\\n        return ((input + '').toLowerCase().charAt(0) === 'p');\\n    }\\n\\n    var defaultLocaleMeridiemParse = /[ap]\\\\.?m?\\\\.?/i;\\n    function localeMeridiem (hours, minutes, isLower) {\\n        if (hours > 11) {\\n            return isLower ? 'pm' : 'PM';\\n        } else {\\n            return isLower ? 'am' : 'AM';\\n        }\\n    }\\n\\n\\n    // MOMENTS\\n\\n    // Setting the hour should keep the time, because the user explicitly\\n    // specified which hour he wants. So trying to maintain the same hour (in\\n    // a new timezone) makes sense. Adding/subtracting hours does not follow\\n    // this rule.\\n    var getSetHour = makeGetSet('Hours', true);\\n\\n    // FORMATTING\\n\\n    addFormatToken('m', ['mm', 2], 0, 'minute');\\n\\n    // ALIASES\\n\\n    addUnitAlias('minute', 'm');\\n\\n    // PARSING\\n\\n    addRegexToken('m',  match1to2);\\n    addRegexToken('mm', match1to2, match2);\\n    addParseToken(['m', 'mm'], MINUTE);\\n\\n    // MOMENTS\\n\\n    var getSetMinute = makeGetSet('Minutes', false);\\n\\n    // FORMATTING\\n\\n    addFormatToken('s', ['ss', 2], 0, 'second');\\n\\n    // ALIASES\\n\\n    addUnitAlias('second', 's');\\n\\n    // PARSING\\n\\n    addRegexToken('s',  match1to2);\\n    addRegexToken('ss', match1to2, match2);\\n    addParseToken(['s', 'ss'], SECOND);\\n\\n    // MOMENTS\\n\\n    var getSetSecond = makeGetSet('Seconds', false);\\n\\n    // FORMATTING\\n\\n    addFormatToken('S', 0, 0, function () {\\n        return ~~(this.millisecond() / 100);\\n    });\\n\\n    addFormatToken(0, ['SS', 2], 0, function () {\\n        return ~~(this.millisecond() / 10);\\n    });\\n\\n    addFormatToken(0, ['SSS', 3], 0, 'millisecond');\\n    addFormatToken(0, ['SSSS', 4], 0, function () {\\n        return this.millisecond() * 10;\\n    });\\n    addFormatToken(0, ['SSSSS', 5], 0, function () {\\n        return this.millisecond() * 100;\\n    });\\n    addFormatToken(0, ['SSSSSS', 6], 0, function () {\\n        return this.millisecond() * 1000;\\n    });\\n    addFormatToken(0, ['SSSSSSS', 7], 0, function () {\\n        return this.millisecond() * 10000;\\n    });\\n    addFormatToken(0, ['SSSSSSSS', 8], 0, function () {\\n        return this.millisecond() * 100000;\\n    });\\n    addFormatToken(0, ['SSSSSSSSS', 9], 0, function () {\\n        return this.millisecond() * 1000000;\\n    });\\n\\n\\n    // ALIASES\\n\\n    addUnitAlias('millisecond', 'ms');\\n\\n    // PARSING\\n\\n    addRegexToken('S',    match1to3, match1);\\n    addRegexToken('SS',   match1to3, match2);\\n    addRegexToken('SSS',  match1to3, match3);\\n\\n    var token;\\n    for (token = 'SSSS'; token.length <= 9; token += 'S') {\\n        addRegexToken(token, matchUnsigned);\\n    }\\n\\n    function parseMs(input, array) {\\n        array[MILLISECOND] = toInt(('0.' + input) * 1000);\\n    }\\n\\n    for (token = 'S'; token.length <= 9; token += 'S') {\\n        addParseToken(token, parseMs);\\n    }\\n    // MOMENTS\\n\\n    var getSetMillisecond = makeGetSet('Milliseconds', false);\\n\\n    // FORMATTING\\n\\n    addFormatToken('z',  0, 0, 'zoneAbbr');\\n    addFormatToken('zz', 0, 0, 'zoneName');\\n\\n    // MOMENTS\\n\\n    function getZoneAbbr () {\\n        return this._isUTC ? 'UTC' : '';\\n    }\\n\\n    function getZoneName () {\\n        return this._isUTC ? 'Coordinated Universal Time' : '';\\n    }\\n\\n    var momentPrototype__proto = Moment.prototype;\\n\\n    momentPrototype__proto.add               = add_subtract__add;\\n    momentPrototype__proto.calendar          = moment_calendar__calendar;\\n    momentPrototype__proto.clone             = clone;\\n    momentPrototype__proto.diff              = diff;\\n    momentPrototype__proto.endOf             = endOf;\\n    momentPrototype__proto.format            = format;\\n    momentPrototype__proto.from              = from;\\n    momentPrototype__proto.fromNow           = fromNow;\\n    momentPrototype__proto.to                = to;\\n    momentPrototype__proto.toNow             = toNow;\\n    momentPrototype__proto.get               = getSet;\\n    momentPrototype__proto.invalidAt         = invalidAt;\\n    momentPrototype__proto.isAfter           = isAfter;\\n    momentPrototype__proto.isBefore          = isBefore;\\n    momentPrototype__proto.isBetween         = isBetween;\\n    momentPrototype__proto.isSame            = isSame;\\n    momentPrototype__proto.isSameOrAfter     = isSameOrAfter;\\n    momentPrototype__proto.isSameOrBefore    = isSameOrBefore;\\n    momentPrototype__proto.isValid           = moment_valid__isValid;\\n    momentPrototype__proto.lang              = lang;\\n    momentPrototype__proto.locale            = locale;\\n    momentPrototype__proto.localeData        = localeData;\\n    momentPrototype__proto.max               = prototypeMax;\\n    momentPrototype__proto.min               = prototypeMin;\\n    momentPrototype__proto.parsingFlags      = parsingFlags;\\n    momentPrototype__proto.set               = getSet;\\n    momentPrototype__proto.startOf           = startOf;\\n    momentPrototype__proto.subtract          = add_subtract__subtract;\\n    momentPrototype__proto.toArray           = toArray;\\n    momentPrototype__proto.toObject          = toObject;\\n    momentPrototype__proto.toDate            = toDate;\\n    momentPrototype__proto.toISOString       = moment_format__toISOString;\\n    momentPrototype__proto.toJSON            = toJSON;\\n    momentPrototype__proto.toString          = toString;\\n    momentPrototype__proto.unix              = unix;\\n    momentPrototype__proto.valueOf           = to_type__valueOf;\\n    momentPrototype__proto.creationData      = creationData;\\n\\n    // Year\\n    momentPrototype__proto.year       = getSetYear;\\n    momentPrototype__proto.isLeapYear = getIsLeapYear;\\n\\n    // Week Year\\n    momentPrototype__proto.weekYear    = getSetWeekYear;\\n    momentPrototype__proto.isoWeekYear = getSetISOWeekYear;\\n\\n    // Quarter\\n    momentPrototype__proto.quarter = momentPrototype__proto.quarters = getSetQuarter;\\n\\n    // Month\\n    momentPrototype__proto.month       = getSetMonth;\\n    momentPrototype__proto.daysInMonth = getDaysInMonth;\\n\\n    // Week\\n    momentPrototype__proto.week           = momentPrototype__proto.weeks        = getSetWeek;\\n    momentPrototype__proto.isoWeek        = momentPrototype__proto.isoWeeks     = getSetISOWeek;\\n    momentPrototype__proto.weeksInYear    = getWeeksInYear;\\n    momentPrototype__proto.isoWeeksInYear = getISOWeeksInYear;\\n\\n    // Day\\n    momentPrototype__proto.date       = getSetDayOfMonth;\\n    momentPrototype__proto.day        = momentPrototype__proto.days             = getSetDayOfWeek;\\n    momentPrototype__proto.weekday    = getSetLocaleDayOfWeek;\\n    momentPrototype__proto.isoWeekday = getSetISODayOfWeek;\\n    momentPrototype__proto.dayOfYear  = getSetDayOfYear;\\n\\n    // Hour\\n    momentPrototype__proto.hour = momentPrototype__proto.hours = getSetHour;\\n\\n    // Minute\\n    momentPrototype__proto.minute = momentPrototype__proto.minutes = getSetMinute;\\n\\n    // Second\\n    momentPrototype__proto.second = momentPrototype__proto.seconds = getSetSecond;\\n\\n    // Millisecond\\n    momentPrototype__proto.millisecond = momentPrototype__proto.milliseconds = getSetMillisecond;\\n\\n    // Offset\\n    momentPrototype__proto.utcOffset            = getSetOffset;\\n    momentPrototype__proto.utc                  = setOffsetToUTC;\\n    momentPrototype__proto.local                = setOffsetToLocal;\\n    momentPrototype__proto.parseZone            = setOffsetToParsedOffset;\\n    momentPrototype__proto.hasAlignedHourOffset = hasAlignedHourOffset;\\n    momentPrototype__proto.isDST                = isDaylightSavingTime;\\n    momentPrototype__proto.isDSTShifted         = isDaylightSavingTimeShifted;\\n    momentPrototype__proto.isLocal              = isLocal;\\n    momentPrototype__proto.isUtcOffset          = isUtcOffset;\\n    momentPrototype__proto.isUtc                = isUtc;\\n    momentPrototype__proto.isUTC                = isUtc;\\n\\n    // Timezone\\n    momentPrototype__proto.zoneAbbr = getZoneAbbr;\\n    momentPrototype__proto.zoneName = getZoneName;\\n\\n    // Deprecations\\n    momentPrototype__proto.dates  = deprecate('dates accessor is deprecated. Use date instead.', getSetDayOfMonth);\\n    momentPrototype__proto.months = deprecate('months accessor is deprecated. Use month instead', getSetMonth);\\n    momentPrototype__proto.years  = deprecate('years accessor is deprecated. Use year instead', getSetYear);\\n    momentPrototype__proto.zone   = deprecate('moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779', getSetZone);\\n\\n    var momentPrototype = momentPrototype__proto;\\n\\n    function moment__createUnix (input) {\\n        return local__createLocal(input * 1000);\\n    }\\n\\n    function moment__createInZone () {\\n        return local__createLocal.apply(null, arguments).parseZone();\\n    }\\n\\n    var defaultCalendar = {\\n        sameDay : '[Today at] LT',\\n        nextDay : '[Tomorrow at] LT',\\n        nextWeek : 'dddd [at] LT',\\n        lastDay : '[Yesterday at] LT',\\n        lastWeek : '[Last] dddd [at] LT',\\n        sameElse : 'L'\\n    };\\n\\n    function locale_calendar__calendar (key, mom, now) {\\n        var output = this._calendar[key];\\n        return isFunction(output) ? output.call(mom, now) : output;\\n    }\\n\\n    var defaultLongDateFormat = {\\n        LTS  : 'h:mm:ss A',\\n        LT   : 'h:mm A',\\n        L    : 'MM/DD/YYYY',\\n        LL   : 'MMMM D, YYYY',\\n        LLL  : 'MMMM D, YYYY h:mm A',\\n        LLLL : 'dddd, MMMM D, YYYY h:mm A'\\n    };\\n\\n    function longDateFormat (key) {\\n        var format = this._longDateFormat[key],\\n            formatUpper = this._longDateFormat[key.toUpperCase()];\\n\\n        if (format || !formatUpper) {\\n            return format;\\n        }\\n\\n        this._longDateFormat[key] = formatUpper.replace(/MMMM|MM|DD|dddd/g, function (val) {\\n            return val.slice(1);\\n        });\\n\\n        return this._longDateFormat[key];\\n    }\\n\\n    var defaultInvalidDate = 'Invalid date';\\n\\n    function invalidDate () {\\n        return this._invalidDate;\\n    }\\n\\n    var defaultOrdinal = '%d';\\n    var defaultOrdinalParse = /\\\\d{1,2}/;\\n\\n    function ordinal (number) {\\n        return this._ordinal.replace('%d', number);\\n    }\\n\\n    function preParsePostFormat (string) {\\n        return string;\\n    }\\n\\n    var defaultRelativeTime = {\\n        future : 'in %s',\\n        past   : '%s ago',\\n        s  : 'a few seconds',\\n        m  : 'a minute',\\n        mm : '%d minutes',\\n        h  : 'an hour',\\n        hh : '%d hours',\\n        d  : 'a day',\\n        dd : '%d days',\\n        M  : 'a month',\\n        MM : '%d months',\\n        y  : 'a year',\\n        yy : '%d years'\\n    };\\n\\n    function relative__relativeTime (number, withoutSuffix, string, isFuture) {\\n        var output = this._relativeTime[string];\\n        return (isFunction(output)) ?\\n            output(number, withoutSuffix, string, isFuture) :\\n            output.replace(/%d/i, number);\\n    }\\n\\n    function pastFuture (diff, output) {\\n        var format = this._relativeTime[diff > 0 ? 'future' : 'past'];\\n        return isFunction(format) ? format(output) : format.replace(/%s/i, output);\\n    }\\n\\n    var prototype__proto = Locale.prototype;\\n\\n    prototype__proto._calendar       = defaultCalendar;\\n    prototype__proto.calendar        = locale_calendar__calendar;\\n    prototype__proto._longDateFormat = defaultLongDateFormat;\\n    prototype__proto.longDateFormat  = longDateFormat;\\n    prototype__proto._invalidDate    = defaultInvalidDate;\\n    prototype__proto.invalidDate     = invalidDate;\\n    prototype__proto._ordinal        = defaultOrdinal;\\n    prototype__proto.ordinal         = ordinal;\\n    prototype__proto._ordinalParse   = defaultOrdinalParse;\\n    prototype__proto.preparse        = preParsePostFormat;\\n    prototype__proto.postformat      = preParsePostFormat;\\n    prototype__proto._relativeTime   = defaultRelativeTime;\\n    prototype__proto.relativeTime    = relative__relativeTime;\\n    prototype__proto.pastFuture      = pastFuture;\\n    prototype__proto.set             = locale_set__set;\\n\\n    // Month\\n    prototype__proto.months            =        localeMonths;\\n    prototype__proto._months           = defaultLocaleMonths;\\n    prototype__proto.monthsShort       =        localeMonthsShort;\\n    prototype__proto._monthsShort      = defaultLocaleMonthsShort;\\n    prototype__proto.monthsParse       =        localeMonthsParse;\\n    prototype__proto._monthsRegex      = defaultMonthsRegex;\\n    prototype__proto.monthsRegex       = monthsRegex;\\n    prototype__proto._monthsShortRegex = defaultMonthsShortRegex;\\n    prototype__proto.monthsShortRegex  = monthsShortRegex;\\n\\n    // Week\\n    prototype__proto.week = localeWeek;\\n    prototype__proto._week = defaultLocaleWeek;\\n    prototype__proto.firstDayOfYear = localeFirstDayOfYear;\\n    prototype__proto.firstDayOfWeek = localeFirstDayOfWeek;\\n\\n    // Day of Week\\n    prototype__proto.weekdays       =        localeWeekdays;\\n    prototype__proto._weekdays      = defaultLocaleWeekdays;\\n    prototype__proto.weekdaysMin    =        localeWeekdaysMin;\\n    prototype__proto._weekdaysMin   = defaultLocaleWeekdaysMin;\\n    prototype__proto.weekdaysShort  =        localeWeekdaysShort;\\n    prototype__proto._weekdaysShort = defaultLocaleWeekdaysShort;\\n    prototype__proto.weekdaysParse  =        localeWeekdaysParse;\\n\\n    prototype__proto._weekdaysRegex      = defaultWeekdaysRegex;\\n    prototype__proto.weekdaysRegex       =        weekdaysRegex;\\n    prototype__proto._weekdaysShortRegex = defaultWeekdaysShortRegex;\\n    prototype__proto.weekdaysShortRegex  =        weekdaysShortRegex;\\n    prototype__proto._weekdaysMinRegex   = defaultWeekdaysMinRegex;\\n    prototype__proto.weekdaysMinRegex    =        weekdaysMinRegex;\\n\\n    // Hours\\n    prototype__proto.isPM = localeIsPM;\\n    prototype__proto._meridiemParse = defaultLocaleMeridiemParse;\\n    prototype__proto.meridiem = localeMeridiem;\\n\\n    function lists__get (format, index, field, setter) {\\n        var locale = locale_locales__getLocale();\\n        var utc = create_utc__createUTC().set(setter, index);\\n        return locale[field](utc, format);\\n    }\\n\\n    function listMonthsImpl (format, index, field) {\\n        if (typeof format === 'number') {\\n            index = format;\\n            format = undefined;\\n        }\\n\\n        format = format || '';\\n\\n        if (index != null) {\\n            return lists__get(format, index, field, 'month');\\n        }\\n\\n        var i;\\n        var out = [];\\n        for (i = 0; i < 12; i++) {\\n            out[i] = lists__get(format, i, field, 'month');\\n        }\\n        return out;\\n    }\\n\\n    // ()\\n    // (5)\\n    // (fmt, 5)\\n    // (fmt)\\n    // (true)\\n    // (true, 5)\\n    // (true, fmt, 5)\\n    // (true, fmt)\\n    function listWeekdaysImpl (localeSorted, format, index, field) {\\n        if (typeof localeSorted === 'boolean') {\\n            if (typeof format === 'number') {\\n                index = format;\\n                format = undefined;\\n            }\\n\\n            format = format || '';\\n        } else {\\n            format = localeSorted;\\n            index = format;\\n            localeSorted = false;\\n\\n            if (typeof format === 'number') {\\n                index = format;\\n                format = undefined;\\n            }\\n\\n            format = format || '';\\n        }\\n\\n        var locale = locale_locales__getLocale(),\\n            shift = localeSorted ? locale._week.dow : 0;\\n\\n        if (index != null) {\\n            return lists__get(format, (index + shift) % 7, field, 'day');\\n        }\\n\\n        var i;\\n        var out = [];\\n        for (i = 0; i < 7; i++) {\\n            out[i] = lists__get(format, (i + shift) % 7, field, 'day');\\n        }\\n        return out;\\n    }\\n\\n    function lists__listMonths (format, index) {\\n        return listMonthsImpl(format, index, 'months');\\n    }\\n\\n    function lists__listMonthsShort (format, index) {\\n        return listMonthsImpl(format, index, 'monthsShort');\\n    }\\n\\n    function lists__listWeekdays (localeSorted, format, index) {\\n        return listWeekdaysImpl(localeSorted, format, index, 'weekdays');\\n    }\\n\\n    function lists__listWeekdaysShort (localeSorted, format, index) {\\n        return listWeekdaysImpl(localeSorted, format, index, 'weekdaysShort');\\n    }\\n\\n    function lists__listWeekdaysMin (localeSorted, format, index) {\\n        return listWeekdaysImpl(localeSorted, format, index, 'weekdaysMin');\\n    }\\n\\n    locale_locales__getSetGlobalLocale('en', {\\n        ordinalParse: /\\\\d{1,2}(th|st|nd|rd)/,\\n        ordinal : function (number) {\\n            var b = number % 10,\\n                output = (toInt(number % 100 / 10) === 1) ? 'th' :\\n                (b === 1) ? 'st' :\\n                (b === 2) ? 'nd' :\\n                (b === 3) ? 'rd' : 'th';\\n            return number + output;\\n        }\\n    });\\n\\n    // Side effect imports\\n    utils_hooks__hooks.lang = deprecate('moment.lang is deprecated. Use moment.locale instead.', locale_locales__getSetGlobalLocale);\\n    utils_hooks__hooks.langData = deprecate('moment.langData is deprecated. Use moment.localeData instead.', locale_locales__getLocale);\\n\\n    var mathAbs = Math.abs;\\n\\n    function duration_abs__abs () {\\n        var data           = this._data;\\n\\n        this._milliseconds = mathAbs(this._milliseconds);\\n        this._days         = mathAbs(this._days);\\n        this._months       = mathAbs(this._months);\\n\\n        data.milliseconds  = mathAbs(data.milliseconds);\\n        data.seconds       = mathAbs(data.seconds);\\n        data.minutes       = mathAbs(data.minutes);\\n        data.hours         = mathAbs(data.hours);\\n        data.months        = mathAbs(data.months);\\n        data.years         = mathAbs(data.years);\\n\\n        return this;\\n    }\\n\\n    function duration_add_subtract__addSubtract (duration, input, value, direction) {\\n        var other = create__createDuration(input, value);\\n\\n        duration._milliseconds += direction * other._milliseconds;\\n        duration._days         += direction * other._days;\\n        duration._months       += direction * other._months;\\n\\n        return duration._bubble();\\n    }\\n\\n    // supports only 2.0-style add(1, 's') or add(duration)\\n    function duration_add_subtract__add (input, value) {\\n        return duration_add_subtract__addSubtract(this, input, value, 1);\\n    }\\n\\n    // supports only 2.0-style subtract(1, 's') or subtract(duration)\\n    function duration_add_subtract__subtract (input, value) {\\n        return duration_add_subtract__addSubtract(this, input, value, -1);\\n    }\\n\\n    function absCeil (number) {\\n        if (number < 0) {\\n            return Math.floor(number);\\n        } else {\\n            return Math.ceil(number);\\n        }\\n    }\\n\\n    function bubble () {\\n        var milliseconds = this._milliseconds;\\n        var days         = this._days;\\n        var months       = this._months;\\n        var data         = this._data;\\n        var seconds, minutes, hours, years, monthsFromDays;\\n\\n        // if we have a mix of positive and negative values, bubble down first\\n        // check: https://github.com/moment/moment/issues/2166\\n        if (!((milliseconds >= 0 && days >= 0 && months >= 0) ||\\n                (milliseconds <= 0 && days <= 0 && months <= 0))) {\\n            milliseconds += absCeil(monthsToDays(months) + days) * 864e5;\\n            days = 0;\\n            months = 0;\\n        }\\n\\n        // The following code bubbles up values, see the tests for\\n        // examples of what that means.\\n        data.milliseconds = milliseconds % 1000;\\n\\n        seconds           = absFloor(milliseconds / 1000);\\n        data.seconds      = seconds % 60;\\n\\n        minutes           = absFloor(seconds / 60);\\n        data.minutes      = minutes % 60;\\n\\n        hours             = absFloor(minutes / 60);\\n        data.hours        = hours % 24;\\n\\n        days += absFloor(hours / 24);\\n\\n        // convert days to months\\n        monthsFromDays = absFloor(daysToMonths(days));\\n        months += monthsFromDays;\\n        days -= absCeil(monthsToDays(monthsFromDays));\\n\\n        // 12 months -> 1 year\\n        years = absFloor(months / 12);\\n        months %= 12;\\n\\n        data.days   = days;\\n        data.months = months;\\n        data.years  = years;\\n\\n        return this;\\n    }\\n\\n    function daysToMonths (days) {\\n        // 400 years have 146097 days (taking into account leap year rules)\\n        // 400 years have 12 months === 4800\\n        return days * 4800 / 146097;\\n    }\\n\\n    function monthsToDays (months) {\\n        // the reverse of daysToMonths\\n        return months * 146097 / 4800;\\n    }\\n\\n    function as (units) {\\n        var days;\\n        var months;\\n        var milliseconds = this._milliseconds;\\n\\n        units = normalizeUnits(units);\\n\\n        if (units === 'month' || units === 'year') {\\n            days   = this._days   + milliseconds / 864e5;\\n            months = this._months + daysToMonths(days);\\n            return units === 'month' ? months : months / 12;\\n        } else {\\n            // handle milliseconds separately because of floating point math errors (issue #1867)\\n            days = this._days + Math.round(monthsToDays(this._months));\\n            switch (units) {\\n                case 'week'   : return days / 7     + milliseconds / 6048e5;\\n                case 'day'    : return days         + milliseconds / 864e5;\\n                case 'hour'   : return days * 24    + milliseconds / 36e5;\\n                case 'minute' : return days * 1440  + milliseconds / 6e4;\\n                case 'second' : return days * 86400 + milliseconds / 1000;\\n                // Math.floor prevents floating point math errors here\\n                case 'millisecond': return Math.floor(days * 864e5) + milliseconds;\\n                default: throw new Error('Unknown unit ' + units);\\n            }\\n        }\\n    }\\n\\n    // TODO: Use this.as('ms')?\\n    function duration_as__valueOf () {\\n        return (\\n            this._milliseconds +\\n            this._days * 864e5 +\\n            (this._months % 12) * 2592e6 +\\n            toInt(this._months / 12) * 31536e6\\n        );\\n    }\\n\\n    function makeAs (alias) {\\n        return function () {\\n            return this.as(alias);\\n        };\\n    }\\n\\n    var asMilliseconds = makeAs('ms');\\n    var asSeconds      = makeAs('s');\\n    var asMinutes      = makeAs('m');\\n    var asHours        = makeAs('h');\\n    var asDays         = makeAs('d');\\n    var asWeeks        = makeAs('w');\\n    var asMonths       = makeAs('M');\\n    var asYears        = makeAs('y');\\n\\n    function duration_get__get (units) {\\n        units = normalizeUnits(units);\\n        return this[units + 's']();\\n    }\\n\\n    function makeGetter(name) {\\n        return function () {\\n            return this._data[name];\\n        };\\n    }\\n\\n    var milliseconds = makeGetter('milliseconds');\\n    var seconds      = makeGetter('seconds');\\n    var minutes      = makeGetter('minutes');\\n    var hours        = makeGetter('hours');\\n    var days         = makeGetter('days');\\n    var months       = makeGetter('months');\\n    var years        = makeGetter('years');\\n\\n    function weeks () {\\n        return absFloor(this.days() / 7);\\n    }\\n\\n    var round = Math.round;\\n    var thresholds = {\\n        s: 45,  // seconds to minute\\n        m: 45,  // minutes to hour\\n        h: 22,  // hours to day\\n        d: 26,  // days to month\\n        M: 11   // months to year\\n    };\\n\\n    // helper function for moment.fn.from, moment.fn.fromNow, and moment.duration.fn.humanize\\n    function substituteTimeAgo(string, number, withoutSuffix, isFuture, locale) {\\n        return locale.relativeTime(number || 1, !!withoutSuffix, string, isFuture);\\n    }\\n\\n    function duration_humanize__relativeTime (posNegDuration, withoutSuffix, locale) {\\n        var duration = create__createDuration(posNegDuration).abs();\\n        var seconds  = round(duration.as('s'));\\n        var minutes  = round(duration.as('m'));\\n        var hours    = round(duration.as('h'));\\n        var days     = round(duration.as('d'));\\n        var months   = round(duration.as('M'));\\n        var years    = round(duration.as('y'));\\n\\n        var a = seconds < thresholds.s && ['s', seconds]  ||\\n                minutes <= 1           && ['m']           ||\\n                minutes < thresholds.m && ['mm', minutes] ||\\n                hours   <= 1           && ['h']           ||\\n                hours   < thresholds.h && ['hh', hours]   ||\\n                days    <= 1           && ['d']           ||\\n                days    < thresholds.d && ['dd', days]    ||\\n                months  <= 1           && ['M']           ||\\n                months  < thresholds.M && ['MM', months]  ||\\n                years   <= 1           && ['y']           || ['yy', years];\\n\\n        a[2] = withoutSuffix;\\n        a[3] = +posNegDuration > 0;\\n        a[4] = locale;\\n        return substituteTimeAgo.apply(null, a);\\n    }\\n\\n    // This function allows you to set a threshold for relative time strings\\n    function duration_humanize__getSetRelativeTimeThreshold (threshold, limit) {\\n        if (thresholds[threshold] === undefined) {\\n            return false;\\n        }\\n        if (limit === undefined) {\\n            return thresholds[threshold];\\n        }\\n        thresholds[threshold] = limit;\\n        return true;\\n    }\\n\\n    function humanize (withSuffix) {\\n        var locale = this.localeData();\\n        var output = duration_humanize__relativeTime(this, !withSuffix, locale);\\n\\n        if (withSuffix) {\\n            output = locale.pastFuture(+this, output);\\n        }\\n\\n        return locale.postformat(output);\\n    }\\n\\n    var iso_string__abs = Math.abs;\\n\\n    function iso_string__toISOString() {\\n        // for ISO strings we do not use the normal bubbling rules:\\n        //  * milliseconds bubble up until they become hours\\n        //  * days do not bubble at all\\n        //  * months bubble up until they become years\\n        // This is because there is no context-free conversion between hours and days\\n        // (think of clock changes)\\n        // and also not between days and months (28-31 days per month)\\n        var seconds = iso_string__abs(this._milliseconds) / 1000;\\n        var days         = iso_string__abs(this._days);\\n        var months       = iso_string__abs(this._months);\\n        var minutes, hours, years;\\n\\n        // 3600 seconds -> 60 minutes -> 1 hour\\n        minutes           = absFloor(seconds / 60);\\n        hours             = absFloor(minutes / 60);\\n        seconds %= 60;\\n        minutes %= 60;\\n\\n        // 12 months -> 1 year\\n        years  = absFloor(months / 12);\\n        months %= 12;\\n\\n\\n        // inspired by https://github.com/dordille/moment-isoduration/blob/master/moment.isoduration.js\\n        var Y = years;\\n        var M = months;\\n        var D = days;\\n        var h = hours;\\n        var m = minutes;\\n        var s = seconds;\\n        var total = this.asSeconds();\\n\\n        if (!total) {\\n            // this is the same as C#'s (Noda) and python (isodate)...\\n            // but not other JS (goog.date)\\n            return 'P0D';\\n        }\\n\\n        return (total < 0 ? '-' : '') +\\n            'P' +\\n            (Y ? Y + 'Y' : '') +\\n            (M ? M + 'M' : '') +\\n            (D ? D + 'D' : '') +\\n            ((h || m || s) ? 'T' : '') +\\n            (h ? h + 'H' : '') +\\n            (m ? m + 'M' : '') +\\n            (s ? s + 'S' : '');\\n    }\\n\\n    var duration_prototype__proto = Duration.prototype;\\n\\n    duration_prototype__proto.abs            = duration_abs__abs;\\n    duration_prototype__proto.add            = duration_add_subtract__add;\\n    duration_prototype__proto.subtract       = duration_add_subtract__subtract;\\n    duration_prototype__proto.as             = as;\\n    duration_prototype__proto.asMilliseconds = asMilliseconds;\\n    duration_prototype__proto.asSeconds      = asSeconds;\\n    duration_prototype__proto.asMinutes      = asMinutes;\\n    duration_prototype__proto.asHours        = asHours;\\n    duration_prototype__proto.asDays         = asDays;\\n    duration_prototype__proto.asWeeks        = asWeeks;\\n    duration_prototype__proto.asMonths       = asMonths;\\n    duration_prototype__proto.asYears        = asYears;\\n    duration_prototype__proto.valueOf        = duration_as__valueOf;\\n    duration_prototype__proto._bubble        = bubble;\\n    duration_prototype__proto.get            = duration_get__get;\\n    duration_prototype__proto.milliseconds   = milliseconds;\\n    duration_prototype__proto.seconds        = seconds;\\n    duration_prototype__proto.minutes        = minutes;\\n    duration_prototype__proto.hours          = hours;\\n    duration_prototype__proto.days           = days;\\n    duration_prototype__proto.weeks          = weeks;\\n    duration_prototype__proto.months         = months;\\n    duration_prototype__proto.years          = years;\\n    duration_prototype__proto.humanize       = humanize;\\n    duration_prototype__proto.toISOString    = iso_string__toISOString;\\n    duration_prototype__proto.toString       = iso_string__toISOString;\\n    duration_prototype__proto.toJSON         = iso_string__toISOString;\\n    duration_prototype__proto.locale         = locale;\\n    duration_prototype__proto.localeData     = localeData;\\n\\n    // Deprecations\\n    duration_prototype__proto.toIsoString = deprecate('toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)', iso_string__toISOString);\\n    duration_prototype__proto.lang = lang;\\n\\n    // Side effect imports\\n\\n    // FORMATTING\\n\\n    addFormatToken('X', 0, 0, 'unix');\\n    addFormatToken('x', 0, 0, 'valueOf');\\n\\n    // PARSING\\n\\n    addRegexToken('x', matchSigned);\\n    addRegexToken('X', matchTimestamp);\\n    addParseToken('X', function (input, array, config) {\\n        config._d = new Date(parseFloat(input, 10) * 1000);\\n    });\\n    addParseToken('x', function (input, array, config) {\\n        config._d = new Date(toInt(input));\\n    });\\n\\n    // Side effect imports\\n\\n\\n    utils_hooks__hooks.version = '2.13.0';\\n\\n    setHookCallback(local__createLocal);\\n\\n    utils_hooks__hooks.fn                    = momentPrototype;\\n    utils_hooks__hooks.min                   = min;\\n    utils_hooks__hooks.max                   = max;\\n    utils_hooks__hooks.now                   = now;\\n    utils_hooks__hooks.utc                   = create_utc__createUTC;\\n    utils_hooks__hooks.unix                  = moment__createUnix;\\n    utils_hooks__hooks.months                = lists__listMonths;\\n    utils_hooks__hooks.isDate                = isDate;\\n    utils_hooks__hooks.locale                = locale_locales__getSetGlobalLocale;\\n    utils_hooks__hooks.invalid               = valid__createInvalid;\\n    utils_hooks__hooks.duration              = create__createDuration;\\n    utils_hooks__hooks.isMoment              = isMoment;\\n    utils_hooks__hooks.weekdays              = lists__listWeekdays;\\n    utils_hooks__hooks.parseZone             = moment__createInZone;\\n    utils_hooks__hooks.localeData            = locale_locales__getLocale;\\n    utils_hooks__hooks.isDuration            = isDuration;\\n    utils_hooks__hooks.monthsShort           = lists__listMonthsShort;\\n    utils_hooks__hooks.weekdaysMin           = lists__listWeekdaysMin;\\n    utils_hooks__hooks.defineLocale          = defineLocale;\\n    utils_hooks__hooks.updateLocale          = updateLocale;\\n    utils_hooks__hooks.locales               = locale_locales__listLocales;\\n    utils_hooks__hooks.weekdaysShort         = lists__listWeekdaysShort;\\n    utils_hooks__hooks.normalizeUnits        = normalizeUnits;\\n    utils_hooks__hooks.relativeTimeThreshold = duration_humanize__getSetRelativeTimeThreshold;\\n    utils_hooks__hooks.prototype             = momentPrototype;\\n\\n    var _moment = utils_hooks__hooks;\\n\\n    return _moment;\\n\\n}));;/**\\n * Parse a text request to a json query object tree\\n *\\n * @param  {String} string The string to parse\\n * @return {Object} The json query tree\\n */\\nfunction parseStringToObject(string) {\\n\\nvar arrayExtend = function () {\\n  var j, i, newlist = [], list_list = arguments;\\n  for (j = 0; j < list_list.length; j += 1) {\\n    for (i = 0; i < list_list[j].length; i += 1) {\\n      newlist.push(list_list[j][i]);\\n    }\\n  }\\n  return newlist;\\n\\n}, mkSimpleQuery = function (key, value, operator) {\\n  var object = {\\\"type\\\": \\\"simple\\\", \\\"key\\\": key, \\\"value\\\": value};\\n  if (operator !== undefined) {\\n    object.operator = operator;\\n  }\\n  return object;\\n\\n}, mkNotQuery = function (query) {\\n  if (query.operator === \\\"NOT\\\") {\\n    return query.query_list[0];\\n  }\\n  return {\\\"type\\\": \\\"complex\\\", \\\"operator\\\": \\\"NOT\\\", \\\"query_list\\\": [query]};\\n\\n}, mkComplexQuery = function (operator, query_list) {\\n  var i, query_list2 = [];\\n  for (i = 0; i < query_list.length; i += 1) {\\n    if (query_list[i].operator === operator) {\\n      query_list2 = arrayExtend(query_list2, query_list[i].query_list);\\n    } else {\\n      query_list2.push(query_list[i]);\\n    }\\n  }\\n  return {type:\\\"complex\\\",operator:operator,query_list:query_list2};\\n\\n}, simpleQuerySetKey = function (query, key) {\\n  var i;\\n  if (query.type === \\\"complex\\\") {\\n    for (i = 0; i < query.query_list.length; ++i) {\\n      simpleQuerySetKey (query.query_list[i],key);\\n    }\\n    return true;\\n  }\\n  if (query.type === \\\"simple\\\" && !query.key) {\\n    query.key = key;\\n    return true;\\n  }\\n  return false;\\n},\\n  error_offsets = [],\\n  error_lookaheads = [],\\n  error_count = 0,\\n  result;\\n;/* parser generated by jison 0.4.16 */\\n/*\\n  Returns a Parser object of the following structure:\\n\\n  Parser: {\\n    yy: {}\\n  }\\n\\n  Parser.prototype: {\\n    yy: {},\\n    trace: function(),\\n    symbols_: {associative list: name ==> number},\\n    terminals_: {associative list: number ==> name},\\n    productions_: [...],\\n    performAction: function anonymous(yytext, yyleng, yylineno, yy, yystate, $$, _$),\\n    table: [...],\\n    defaultActions: {...},\\n    parseError: function(str, hash),\\n    parse: function(input),\\n\\n    lexer: {\\n        EOF: 1,\\n        parseError: function(str, hash),\\n        setInput: function(input),\\n        input: function(),\\n        unput: function(str),\\n        more: function(),\\n        less: function(n),\\n        pastInput: function(),\\n        upcomingInput: function(),\\n        showPosition: function(),\\n        test_match: function(regex_match_array, rule_index),\\n        next: function(),\\n        lex: function(),\\n        begin: function(condition),\\n        popState: function(),\\n        _currentRules: function(),\\n        topState: function(),\\n        pushState: function(condition),\\n\\n        options: {\\n            ranges: boolean           (optional: true ==> token location info will include a .range[] member)\\n            flex: boolean             (optional: true ==> flex-like lexing behaviour where the rules are tested exhaustively to find the longest match)\\n            backtrack_lexer: boolean  (optional: true ==> lexer regexes are tested in order and for each matching regex the action code is invoked; the lexer terminates the scan when a token is returned by the action code)\\n        },\\n\\n        performAction: function(yy, yy_, $avoiding_name_collisions, YY_START),\\n        rules: [...],\\n        conditions: {associative list: name ==> set},\\n    }\\n  }\\n\\n\\n  token location info (@$, _$, etc.): {\\n    first_line: n,\\n    last_line: n,\\n    first_column: n,\\n    last_column: n,\\n    range: [start_number, end_number]       (where the numbers are indexes into the input string, regular zero-based)\\n  }\\n\\n\\n  the parseError function receives a 'hash' object with these members for lexer and parser errors: {\\n    text:        (matched text)\\n    token:       (the produced terminal token, if any)\\n    line:        (yylineno)\\n  }\\n  while parser (grammar) errors will also provide these members, i.e. parser errors deliver a superset of attributes: {\\n    loc:         (yylloc)\\n    expected:    (string describing the set of expected tokens)\\n    recoverable: (boolean: TRUE when the parser has a error recovery rule available for this particular error)\\n  }\\n*/\\nvar parser = (function(){\\nvar o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v);return o},$V0=[1,5],$V1=[1,7],$V2=[1,8],$V3=[1,10],$V4=[1,12],$V5=[1,6,7,15],$V6=[1,6,7,9,12,14,15,16,19,21],$V7=[1,6,7,9,11,12,14,15,16,19,21],$V8=[2,17];\\nvar parser = {trace: function trace() { },\\nyy: {},\\nsymbols_: {\\\"error\\\":2,\\\"begin\\\":3,\\\"search_text\\\":4,\\\"end\\\":5,\\\"EOF\\\":6,\\\"NEWLINE\\\":7,\\\"and_expression\\\":8,\\\"OR\\\":9,\\\"boolean_expression\\\":10,\\\"AND\\\":11,\\\"NOT\\\":12,\\\"expression\\\":13,\\\"LEFT_PARENTHESE\\\":14,\\\"RIGHT_PARENTHESE\\\":15,\\\"WORD\\\":16,\\\"DEFINITION\\\":17,\\\"value\\\":18,\\\"OPERATOR\\\":19,\\\"string\\\":20,\\\"QUOTE\\\":21,\\\"QUOTED_STRING\\\":22,\\\"$accept\\\":0,\\\"$end\\\":1},\\nterminals_: {2:\\\"error\\\",6:\\\"EOF\\\",7:\\\"NEWLINE\\\",9:\\\"OR\\\",11:\\\"AND\\\",12:\\\"NOT\\\",14:\\\"LEFT_PARENTHESE\\\",15:\\\"RIGHT_PARENTHESE\\\",16:\\\"WORD\\\",17:\\\"DEFINITION\\\",19:\\\"OPERATOR\\\",21:\\\"QUOTE\\\",22:\\\"QUOTED_STRING\\\"},\\nproductions_: [0,[3,2],[5,0],[5,1],[5,1],[4,1],[4,2],[4,3],[8,1],[8,3],[10,2],[10,1],[13,3],[13,3],[13,1],[18,2],[18,1],[20,1],[20,3]],\\nperformAction: function anonymous(yytext, yyleng, yylineno, yy, yystate /* action[1] */, $$ /* vstack */, _$ /* lstack */) {\\n/* this == yyval */\\n\\nvar $0 = $$.length - 1;\\nswitch (yystate) {\\ncase 1:\\n return $$[$0-1]; \\nbreak;\\ncase 5: case 8: case 11: case 14: case 16:\\n this.$ = $$[$0]; \\nbreak;\\ncase 6:\\n this.$ = mkComplexQuery('OR', [$$[$0-1], $$[$0]]); \\nbreak;\\ncase 7:\\n this.$ = mkComplexQuery('OR', [$$[$0-2], $$[$0]]); \\nbreak;\\ncase 9:\\n this.$ = mkComplexQuery('AND', [$$[$0-2], $$[$0]]); \\nbreak;\\ncase 10:\\n this.$ = mkNotQuery($$[$0]); \\nbreak;\\ncase 12:\\n this.$ = $$[$0-1]; \\nbreak;\\ncase 13:\\n simpleQuerySetKey($$[$0], $$[$0-2]); this.$ = $$[$0]; \\nbreak;\\ncase 15:\\n $$[$0].operator = $$[$0-1] ; this.$ = $$[$0]; \\nbreak;\\ncase 17:\\n this.$ = mkSimpleQuery('', $$[$0]); \\nbreak;\\ncase 18:\\n this.$ = mkSimpleQuery('', $$[$0-1]); \\nbreak;\\n}\\n},\\ntable: [{3:1,4:2,8:3,10:4,12:$V0,13:6,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},{1:[3]},{1:[2,2],5:13,6:[1,14],7:[1,15]},o($V5,[2,5],{8:3,10:4,13:6,18:9,20:11,4:16,9:[1,17],12:$V0,14:$V1,16:$V2,19:$V3,21:$V4}),o($V6,[2,8],{11:[1,18]}),{13:19,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},o($V7,[2,11]),{4:20,8:3,10:4,12:$V0,13:6,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},o($V7,$V8,{17:[1,21]}),o($V7,[2,14]),{16:[1,23],20:22,21:$V4},o($V7,[2,16]),{22:[1,24]},{1:[2,1]},{1:[2,3]},{1:[2,4]},o($V5,[2,6]),{4:25,8:3,10:4,12:$V0,13:6,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},{8:26,10:4,12:$V0,13:6,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},o($V7,[2,10]),{15:[1,27]},{13:28,14:$V1,16:$V2,18:9,19:$V3,20:11,21:$V4},o($V7,[2,15]),o($V7,$V8),{21:[1,29]},o($V5,[2,7]),o($V6,[2,9]),o($V7,[2,12]),o($V7,[2,13]),o($V7,[2,18])],\\ndefaultActions: {13:[2,1],14:[2,3],15:[2,4]},\\nparseError: function parseError(str, hash) {\\n    if (hash.recoverable) {\\n        this.trace(str);\\n    } else {\\n        function _parseError (msg, hash) {\\n            this.message = msg;\\n            this.hash = hash;\\n        }\\n        _parseError.prototype = new Error();\\n\\n        throw new _parseError(str, hash);\\n    }\\n},\\nparse: function parse(input) {\\n    var self = this, stack = [0], tstack = [], vstack = [null], lstack = [], table = this.table, yytext = '', yylineno = 0, yyleng = 0, recovering = 0, TERROR = 2, EOF = 1;\\n    var args = lstack.slice.call(arguments, 1);\\n    var lexer = Object.create(this.lexer);\\n    var sharedState = { yy: {} };\\n    for (var k in this.yy) {\\n        if (Object.prototype.hasOwnProperty.call(this.yy, k)) {\\n            sharedState.yy[k] = this.yy[k];\\n        }\\n    }\\n    lexer.setInput(input, sharedState.yy);\\n    sharedState.yy.lexer = lexer;\\n    sharedState.yy.parser = this;\\n    if (typeof lexer.yylloc == 'undefined') {\\n        lexer.yylloc = {};\\n    }\\n    var yyloc = lexer.yylloc;\\n    lstack.push(yyloc);\\n    var ranges = lexer.options && lexer.options.ranges;\\n    if (typeof sharedState.yy.parseError === 'function') {\\n        this.parseError = sharedState.yy.parseError;\\n    } else {\\n        this.parseError = Object.getPrototypeOf(this).parseError;\\n    }\\n    function popStack(n) {\\n        stack.length = stack.length - 2 * n;\\n        vstack.length = vstack.length - n;\\n        lstack.length = lstack.length - n;\\n    }\\n    _token_stack:\\n        var lex = function () {\\n            var token;\\n            token = lexer.lex() || EOF;\\n            if (typeof token !== 'number') {\\n                token = self.symbols_[token] || token;\\n            }\\n            return token;\\n        };\\n    var symbol, preErrorSymbol, state, action, a, r, yyval = {}, p, len, newState, expected;\\n    while (true) {\\n        state = stack[stack.length - 1];\\n        if (this.defaultActions[state]) {\\n            action = this.defaultActions[state];\\n        } else {\\n            if (symbol === null || typeof symbol == 'undefined') {\\n                symbol = lex();\\n            }\\n            action = table[state] && table[state][symbol];\\n        }\\n                    if (typeof action === 'undefined' || !action.length || !action[0]) {\\n                var errStr = '';\\n                expected = [];\\n                for (p in table[state]) {\\n                    if (this.terminals_[p] && p > TERROR) {\\n                        expected.push('\\\\'' + this.terminals_[p] + '\\\\'');\\n                    }\\n                }\\n                if (lexer.showPosition) {\\n                    errStr = 'Parse error on line ' + (yylineno + 1) + ':\\\\n' + lexer.showPosition() + '\\\\nExpecting ' + expected.join(', ') + ', got \\\\'' + (this.terminals_[symbol] || symbol) + '\\\\'';\\n                } else {\\n                    errStr = 'Parse error on line ' + (yylineno + 1) + ': Unexpected ' + (symbol == EOF ? 'end of input' : '\\\\'' + (this.terminals_[symbol] || symbol) + '\\\\'');\\n                }\\n                this.parseError(errStr, {\\n                    text: lexer.match,\\n                    token: this.terminals_[symbol] || symbol,\\n                    line: lexer.yylineno,\\n                    loc: yyloc,\\n                    expected: expected\\n                });\\n            }\\n        if (action[0] instanceof Array && action.length > 1) {\\n            throw new Error('Parse Error: multiple actions possible at state: ' + state + ', token: ' + symbol);\\n        }\\n        switch (action[0]) {\\n        case 1:\\n            stack.push(symbol);\\n            vstack.push(lexer.yytext);\\n            lstack.push(lexer.yylloc);\\n            stack.push(action[1]);\\n            symbol = null;\\n            if (!preErrorSymbol) {\\n                yyleng = lexer.yyleng;\\n                yytext = lexer.yytext;\\n                yylineno = lexer.yylineno;\\n                yyloc = lexer.yylloc;\\n                if (recovering > 0) {\\n                    recovering--;\\n                }\\n            } else {\\n                symbol = preErrorSymbol;\\n                preErrorSymbol = null;\\n            }\\n            break;\\n        case 2:\\n            len = this.productions_[action[1]][1];\\n            yyval.$ = vstack[vstack.length - len];\\n            yyval._$ = {\\n                first_line: lstack[lstack.length - (len || 1)].first_line,\\n                last_line: lstack[lstack.length - 1].last_line,\\n                first_column: lstack[lstack.length - (len || 1)].first_column,\\n                last_column: lstack[lstack.length - 1].last_column\\n            };\\n            if (ranges) {\\n                yyval._$.range = [\\n                    lstack[lstack.length - (len || 1)].range[0],\\n                    lstack[lstack.length - 1].range[1]\\n                ];\\n            }\\n            r = this.performAction.apply(yyval, [\\n                yytext,\\n                yyleng,\\n                yylineno,\\n                sharedState.yy,\\n                action[1],\\n                vstack,\\n                lstack\\n            ].concat(args));\\n            if (typeof r !== 'undefined') {\\n                return r;\\n            }\\n            if (len) {\\n                stack = stack.slice(0, -1 * len * 2);\\n                vstack = vstack.slice(0, -1 * len);\\n                lstack = lstack.slice(0, -1 * len);\\n            }\\n            stack.push(this.productions_[action[1]][0]);\\n            vstack.push(yyval.$);\\n            lstack.push(yyval._$);\\n            newState = table[stack[stack.length - 2]][stack[stack.length - 1]];\\n            stack.push(newState);\\n            break;\\n        case 3:\\n            return true;\\n        }\\n    }\\n    return true;\\n}};\\n/* generated by jison-lex 0.3.4 */\\nvar lexer = (function(){\\nvar lexer = ({\\n\\nEOF:1,\\n\\nparseError:function parseError(str, hash) {\\n        if (this.yy.parser) {\\n            this.yy.parser.parseError(str, hash);\\n        } else {\\n            throw new Error(str);\\n        }\\n    },\\n\\n// resets the lexer, sets new input\\nsetInput:function (input, yy) {\\n        this.yy = yy || this.yy || {};\\n        this._input = input;\\n        this._more = this._backtrack = this.done = false;\\n        this.yylineno = this.yyleng = 0;\\n        this.yytext = this.matched = this.match = '';\\n        this.conditionStack = ['INITIAL'];\\n        this.yylloc = {\\n            first_line: 1,\\n            first_column: 0,\\n            last_line: 1,\\n            last_column: 0\\n        };\\n        if (this.options.ranges) {\\n            this.yylloc.range = [0,0];\\n        }\\n        this.offset = 0;\\n        return this;\\n    },\\n\\n// consumes and returns one char from the input\\ninput:function () {\\n        var ch = this._input[0];\\n        this.yytext += ch;\\n        this.yyleng++;\\n        this.offset++;\\n        this.match += ch;\\n        this.matched += ch;\\n        var lines = ch.match(/(?:\\\\r\\\\n?|\\\\n).*/g);\\n        if (lines) {\\n            this.yylineno++;\\n            this.yylloc.last_line++;\\n        } else {\\n            this.yylloc.last_column++;\\n        }\\n        if (this.options.ranges) {\\n            this.yylloc.range[1]++;\\n        }\\n\\n        this._input = this._input.slice(1);\\n        return ch;\\n    },\\n\\n// unshifts one char (or a string) into the input\\nunput:function (ch) {\\n        var len = ch.length;\\n        var lines = ch.split(/(?:\\\\r\\\\n?|\\\\n)/g);\\n\\n        this._input = ch + this._input;\\n        this.yytext = this.yytext.substr(0, this.yytext.length - len);\\n        //this.yyleng -= len;\\n        this.offset -= len;\\n        var oldLines = this.match.split(/(?:\\\\r\\\\n?|\\\\n)/g);\\n        this.match = this.match.substr(0, this.match.length - 1);\\n        this.matched = this.matched.substr(0, this.matched.length - 1);\\n\\n        if (lines.length - 1) {\\n            this.yylineno -= lines.length - 1;\\n        }\\n        var r = this.yylloc.range;\\n\\n        this.yylloc = {\\n            first_line: this.yylloc.first_line,\\n            last_line: this.yylineno + 1,\\n            first_column: this.yylloc.first_column,\\n            last_column: lines ?\\n                (lines.length === oldLines.length ? this.yylloc.first_column : 0)\\n                 + oldLines[oldLines.length - lines.length].length - lines[0].length :\\n              this.yylloc.first_column - len\\n        };\\n\\n        if (this.options.ranges) {\\n            this.yylloc.range = [r[0], r[0] + this.yyleng - len];\\n        }\\n        this.yyleng = this.yytext.length;\\n        return this;\\n    },\\n\\n// When called from action, caches matched text and appends it on next action\\nmore:function () {\\n        this._more = true;\\n        return this;\\n    },\\n\\n// When called from action, signals the lexer that this rule fails to match the input, so the next matching rule (regex) should be tested instead.\\nreject:function () {\\n        if (this.options.backtrack_lexer) {\\n            this._backtrack = true;\\n        } else {\\n            return this.parseError('Lexical error on line ' + (this.yylineno + 1) + '. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\\\\n' + this.showPosition(), {\\n                text: \\\"\\\",\\n                token: null,\\n                line: this.yylineno\\n            });\\n\\n        }\\n        return this;\\n    },\\n\\n// retain first n characters of the match\\nless:function (n) {\\n        this.unput(this.match.slice(n));\\n    },\\n\\n// displays already matched input, i.e. for error messages\\npastInput:function () {\\n        var past = this.matched.substr(0, this.matched.length - this.match.length);\\n        return (past.length > 20 ? '...':'') + past.substr(-20).replace(/\\\\n/g, \\\"\\\");\\n    },\\n\\n// displays upcoming input, i.e. for error messages\\nupcomingInput:function () {\\n        var next = this.match;\\n        if (next.length < 20) {\\n            next += this._input.substr(0, 20-next.length);\\n        }\\n        return (next.substr(0,20) + (next.length > 20 ? '...' : '')).replace(/\\\\n/g, \\\"\\\");\\n    },\\n\\n// displays the character position where the lexing error occurred, i.e. for error messages\\nshowPosition:function () {\\n        var pre = this.pastInput();\\n        var c = new Array(pre.length + 1).join(\\\"-\\\");\\n        return pre + this.upcomingInput() + \\\"\\\\n\\\" + c + \\\"^\\\";\\n    },\\n\\n// test the lexed token: return FALSE when not a match, otherwise return token\\ntest_match:function (match, indexed_rule) {\\n        var token,\\n            lines,\\n            backup;\\n\\n        if (this.options.backtrack_lexer) {\\n            // save context\\n            backup = {\\n                yylineno: this.yylineno,\\n                yylloc: {\\n                    first_line: this.yylloc.first_line,\\n                    last_line: this.last_line,\\n                    first_column: this.yylloc.first_column,\\n                    last_column: this.yylloc.last_column\\n                },\\n                yytext: this.yytext,\\n                match: this.match,\\n                matches: this.matches,\\n                matched: this.matched,\\n                yyleng: this.yyleng,\\n                offset: this.offset,\\n                _more: this._more,\\n                _input: this._input,\\n                yy: this.yy,\\n                conditionStack: this.conditionStack.slice(0),\\n                done: this.done\\n            };\\n            if (this.options.ranges) {\\n                backup.yylloc.range = this.yylloc.range.slice(0);\\n            }\\n        }\\n\\n        lines = match[0].match(/(?:\\\\r\\\\n?|\\\\n).*/g);\\n        if (lines) {\\n            this.yylineno += lines.length;\\n        }\\n        this.yylloc = {\\n            first_line: this.yylloc.last_line,\\n            last_line: this.yylineno + 1,\\n            first_column: this.yylloc.last_column,\\n            last_column: lines ?\\n                         lines[lines.length - 1].length - lines[lines.length - 1].match(/\\\\r?\\\\n?/)[0].length :\\n                         this.yylloc.last_column + match[0].length\\n        };\\n        this.yytext += match[0];\\n        this.match += match[0];\\n        this.matches = match;\\n        this.yyleng = this.yytext.length;\\n        if (this.options.ranges) {\\n            this.yylloc.range = [this.offset, this.offset += this.yyleng];\\n        }\\n        this._more = false;\\n        this._backtrack = false;\\n        this._input = this._input.slice(match[0].length);\\n        this.matched += match[0];\\n        token = this.performAction.call(this, this.yy, this, indexed_rule, this.conditionStack[this.conditionStack.length - 1]);\\n        if (this.done && this._input) {\\n            this.done = false;\\n        }\\n        if (token) {\\n            return token;\\n        } else if (this._backtrack) {\\n            // recover context\\n            for (var k in backup) {\\n                this[k] = backup[k];\\n            }\\n            return false; // rule action called reject() implying the next rule should be tested instead.\\n        }\\n        return false;\\n    },\\n\\n// return next match in input\\nnext:function () {\\n        if (this.done) {\\n            return this.EOF;\\n        }\\n        if (!this._input) {\\n            this.done = true;\\n        }\\n\\n        var token,\\n            match,\\n            tempMatch,\\n            index;\\n        if (!this._more) {\\n            this.yytext = '';\\n            this.match = '';\\n        }\\n        var rules = this._currentRules();\\n        for (var i = 0; i < rules.length; i++) {\\n            tempMatch = this._input.match(this.rules[rules[i]]);\\n            if (tempMatch && (!match || tempMatch[0].length > match[0].length)) {\\n                match = tempMatch;\\n                index = i;\\n                if (this.options.backtrack_lexer) {\\n                    token = this.test_match(tempMatch, rules[i]);\\n                    if (token !== false) {\\n                        return token;\\n                    } else if (this._backtrack) {\\n                        match = false;\\n                        continue; // rule action called reject() implying a rule MISmatch.\\n                    } else {\\n                        // else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)\\n                        return false;\\n                    }\\n                } else if (!this.options.flex) {\\n                    break;\\n                }\\n            }\\n        }\\n        if (match) {\\n            token = this.test_match(match, rules[index]);\\n            if (token !== false) {\\n                return token;\\n            }\\n            // else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)\\n            return false;\\n        }\\n        if (this._input === \\\"\\\") {\\n            return this.EOF;\\n        } else {\\n            return this.parseError('Lexical error on line ' + (this.yylineno + 1) + '. Unrecognized text.\\\\n' + this.showPosition(), {\\n                text: \\\"\\\",\\n                token: null,\\n                line: this.yylineno\\n            });\\n        }\\n    },\\n\\n// return next match that has a token\\nlex:function lex() {\\n        var r = this.next();\\n        if (r) {\\n            return r;\\n        } else {\\n            return this.lex();\\n        }\\n    },\\n\\n// activates a new lexer condition state (pushes the new lexer condition state onto the condition stack)\\nbegin:function begin(condition) {\\n        this.conditionStack.push(condition);\\n    },\\n\\n// pop the previously active lexer condition state off the condition stack\\npopState:function popState() {\\n        var n = this.conditionStack.length - 1;\\n        if (n > 0) {\\n            return this.conditionStack.pop();\\n        } else {\\n            return this.conditionStack[0];\\n        }\\n    },\\n\\n// produce the lexer rule set which is active for the currently active lexer condition state\\n_currentRules:function _currentRules() {\\n        if (this.conditionStack.length && this.conditionStack[this.conditionStack.length - 1]) {\\n            return this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules;\\n        } else {\\n            return this.conditions[\\\"INITIAL\\\"].rules;\\n        }\\n    },\\n\\n// return the currently active lexer condition state; when an index argument is provided it produces the N-th previous condition state, if available\\ntopState:function topState(n) {\\n        n = this.conditionStack.length - 1 - Math.abs(n || 0);\\n        if (n >= 0) {\\n            return this.conditionStack[n];\\n        } else {\\n            return \\\"INITIAL\\\";\\n        }\\n    },\\n\\n// alias for begin(condition)\\npushState:function pushState(condition) {\\n        this.begin(condition);\\n    },\\n\\n// return the number of states currently on the stack\\nstateStackSize:function stateStackSize() {\\n        return this.conditionStack.length;\\n    },\\noptions: {},\\nperformAction: function anonymous(yy,yy_,$avoiding_name_collisions,YY_START) {\\nvar YYSTATE=YY_START;\\nswitch($avoiding_name_collisions) {\\ncase 0:this.begin(\\\"letsquote\\\"); return \\\"QUOTE\\\";\\nbreak;\\ncase 1:this.popState(); this.begin(\\\"endquote\\\"); return \\\"QUOTED_STRING\\\";\\nbreak;\\ncase 2:this.popState(); return \\\"QUOTE\\\";\\nbreak;\\ncase 3:/* skip whitespace */\\nbreak;\\ncase 4:return \\\"LEFT_PARENTHESE\\\";\\nbreak;\\ncase 5:return \\\"RIGHT_PARENTHESE\\\";\\nbreak;\\ncase 6:return \\\"AND\\\";\\nbreak;\\ncase 7:return \\\"OR\\\";\\nbreak;\\ncase 8:return \\\"NOT\\\";\\nbreak;\\ncase 9:return \\\"DEFINITION\\\";\\nbreak;\\ncase 10:return 19;\\nbreak;\\ncase 11:return 16;\\nbreak;\\ncase 12:return 6;\\nbreak;\\n}\\n},\\nrules: [/^(?:\\\")/,/^(?:(\\\\\\\\\\\"|[^\\\"])*)/,/^(?:\\\")/,/^(?:[^\\\\S]+)/,/^(?:\\\\()/,/^(?:\\\\))/,/^(?:AND\\\\b)/,/^(?:OR\\\\b)/,/^(?:NOT\\\\b)/,/^(?::)/,/^(?:(!?=|<=?|>=?))/,/^(?:[^\\\\s\\\\n\\\"():><!=]+)/,/^(?:$)/],\\nconditions: {\\\"endquote\\\":{\\\"rules\\\":[2],\\\"inclusive\\\":false},\\\"letsquote\\\":{\\\"rules\\\":[1],\\\"inclusive\\\":false},\\\"INITIAL\\\":{\\\"rules\\\":[0,3,4,5,6,7,8,9,10,11,12],\\\"inclusive\\\":true}}\\n});\\nreturn lexer;\\n})();\\nparser.lexer = lexer;\\nfunction Parser () {\\n  this.yy = {};\\n}\\nParser.prototype = parser;parser.Parser = Parser;\\nreturn new Parser;\\n})();;  return parser.parse(string);\\n} // parseStringToObject\\n\\n;/*global RSVP, window, parseStringToObject*/\\n/*jslint nomen: true, maxlen: 90*/\\n(function (RSVP, window, parseStringToObject) {\\n  \\\"use strict\\\";\\n\\n  var query_class_dict = {},\\n    regexp_escape = /[\\\\-\\\\[\\\\]{}()*+?.,\\\\\\\\\\\\^$|#\\\\s]/g,\\n    regexp_percent = /%/g,\\n    regexp_underscore = /_/g,\\n    regexp_operator = /^(?:AND|OR|NOT)$/i,\\n    regexp_comparaison = /^(?:!?=|<=?|>=?)$/i;\\n\\n  /**\\n   * Convert metadata values to array of strings. ex:\\n   *\\n   *     \\\"a\\\" -> [\\\"a\\\"],\\n   *     {\\\"content\\\": \\\"a\\\"} -> [\\\"a\\\"]\\n   *\\n   * @param  {Any} value The metadata value\\n   * @return {Array} The value in string array format\\n   */\\n  function metadataValueToStringArray(value) {\\n    var i, new_value = [];\\n    if (value === undefined) {\\n      return undefined;\\n    }\\n    if (!Array.isArray(value)) {\\n      value = [value];\\n    }\\n    for (i = 0; i < value.length; i += 1) {\\n      if (typeof value[i] === 'object') {\\n        new_value[i] = value[i].content;\\n      } else {\\n        new_value[i] = value[i];\\n      }\\n    }\\n    return new_value;\\n  }\\n\\n  /**\\n   * A sort function to sort items by key\\n   *\\n   * @param  {String} key The key to sort on\\n   * @param  {String} [way=\\\"ascending\\\"] 'ascending' or 'descending'\\n   * @return {Function} The sort function\\n   */\\n  function sortFunction(key, way) {\\n    var result;\\n    if (way === 'descending') {\\n      result = 1;\\n    } else if (way === 'ascending') {\\n      result = -1;\\n    } else {\\n      throw new TypeError(\\\"Query.sortFunction(): \\\" +\\n                          \\\"Argument 2 must be 'ascending' or 'descending'\\\");\\n    }\\n    return function (a, b) {\\n      // this comparison is 5 times faster than json comparison\\n      var i, l;\\n      a = metadataValueToStringArray(a[key]) || [];\\n      b = metadataValueToStringArray(b[key]) || [];\\n      l = a.length > b.length ? a.length : b.length;\\n      for (i = 0; i < l; i += 1) {\\n        if (a[i] === undefined) {\\n          return result;\\n        }\\n        if (b[i] === undefined) {\\n          return -result;\\n        }\\n        if (a[i] > b[i]) {\\n          return -result;\\n        }\\n        if (a[i] < b[i]) {\\n          return result;\\n        }\\n      }\\n      return 0;\\n    };\\n  }\\n\\n  /**\\n   * Sort a list of items, according to keys and directions.\\n   *\\n   * @param  {Array} sort_on_option List of couples [key, direction]\\n   * @param  {Array} list The item list to sort\\n   * @return {Array} The filtered list\\n   */\\n  function sortOn(sort_on_option, list) {\\n    var sort_index;\\n    if (!Array.isArray(sort_on_option)) {\\n      throw new TypeError(\\\"jioquery.sortOn(): \\\" +\\n                          \\\"Argument 1 is not of type 'array'\\\");\\n    }\\n    for (sort_index = sort_on_option.length - 1; sort_index >= 0;\\n         sort_index -= 1) {\\n      list.sort(sortFunction(\\n        sort_on_option[sort_index][0],\\n        sort_on_option[sort_index][1]\\n      ));\\n    }\\n    return list;\\n  }\\n\\n  /**\\n   * Limit a list of items, according to index and length.\\n   *\\n   * @param  {Array} limit_option A couple [from, length]\\n   * @param  {Array} list The item list to limit\\n   * @return {Array} The filtered list\\n   */\\n  function limit(limit_option, list) {\\n    if (!Array.isArray(limit_option)) {\\n      throw new TypeError(\\\"jioquery.limit(): \\\" +\\n                          \\\"Argument 1 is not of type 'array'\\\");\\n    }\\n    if (!Array.isArray(list)) {\\n      throw new TypeError(\\\"jioquery.limit(): \\\" +\\n                          \\\"Argument 2 is not of type 'array'\\\");\\n    }\\n    list.splice(0, limit_option[0]);\\n    if (limit_option[1]) {\\n      list.splice(limit_option[1]);\\n    }\\n    return list;\\n  }\\n\\n  /**\\n   * Filter a list of items, modifying them to select only wanted keys.\\n   *\\n   * @param  {Array} select_option Key list to keep\\n   * @param  {Array} list The item list to filter\\n   * @return {Array} The filtered list\\n   */\\n  function select(select_option, list) {\\n    var i, j, new_item;\\n    if (!Array.isArray(select_option)) {\\n      throw new TypeError(\\\"jioquery.select(): \\\" +\\n                          \\\"Argument 1 is not of type Array\\\");\\n    }\\n    if (!Array.isArray(list)) {\\n      throw new TypeError(\\\"jioquery.select(): \\\" +\\n                          \\\"Argument 2 is not of type Array\\\");\\n    }\\n    for (i = 0; i < list.length; i += 1) {\\n      new_item = {};\\n      for (j = 0; j < select_option.length; j += 1) {\\n        if (list[i].hasOwnProperty([select_option[j]])) {\\n          new_item[select_option[j]] = list[i][select_option[j]];\\n        }\\n      }\\n      for (j in new_item) {\\n        if (new_item.hasOwnProperty(j)) {\\n          list[i] = new_item;\\n          break;\\n        }\\n      }\\n    }\\n    return list;\\n  }\\n\\n  /**\\n   * The query to use to filter a list of objects.\\n   * This is an abstract class.\\n   *\\n   * @class Query\\n   * @constructor\\n   */\\n  function Query() {\\n\\n    /**\\n     * Called before parsing the query. Must be overridden!\\n     *\\n     * @method onParseStart\\n     * @param  {Object} object The object shared in the parse process\\n     * @param  {Object} option Some option gave in parse()\\n     */\\n  //   this.onParseStart = emptyFunction;\\n\\n    /**\\n     * Called when parsing a simple query. Must be overridden!\\n     *\\n     * @method onParseSimpleQuery\\n     * @param  {Object} object The object shared in the parse process\\n     * @param  {Object} option Some option gave in parse()\\n     */\\n  //   this.onParseSimpleQuery = emptyFunction;\\n\\n    /**\\n     * Called when parsing a complex query. Must be overridden!\\n     *\\n     * @method onParseComplexQuery\\n     * @param  {Object} object The object shared in the parse process\\n     * @param  {Object} option Some option gave in parse()\\n     */\\n  //   this.onParseComplexQuery = emptyFunction;\\n\\n    /**\\n     * Called after parsing the query. Must be overridden!\\n     *\\n     * @method onParseEnd\\n     * @param  {Object} object The object shared in the parse process\\n     * @param  {Object} option Some option gave in parse()\\n     */\\n  //   this.onParseEnd = emptyFunction;\\n\\n    return;\\n  }\\n\\n  /**\\n   * Filter the item list with matching item only\\n   *\\n   * @method exec\\n   * @param  {Array} item_list The list of object\\n   * @param  {Object} [option] Some operation option\\n   * @param  {Array} [option.select_list] A object keys to retrieve\\n   * @param  {Array} [option.sort_on] Couples of object keys and \\\"ascending\\\"\\n   *                 or \\\"descending\\\"\\n   * @param  {Array} [option.limit] Couple of integer, first is an index and\\n   *                 second is the length.\\n   */\\n  Query.prototype.exec = function (item_list, option) {\\n    if (!Array.isArray(item_list)) {\\n      throw new TypeError(\\\"Query().exec(): Argument 1 is not of type 'array'\\\");\\n    }\\n    if (option === undefined) {\\n      option = {};\\n    }\\n    if (typeof option !== 'object') {\\n      throw new TypeError(\\\"Query().exec(): \\\" +\\n                          \\\"Optional argument 2 is not of type 'object'\\\");\\n    }\\n    var context = this,\\n      i;\\n    for (i = item_list.length - 1; i >= 0; i -= 1) {\\n      if (!context.match(item_list[i])) {\\n        item_list.splice(i, 1);\\n      }\\n    }\\n\\n    if (option.sort_on) {\\n      sortOn(option.sort_on, item_list);\\n    }\\n\\n    if (option.limit) {\\n      limit(option.limit, item_list);\\n    }\\n\\n    select(option.select_list || [], item_list);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return item_list;\\n      });\\n  };\\n\\n  /**\\n   * Test if an item matches this query\\n   *\\n   * @method match\\n   * @param  {Object} item The object to test\\n   * @return {Boolean} true if match, false otherwise\\n   */\\n  Query.prototype.match = function () {\\n    return true;\\n  };\\n\\n  /**\\n   * Browse the Query in deep calling parser method in each step.\\n   *\\n   * `onParseStart` is called first, on end `onParseEnd` is called.\\n   * It starts from the simple queries at the bottom of the tree calling the\\n   * parser method `onParseSimpleQuery`, and go up calling the\\n   * `onParseComplexQuery` method.\\n   *\\n   * @method parse\\n   * @param  {Object} option Any options you want (except 'parsed')\\n   * @return {Any} The parse result\\n   */\\n  Query.prototype.parse = function (option) {\\n    var that = this,\\n      object;\\n    /**\\n     * The recursive parser.\\n     *\\n     * @param  {Object} object The object shared in the parse process\\n     * @param  {Object} options Some options usable in the parseMethods\\n     * @return {Any} The parser result\\n     */\\n    function recParse(object, option) {\\n      var query = object.parsed,\\n        queue = new RSVP.Queue(),\\n        i;\\n\\n      function enqueue(j) {\\n        queue\\n          .push(function () {\\n            object.parsed = query.query_list[j];\\n            return recParse(object, option);\\n          })\\n          .push(function () {\\n            query.query_list[j] = object.parsed;\\n          });\\n      }\\n\\n      if (query.type === \\\"complex\\\") {\\n\\n\\n        for (i = 0; i < query.query_list.length; i += 1) {\\n          enqueue(i);\\n        }\\n\\n        return queue\\n          .push(function () {\\n            object.parsed = query;\\n            return that.onParseComplexQuery(object, option);\\n          });\\n\\n      }\\n      if (query.type === \\\"simple\\\") {\\n        return that.onParseSimpleQuery(object, option);\\n      }\\n    }\\n    object = {\\n      parsed: JSON.parse(JSON.stringify(that.serialized()))\\n    };\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that.onParseStart(object, option);\\n      })\\n      .push(function () {\\n        return recParse(object, option);\\n      })\\n      .push(function () {\\n        return that.onParseEnd(object, option);\\n      })\\n      .push(function () {\\n        return object.parsed;\\n      });\\n\\n  };\\n\\n  /**\\n   * Convert this query to a parsable string.\\n   *\\n   * @method toString\\n   * @return {String} The string version of this query\\n   */\\n  Query.prototype.toString = function () {\\n    return \\\"\\\";\\n  };\\n\\n  /**\\n   * Convert this query to an jsonable object in order to be remake thanks to\\n   * QueryFactory class.\\n   *\\n   * @method serialized\\n   * @return {Object} The jsonable object\\n   */\\n  Query.prototype.serialized = function () {\\n    return undefined;\\n  };\\n\\n  /**\\n   * Provides static methods to create Query object\\n   *\\n   * @class QueryFactory\\n   */\\n  function QueryFactory() {\\n    return;\\n  }\\n\\n  /**\\n   * Escapes regexp special chars from a string.\\n   *\\n   * @param  {String} string The string to escape\\n   * @return {String} The escaped string\\n   */\\n  function stringEscapeRegexpCharacters(string) {\\n    return string.replace(regexp_escape, \\\"\\\\\\\\$&\\\");\\n  }\\n\\n  /**\\n   * Inherits the prototype methods from one constructor into another. The\\n   * prototype of `constructor` will be set to a new object created from\\n   * `superConstructor`.\\n   *\\n   * @param  {Function} constructor The constructor which inherits the super one\\n   * @param  {Function} superConstructor The super constructor\\n   */\\n  function inherits(constructor, superConstructor) {\\n    constructor.super_ = superConstructor;\\n    constructor.prototype = Object.create(superConstructor.prototype, {\\n      \\\"constructor\\\": {\\n        \\\"configurable\\\": true,\\n        \\\"enumerable\\\": false,\\n        \\\"writable\\\": true,\\n        \\\"value\\\": constructor\\n      }\\n    });\\n  }\\n\\n  /**\\n   * Convert a search text to a regexp.\\n   *\\n   * @param  {String} string The string to convert\\n   * @param  {Boolean} [use_wildcard_character=true] Use wildcard \\\"%\\\" and \\\"_\\\"\\n   * @return {RegExp} The search text regexp\\n   */\\n  function searchTextToRegExp(string, use_wildcard_characters) {\\n    if (typeof string !== 'string') {\\n      throw new TypeError(\\\"jioquery.searchTextToRegExp(): \\\" +\\n                          \\\"Argument 1 is not of type 'string'\\\");\\n    }\\n    if (use_wildcard_characters === false) {\\n      return new RegExp(\\\"^\\\" + stringEscapeRegexpCharacters(string) + \\\"$\\\");\\n    }\\n    return new RegExp(\\\"^\\\" + stringEscapeRegexpCharacters(string)\\n      .replace(regexp_percent, '.*')\\n      .replace(regexp_underscore, '.') + \\\"$\\\");\\n  }\\n\\n  /**\\n   * The ComplexQuery inherits from Query, and compares one or several metadata\\n   * values.\\n   *\\n   * @class ComplexQuery\\n   * @extends Query\\n   * @param  {Object} [spec={}] The specifications\\n   * @param  {String} [spec.operator=\\\"AND\\\"] The compare method to use\\n   * @param  {String} spec.key The metadata key\\n   * @param  {String} spec.value The value of the metadata to compare\\n   */\\n  function ComplexQuery(spec, key_schema) {\\n    Query.call(this);\\n\\n    /**\\n     * Logical operator to use to compare object values\\n     *\\n     * @attribute operator\\n     * @type String\\n     * @default \\\"AND\\\"\\n     * @optional\\n     */\\n    this.operator = spec.operator;\\n\\n    /**\\n     * The sub Query list which are used to query an item.\\n     *\\n     * @attribute query_list\\n     * @type Array\\n     * @default []\\n     * @optional\\n     */\\n    this.query_list = spec.query_list || [];\\n    this.query_list = this.query_list.map(\\n      // decorate the map to avoid sending the index as key_schema argument\\n      function (o) { return QueryFactory.create(o, key_schema); }\\n    );\\n\\n  }\\n  inherits(ComplexQuery, Query);\\n\\n  ComplexQuery.prototype.operator = \\\"AND\\\";\\n  ComplexQuery.prototype.type = \\\"complex\\\";\\n\\n  /**\\n   * #crossLink \\\"Query/match:method\\\"\\n   */\\n  ComplexQuery.prototype.match = function (item) {\\n    var operator = this.operator;\\n    if (!(regexp_operator.test(operator))) {\\n      operator = \\\"AND\\\";\\n    }\\n    return this[operator.toUpperCase()](item);\\n  };\\n\\n  /**\\n   * #crossLink \\\"Query/toString:method\\\"\\n   */\\n  ComplexQuery.prototype.toString = function () {\\n    var str_list = [], this_operator = this.operator;\\n    if (this.operator === \\\"NOT\\\") {\\n      str_list.push(\\\"NOT (\\\");\\n      str_list.push(this.query_list[0].toString());\\n      str_list.push(\\\")\\\");\\n      return str_list.join(\\\" \\\");\\n    }\\n    this.query_list.forEach(function (query) {\\n      str_list.push(\\\"(\\\");\\n      str_list.push(query.toString());\\n      str_list.push(\\\")\\\");\\n      str_list.push(this_operator);\\n    });\\n    str_list.length -= 1;\\n    return str_list.join(\\\" \\\");\\n  };\\n\\n  /**\\n   * #crossLink \\\"Query/serialized:method\\\"\\n   */\\n  ComplexQuery.prototype.serialized = function () {\\n    var s = {\\n      \\\"type\\\": \\\"complex\\\",\\n      \\\"operator\\\": this.operator,\\n      \\\"query_list\\\": []\\n    };\\n    this.query_list.forEach(function (query) {\\n      s.query_list.push(\\n        typeof query.toJSON === \\\"function\\\" ? query.toJSON() : query\\n      );\\n    });\\n    return s;\\n  };\\n  ComplexQuery.prototype.toJSON = ComplexQuery.prototype.serialized;\\n\\n  /**\\n   * Comparison operator, test if all sub queries match the\\n   * item value\\n   *\\n   * @method AND\\n   * @param  {Object} item The item to match\\n   * @return {Boolean} true if all match, false otherwise\\n   */\\n  ComplexQuery.prototype.AND = function (item) {\\n    var result = true,\\n      i = 0;\\n\\n    while (result && (i !== this.query_list.length)) {\\n      result = this.query_list[i].match(item);\\n      i += 1;\\n    }\\n    return result;\\n\\n  };\\n\\n  /**\\n   * Comparison operator, test if one of the sub queries matches the\\n   * item value\\n   *\\n   * @method OR\\n   * @param  {Object} item The item to match\\n   * @return {Boolean} true if one match, false otherwise\\n   */\\n  ComplexQuery.prototype.OR = function (item) {\\n    var result = false,\\n      i = 0;\\n\\n    while ((!result) && (i !== this.query_list.length)) {\\n      result = this.query_list[i].match(item);\\n      i += 1;\\n    }\\n\\n    return result;\\n  };\\n\\n  /**\\n   * Comparison operator, test if the sub query does not match the\\n   * item value\\n   *\\n   * @method NOT\\n   * @param  {Object} item The item to match\\n   * @return {Boolean} true if one match, false otherwise\\n   */\\n  ComplexQuery.prototype.NOT = function (item) {\\n    return !this.query_list[0].match(item);\\n  };\\n\\n  /**\\n   * Creates Query object from a search text string or a serialized version\\n   * of a Query.\\n   *\\n   * @method create\\n   * @static\\n   * @param  {Object,String} object The search text or the serialized version\\n   *         of a Query\\n   * @return {Query} A Query object\\n   */\\n  QueryFactory.create = function (object, key_schema) {\\n    if (object === \\\"\\\") {\\n      return new Query();\\n    }\\n    if (typeof object === \\\"string\\\") {\\n      object = parseStringToObject(object);\\n    }\\n    if (typeof (object || {}).type === \\\"string\\\" &&\\n        query_class_dict[object.type]) {\\n      return new query_class_dict[object.type](object, key_schema);\\n    }\\n    throw new TypeError(\\\"QueryFactory.create(): \\\" +\\n                        \\\"Argument 1 is not a search text or a parsable object\\\");\\n  };\\n\\n  function objectToSearchText(query) {\\n    var str_list = [];\\n    if (query.type === \\\"complex\\\") {\\n      str_list.push(\\\"(\\\");\\n      (query.query_list || []).forEach(function (sub_query) {\\n        str_list.push(objectToSearchText(sub_query));\\n        str_list.push(query.operator);\\n      });\\n      str_list.length -= 1;\\n      str_list.push(\\\")\\\");\\n      return str_list.join(\\\" \\\");\\n    }\\n    if (query.type === \\\"simple\\\") {\\n      return (query.key ? query.key + \\\": \\\" : \\\"\\\") +\\n        (query.operator || \\\"\\\") + ' \\\"' + query.value + '\\\"';\\n    }\\n    throw new TypeError(\\\"This object is not a query\\\");\\n  }\\n\\n  function checkKeySchema(key_schema) {\\n    var prop;\\n\\n    if (key_schema !== undefined) {\\n      if (typeof key_schema !== 'object') {\\n        throw new TypeError(\\\"SimpleQuery().create(): \\\" +\\n                            \\\"key_schema is not of type 'object'\\\");\\n      }\\n      // key_set is mandatory\\n      if (key_schema.key_set === undefined) {\\n        throw new TypeError(\\\"SimpleQuery().create(): \\\" +\\n                            \\\"key_schema has no 'key_set' property\\\");\\n      }\\n      for (prop in key_schema) {\\n        if (key_schema.hasOwnProperty(prop)) {\\n          switch (prop) {\\n          case 'key_set':\\n          case 'cast_lookup':\\n          case 'match_lookup':\\n            break;\\n          default:\\n            throw new TypeError(\\\"SimpleQuery().create(): \\\" +\\n                               \\\"key_schema has unknown property '\\\" + prop + \\\"'\\\");\\n          }\\n        }\\n      }\\n    }\\n  }\\n\\n  /**\\n   * The SimpleQuery inherits from Query, and compares one metadata value\\n   *\\n   * @class SimpleQuery\\n   * @extends Query\\n   * @param  {Object} [spec={}] The specifications\\n   * @param  {String} [spec.operator=\\\"=\\\"] The compare method to use\\n   * @param  {String} spec.key The metadata key\\n   * @param  {String} spec.value The value of the metadata to compare\\n   */\\n  function SimpleQuery(spec, key_schema) {\\n    Query.call(this);\\n\\n    checkKeySchema(key_schema);\\n\\n    this._key_schema = key_schema || {};\\n\\n    /**\\n     * Operator to use to compare object values\\n     *\\n     * @attribute operator\\n     * @type String\\n     * @optional\\n     */\\n    this.operator = spec.operator;\\n\\n    /**\\n     * Key of the object which refers to the value to compare\\n     *\\n     * @attribute key\\n     * @type String\\n     */\\n    this.key = spec.key;\\n\\n    /**\\n     * Value is used to do the comparison with the object value\\n     *\\n     * @attribute value\\n     * @type String\\n     */\\n    this.value = spec.value;\\n\\n  }\\n  inherits(SimpleQuery, Query);\\n\\n  SimpleQuery.prototype.type = \\\"simple\\\";\\n\\n  function checkKey(key) {\\n    var prop;\\n\\n    if (key.read_from === undefined) {\\n      throw new TypeError(\\\"Custom key is missing the read_from property\\\");\\n    }\\n\\n    for (prop in key) {\\n      if (key.hasOwnProperty(prop)) {\\n        switch (prop) {\\n        case 'read_from':\\n        case 'cast_to':\\n        case 'equal_match':\\n          break;\\n        default:\\n          throw new TypeError(\\\"Custom key has unknown property '\\\" +\\n                              prop + \\\"'\\\");\\n        }\\n      }\\n    }\\n  }\\n\\n  /**\\n   * #crossLink \\\"Query/match:method\\\"\\n   */\\n  SimpleQuery.prototype.match = function (item) {\\n    var object_value = null,\\n      equal_match = null,\\n      cast_to = null,\\n      matchMethod = null,\\n      operator = this.operator,\\n      value = null,\\n      key = this.key;\\n\\n    if (!(regexp_comparaison.test(operator))) {\\n      // `operator` is not correct, we have to change it to \\\"like\\\" or \\\"=\\\"\\n      if (regexp_percent.test(this.value)) {\\n        // `value` contains a non escaped `%`\\n        operator = \\\"like\\\";\\n      } else {\\n        // `value` does not contain non escaped `%`\\n        operator = \\\"=\\\";\\n      }\\n    }\\n\\n    matchMethod = this[operator];\\n\\n    if (this._key_schema.key_set && this._key_schema.key_set[key] !== undefined) {\\n      key = this._key_schema.key_set[key];\\n    }\\n\\n    if (typeof key === 'object') {\\n      checkKey(key);\\n      object_value = item[key.read_from];\\n\\n      equal_match = key.equal_match;\\n\\n      // equal_match can be a string\\n      if (typeof equal_match === 'string') {\\n        // XXX raise error if equal_match not in match_lookup\\n        equal_match = this._key_schema.match_lookup[equal_match];\\n      }\\n\\n      // equal_match overrides the default '=' operator\\n      if (equal_match !== undefined) {\\n        matchMethod = (operator === \\\"=\\\" || operator === \\\"like\\\" ?\\n                       equal_match : matchMethod);\\n      }\\n\\n      value = this.value;\\n      cast_to = key.cast_to;\\n      if (cast_to) {\\n        // cast_to can be a string\\n        if (typeof cast_to === 'string') {\\n          // XXX raise error if cast_to not in cast_lookup\\n          cast_to = this._key_schema.cast_lookup[cast_to];\\n        }\\n\\n        try {\\n          value = cast_to(value);\\n        } catch (e) {\\n          value = undefined;\\n        }\\n\\n        try {\\n          object_value = cast_to(object_value);\\n        } catch (e) {\\n          object_value = undefined;\\n        }\\n      }\\n    } else {\\n      object_value = item[key];\\n      value = this.value;\\n    }\\n    if (object_value === undefined || value === undefined) {\\n      return false;\\n    }\\n    return matchMethod(object_value, value);\\n  };\\n\\n  /**\\n   * #crossLink \\\"Query/toString:method\\\"\\n   */\\n  SimpleQuery.prototype.toString = function () {\\n    return (this.key ? this.key + \\\":\\\" : \\\"\\\") +\\n      (this.operator ? \\\" \\\" + this.operator : \\\"\\\") + ' \\\"' + this.value + '\\\"';\\n  };\\n\\n  /**\\n   * #crossLink \\\"Query/serialized:method\\\"\\n   */\\n  SimpleQuery.prototype.serialized = function () {\\n    var object = {\\n      \\\"type\\\": \\\"simple\\\",\\n      \\\"key\\\": this.key,\\n      \\\"value\\\": this.value\\n    };\\n    if (this.operator !== undefined) {\\n      object.operator = this.operator;\\n    }\\n    return object;\\n  };\\n  SimpleQuery.prototype.toJSON = SimpleQuery.prototype.serialized;\\n\\n  /**\\n   * Comparison operator, test if this query value matches the item value\\n   *\\n   * @method =\\n   * @param  {String} object_value The value to compare\\n   * @param  {String} comparison_value The comparison value\\n   * @return {Boolean} true if match, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\"=\\\"] = function (object_value, comparison_value) {\\n    var value, i;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    for (i = 0; i < object_value.length; i += 1) {\\n      value = object_value[i];\\n      if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n        value = value.content;\\n      }\\n      if (typeof value.cmp === \\\"function\\\") {\\n        return (value.cmp(comparison_value) === 0);\\n      }\\n      if (comparison_value.toString() === value.toString()) {\\n        return true;\\n      }\\n    }\\n    return false;\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value matches the item value\\n   *\\n   * @method like\\n   * @param  {String} object_value The value to compare\\n   * @param  {String} comparison_value The comparison value\\n   * @return {Boolean} true if match, false otherwise\\n   */\\n  SimpleQuery.prototype.like = function (object_value, comparison_value) {\\n    var value, i;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    for (i = 0; i < object_value.length; i += 1) {\\n      value = object_value[i];\\n      if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n        value = value.content;\\n      }\\n      if (typeof value.cmp === \\\"function\\\") {\\n        return (value.cmp(comparison_value) === 0);\\n      }\\n      if (\\n        searchTextToRegExp(comparison_value.toString()).test(value.toString())\\n      ) {\\n        return true;\\n      }\\n    }\\n    return false;\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value does not match the item value\\n   *\\n   * @method !=\\n   * @param  {String} object_value The value to compare\\n   * @param  {String} comparison_value The comparison value\\n   * @return {Boolean} true if not match, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\"!=\\\"] = function (object_value, comparison_value) {\\n    var value, i;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    for (i = 0; i < object_value.length; i += 1) {\\n      value = object_value[i];\\n      if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n        value = value.content;\\n      }\\n      if (typeof value.cmp === \\\"function\\\") {\\n        return (value.cmp(comparison_value) !== 0);\\n      }\\n      if (comparison_value.toString() === value.toString()) {\\n        return false;\\n      }\\n    }\\n    return true;\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value is lower than the item value\\n   *\\n   * @method <\\n   * @param  {Number, String} object_value The value to compare\\n   * @param  {Number, String} comparison_value The comparison value\\n   * @return {Boolean} true if lower, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\"<\\\"] = function (object_value, comparison_value) {\\n    var value;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    value = object_value[0];\\n    if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n      value = value.content;\\n    }\\n    if (typeof value.cmp === \\\"function\\\") {\\n      return (value.cmp(comparison_value) < 0);\\n    }\\n    return (value < comparison_value);\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value is equal or lower than the\\n   * item value\\n   *\\n   * @method <=\\n   * @param  {Number, String} object_value The value to compare\\n   * @param  {Number, String} comparison_value The comparison value\\n   * @return {Boolean} true if equal or lower, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\"<=\\\"] = function (object_value, comparison_value) {\\n    var value;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    value = object_value[0];\\n    if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n      value = value.content;\\n    }\\n    if (typeof value.cmp === \\\"function\\\") {\\n      return (value.cmp(comparison_value) <= 0);\\n    }\\n    return (value <= comparison_value);\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value is greater than the item\\n   * value\\n   *\\n   * @method >\\n   * @param  {Number, String} object_value The value to compare\\n   * @param  {Number, String} comparison_value The comparison value\\n   * @return {Boolean} true if greater, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\">\\\"] = function (object_value, comparison_value) {\\n    var value;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    value = object_value[0];\\n    if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n      value = value.content;\\n    }\\n    if (typeof value.cmp === \\\"function\\\") {\\n      return (value.cmp(comparison_value) > 0);\\n    }\\n    return (value > comparison_value);\\n  };\\n\\n  /**\\n   * Comparison operator, test if this query value is equal or greater than the\\n   * item value\\n   *\\n   * @method >=\\n   * @param  {Number, String} object_value The value to compare\\n   * @param  {Number, String} comparison_value The comparison value\\n   * @return {Boolean} true if equal or greater, false otherwise\\n   */\\n  SimpleQuery.prototype[\\\">=\\\"] = function (object_value, comparison_value) {\\n    var value;\\n    if (!Array.isArray(object_value)) {\\n      object_value = [object_value];\\n    }\\n    value = object_value[0];\\n    if (typeof value === 'object' && value.hasOwnProperty('content')) {\\n      value = value.content;\\n    }\\n    if (typeof value.cmp === \\\"function\\\") {\\n      return (value.cmp(comparison_value) >= 0);\\n    }\\n    return (value >= comparison_value);\\n  };\\n\\n  query_class_dict.simple = SimpleQuery;\\n  query_class_dict.complex = ComplexQuery;\\n\\n  Query.parseStringToObject = parseStringToObject;\\n  Query.objectToSearchText = objectToSearchText;\\n\\n  window.Query = Query;\\n  window.SimpleQuery = SimpleQuery;\\n  window.ComplexQuery = ComplexQuery;\\n  window.QueryFactory = QueryFactory;\\n\\n}(RSVP, window, parseStringToObject));\\n;/*global window, moment */\\n/*jslint nomen: true, maxlen: 200*/\\n(function (window, moment) {\\n  \\\"use strict\\\";\\n\\n//   /**\\n//    * Add a secured (write permission denied) property to an object.\\n//    *\\n//    * @param  {Object} object The object to fill\\n//    * @param  {String} key The object key where to store the property\\n//    * @param  {Any} value The value to store\\n//    */\\n//   function _export(key, value) {\\n//     Object.defineProperty(to_export, key, {\\n//       \\\"configurable\\\": false,\\n//       \\\"enumerable\\\": true,\\n//       \\\"writable\\\": false,\\n//       \\\"value\\\": value\\n//     });\\n//   }\\n\\n  var YEAR = 'year',\\n    MONTH = 'month',\\n    DAY = 'day',\\n    HOUR = 'hour',\\n    MIN = 'minute',\\n    SEC = 'second',\\n    MSEC = 'millisecond',\\n    precision_grade = {\\n      'year': 0,\\n      'month': 1,\\n      'day': 2,\\n      'hour': 3,\\n      'minute': 4,\\n      'second': 5,\\n      'millisecond': 6\\n    },\\n    lesserPrecision = function (p1, p2) {\\n      return (precision_grade[p1] < precision_grade[p2]) ? p1 : p2;\\n    },\\n    JIODate;\\n\\n\\n  JIODate = function (str) {\\n    // in case of forgotten 'new'\\n    if (!(this instanceof JIODate)) {\\n      return new JIODate(str);\\n    }\\n\\n    if (str instanceof JIODate) {\\n      this.mom = str.mom.clone();\\n      this._precision = str._precision;\\n      return;\\n    }\\n\\n    if (str === undefined) {\\n      this.mom = moment();\\n      this.setPrecision(MSEC);\\n      return;\\n    }\\n\\n    this.mom = null;\\n    this._str = str;\\n\\n    // http://www.w3.org/TR/NOTE-datetime\\n    // http://dotat.at/tmp/ISO_8601-2004_E.pdf\\n\\n    // XXX these regexps fail to detect many invalid dates.\\n\\n    if (str.match(/\\\\d{4}-[01]\\\\d-[0-3]\\\\dT[0-2]\\\\d:[0-5]\\\\d:[0-5]\\\\d\\\\.\\\\d+([+\\\\-][0-2]\\\\d:[0-5]\\\\d|Z)/)\\n          || str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d-\\\\d\\\\d \\\\d\\\\d:\\\\d\\\\d:\\\\d\\\\d\\\\.\\\\d\\\\d\\\\d/)) {\\n      // ISO, milliseconds\\n      this.mom = moment(str);\\n      this.setPrecision(MSEC);\\n    } else if (str.match(/\\\\d{4}-[01]\\\\d-[0-3]\\\\dT[0-2]\\\\d:[0-5]\\\\d:[0-5]\\\\d([+\\\\-][0-2]\\\\d:[0-5]\\\\d|Z)/)\\n          || str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d-\\\\d\\\\d \\\\d\\\\d:\\\\d\\\\d:\\\\d\\\\d/)) {\\n      // ISO, seconds\\n      this.mom = moment(str);\\n      this.setPrecision(SEC);\\n    } else if (str.match(/\\\\d{4}-[01]\\\\d-[0-3]\\\\dT[0-2]\\\\d:[0-5]\\\\d([+\\\\-][0-2]\\\\d:[0-5]\\\\d|Z)/)\\n          || str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d-\\\\d\\\\d \\\\d\\\\d:\\\\d\\\\d/)) {\\n      // ISO, minutes\\n      this.mom = moment(str);\\n      this.setPrecision(MIN);\\n    } else if (str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d-\\\\d\\\\d \\\\d\\\\d/)) {\\n      this.mom = moment(str);\\n      this.setPrecision(HOUR);\\n    } else if (str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d-\\\\d\\\\d/)) {\\n      this.mom = moment(str);\\n      this.setPrecision(DAY);\\n    } else if (str.match(/\\\\d\\\\d\\\\d\\\\d-\\\\d\\\\d/)) {\\n      this.mom = moment(str);\\n      this.setPrecision(MONTH);\\n    } else if (str.match(/\\\\d\\\\d\\\\d\\\\d/)) {\\n      // Creating a moment with only the year will show this deprecation\\n      // warning:\\n      //\\n      // Deprecation warning: moment construction falls back to js Date. This is\\n      // discouraged and will be removed in upcoming major release. Please refer\\n      // to https://github.com/moment/moment/issues/1407 for more info.\\n      //\\n      // TL;DR: parsing year-only strings with momentjs falls back to native\\n      // Date and it won't correctly represent the year in local time if UTF\\n      // offset is negative.\\n      //\\n      // The solution is to use the format parameter, so momentjs won't fall\\n      // back to the native Date and we will have the correct year in local\\n      // time.\\n      //\\n      this.mom = moment(str, 'YYYY');\\n      this.setPrecision(YEAR);\\n    }\\n\\n    if (!this.mom) {\\n      throw new Error(\\\"Cannot parse: \\\" + str);\\n    }\\n\\n  };\\n\\n\\n  JIODate.prototype.setPrecision = function (prec) {\\n    this._precision = prec;\\n  };\\n\\n\\n  JIODate.prototype.getPrecision = function () {\\n    return this._precision;\\n  };\\n\\n\\n  JIODate.prototype.cmp = function (other) {\\n    var m1 = this.mom,\\n      m2 = other.mom,\\n      p = lesserPrecision(this._precision, other._precision);\\n    return m1.isBefore(m2, p) ? -1 : (m1.isSame(m2, p) ? 0 : +1);\\n  };\\n\\n\\n  JIODate.prototype.toPrecisionString = function (precision) {\\n    var fmt;\\n\\n    precision = precision || this._precision;\\n\\n    fmt = {\\n      'millisecond': 'YYYY-MM-DD HH:mm:ss.SSS',\\n      'second': 'YYYY-MM-DD HH:mm:ss',\\n      'minute': 'YYYY-MM-DD HH:mm',\\n      'hour': 'YYYY-MM-DD HH',\\n      'day': 'YYYY-MM-DD',\\n      'month': 'YYYY-MM',\\n      'year': 'YYYY'\\n    }[precision];\\n\\n    if (!fmt) {\\n      throw new TypeError(\\\"Unsupported precision value '\\\" + precision + \\\"'\\\");\\n    }\\n\\n    return this.mom.format(fmt);\\n  };\\n\\n\\n  JIODate.prototype.toString = function () {\\n    return this._str;\\n  };\\n\\n\\n//   _export('JIODate', JIODate);\\n// \\n//   _export('YEAR', YEAR);\\n//   _export('MONTH', MONTH);\\n//   _export('DAY', DAY);\\n//   _export('HOUR', HOUR);\\n//   _export('MIN', MIN);\\n//   _export('SEC', SEC);\\n//   _export('MSEC', MSEC);\\n\\n  window.jiodate = {\\n    JIODate: JIODate,\\n    YEAR: YEAR,\\n    MONTH: MONTH,\\n    DAY: DAY,\\n    HOUR: HOUR,\\n    MIN: MIN,\\n    SEC: SEC,\\n    MSEC: MSEC\\n  };\\n}(window, moment));\\n;/*global window, RSVP, Blob, XMLHttpRequest, QueryFactory, Query, atob,\\n  FileReader, ArrayBuffer, Uint8Array, navigator */\\n(function (window, RSVP, Blob, QueryFactory, Query, atob,\\n           FileReader, ArrayBuffer, Uint8Array, navigator) {\\n  \\\"use strict\\\";\\n\\n  if (window.openDatabase === undefined) {\\n    window.openDatabase = function () {\\n      throw new Error('WebSQL is not supported by ' + navigator.userAgent);\\n    };\\n  }\\n\\n  var util = {},\\n    jIO;\\n\\n  function jIOError(message, status_code) {\\n    if ((message !== undefined) && (typeof message !== \\\"string\\\")) {\\n      throw new TypeError('You must pass a string.');\\n    }\\n    this.message = message || \\\"Default Message\\\";\\n    this.status_code = status_code || 500;\\n  }\\n  jIOError.prototype = new Error();\\n  jIOError.prototype.constructor = jIOError;\\n  util.jIOError = jIOError;\\n\\n  /**\\n   * Send request with XHR and return a promise. xhr.onload: The promise is\\n   * resolved when the status code is lower than 400 with the xhr object as\\n   * first parameter. xhr.onerror: reject with xhr object as first\\n   * parameter. xhr.onprogress: notifies the xhr object.\\n   *\\n   * @param  {Object} param The parameters\\n   * @param  {String} [param.type=\\\"GET\\\"] The request method\\n   * @param  {String} [param.dataType=\\\"\\\"] The data type to retrieve\\n   * @param  {String} param.url The url\\n   * @param  {Any} [param.data] The data to send\\n   * @param  {Function} [param.beforeSend] A function called just before the\\n   *    send request. The first parameter of this function is the XHR object.\\n   * @return {Promise} The promise\\n   */\\n  function ajax(param) {\\n    var xhr = new XMLHttpRequest();\\n    return new RSVP.Promise(function (resolve, reject, notify) {\\n      var k;\\n      xhr.open(param.type || \\\"GET\\\", param.url, true);\\n      xhr.responseType = param.dataType || \\\"\\\";\\n      if (typeof param.headers === 'object' && param.headers !== null) {\\n        for (k in param.headers) {\\n          if (param.headers.hasOwnProperty(k)) {\\n            xhr.setRequestHeader(k, param.headers[k]);\\n          }\\n        }\\n      }\\n      xhr.addEventListener(\\\"load\\\", function (e) {\\n        if (e.target.status >= 400) {\\n          return reject(e);\\n        }\\n        resolve(e);\\n      });\\n      xhr.addEventListener(\\\"error\\\", reject);\\n      xhr.addEventListener(\\\"progress\\\", notify);\\n      if (typeof param.xhrFields === 'object' && param.xhrFields !== null) {\\n        for (k in param.xhrFields) {\\n          if (param.xhrFields.hasOwnProperty(k)) {\\n            xhr[k] = param.xhrFields[k];\\n          }\\n        }\\n      }\\n      if (typeof param.beforeSend === 'function') {\\n        param.beforeSend(xhr);\\n      }\\n      xhr.send(param.data);\\n    }, function () {\\n      xhr.abort();\\n    });\\n  }\\n  util.ajax = ajax;\\n\\n  function readBlobAsText(blob, encoding) {\\n    var fr = new FileReader();\\n    return new RSVP.Promise(function (resolve, reject, notify) {\\n      fr.addEventListener(\\\"load\\\", resolve);\\n      fr.addEventListener(\\\"error\\\", reject);\\n      fr.addEventListener(\\\"progress\\\", notify);\\n      fr.readAsText(blob, encoding);\\n    }, function () {\\n      fr.abort();\\n    });\\n  }\\n  util.readBlobAsText = readBlobAsText;\\n\\n  function readBlobAsArrayBuffer(blob) {\\n    var fr = new FileReader();\\n    return new RSVP.Promise(function (resolve, reject, notify) {\\n      fr.addEventListener(\\\"load\\\", resolve);\\n      fr.addEventListener(\\\"error\\\", reject);\\n      fr.addEventListener(\\\"progress\\\", notify);\\n      fr.readAsArrayBuffer(blob);\\n    }, function () {\\n      fr.abort();\\n    });\\n  }\\n  util.readBlobAsArrayBuffer = readBlobAsArrayBuffer;\\n\\n  function readBlobAsDataURL(blob) {\\n    var fr = new FileReader();\\n    return new RSVP.Promise(function (resolve, reject, notify) {\\n      fr.addEventListener(\\\"load\\\", resolve);\\n      fr.addEventListener(\\\"error\\\", reject);\\n      fr.addEventListener(\\\"progress\\\", notify);\\n      fr.readAsDataURL(blob);\\n    }, function () {\\n      fr.abort();\\n    });\\n  }\\n  util.readBlobAsDataURL = readBlobAsDataURL;\\n\\n  function stringify(obj) {\\n    // Implement a stable JSON.stringify\\n    // Object's keys are alphabetically ordered\\n    var key,\\n      key_list,\\n      i,\\n      value,\\n      result_list;\\n    if (obj === undefined) {\\n      return undefined;\\n    }\\n    if (obj.constructor === Object) {\\n      key_list = Object.keys(obj).sort();\\n      result_list = [];\\n      for (i = 0; i < key_list.length; i += 1) {\\n        key = key_list[i];\\n        value = stringify(obj[key]);\\n        if (value !== undefined) {\\n          result_list.push(stringify(key) + ':' + value);\\n        }\\n      }\\n      return '{' + result_list.join(',') + '}';\\n    }\\n    if (obj.constructor === Array) {\\n      result_list = [];\\n      for (i = 0; i < obj.length; i += 1) {\\n        result_list.push(stringify(obj[i]));\\n      }\\n      return '[' + result_list.join(',') + ']';\\n    }\\n    return JSON.stringify(obj);\\n  }\\n  util.stringify = stringify;\\n\\n\\n  // https://gist.github.com/davoclavo/4424731\\n  function dataURItoBlob(dataURI) {\\n    if (dataURI === 'data:') {\\n      return new Blob();\\n    }\\n    // convert base64 to raw binary data held in a string\\n    var byteString = atob(dataURI.split(',')[1]),\\n    // separate out the mime component\\n      mimeString = dataURI.split(',')[0].split(':')[1],\\n    // write the bytes of the string to an ArrayBuffer\\n      arrayBuffer = new ArrayBuffer(byteString.length),\\n      _ia = new Uint8Array(arrayBuffer),\\n      i;\\n    mimeString = mimeString.slice(0, mimeString.length - \\\";base64\\\".length);\\n    for (i = 0; i < byteString.length; i += 1) {\\n      _ia[i] = byteString.charCodeAt(i);\\n    }\\n    return new Blob([arrayBuffer], {type: mimeString});\\n  }\\n\\n  util.dataURItoBlob = dataURItoBlob;\\n\\n  // tools\\n  function checkId(argument_list, storage, method_name) {\\n    if (typeof argument_list[0] !== 'string' || argument_list[0] === '') {\\n      throw new jIO.util.jIOError(\\n        \\\"Document id must be a non empty string on '\\\" + storage.__type +\\n          \\\".\\\" + method_name + \\\"'.\\\",\\n        400\\n      );\\n    }\\n  }\\n\\n  function checkAttachmentId(argument_list, storage, method_name) {\\n    if (typeof argument_list[1] !== 'string' || argument_list[1] === '') {\\n      throw new jIO.util.jIOError(\\n        \\\"Attachment id must be a non empty string on '\\\" + storage.__type +\\n          \\\".\\\" + method_name + \\\"'.\\\",\\n        400\\n      );\\n    }\\n  }\\n\\n  function declareMethod(klass, name, precondition_function, post_function) {\\n    klass.prototype[name] = function () {\\n      var argument_list = arguments,\\n        context = this,\\n        precondition_result;\\n\\n      return new RSVP.Queue()\\n        .push(function () {\\n          if (precondition_function !== undefined) {\\n            return precondition_function.apply(\\n              context.__storage,\\n              [argument_list, context, name]\\n            );\\n          }\\n        })\\n        .push(function (result) {\\n          var storage_method = context.__storage[name];\\n          precondition_result = result;\\n          if (storage_method === undefined) {\\n            throw new jIO.util.jIOError(\\n              \\\"Capacity '\\\" + name + \\\"' is not implemented on '\\\" +\\n                context.__type + \\\"'\\\",\\n              501\\n            );\\n          }\\n          return storage_method.apply(\\n            context.__storage,\\n            argument_list\\n          );\\n        })\\n        .push(function (result) {\\n          if (post_function !== undefined) {\\n            return post_function.call(\\n              context,\\n              argument_list,\\n              result,\\n              precondition_result\\n            );\\n          }\\n          return result;\\n        });\\n    };\\n    // Allow chain\\n    return this;\\n  }\\n\\n\\n\\n\\n  /////////////////////////////////////////////////////////////////\\n  // jIO Storage Proxy\\n  /////////////////////////////////////////////////////////////////\\n  function JioProxyStorage(type, storage) {\\n    if (!(this instanceof JioProxyStorage)) {\\n      return new JioProxyStorage();\\n    }\\n    this.__type = type;\\n    this.__storage = storage;\\n  }\\n\\n  declareMethod(JioProxyStorage, \\\"put\\\", checkId, function (argument_list) {\\n    return argument_list[0];\\n  });\\n  declareMethod(JioProxyStorage, \\\"get\\\", checkId);\\n  declareMethod(JioProxyStorage, \\\"bulk\\\");\\n  declareMethod(JioProxyStorage, \\\"remove\\\", checkId, function (argument_list) {\\n    return argument_list[0];\\n  });\\n\\n  JioProxyStorage.prototype.post = function () {\\n    var context = this,\\n      argument_list = arguments;\\n    return new RSVP.Queue()\\n      .push(function () {\\n        var storage_method = context.__storage.post;\\n        if (storage_method === undefined) {\\n          throw new jIO.util.jIOError(\\n            \\\"Capacity 'post' is not implemented on '\\\" + context.__type + \\\"'\\\",\\n            501\\n          );\\n        }\\n        return context.__storage.post.apply(context.__storage, argument_list);\\n      });\\n  };\\n\\n  declareMethod(JioProxyStorage, 'putAttachment', function (argument_list,\\n                                                            storage,\\n                                                            method_name) {\\n    checkId(argument_list, storage, method_name);\\n    checkAttachmentId(argument_list, storage, method_name);\\n\\n    var options = argument_list[3] || {};\\n\\n    if (typeof argument_list[2] === 'string') {\\n      argument_list[2] = new Blob([argument_list[2]], {\\n        \\\"type\\\": options._content_type || options._mimetype ||\\n                \\\"text/plain;charset=utf-8\\\"\\n      });\\n    } else if (!(argument_list[2] instanceof Blob)) {\\n      throw new jIO.util.jIOError(\\n        'Attachment content is not a blob',\\n        400\\n      );\\n    }\\n  });\\n\\n  declareMethod(JioProxyStorage, 'removeAttachment', function (argument_list,\\n                                                               storage,\\n                                                               method_name) {\\n    checkId(argument_list, storage, method_name);\\n    checkAttachmentId(argument_list, storage, method_name);\\n  });\\n\\n  declareMethod(JioProxyStorage, 'getAttachment', function (argument_list,\\n                                                            storage,\\n                                                            method_name) {\\n    var result = \\\"blob\\\";\\n//     if (param.storage_spec.type !== \\\"indexeddb\\\" &&\\n//         param.storage_spec.type !== \\\"dav\\\" &&\\n//         (param.kwargs._start !== undefined\\n//          || param.kwargs._end !== undefined)) {\\n//       restCommandRejecter(param, [\\n//         'bad_request',\\n//         'unsupport',\\n//         '_start, _end not support'\\n//       ]);\\n//       return false;\\n//     }\\n    checkId(argument_list, storage, method_name);\\n    checkAttachmentId(argument_list, storage, method_name);\\n    // Drop optional parameters, which are only used in postfunction\\n    if (argument_list[2] !== undefined) {\\n      result = argument_list[2].format || result;\\n      delete argument_list[2].format;\\n    }\\n    return result;\\n  }, function (argument_list, blob, convert) {\\n    var result;\\n    if (!(blob instanceof Blob)) {\\n      throw new jIO.util.jIOError(\\n        \\\"'getAttachment' (\\\" + argument_list[0] + \\\" , \\\" +\\n          argument_list[1] + \\\") on '\\\" + this.__type +\\n          \\\"' does not return a Blob.\\\",\\n        501\\n      );\\n    }\\n    if (convert === \\\"blob\\\") {\\n      result = blob;\\n    } else if (convert === \\\"data_url\\\") {\\n      result = new RSVP.Queue()\\n        .push(function () {\\n          return jIO.util.readBlobAsDataURL(blob);\\n        })\\n        .push(function (evt) {\\n          return evt.target.result;\\n        });\\n    } else if (convert === \\\"array_buffer\\\") {\\n      result = new RSVP.Queue()\\n        .push(function () {\\n          return jIO.util.readBlobAsArrayBuffer(blob);\\n        })\\n        .push(function (evt) {\\n          return evt.target.result;\\n        });\\n    } else if (convert === \\\"text\\\") {\\n      result = new RSVP.Queue()\\n        .push(function () {\\n          return jIO.util.readBlobAsText(blob);\\n        })\\n        .push(function (evt) {\\n          return evt.target.result;\\n        });\\n    } else if (convert === \\\"json\\\") {\\n      result = new RSVP.Queue()\\n        .push(function () {\\n          return jIO.util.readBlobAsText(blob);\\n        })\\n        .push(function (evt) {\\n          return JSON.parse(evt.target.result);\\n        });\\n    } else {\\n      throw new jIO.util.jIOError(\\n        this.__type + \\\".getAttachment format: '\\\" + convert +\\n          \\\"' is not supported\\\",\\n        400\\n      );\\n    }\\n    return result;\\n  });\\n\\n  JioProxyStorage.prototype.buildQuery = function () {\\n    var storage_method = this.__storage.buildQuery,\\n      context = this,\\n      argument_list = arguments;\\n    if (storage_method === undefined) {\\n      throw new jIO.util.jIOError(\\n        \\\"Capacity 'buildQuery' is not implemented on '\\\" + this.__type + \\\"'\\\",\\n        501\\n      );\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return storage_method.apply(\\n          context.__storage,\\n          argument_list\\n        );\\n      });\\n  };\\n\\n  JioProxyStorage.prototype.hasCapacity = function (name) {\\n    var storage_method = this.__storage.hasCapacity,\\n      capacity_method = this.__storage[name];\\n    if (capacity_method !== undefined) {\\n      return true;\\n    }\\n    if ((storage_method === undefined) ||\\n        !storage_method.apply(this.__storage, arguments)) {\\n      throw new jIO.util.jIOError(\\n        \\\"Capacity '\\\" + name + \\\"' is not implemented on '\\\" + this.__type + \\\"'\\\",\\n        501\\n      );\\n    }\\n    return true;\\n  };\\n\\n  JioProxyStorage.prototype.allDocs = function (options) {\\n    var context = this;\\n    if (options === undefined) {\\n      options = {};\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        if (context.hasCapacity(\\\"list\\\") &&\\n            ((options.query === undefined) || context.hasCapacity(\\\"query\\\")) &&\\n            ((options.sort_on === undefined) || context.hasCapacity(\\\"sort\\\")) &&\\n            ((options.select_list === undefined) ||\\n             context.hasCapacity(\\\"select\\\")) &&\\n            ((options.include_docs === undefined) ||\\n             context.hasCapacity(\\\"include\\\")) &&\\n            ((options.limit === undefined) || context.hasCapacity(\\\"limit\\\"))) {\\n          return context.buildQuery(options);\\n        }\\n      })\\n      .push(function (result) {\\n        return {\\n          data: {\\n            rows: result,\\n            total_rows: result.length\\n          }\\n        };\\n      });\\n  };\\n\\n  declareMethod(JioProxyStorage, \\\"allAttachments\\\", checkId);\\n  declareMethod(JioProxyStorage, \\\"repair\\\");\\n\\n  JioProxyStorage.prototype.repair = function () {\\n    var context = this,\\n      argument_list = arguments;\\n    return new RSVP.Queue()\\n      .push(function () {\\n        var storage_method = context.__storage.repair;\\n        if (storage_method !== undefined) {\\n          return context.__storage.repair.apply(context.__storage,\\n                                                argument_list);\\n        }\\n      });\\n  };\\n\\n  /////////////////////////////////////////////////////////////////\\n  // Storage builder\\n  /////////////////////////////////////////////////////////////////\\n  function JioBuilder() {\\n    if (!(this instanceof JioBuilder)) {\\n      return new JioBuilder();\\n    }\\n    this.__storage_types = {};\\n  }\\n\\n  JioBuilder.prototype.createJIO = function (storage_spec, util) {\\n\\n    if (typeof storage_spec.type !== 'string') {\\n      throw new TypeError(\\\"Invalid storage description\\\");\\n    }\\n    if (!this.__storage_types[storage_spec.type]) {\\n      throw new TypeError(\\\"Unknown storage '\\\" + storage_spec.type + \\\"'\\\");\\n    }\\n\\n    return new JioProxyStorage(\\n      storage_spec.type,\\n      new this.__storage_types[storage_spec.type](storage_spec, util)\\n    );\\n\\n  };\\n\\n  JioBuilder.prototype.addStorage = function (type, Constructor) {\\n    if (typeof type !== 'string') {\\n      throw new TypeError(\\n        \\\"jIO.addStorage(): Argument 1 is not of type 'string'\\\"\\n      );\\n    }\\n    if (typeof Constructor !== 'function') {\\n      throw new TypeError(\\\"jIO.addStorage(): \\\" +\\n                          \\\"Argument 2 is not of type 'function'\\\");\\n    }\\n    if (this.__storage_types[type] !== undefined) {\\n      throw new TypeError(\\\"jIO.addStorage(): Storage type already exists\\\");\\n    }\\n    this.__storage_types[type] = Constructor;\\n  };\\n\\n  JioBuilder.prototype.util = util;\\n  JioBuilder.prototype.QueryFactory = QueryFactory;\\n  JioBuilder.prototype.Query = Query;\\n\\n  /////////////////////////////////////////////////////////////////\\n  // global\\n  /////////////////////////////////////////////////////////////////\\n  jIO = new JioBuilder();\\n  window.jIO = jIO;\\n\\n}(window, RSVP, Blob, QueryFactory, Query, atob,\\n  FileReader, ArrayBuffer, Uint8Array, navigator));\\n;/*\\n * Rusha, a JavaScript implementation of the Secure Hash Algorithm, SHA-1,\\n * as defined in FIPS PUB 180-1, tuned for high performance with large inputs.\\n * (http://github.com/srijs/rusha)\\n *\\n * Inspired by Paul Johnstons implementation (http://pajhome.org.uk/crypt/md5).\\n *\\n * Copyright (c) 2013 Sam Rijs (http://awesam.de).\\n * Released under the terms of the MIT license as follows:\\n *\\n * Permission is hereby granted, free of charge, to any person obtaining a\\n * copy of this software and associated documentation files (the \\\"Software\\\"),\\n * to deal in the Software without restriction, including without limitation\\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\\n * and/or sell copies of the Software, and to permit persons to whom the\\n * Software is furnished to do so, subject to the following conditions:\\n *\\n * The above copyright notice and this permission notice shall be included in\\n * all copies or substantial portions of the Software.\\n *\\n * THE SOFTWARE IS PROVIDED \\\"AS IS\\\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\\n * IN THE SOFTWARE.\\n */\\n(function () {\\n    // If we'e running in Node.JS, export a module.\\n    if (typeof module !== 'undefined') {\\n        module.exports = Rusha;\\n    } else if (typeof window !== 'undefined') {\\n        window.Rusha = Rusha;\\n    }\\n    // If we're running in a webworker, accept\\n    // messages containing a jobid and a buffer\\n    // or blob object, and return the hash result.\\n    if (typeof FileReaderSync !== 'undefined') {\\n        var reader = new FileReaderSync(), hasher = new Rusha(4 * 1024 * 1024);\\n        self.onmessage = function onMessage(event) {\\n            var hash, data = event.data.data;\\n            try {\\n                hash = hasher.digest(data);\\n                self.postMessage({\\n                    id: event.data.id,\\n                    hash: hash\\n                });\\n            } catch (e) {\\n                self.postMessage({\\n                    id: event.data.id,\\n                    error: e.name\\n                });\\n            }\\n        };\\n    }\\n    var util = {\\n            getDataType: function (data) {\\n                if (typeof data === 'string') {\\n                    return 'string';\\n                }\\n                if (data instanceof Array) {\\n                    return 'array';\\n                }\\n                if (typeof global !== 'undefined' && global.Buffer && global.Buffer.isBuffer(data)) {\\n                    return 'buffer';\\n                }\\n                if (data instanceof ArrayBuffer) {\\n                    return 'arraybuffer';\\n                }\\n                if (data.buffer instanceof ArrayBuffer) {\\n                    return 'view';\\n                }\\n                if (data instanceof Blob) {\\n                    return 'blob';\\n                }\\n                throw new Error('Unsupported data type.');\\n            }\\n        };\\n    // The Rusha object is a wrapper around the low-level RushaCore.\\n    // It provides means of converting different inputs to the\\n    // format accepted by RushaCore as well as other utility methods.\\n    function Rusha(chunkSize) {\\n        'use strict';\\n        // Private object structure.\\n        var self$2 = { fill: 0 };\\n        // Calculate the length of buffer that the sha1 routine uses\\n        // including the padding.\\n        var padlen = function (len) {\\n            for (len += 9; len % 64 > 0; len += 1);\\n            return len;\\n        };\\n        var padZeroes = function (bin, len) {\\n            for (var i = len >> 2; i < bin.length; i++)\\n                bin[i] = 0;\\n        };\\n        var padData = function (bin, chunkLen, msgLen) {\\n            bin[chunkLen >> 2] |= 128 << 24 - (chunkLen % 4 << 3);\\n            bin[((chunkLen >> 2) + 2 & ~15) + 14] = msgLen >> 29;\\n            bin[((chunkLen >> 2) + 2 & ~15) + 15] = msgLen << 3;\\n        };\\n        // Convert a binary string and write it to the heap.\\n        // A binary string is expected to only contain char codes < 256.\\n        var convStr = function (H8, H32, start, len, off) {\\n            var str = this, i, om = off % 4, lm = len % 4, j = len - lm;\\n            if (j > 0) {\\n                switch (om) {\\n                case 0:\\n                    H8[off + 3 | 0] = str.charCodeAt(start);\\n                case 1:\\n                    H8[off + 2 | 0] = str.charCodeAt(start + 1);\\n                case 2:\\n                    H8[off + 1 | 0] = str.charCodeAt(start + 2);\\n                case 3:\\n                    H8[off | 0] = str.charCodeAt(start + 3);\\n                }\\n            }\\n            for (i = om; i < j; i = i + 4 | 0) {\\n                H32[off + i >> 2] = str.charCodeAt(start + i) << 24 | str.charCodeAt(start + i + 1) << 16 | str.charCodeAt(start + i + 2) << 8 | str.charCodeAt(start + i + 3);\\n            }\\n            switch (lm) {\\n            case 3:\\n                H8[off + j + 1 | 0] = str.charCodeAt(start + j + 2);\\n            case 2:\\n                H8[off + j + 2 | 0] = str.charCodeAt(start + j + 1);\\n            case 1:\\n                H8[off + j + 3 | 0] = str.charCodeAt(start + j);\\n            }\\n        };\\n        // Convert a buffer or array and write it to the heap.\\n        // The buffer or array is expected to only contain elements < 256.\\n        var convBuf = function (H8, H32, start, len, off) {\\n            var buf = this, i, om = off % 4, lm = len % 4, j = len - lm;\\n            if (j > 0) {\\n                switch (om) {\\n                case 0:\\n                    H8[off + 3 | 0] = buf[start];\\n                case 1:\\n                    H8[off + 2 | 0] = buf[start + 1];\\n                case 2:\\n                    H8[off + 1 | 0] = buf[start + 2];\\n                case 3:\\n                    H8[off | 0] = buf[start + 3];\\n                }\\n            }\\n            for (i = 4 - om; i < j; i = i += 4 | 0) {\\n                H32[off + i >> 2] = buf[start + i] << 24 | buf[start + i + 1] << 16 | buf[start + i + 2] << 8 | buf[start + i + 3];\\n            }\\n            switch (lm) {\\n            case 3:\\n                H8[off + j + 1 | 0] = buf[start + j + 2];\\n            case 2:\\n                H8[off + j + 2 | 0] = buf[start + j + 1];\\n            case 1:\\n                H8[off + j + 3 | 0] = buf[start + j];\\n            }\\n        };\\n        var convBlob = function (H8, H32, start, len, off) {\\n            var blob = this, i, om = off % 4, lm = len % 4, j = len - lm;\\n            var buf = new Uint8Array(reader.readAsArrayBuffer(blob.slice(start, start + len)));\\n            if (j > 0) {\\n                switch (om) {\\n                case 0:\\n                    H8[off + 3 | 0] = buf[0];\\n                case 1:\\n                    H8[off + 2 | 0] = buf[1];\\n                case 2:\\n                    H8[off + 1 | 0] = buf[2];\\n                case 3:\\n                    H8[off | 0] = buf[3];\\n                }\\n            }\\n            for (i = 4 - om; i < j; i = i += 4 | 0) {\\n                H32[off + i >> 2] = buf[i] << 24 | buf[i + 1] << 16 | buf[i + 2] << 8 | buf[i + 3];\\n            }\\n            switch (lm) {\\n            case 3:\\n                H8[off + j + 1 | 0] = buf[j + 2];\\n            case 2:\\n                H8[off + j + 2 | 0] = buf[j + 1];\\n            case 1:\\n                H8[off + j + 3 | 0] = buf[j];\\n            }\\n        };\\n        var convFn = function (data) {\\n            switch (util.getDataType(data)) {\\n            case 'string':\\n                return convStr.bind(data);\\n            case 'array':\\n                return convBuf.bind(data);\\n            case 'buffer':\\n                return convBuf.bind(data);\\n            case 'arraybuffer':\\n                return convBuf.bind(new Uint8Array(data));\\n            case 'view':\\n                return convBuf.bind(new Uint8Array(data.buffer, data.byteOffset, data.byteLength));\\n            case 'blob':\\n                return convBlob.bind(data);\\n            }\\n        };\\n        var slice = function (data, offset) {\\n            switch (util.getDataType(data)) {\\n            case 'string':\\n                return data.slice(offset);\\n            case 'array':\\n                return data.slice(offset);\\n            case 'buffer':\\n                return data.slice(offset);\\n            case 'arraybuffer':\\n                return data.slice(offset);\\n            case 'view':\\n                return data.buffer.slice(offset);\\n            }\\n        };\\n        // Convert an ArrayBuffer into its hexadecimal string representation.\\n        var hex = function (arrayBuffer) {\\n            var i, x, hex_tab = '0123456789abcdef', res = [], binarray = new Uint8Array(arrayBuffer);\\n            for (i = 0; i < binarray.length; i++) {\\n                x = binarray[i];\\n                res[i] = hex_tab.charAt(x >> 4 & 15) + hex_tab.charAt(x >> 0 & 15);\\n            }\\n            return res.join('');\\n        };\\n        var ceilHeapSize = function (v) {\\n            // The asm.js spec says:\\n            // The heap object's byteLength must be either\\n            // 2^n for n in [12, 24) or 2^24 * n for n ≥ 1.\\n            // Also, byteLengths smaller than 2^16 are deprecated.\\n            var p;\\n            // If v is smaller than 2^16, the smallest possible solution\\n            // is 2^16.\\n            if (v <= 65536)\\n                return 65536;\\n            // If v < 2^24, we round up to 2^n,\\n            // otherwise we round up to 2^24 * n.\\n            if (v < 16777216) {\\n                for (p = 1; p < v; p = p << 1);\\n            } else {\\n                for (p = 16777216; p < v; p += 16777216);\\n            }\\n            return p;\\n        };\\n        // Initialize the internal data structures to a new capacity.\\n        var init = function (size) {\\n            if (size % 64 > 0) {\\n                throw new Error('Chunk size must be a multiple of 128 bit');\\n            }\\n            self$2.maxChunkLen = size;\\n            self$2.padMaxChunkLen = padlen(size);\\n            // The size of the heap is the sum of:\\n            // 1. The padded input message size\\n            // 2. The extended space the algorithm needs (320 byte)\\n            // 3. The 160 bit state the algoritm uses\\n            self$2.heap = new ArrayBuffer(ceilHeapSize(self$2.padMaxChunkLen + 320 + 20));\\n            self$2.h32 = new Int32Array(self$2.heap);\\n            self$2.h8 = new Int8Array(self$2.heap);\\n            self$2.core = RushaCore({\\n                Int32Array: Int32Array,\\n                DataView: DataView\\n            }, {}, self$2.heap);\\n            self$2.buffer = null;\\n        };\\n        // Iinitializethe datastructures according\\n        // to a chunk siyze.\\n        init(chunkSize || 64 * 1024);\\n        var initState = function (heap, padMsgLen) {\\n            var io = new Int32Array(heap, padMsgLen + 320, 5);\\n            io[0] = 1732584193;\\n            io[1] = -271733879;\\n            io[2] = -1732584194;\\n            io[3] = 271733878;\\n            io[4] = -1009589776;\\n        };\\n        var padChunk = function (chunkLen, msgLen) {\\n            var padChunkLen = padlen(chunkLen);\\n            var view = new Int32Array(self$2.heap, 0, padChunkLen >> 2);\\n            padZeroes(view, chunkLen);\\n            padData(view, chunkLen, msgLen);\\n            return padChunkLen;\\n        };\\n        // Write data to the heap.\\n        var write = function (data, chunkOffset, chunkLen) {\\n            convFn(data)(self$2.h8, self$2.h32, chunkOffset, chunkLen, 0);\\n        };\\n        // Initialize and call the RushaCore,\\n        // assuming an input buffer of length len * 4.\\n        var coreCall = function (data, chunkOffset, chunkLen, msgLen, finalize) {\\n            var padChunkLen = chunkLen;\\n            if (finalize) {\\n                padChunkLen = padChunk(chunkLen, msgLen);\\n            }\\n            write(data, chunkOffset, chunkLen);\\n            self$2.core.hash(padChunkLen, self$2.padMaxChunkLen);\\n        };\\n        var getRawDigest = function (heap, padMaxChunkLen) {\\n            var io = new Int32Array(heap, padMaxChunkLen + 320, 5);\\n            var out = new Int32Array(5);\\n            var arr = new DataView(out.buffer);\\n            arr.setInt32(0, io[0], false);\\n            arr.setInt32(4, io[1], false);\\n            arr.setInt32(8, io[2], false);\\n            arr.setInt32(12, io[3], false);\\n            arr.setInt32(16, io[4], false);\\n            return out;\\n        };\\n        // Calculate the hash digest as an array of 5 32bit integers.\\n        var rawDigest = this.rawDigest = function (str) {\\n                var msgLen = str.byteLength || str.length || str.size || 0;\\n                initState(self$2.heap, self$2.padMaxChunkLen);\\n                var chunkOffset = 0, chunkLen = self$2.maxChunkLen, last;\\n                for (chunkOffset = 0; msgLen > chunkOffset + chunkLen; chunkOffset += chunkLen) {\\n                    coreCall(str, chunkOffset, chunkLen, msgLen, false);\\n                }\\n                coreCall(str, chunkOffset, msgLen - chunkOffset, msgLen, true);\\n                return getRawDigest(self$2.heap, self$2.padMaxChunkLen);\\n            };\\n        // The digest and digestFrom* interface returns the hash digest\\n        // as a hex string.\\n        this.digest = this.digestFromString = this.digestFromBuffer = this.digestFromArrayBuffer = function (str) {\\n            return hex(rawDigest(str).buffer);\\n        };\\n    }\\n    ;\\n    // The low-level RushCore module provides the heart of Rusha,\\n    // a high-speed sha1 implementation working on an Int32Array heap.\\n    // At first glance, the implementation seems complicated, however\\n    // with the SHA1 spec at hand, it is obvious this almost a textbook\\n    // implementation that has a few functions hand-inlined and a few loops\\n    // hand-unrolled.\\n    function RushaCore(stdlib, foreign, heap) {\\n        'use asm';\\n        var H = new stdlib.Int32Array(heap);\\n        function hash(k, x) {\\n            // k in bytes\\n            k = k | 0;\\n            x = x | 0;\\n            var i = 0, j = 0, y0 = 0, z0 = 0, y1 = 0, z1 = 0, y2 = 0, z2 = 0, y3 = 0, z3 = 0, y4 = 0, z4 = 0, t0 = 0, t1 = 0;\\n            y0 = H[x + 320 >> 2] | 0;\\n            y1 = H[x + 324 >> 2] | 0;\\n            y2 = H[x + 328 >> 2] | 0;\\n            y3 = H[x + 332 >> 2] | 0;\\n            y4 = H[x + 336 >> 2] | 0;\\n            for (i = 0; (i | 0) < (k | 0); i = i + 64 | 0) {\\n                z0 = y0;\\n                z1 = y1;\\n                z2 = y2;\\n                z3 = y3;\\n                z4 = y4;\\n                for (j = 0; (j | 0) < 64; j = j + 4 | 0) {\\n                    t1 = H[i + j >> 2] | 0;\\n                    t0 = ((y0 << 5 | y0 >>> 27) + (y1 & y2 | ~y1 & y3) | 0) + ((t1 + y4 | 0) + 1518500249 | 0) | 0;\\n                    y4 = y3;\\n                    y3 = y2;\\n                    y2 = y1 << 30 | y1 >>> 2;\\n                    y1 = y0;\\n                    y0 = t0;\\n                    ;\\n                    H[k + j >> 2] = t1;\\n                }\\n                for (j = k + 64 | 0; (j | 0) < (k + 80 | 0); j = j + 4 | 0) {\\n                    t1 = (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) << 1 | (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) >>> 31;\\n                    t0 = ((y0 << 5 | y0 >>> 27) + (y1 & y2 | ~y1 & y3) | 0) + ((t1 + y4 | 0) + 1518500249 | 0) | 0;\\n                    y4 = y3;\\n                    y3 = y2;\\n                    y2 = y1 << 30 | y1 >>> 2;\\n                    y1 = y0;\\n                    y0 = t0;\\n                    ;\\n                    H[j >> 2] = t1;\\n                }\\n                for (j = k + 80 | 0; (j | 0) < (k + 160 | 0); j = j + 4 | 0) {\\n                    t1 = (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) << 1 | (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) >>> 31;\\n                    t0 = ((y0 << 5 | y0 >>> 27) + (y1 ^ y2 ^ y3) | 0) + ((t1 + y4 | 0) + 1859775393 | 0) | 0;\\n                    y4 = y3;\\n                    y3 = y2;\\n                    y2 = y1 << 30 | y1 >>> 2;\\n                    y1 = y0;\\n                    y0 = t0;\\n                    ;\\n                    H[j >> 2] = t1;\\n                }\\n                for (j = k + 160 | 0; (j | 0) < (k + 240 | 0); j = j + 4 | 0) {\\n                    t1 = (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) << 1 | (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) >>> 31;\\n                    t0 = ((y0 << 5 | y0 >>> 27) + (y1 & y2 | y1 & y3 | y2 & y3) | 0) + ((t1 + y4 | 0) - 1894007588 | 0) | 0;\\n                    y4 = y3;\\n                    y3 = y2;\\n                    y2 = y1 << 30 | y1 >>> 2;\\n                    y1 = y0;\\n                    y0 = t0;\\n                    ;\\n                    H[j >> 2] = t1;\\n                }\\n                for (j = k + 240 | 0; (j | 0) < (k + 320 | 0); j = j + 4 | 0) {\\n                    t1 = (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) << 1 | (H[j - 12 >> 2] ^ H[j - 32 >> 2] ^ H[j - 56 >> 2] ^ H[j - 64 >> 2]) >>> 31;\\n                    t0 = ((y0 << 5 | y0 >>> 27) + (y1 ^ y2 ^ y3) | 0) + ((t1 + y4 | 0) - 899497514 | 0) | 0;\\n                    y4 = y3;\\n                    y3 = y2;\\n                    y2 = y1 << 30 | y1 >>> 2;\\n                    y1 = y0;\\n                    y0 = t0;\\n                    ;\\n                    H[j >> 2] = t1;\\n                }\\n                y0 = y0 + z0 | 0;\\n                y1 = y1 + z1 | 0;\\n                y2 = y2 + z2 | 0;\\n                y3 = y3 + z3 | 0;\\n                y4 = y4 + z4 | 0;\\n            }\\n            H[x + 320 >> 2] = y0;\\n            H[x + 324 >> 2] = y1;\\n            H[x + 328 >> 2] = y2;\\n            H[x + 332 >> 2] = y3;\\n            H[x + 336 >> 2] = y4;\\n        }\\n        return { hash: hash };\\n    }\\n}());;/*\\n * JIO extension for resource replication.\\n * Copyright (C) 2013, 2015  Nexedi SA\\n *\\n *   This library is free software: you can redistribute it and/or modify\\n *   it under the terms of the GNU Lesser General Public License as published by\\n *   the Free Software Foundation, either version 3 of the License, or\\n *   (at your option) any later version.\\n *\\n *   This library is distributed in the hope that it will be useful,\\n *   but WITHOUT ANY WARRANTY; without even the implied warranty of\\n *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\\n *   GNU Lesser General Public License for more details.\\n *\\n *   You should have received a copy of the GNU Lesser General Public License\\n *   along with this program.  If not, see <http://www.gnu.org/licenses/>.\\n */\\n\\n/*jslint nomen: true*/\\n/*global jIO, RSVP, Rusha*/\\n\\n(function (jIO, RSVP, Rusha, stringify) {\\n  \\\"use strict\\\";\\n\\n  var rusha = new Rusha(),\\n    CONFLICT_THROW = 0,\\n    CONFLICT_KEEP_LOCAL = 1,\\n    CONFLICT_KEEP_REMOTE = 2,\\n    CONFLICT_CONTINUE = 3;\\n\\n  /****************************************************\\n   Use a local jIO to read/write/search documents\\n   Synchronize in background those document with a remote jIO.\\n   Synchronization status is stored for each document as an local attachment.\\n  ****************************************************/\\n\\n  function generateHash(content) {\\n    // XXX Improve performance by moving calculation to WebWorker\\n    return rusha.digestFromString(content);\\n  }\\n\\n  function ReplicateStorage(spec) {\\n    this._query_options = spec.query || {};\\n\\n    this._local_sub_storage = jIO.createJIO(spec.local_sub_storage);\\n    this._remote_sub_storage = jIO.createJIO(spec.remote_sub_storage);\\n\\n    this._signature_hash = \\\"_replicate_\\\" + generateHash(\\n      stringify(spec.local_sub_storage) +\\n        stringify(spec.remote_sub_storage) +\\n        stringify(this._query_options)\\n    );\\n    this._signature_sub_storage = jIO.createJIO({\\n      type: \\\"document\\\",\\n      document_id: this._signature_hash,\\n      sub_storage: spec.signature_storage || spec.local_sub_storage\\n    });\\n\\n    this._use_remote_post = spec.use_remote_post || false;\\n\\n    this._conflict_handling = spec.conflict_handling || 0;\\n    // 0: no resolution (ie, throw an Error)\\n    // 1: keep the local state\\n    //    (overwrites the remote document with local content)\\n    //    (delete remote document if local is deleted)\\n    // 2: keep the remote state\\n    //    (overwrites the local document with remote content)\\n    //    (delete local document if remote is deleted)\\n    // 3: keep both copies (leave documents untouched, no signature update)\\n    if ((this._conflict_handling !== CONFLICT_THROW) &&\\n        (this._conflict_handling !== CONFLICT_KEEP_LOCAL) &&\\n        (this._conflict_handling !== CONFLICT_KEEP_REMOTE) &&\\n        (this._conflict_handling !== CONFLICT_CONTINUE)) {\\n      throw new jIO.util.jIOError(\\\"Unsupported conflict handling: \\\" +\\n                                  this._conflict_handling, 400);\\n    }\\n\\n    this._check_local_modification = spec.check_local_modification;\\n    if (this._check_local_modification === undefined) {\\n      this._check_local_modification = true;\\n    }\\n    this._check_local_creation = spec.check_local_creation;\\n    if (this._check_local_creation === undefined) {\\n      this._check_local_creation = true;\\n    }\\n    this._check_local_deletion = spec.check_local_deletion;\\n    if (this._check_local_deletion === undefined) {\\n      this._check_local_deletion = true;\\n    }\\n    this._check_remote_modification = spec.check_remote_modification;\\n    if (this._check_remote_modification === undefined) {\\n      this._check_remote_modification = true;\\n    }\\n    this._check_remote_creation = spec.check_remote_creation;\\n    if (this._check_remote_creation === undefined) {\\n      this._check_remote_creation = true;\\n    }\\n    this._check_remote_deletion = spec.check_remote_deletion;\\n    if (this._check_remote_deletion === undefined) {\\n      this._check_remote_deletion = true;\\n    }\\n  }\\n\\n  ReplicateStorage.prototype.remove = function (id) {\\n    if (id === this._signature_hash) {\\n      throw new jIO.util.jIOError(this._signature_hash + \\\" is frozen\\\",\\n                                  403);\\n    }\\n    return this._local_sub_storage.remove.apply(this._local_sub_storage,\\n                                                arguments);\\n  };\\n  ReplicateStorage.prototype.post = function () {\\n    return this._local_sub_storage.post.apply(this._local_sub_storage,\\n                                              arguments);\\n  };\\n  ReplicateStorage.prototype.put = function (id) {\\n    if (id === this._signature_hash) {\\n      throw new jIO.util.jIOError(this._signature_hash + \\\" is frozen\\\",\\n                                  403);\\n    }\\n    return this._local_sub_storage.put.apply(this._local_sub_storage,\\n                                             arguments);\\n  };\\n  ReplicateStorage.prototype.get = function () {\\n    return this._local_sub_storage.get.apply(this._local_sub_storage,\\n                                             arguments);\\n  };\\n  ReplicateStorage.prototype.hasCapacity = function () {\\n    return this._local_sub_storage.hasCapacity.apply(this._local_sub_storage,\\n                                                     arguments);\\n  };\\n  ReplicateStorage.prototype.buildQuery = function () {\\n    // XXX Remove signature document?\\n    return this._local_sub_storage.buildQuery.apply(this._local_sub_storage,\\n                                                    arguments);\\n  };\\n\\n  ReplicateStorage.prototype.repair = function () {\\n    var context = this,\\n      argument_list = arguments,\\n      skip_document_dict = {};\\n\\n    // Do not sync the signature document\\n    skip_document_dict[context._signature_hash] = null;\\n\\n    function propagateModification(source, destination, doc, hash, id,\\n                                   options) {\\n      var result,\\n        post_id,\\n        to_skip = true;\\n      if (options === undefined) {\\n        options = {};\\n      }\\n      if (options.use_post) {\\n        result = destination.post(doc)\\n          .push(function (new_id) {\\n            to_skip = false;\\n            post_id = new_id;\\n            return source.put(post_id, doc);\\n          })\\n          .push(function () {\\n            return source.remove(id);\\n          })\\n          .push(function () {\\n            return context._signature_sub_storage.remove(id);\\n          })\\n          .push(function () {\\n            to_skip = true;\\n            return context._signature_sub_storage.put(post_id, {\\n              \\\"hash\\\": hash\\n            });\\n          })\\n          .push(function () {\\n            skip_document_dict[post_id] = null;\\n          });\\n      } else {\\n        result = destination.put(id, doc)\\n          .push(function () {\\n            return context._signature_sub_storage.put(id, {\\n              \\\"hash\\\": hash\\n            });\\n          });\\n      }\\n      return result\\n        .push(function () {\\n          if (to_skip) {\\n            skip_document_dict[id] = null;\\n          }\\n        });\\n    }\\n\\n    function propagateDeletion(destination, id) {\\n      return destination.remove(id)\\n        .push(function () {\\n          return context._signature_sub_storage.remove(id);\\n        })\\n        .push(function () {\\n          skip_document_dict[id] = null;\\n        });\\n    }\\n\\n    function checkAndPropagate(status_hash, local_hash, doc,\\n                               source, destination, id,\\n                               conflict_force, conflict_revert,\\n                               conflict_ignore,\\n                               options) {\\n      return destination.get(id)\\n        .push(function (remote_doc) {\\n          return [remote_doc, generateHash(stringify(remote_doc))];\\n        }, function (error) {\\n          if ((error instanceof jIO.util.jIOError) &&\\n              (error.status_code === 404)) {\\n            return [null, null];\\n          }\\n          throw error;\\n        })\\n        .push(function (remote_list) {\\n          var remote_doc = remote_list[0],\\n            remote_hash = remote_list[1];\\n\\n          if (local_hash === remote_hash) {\\n            // Same modifications on both side\\n            if (local_hash === null) {\\n              // Deleted on both side, drop signature\\n              return context._signature_sub_storage.remove(id)\\n                .push(function () {\\n                  skip_document_dict[id] = null;\\n                });\\n            }\\n\\n            return context._signature_sub_storage.put(id, {\\n              \\\"hash\\\": local_hash\\n            })\\n              .push(function () {\\n                skip_document_dict[id] = null;\\n              });\\n          }\\n\\n          if ((remote_hash === status_hash) || (conflict_force === true)) {\\n            // Modified only locally. No conflict or force\\n            if (local_hash === null) {\\n              // Deleted locally\\n              return propagateDeletion(destination, id);\\n            }\\n            return propagateModification(source, destination, doc,\\n                                         local_hash, id,\\n                                         {use_post: ((options.use_post) &&\\n                                                     (remote_hash === null))});\\n          }\\n\\n          // Conflict cases\\n          if (conflict_ignore === true) {\\n            return;\\n          }\\n\\n          if ((conflict_revert === true) || (local_hash === null)) {\\n            // Automatically resolve conflict or force revert\\n            if (remote_hash === null) {\\n              // Deleted remotely\\n              return propagateDeletion(source, id);\\n            }\\n            return propagateModification(\\n              destination,\\n              source,\\n              remote_doc,\\n              remote_hash,\\n              id,\\n              {use_post: ((options.use_revert_post) &&\\n                          (local_hash === null))}\\n            );\\n          }\\n\\n          // Minimize conflict if it can be resolved\\n          if (remote_hash === null) {\\n            // Copy remote modification remotely\\n            return propagateModification(source, destination, doc,\\n                                         local_hash, id,\\n                                         {use_post: options.use_post});\\n          }\\n          throw new jIO.util.jIOError(\\\"Conflict on '\\\" + id + \\\"': \\\" +\\n                                      stringify(doc || '') + \\\" !== \\\" +\\n                                      stringify(remote_doc || ''),\\n                                      409);\\n        });\\n    }\\n\\n    function checkLocalDeletion(queue, destination, id, source,\\n                                conflict_force, conflict_revert,\\n                                conflict_ignore, options) {\\n      var status_hash;\\n      queue\\n        .push(function () {\\n          return context._signature_sub_storage.get(id);\\n        })\\n        .push(function (result) {\\n          status_hash = result.hash;\\n          return checkAndPropagate(status_hash, null, null,\\n                                   source, destination, id,\\n                                   conflict_force, conflict_revert,\\n                                   conflict_ignore,\\n                                   options);\\n        });\\n    }\\n\\n    function checkSignatureDifference(queue, source, destination, id,\\n                                      conflict_force, conflict_revert,\\n                                      conflict_ignore,\\n                                      is_creation, is_modification,\\n                                      getMethod, options) {\\n      queue\\n        .push(function () {\\n          // Optimisation to save a get call to signature storage\\n          if (is_creation === true) {\\n            return RSVP.all([\\n              getMethod(id),\\n              {hash: null}\\n            ]);\\n          }\\n          if (is_modification === true) {\\n            return RSVP.all([\\n              getMethod(id),\\n              context._signature_sub_storage.get(id)\\n            ]);\\n          }\\n          throw new jIO.util.jIOError(\\\"Unexpected call of\\\"\\n                                      + \\\" checkSignatureDifference\\\",\\n                                      409);\\n        })\\n        .push(function (result_list) {\\n          var doc = result_list[0],\\n            local_hash = generateHash(stringify(doc)),\\n            status_hash = result_list[1].hash;\\n\\n          if (local_hash !== status_hash) {\\n            return checkAndPropagate(status_hash, local_hash, doc,\\n                                     source, destination, id,\\n                                     conflict_force, conflict_revert,\\n                                     conflict_ignore,\\n                                     options);\\n          }\\n        });\\n    }\\n\\n    function checkBulkSignatureDifference(queue, source, destination, id_list,\\n                                          document_status_list, options,\\n                                          conflict_force, conflict_revert,\\n                                          conflict_ignore) {\\n      queue\\n        .push(function () {\\n          return source.bulk(id_list);\\n        })\\n        .push(function (result_list) {\\n          var i,\\n            sub_queue = new RSVP.Queue();\\n\\n          function getResult(j) {\\n            return function (id) {\\n              if (id !== id_list[j].parameter_list[0]) {\\n                throw new Error(\\\"Does not access expected ID \\\" + id);\\n              }\\n              return result_list[j];\\n            };\\n          }\\n\\n          for (i = 0; i < result_list.length; i += 1) {\\n            checkSignatureDifference(sub_queue, source, destination,\\n                               id_list[i].parameter_list[0],\\n                               conflict_force, conflict_revert,\\n                               conflict_ignore,\\n                               document_status_list[i].is_creation,\\n                               document_status_list[i].is_modification,\\n                               getResult(i), options);\\n          }\\n          return sub_queue;\\n        });\\n    }\\n\\n    function pushStorage(source, destination, options) {\\n      var queue = new RSVP.Queue();\\n      if (!options.hasOwnProperty(\\\"use_post\\\")) {\\n        options.use_post = false;\\n      }\\n      if (!options.hasOwnProperty(\\\"use_revert_post\\\")) {\\n        options.use_revert_post = false;\\n      }\\n      return queue\\n        .push(function () {\\n          return RSVP.all([\\n            source.allDocs(context._query_options),\\n            context._signature_sub_storage.allDocs()\\n          ]);\\n        })\\n        .push(function (result_list) {\\n          var i,\\n            local_dict = {},\\n            document_list = [],\\n            document_status_list = [],\\n            signature_dict = {},\\n            is_modification,\\n            is_creation,\\n            key;\\n          for (i = 0; i < result_list[0].data.total_rows; i += 1) {\\n            if (!skip_document_dict.hasOwnProperty(\\n                result_list[0].data.rows[i].id\\n              )) {\\n              local_dict[result_list[0].data.rows[i].id] = i;\\n            }\\n          }\\n          for (i = 0; i < result_list[1].data.total_rows; i += 1) {\\n            if (!skip_document_dict.hasOwnProperty(\\n                result_list[1].data.rows[i].id\\n              )) {\\n              signature_dict[result_list[1].data.rows[i].id] = i;\\n            }\\n          }\\n          for (key in local_dict) {\\n            if (local_dict.hasOwnProperty(key)) {\\n              is_modification = signature_dict.hasOwnProperty(key)\\n                && options.check_modification;\\n              is_creation = !signature_dict.hasOwnProperty(key)\\n                && options.check_creation;\\n              if (is_modification === true || is_creation === true) {\\n                if (options.use_bulk_get === true) {\\n                  document_list.push({\\n                    method: \\\"get\\\",\\n                    parameter_list: [key]\\n                  });\\n                  document_status_list.push({\\n                    is_creation: is_creation,\\n                    is_modification: is_modification\\n                  });\\n                } else {\\n                  checkSignatureDifference(queue, source, destination, key,\\n                                           options.conflict_force,\\n                                           options.conflict_revert,\\n                                           options.conflict_ignore,\\n                                           is_creation, is_modification,\\n                                           source.get.bind(source),\\n                                           options);\\n                }\\n              }\\n            }\\n          }\\n          if (options.check_deletion === true) {\\n            for (key in signature_dict) {\\n              if (signature_dict.hasOwnProperty(key)) {\\n                if (!local_dict.hasOwnProperty(key)) {\\n                  checkLocalDeletion(queue, destination, key, source,\\n                                     options.conflict_force,\\n                                     options.conflict_revert,\\n                                     options.conflict_ignore,\\n                                     options);\\n                }\\n              }\\n            }\\n          }\\n          if ((options.use_bulk_get === true) && (document_list.length !== 0)) {\\n            checkBulkSignatureDifference(queue, source, destination,\\n                                         document_list, document_status_list,\\n                                         options,\\n                                         options.conflict_force,\\n                                         options.conflict_revert,\\n                                         options.conflict_ignore);\\n          }\\n        });\\n    }\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        // Ensure that the document storage is usable\\n        return context._signature_sub_storage.__storage._sub_storage.get(\\n          context._signature_hash\\n        );\\n      })\\n      .push(undefined, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          return context._signature_sub_storage.__storage._sub_storage.put(\\n            context._signature_hash,\\n            {}\\n          );\\n        }\\n        throw error;\\n      })\\n\\n      .push(function () {\\n        return RSVP.all([\\n// Don't repair local_sub_storage twice\\n//           context._signature_sub_storage.repair.apply(\\n//             context._signature_sub_storage,\\n//             argument_list\\n//           ),\\n          context._local_sub_storage.repair.apply(\\n            context._local_sub_storage,\\n            argument_list\\n          ),\\n          context._remote_sub_storage.repair.apply(\\n            context._remote_sub_storage,\\n            argument_list\\n          )\\n        ]);\\n      })\\n\\n      .push(function () {\\n        if (context._check_local_modification ||\\n            context._check_local_creation ||\\n            context._check_local_deletion) {\\n          return pushStorage(context._local_sub_storage,\\n                             context._remote_sub_storage,\\n                             {\\n              use_post: context._use_remote_post,\\n              conflict_force: (context._conflict_handling ===\\n                               CONFLICT_KEEP_LOCAL),\\n              conflict_revert: (context._conflict_handling ===\\n                                CONFLICT_KEEP_REMOTE),\\n              conflict_ignore: (context._conflict_handling ===\\n                                CONFLICT_CONTINUE),\\n              check_modification: context._check_local_modification,\\n              check_creation: context._check_local_creation,\\n              check_deletion: context._check_local_deletion\\n            });\\n        }\\n      })\\n      .push(function () {\\n        // Autoactivate bulk if substorage implements it\\n        // Keep it like this until the bulk API is stabilized\\n        var use_bulk_get = false;\\n        try {\\n          use_bulk_get = context._remote_sub_storage.hasCapacity(\\\"bulk\\\");\\n        } catch (error) {\\n          if (!((error instanceof jIO.util.jIOError) &&\\n               (error.status_code === 501))) {\\n            throw error;\\n          }\\n        }\\n        if (context._check_remote_modification ||\\n            context._check_remote_creation ||\\n            context._check_remote_deletion) {\\n          return pushStorage(context._remote_sub_storage,\\n                             context._local_sub_storage, {\\n              use_bulk_get: use_bulk_get,\\n              use_revert_post: context._use_remote_post,\\n              conflict_force: (context._conflict_handling ===\\n                               CONFLICT_KEEP_REMOTE),\\n              conflict_revert: (context._conflict_handling ===\\n                                CONFLICT_KEEP_LOCAL),\\n              conflict_ignore: (context._conflict_handling ===\\n                                CONFLICT_CONTINUE),\\n              check_modification: context._check_remote_modification,\\n              check_creation: context._check_remote_creation,\\n              check_deletion: context._check_remote_deletion\\n            });\\n        }\\n      });\\n  };\\n\\n  jIO.addStorage('replicate', ReplicateStorage);\\n\\n}(jIO, RSVP, Rusha, jIO.util.stringify));\\n;/*\\n * Copyright 2015, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/*jslint nomen: true*/\\n/*global Rusha*/\\n\\n/**\\n * JIO Sha Storage. Type = 'sha'.\\n */\\n\\n(function (Rusha) {\\n  \\\"use strict\\\";\\n\\n  var rusha = new Rusha();\\n\\n  function ShaStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n  }\\n\\n  ShaStorage.prototype.post = function (param) {\\n    return this._sub_storage.put(\\n      rusha.digestFromString(JSON.stringify(param)),\\n      param\\n    );\\n  };\\n\\n  ShaStorage.prototype.get = function () {\\n    return this._sub_storage.get.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.remove = function () {\\n    return this._sub_storage.remove.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.hasCapacity = function () {\\n    return this._sub_storage.hasCapacity.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.buildQuery = function () {\\n    return this._sub_storage.buildQuery.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.getAttachment = function () {\\n    return this._sub_storage.getAttachment.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.putAttachment = function () {\\n    return this._sub_storage.putAttachment.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.removeAttachment = function () {\\n    return this._sub_storage.removeAttachment.apply(this._sub_storage,\\n                                                    arguments);\\n  };\\n  ShaStorage.prototype.allAttachments = function () {\\n    return this._sub_storage.allAttachments.apply(this._sub_storage, arguments);\\n  };\\n  ShaStorage.prototype.repair = function () {\\n    return this._sub_storage.repair.apply(this._sub_storage, arguments);\\n  };\\n\\n  jIO.addStorage('sha', ShaStorage);\\n\\n}(Rusha));\\n;/*jslint nomen: true*/\\n(function (jIO) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The jIO UUIDStorage extension\\n   *\\n   * @class UUIDStorage\\n   * @constructor\\n   */\\n  function UUIDStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n  }\\n\\n  UUIDStorage.prototype.get = function () {\\n    return this._sub_storage.get.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.allAttachments = function () {\\n    return this._sub_storage.allAttachments.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.post = function (param) {\\n\\n    function S4() {\\n      return ('0000' + Math.floor(\\n        Math.random() * 0x10000 /* 65536 */\\n      ).toString(16)).slice(-4);\\n    }\\n\\n    var id = S4() + S4() + \\\"-\\\" +\\n      S4() + \\\"-\\\" +\\n      S4() + \\\"-\\\" +\\n      S4() + \\\"-\\\" +\\n      S4() + S4() + S4();\\n\\n    return this.put(id, param);\\n  };\\n  UUIDStorage.prototype.put = function () {\\n    return this._sub_storage.put.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.remove = function () {\\n    return this._sub_storage.remove.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.getAttachment = function () {\\n    return this._sub_storage.getAttachment.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.putAttachment = function () {\\n    return this._sub_storage.putAttachment.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.removeAttachment = function () {\\n    return this._sub_storage.removeAttachment.apply(this._sub_storage,\\n                                                    arguments);\\n  };\\n  UUIDStorage.prototype.repair = function () {\\n    return this._sub_storage.repair.apply(this._sub_storage, arguments);\\n  };\\n  UUIDStorage.prototype.hasCapacity = function (name) {\\n    return this._sub_storage.hasCapacity(name);\\n  };\\n  UUIDStorage.prototype.buildQuery = function () {\\n    return this._sub_storage.buildQuery.apply(this._sub_storage,\\n                                              arguments);\\n  };\\n\\n  jIO.addStorage('uuid', UUIDStorage);\\n\\n}(jIO));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/*jslint nomen: true*/\\n/*global jIO, RSVP*/\\n\\n/**\\n * JIO Memory Storage. Type = 'memory'.\\n * Memory browser \\\"database\\\" storage.\\n *\\n * Storage Description:\\n *\\n *     {\\n *       \\\"type\\\": \\\"memory\\\"\\n *     }\\n *\\n * @class MemoryStorage\\n */\\n\\n(function (jIO, JSON, RSVP) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The JIO MemoryStorage extension\\n   *\\n   * @class MemoryStorage\\n   * @constructor\\n   */\\n  function MemoryStorage() {\\n    this._database = {};\\n  }\\n\\n  MemoryStorage.prototype.put = function (id, metadata) {\\n    if (!this._database.hasOwnProperty(id)) {\\n      this._database[id] = {\\n        attachments: {}\\n      };\\n    }\\n    this._database[id].doc = JSON.stringify(metadata);\\n    return id;\\n  };\\n\\n  MemoryStorage.prototype.get = function (id) {\\n    try {\\n      return JSON.parse(this._database[id].doc);\\n    } catch (error) {\\n      if (error instanceof TypeError) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find document: \\\" + id,\\n          404\\n        );\\n      }\\n      throw error;\\n    }\\n  };\\n\\n  MemoryStorage.prototype.allAttachments = function (id) {\\n    var key,\\n      attachments = {};\\n    try {\\n      for (key in this._database[id].attachments) {\\n        if (this._database[id].attachments.hasOwnProperty(key)) {\\n          attachments[key] = {};\\n        }\\n      }\\n    } catch (error) {\\n      if (error instanceof TypeError) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find document: \\\" + id,\\n          404\\n        );\\n      }\\n      throw error;\\n    }\\n    return attachments;\\n  };\\n\\n  MemoryStorage.prototype.remove = function (id) {\\n    delete this._database[id];\\n    return id;\\n  };\\n\\n  MemoryStorage.prototype.getAttachment = function (id, name) {\\n    try {\\n      var result = this._database[id].attachments[name];\\n      if (result === undefined) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find attachment: \\\" + id + \\\" , \\\" + name,\\n          404\\n        );\\n      }\\n      return jIO.util.dataURItoBlob(result);\\n    } catch (error) {\\n      if (error instanceof TypeError) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find attachment: \\\" + id + \\\" , \\\" + name,\\n          404\\n        );\\n      }\\n      throw error;\\n    }\\n  };\\n\\n  MemoryStorage.prototype.putAttachment = function (id, name, blob) {\\n    var attachment_dict;\\n    try {\\n      attachment_dict = this._database[id].attachments;\\n    } catch (error) {\\n      if (error instanceof TypeError) {\\n        throw new jIO.util.jIOError(\\\"Cannot find document: \\\" + id, 404);\\n      }\\n      throw error;\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.readBlobAsDataURL(blob);\\n      })\\n      .push(function (evt) {\\n        attachment_dict[name] = evt.target.result;\\n      });\\n  };\\n\\n  MemoryStorage.prototype.removeAttachment = function (id, name) {\\n    try {\\n      delete this._database[id].attachments[name];\\n    } catch (error) {\\n      if (error instanceof TypeError) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find document: \\\" + id,\\n          404\\n        );\\n      }\\n      throw error;\\n    }\\n  };\\n\\n\\n  MemoryStorage.prototype.hasCapacity = function (name) {\\n    return ((name === \\\"list\\\") || (name === \\\"include\\\"));\\n  };\\n\\n  MemoryStorage.prototype.buildQuery = function (options) {\\n    var rows = [],\\n      i;\\n    for (i in this._database) {\\n      if (this._database.hasOwnProperty(i)) {\\n        if (options.include_docs === true) {\\n          rows.push({\\n            id: i,\\n            value: {},\\n            doc: JSON.parse(this._database[i].doc)\\n          });\\n        } else {\\n          rows.push({\\n            id: i,\\n            value: {}\\n          });\\n        }\\n\\n      }\\n    }\\n    return rows;\\n  };\\n\\n  jIO.addStorage('memory', MemoryStorage);\\n\\n}(jIO, JSON, RSVP));\\n;/*jslint nomen: true*/\\n/*global RSVP, Blob, LZString, DOMException*/\\n(function (RSVP, Blob, LZString, DOMException) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The jIO ZipStorage extension\\n   *\\n   * @class ZipStorage\\n   * @constructor\\n   */\\n\\n  var MIME_TYPE = \\\"application/x-jio-utf16_lz_string\\\";\\n\\n  function ZipStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n  }\\n\\n  ZipStorage.prototype.get = function () {\\n    return this._sub_storage.get.apply(this._sub_storage,\\n                                        arguments);\\n  };\\n\\n  ZipStorage.prototype.post = function () {\\n    return this._sub_storage.post.apply(this._sub_storage,\\n                                        arguments);\\n  };\\n\\n  ZipStorage.prototype.put = function () {\\n    return this._sub_storage.put.apply(this._sub_storage,\\n                                       arguments);\\n  };\\n\\n  ZipStorage.prototype.remove = function () {\\n    return this._sub_storage.remove.apply(this._sub_storage,\\n                                          arguments);\\n  };\\n\\n  ZipStorage.prototype.hasCapacity = function () {\\n    return this._sub_storage.hasCapacity.apply(this._sub_storage,\\n                                               arguments);\\n  };\\n\\n  ZipStorage.prototype.buildQuery = function () {\\n    return this._sub_storage.buildQuery.apply(this._sub_storage,\\n                                              arguments);\\n  };\\n\\n  ZipStorage.prototype.getAttachment = function (id, name) {\\n    var that = this;\\n    return that._sub_storage.getAttachment(id, name)\\n      .push(function (blob) {\\n        if (blob.type !== MIME_TYPE) {\\n          return blob;\\n        }\\n        return new RSVP.Queue()\\n          .push(function () {\\n            return jIO.util.readBlobAsText(blob, 'utf16');\\n          })\\n          .push(function (evt) {\\n            var result =\\n              LZString.decompressFromUTF16(evt.target.result);\\n            if (result === '') {\\n              return blob;\\n            }\\n            try {\\n              return jIO.util.dataURItoBlob(\\n                result\\n              );\\n            } catch (error) {\\n              if (error instanceof DOMException) {\\n                return blob;\\n              }\\n              throw error;\\n            }\\n          });\\n      });\\n  };\\n\\n  function myEndsWith(str, query) {\\n    return (str.indexOf(query) === str.length - query.length);\\n  }\\n\\n  ZipStorage.prototype.putAttachment = function (id, name, blob) {\\n    var that = this;\\n    if ((blob.type.indexOf(\\\"text/\\\") === 0) || myEndsWith(blob.type, \\\"xml\\\") ||\\n        myEndsWith(blob.type, \\\"json\\\")) {\\n      return new RSVP.Queue()\\n        .push(function () {\\n          return jIO.util.readBlobAsDataURL(blob);\\n        })\\n        .push(function (data) {\\n          var result = LZString.compressToUTF16(data.target.result);\\n          blob = new Blob([result],\\n                          {type: MIME_TYPE});\\n          return that._sub_storage.putAttachment(id, name, blob);\\n        });\\n    }\\n    return this._sub_storage.putAttachment.apply(this._sub_storage,\\n                                                 arguments);\\n  };\\n\\n  ZipStorage.prototype.removeAttachment = function () {\\n    return this._sub_storage.removeAttachment.apply(this._sub_storage,\\n                                                    arguments);\\n  };\\n\\n  ZipStorage.prototype.allAttachments = function () {\\n    return this._sub_storage.allAttachments.apply(this._sub_storage,\\n                                                  arguments);\\n  };\\n\\n  jIO.addStorage('zip', ZipStorage);\\n}(RSVP, Blob, LZString, DOMException));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n/**\\n * JIO Dropbox Storage. Type = \\\"dropbox\\\".\\n * Dropbox \\\"database\\\" storage.\\n */\\n/*global Blob, jIO, RSVP, UriTemplate*/\\n/*jslint nomen: true*/\\n\\n(function (jIO, RSVP, Blob, UriTemplate) {\\n  \\\"use strict\\\";\\n  var UPLOAD_URL = \\\"https://content.dropboxapi.com/1/files_put/\\\" +\\n      \\\"{+root}{+id}{+name}{?access_token}\\\",\\n    upload_template = UriTemplate.parse(UPLOAD_URL),\\n    CREATE_DIR_URL = \\\"https://api.dropboxapi.com/1/fileops/create_folder\\\" +\\n      \\\"{?access_token,root,path}\\\",\\n    create_dir_template = UriTemplate.parse(CREATE_DIR_URL),\\n    REMOVE_URL = \\\"https://api.dropboxapi.com/1/fileops/delete/\\\" +\\n      \\\"{?access_token,root,path}\\\",\\n    remote_template = UriTemplate.parse(REMOVE_URL),\\n    GET_URL = \\\"https://content.dropboxapi.com/1/files\\\" +\\n      \\\"{/root,id}{+name}{?access_token}\\\",\\n    get_template = UriTemplate.parse(GET_URL),\\n    //LIST_URL = 'https://api.dropboxapi.com/1/metadata/sandbox/';\\n    METADATA_URL = \\\"https://api.dropboxapi.com/1/metadata\\\" +\\n      \\\"{/root}{+id}{?access_token}\\\",\\n    metadata_template = UriTemplate.parse(METADATA_URL);\\n\\n  function restrictDocumentId(id) {\\n    if (id.indexOf(\\\"/\\\") !== 0) {\\n      throw new jIO.util.jIOError(\\\"id \\\" + id + \\\" is forbidden (no begin /)\\\",\\n                                  400);\\n    }\\n    if (id.lastIndexOf(\\\"/\\\") !== (id.length - 1)) {\\n      throw new jIO.util.jIOError(\\\"id \\\" + id + \\\" is forbidden (no end /)\\\",\\n                                  400);\\n    }\\n    return id;\\n  }\\n\\n  function restrictAttachmentId(id) {\\n    if (id.indexOf(\\\"/\\\") !== -1) {\\n      throw new jIO.util.jIOError(\\\"attachment \\\" + id + \\\" is forbidden\\\",\\n                                  400);\\n    }\\n  }\\n\\n  /**\\n   * The JIO Dropbox Storage extension\\n   *\\n   * @class DropboxStorage\\n   * @constructor\\n   */\\n  function DropboxStorage(spec) {\\n    if (typeof spec.access_token !== 'string' || !spec.access_token) {\\n      throw new TypeError(\\\"Access Token' must be a string \\\" +\\n                          \\\"which contains more than one character.\\\");\\n    }\\n    if (typeof spec.root !== 'string' || !spec.root ||\\n        (spec.root !== \\\"dropbox\\\" && spec.root !== \\\"sandbox\\\")) {\\n      throw new TypeError(\\\"root must be 'dropbox' or 'sandbox'\\\");\\n    }\\n    this._access_token = spec.access_token;\\n    this._root = spec.root;\\n  }\\n\\n  DropboxStorage.prototype.put = function (id, param) {\\n    var that = this;\\n    id = restrictDocumentId(id);\\n    if (Object.getOwnPropertyNames(param).length > 0) {\\n      // Reject if param has some properties\\n      throw new jIO.util.jIOError(\\\"Can not store properties: \\\" +\\n                                  Object.getOwnPropertyNames(param), 400);\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"POST\\\",\\n          url: create_dir_template.expand({\\n            access_token: that._access_token,\\n            root: that._root,\\n            path: id\\n          })\\n        });\\n      })\\n      .push(undefined, function (err) {\\n        if ((err.target !== undefined) &&\\n            (err.target.status === 405)) {\\n          // Directory already exists, no need to fail\\n          return;\\n        }\\n        throw err;\\n      });\\n  };\\n\\n  DropboxStorage.prototype.remove = function (id) {\\n    id = restrictDocumentId(id);\\n    return jIO.util.ajax({\\n      type: \\\"POST\\\",\\n      url: remote_template.expand({\\n        access_token: this._access_token,\\n        root: this._root,\\n        path: id\\n      })\\n    });\\n  };\\n\\n  DropboxStorage.prototype.get = function (id) {\\n    var that = this;\\n\\n    if (id === \\\"/\\\") {\\n      return {};\\n    }\\n    id = restrictDocumentId(id);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"GET\\\",\\n          url: metadata_template.expand({\\n            access_token: that._access_token,\\n            root: that._root,\\n            id: id\\n          })\\n        });\\n      })\\n      .push(function (evt) {\\n        var obj = JSON.parse(evt.target.response ||\\n                             evt.target.responseText);\\n        if (obj.is_dir) {\\n          return {};\\n        }\\n        throw new jIO.util.jIOError(\\\"Not a directory: \\\" + id, 404);\\n      }, function (error) {\\n        if (error.target !== undefined && error.target.status === 404) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document: \\\" + id, 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  DropboxStorage.prototype.allAttachments = function (id) {\\n\\n    var that = this;\\n    id = restrictDocumentId(id);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"GET\\\",\\n          url: metadata_template.expand({\\n            access_token: that._access_token,\\n            root: that._root,\\n            id: id\\n          })\\n        });\\n      })\\n      .push(function (evt) {\\n        var obj = JSON.parse(evt.target.response || evt.target.responseText),\\n          i,\\n          result = {};\\n        if (!obj.is_dir) {\\n          throw new jIO.util.jIOError(\\\"Not a directory: \\\" + id, 404);\\n        }\\n        for (i = 0; i < obj.contents.length; i += 1) {\\n          if (!obj.contents[i].is_dir) {\\n            result[obj.contents[i].path.split(\\\"/\\\").pop()] = {};\\n          }\\n        }\\n        return result;\\n      }, function (error) {\\n        if (error.target !== undefined && error.target.status === 404) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document: \\\" + id, 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  //currently, putAttachment will fail with files larger than 150MB,\\n  //due to the Dropbox API. the API provides the \\\"chunked_upload\\\" method\\n  //to pass this limit, but upload process becomes more complex to implement.\\n  //\\n  //putAttachment will also create a folder if you try to put an attachment\\n  //to an inexisting foler.\\n\\n  DropboxStorage.prototype.putAttachment = function (id, name, blob) {\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return jIO.util.ajax({\\n      type: \\\"PUT\\\",\\n      url: upload_template.expand({\\n        root: this._root,\\n        id: id,\\n        name: name,\\n        access_token: this._access_token\\n      }),\\n      dataType: blob.type,\\n      data: blob\\n    });\\n  };\\n\\n  DropboxStorage.prototype.getAttachment = function (id, name) {\\n    var that = this;\\n\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"GET\\\",\\n          dataType: \\\"blob\\\",\\n          url: get_template.expand({\\n            root: that._root,\\n            id: id,\\n            name: name,\\n            access_token: that._access_token\\n          })\\n        });\\n      })\\n      .push(function (evt) {\\n        return new Blob(\\n          [evt.target.response || evt.target.responseText],\\n          {\\\"type\\\": evt.target.getResponseHeader('Content-Type') ||\\n            \\\"application/octet-stream\\\"}\\n        );\\n      }, function (error) {\\n        if (error.target !== undefined && error.target.status === 404) {\\n          throw new jIO.util.jIOError(\\\"Cannot find attachment: \\\" +\\n                                      id + \\\", \\\" + name, 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  //removeAttachment removes also directories.(due to Dropbox API)\\n\\n  DropboxStorage.prototype.removeAttachment = function (id, name) {\\n    var that = this;\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"POST\\\",\\n          url: remote_template.expand({\\n            access_token: that._access_token,\\n            root: that._root,\\n            path: id + name\\n          })\\n        });\\n      }).push(undefined, function (error) {\\n        if (error.target !== undefined && error.target.status === 404) {\\n          throw new jIO.util.jIOError(\\\"Cannot find attachment: \\\" +\\n                                      id + \\\", \\\" + name, 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  jIO.addStorage('dropbox', DropboxStorage);\\n\\n}(jIO, RSVP, Blob, UriTemplate));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/*jslint nomen: true*/\\n/*global jIO, RSVP, DOMParser, Blob */\\n\\n// JIO Dav Storage Description :\\n// {\\n//   type: \\\"dav\\\",\\n//   url: {string},\\n//   basic_login: {string} // Basic authentication\\n// }\\n\\n// NOTE: to get the authentication type ->\\n// curl --verbose  -X OPTION http://domain/\\n// In the headers: \\\"WWW-Authenticate: Basic realm=\\\"DAV-upload\\\"\\n\\n(function (jIO, RSVP, DOMParser, Blob) {\\n  \\\"use strict\\\";\\n\\n  function ajax(storage, options) {\\n    if (options === undefined) {\\n      options = {};\\n    }\\n    if (storage._authorization !== undefined) {\\n      if (options.headers === undefined) {\\n        options.headers = {};\\n      }\\n      options.headers.Authorization = storage._authorization;\\n    }\\n\\n    if (storage._with_credentials !== undefined) {\\n      if (options.xhrFields === undefined) {\\n        options.xhrFields = {};\\n      }\\n      options.xhrFields.withCredentials = storage._with_credentials;\\n    }\\n//       if (start !== undefined) {\\n//         if (end !== undefined) {\\n//           headers.Range = \\\"bytes=\\\" + start + \\\"-\\\" + end;\\n//         } else {\\n//           headers.Range = \\\"bytes=\\\" + start + \\\"-\\\";\\n//         }\\n//       }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax(options);\\n      });\\n  }\\n\\n  function restrictDocumentId(id) {\\n    if (id.indexOf(\\\"/\\\") !== 0) {\\n      throw new jIO.util.jIOError(\\\"id \\\" + id + \\\" is forbidden (no begin /)\\\",\\n                                  400);\\n    }\\n    if (id.lastIndexOf(\\\"/\\\") !== (id.length - 1)) {\\n      throw new jIO.util.jIOError(\\\"id \\\" + id + \\\" is forbidden (no end /)\\\",\\n                                  400);\\n    }\\n    return id;\\n  }\\n\\n  function restrictAttachmentId(id) {\\n    if (id.indexOf(\\\"/\\\") !== -1) {\\n      throw new jIO.util.jIOError(\\\"attachment \\\" + id + \\\" is forbidden\\\",\\n                                  400);\\n    }\\n  }\\n\\n  /**\\n   * The JIO WebDAV Storage extension\\n   *\\n   * @class DavStorage\\n   * @constructor\\n   */\\n  function DavStorage(spec) {\\n    if (typeof spec.url !== 'string') {\\n      throw new TypeError(\\\"DavStorage 'url' is not of type string\\\");\\n    }\\n    this._url = spec.url;\\n    // XXX digest login\\n    if (typeof spec.basic_login === 'string') {\\n      this._authorization = \\\"Basic \\\" + spec.basic_login;\\n    }\\n    this._with_credentials = spec.with_credentials;\\n  }\\n\\n  DavStorage.prototype.put = function (id, param) {\\n    var that = this;\\n    id = restrictDocumentId(id);\\n    if (Object.getOwnPropertyNames(param).length > 0) {\\n      // Reject if param has some properties\\n      throw new jIO.util.jIOError(\\\"Can not store properties: \\\" +\\n                                  Object.getOwnPropertyNames(param), 400);\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(that, {\\n          type: \\\"MKCOL\\\",\\n          url: that._url + id\\n        });\\n      })\\n      .push(undefined, function (err) {\\n        if ((err.target !== undefined) &&\\n            (err.target.status === 405)) {\\n          return;\\n        }\\n        throw err;\\n      });\\n  };\\n\\n  DavStorage.prototype.remove = function (id) {\\n    id = restrictDocumentId(id);\\n    return ajax(this, {\\n      type: \\\"DELETE\\\",\\n      url: this._url + id\\n    });\\n  };\\n\\n  DavStorage.prototype.get = function (id) {\\n    var context = this;\\n    id = restrictDocumentId(id);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(context, {\\n          type: \\\"PROPFIND\\\",\\n          url: context._url + id,\\n          dataType: \\\"text\\\",\\n          headers: {\\n            // Increasing this value is a performance killer\\n            Depth: \\\"1\\\"\\n          }\\n        });\\n      })\\n      .push(function () {\\n        return {};\\n      }, function (error) {\\n        if ((error.target !== undefined) &&\\n            (error.target.status === 404)) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  DavStorage.prototype.allAttachments = function (id) {\\n\\n    var context = this;\\n    id = restrictDocumentId(id);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(context, {\\n          type: \\\"PROPFIND\\\",\\n          url: context._url + id,\\n          dataType: \\\"text\\\",\\n          headers: {\\n            // Increasing this value is a performance killer\\n            Depth: \\\"1\\\"\\n          }\\n        });\\n      })\\n\\n\\n      .push(function (response) {\\n        // Extract all meta informations and return them to JSON\\n\\n        var i,\\n          attachment = {},\\n          id,\\n          attachment_list = new DOMParser().parseFromString(\\n            response.target.responseText,\\n            \\\"text/xml\\\"\\n          ).querySelectorAll(\\n            \\\"D\\\\\\\\:response, response\\\"\\n          );\\n\\n        // exclude parent folder and browse\\n        for (i = 1; i < attachment_list.length; i += 1) {\\n          // XXX Only get files for now\\n          id = attachment_list[i].querySelector(\\\"D\\\\\\\\:href, href\\\").\\n            textContent.split('/').slice(-1)[0];\\n          // XXX Ugly\\n          if ((id !== undefined) && (id !== \\\"\\\")) {\\n            attachment[id] = {};\\n          }\\n        }\\n        return attachment;\\n\\n      }, function (error) {\\n        if ((error.target !== undefined) &&\\n            (error.target.status === 404)) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        throw error;\\n      });\\n\\n  };\\n\\n\\n  DavStorage.prototype.putAttachment = function (id, name, blob) {\\n    var that = this;\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(that, {\\n          type: \\\"PUT\\\",\\n          url: that._url + id + name,\\n          data: blob\\n        });\\n      })\\n      .push(undefined, function (error) {\\n        if (error.target.status === 403 || error.target.status === 424) {\\n          throw new jIO.util.jIOError(\\\"Cannot access subdocument\\\", 404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  DavStorage.prototype.getAttachment = function (id, name) {\\n    var context = this;\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(context, {\\n          type: \\\"GET\\\",\\n          url: context._url + id + name,\\n          dataType: \\\"blob\\\"\\n        });\\n      })\\n      .push(function (response) {\\n        return new Blob(\\n          [response.target.response || response.target.responseText],\\n          {\\\"type\\\": response.target.getResponseHeader('Content-Type') ||\\n                   \\\"application/octet-stream\\\"}\\n        );\\n      }, function (error) {\\n        if ((error.target !== undefined) &&\\n            (error.target.status === 404)) {\\n          throw new jIO.util.jIOError(\\\"Cannot find attachment: \\\"\\n                                      + id + \\\" , \\\" + name,\\n                                      404);\\n        }\\n        throw error;\\n      });\\n\\n  };\\n\\n  DavStorage.prototype.removeAttachment = function (id, name) {\\n    var context = this;\\n    id = restrictDocumentId(id);\\n    restrictAttachmentId(name);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return ajax(context, {\\n          type: \\\"DELETE\\\",\\n          url: context._url + id + name\\n        });\\n      })\\n      .push(undefined, function (error) {\\n        if ((error.target !== undefined) &&\\n            (error.target.status === 404)) {\\n          throw new jIO.util.jIOError(\\\"Cannot find attachment: \\\"\\n                                      + id + \\\" , \\\" + name,\\n                                      404);\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  // JIO COMMANDS //\\n\\n  // wedDav methods rfc4918 (short summary)\\n  // COPY     Reproduces single resources (files) and collections (directory\\n  //          trees). Will overwrite files (if specified by request) but will\\n  //          respond 209 (Conflict) if it would overwrite a tree\\n  // DELETE   deletes files and directory trees\\n  // GET      just the vanilla HTTP/1.1 behaviour\\n  // HEAD     ditto\\n  // LOCK     locks a resources\\n  // MKCOL    creates a directory\\n  // MOVE     Moves (rename or copy) a file or a directory tree. Will\\n  //          'overwrite' files (if specified by the request) but will respond\\n  //          209 (Conflict) if it would overwrite a tree.\\n  // OPTIONS  If WebDAV is enabled and available for the path this reports the\\n  //          WebDAV extension methods\\n  // PROPFIND Retrieves the requested file characteristics, DAV lock status\\n  //          and 'dead' properties for individual files, a directory and its\\n  //          child files, or a directory tree\\n  // PROPPATCHset and remove 'dead' meta-data properties\\n  // PUT      Update or create resource or collections\\n  // UNLOCK   unlocks a resource\\n\\n  // Notes: all Ajax requests should be CORS (cross-domain)\\n  // adding custom headers triggers preflight OPTIONS request!\\n  // http://remysharp.com/2011/04/21/getting-cors-working/\\n\\n  jIO.addStorage('dav', DavStorage);\\n\\n}(jIO, RSVP, DOMParser, Blob));\\n;/*\\n * Copyright 2015, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n/**\\n * JIO Google Drive Storage. Type = \\\"gdrive\\\".\\n * Google Drive \\\"database\\\" storage.\\n */\\n/*global jIO, Blob, RSVP, UriTemplate, JSON*/\\n/*jslint nomen: true*/\\n\\n(function (jIO, Blob, RSVP, UriTemplate, JSON) {\\n  \\\"use strict\\\";\\n\\n  var UPLOAD_URL = \\\"https://www.googleapis.com{/upload}/drive/v2/files{/id}\\\" +\\n      \\\"{?uploadType,access_token}\\\",\\n    upload_template = UriTemplate.parse(UPLOAD_URL),\\n    REMOVE_URL = \\\"https://www.googleapis.com/drive/v2/\\\" +\\n      \\\"files{/id,trash}{?access_token}\\\",\\n    remove_template = UriTemplate.parse(REMOVE_URL),\\n    LIST_URL = \\\"https://www.googleapis.com/drive/v2/files\\\" +\\n      \\\"?prettyPrint=false{&pageToken}&q=trashed=false\\\" +\\n      \\\"&fields=nextPageToken,items(id){&access_token}\\\",\\n    list_template = UriTemplate.parse(LIST_URL),\\n    GET_URL = \\\"https://www.googleapis.com/drive/v2/files{/id}{?alt}\\\",\\n    get_template = UriTemplate.parse(GET_URL);\\n\\n  function handleError(error, id) {\\n    if (error.target.status === 404) {\\n      throw new jIO.util.jIOError(\\n        \\\"Cannot find document: \\\" + id,\\n        404\\n      );\\n    }\\n    throw error;\\n  }\\n\\n  function listPage(result, token) {\\n    var i,\\n      obj;\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"GET\\\",\\n          \\\"url\\\": list_template.expand({\\n            pageToken : (result.nextPageToken || \\\"\\\"),\\n            access_token: token\\n          })\\n        });\\n      })\\n      .push(function (data) {\\n        obj = JSON.parse(data.target.response || data.target.responseText);\\n        for (i = 0; i < obj.items.length; i += 1) {\\n          obj.items[i].value = {};\\n          result.push(obj.items[i]);\\n        }\\n        result.nextPageToken = obj.nextPageToken;\\n        return result;\\n      }, handleError);\\n  }\\n\\n  function checkName(name) {\\n    if (name !== \\\"enclosure\\\") {\\n      throw new jIO.util.jIOError(\\\"Only support 'enclosure' attachment\\\", 400);\\n    }\\n  }\\n\\n  /**\\n   * The JIO Google Drive Storage extension\\n   *\\n   * @class GdriveStorage\\n   * @constructor\\n   */\\n  function GdriveStorage(spec) {\\n    if (spec === undefined || spec.access_token === undefined ||\\n        typeof spec.access_token !== 'string') {\\n      throw new TypeError(\\\"Access Token must be a string \\\" +\\n                          \\\"which contains more than one character.\\\");\\n    }\\n    if (spec.trashing !== undefined &&\\n        (spec.trashing !== true && spec.trashing !== false)) {\\n      throw new TypeError(\\\"trashing parameter\\\" +\\n                          \\\" must be a boolean (true or false)\\\");\\n    }\\n    this._trashing = spec.trashing || true;\\n    this._access_token = spec.access_token;\\n    return;\\n  }\\n\\n  function recursiveAllDocs(result, accessToken) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return listPage(result, accessToken);\\n      })\\n      .push(function () {\\n        if (result.nextPageToken) {\\n          return recursiveAllDocs(result, accessToken);\\n        }\\n        return result;\\n      });\\n  }\\n\\n  GdriveStorage.prototype.hasCapacity = function (name) {\\n    return (name === \\\"list\\\");\\n  };\\n\\n  GdriveStorage.prototype.buildQuery = function () {\\n    return recursiveAllDocs([], this._access_token);\\n  };\\n\\n  function sendMetaData(id, param, token) {\\n    var boundary = \\\"-------314159265358979323846\\\";\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          \\\"type\\\": id ? \\\"PUT\\\" : \\\"POST\\\",\\n          \\\"url\\\": upload_template.expand({\\n            access_token: token,\\n            id: id || [],\\n            upload: id ? [] : \\\"upload\\\",\\n            uploadType: \\\"multipart\\\"\\n          }),\\n          headers: {\\n            \\\"Content-Type\\\" : 'multipart/related; boundary=\\\"' + boundary + '\\\"'\\n          },\\n          data: '--' + boundary + '\\\\n' +\\n            'Content-Type: application/json; charset=UTF-8\\\\n\\\\n' +\\n            JSON.stringify(param) + '\\\\n\\\\n--' + boundary + \\\"--\\\"\\n        });\\n      })\\n      .push(function (result) {\\n        var obj = JSON.parse(result.target.responseText);\\n\\n        return obj.id;\\n      },\\n            function (error) {handleError(error, id); });\\n  }\\n\\n  GdriveStorage.prototype.put = function (id, param) {\\n    return sendMetaData(id, param, this._access_token);\\n  };\\n\\n  GdriveStorage.prototype.post = function (param) {\\n    return sendMetaData(undefined, param, this._access_token);\\n  };\\n\\n  function sendData(id, blob, token) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"PUT\\\",\\n          \\\"url\\\": upload_template.expand({\\n            access_token: token,\\n            upload: \\\"upload\\\",\\n            id: id,\\n            uploadType: \\\"media\\\"\\n          }),\\n          data: blob\\n        });\\n      })\\n      .push(function (data) {\\n        data = JSON.parse(data.target.responseText);\\n        if (data.mimeType === \\\"application/vnd.google-apps.folder\\\") {\\n          throw new jIO.util.jIOError(\\\"cannot put attachments to folder\\\", 400);\\n        }\\n        return data;\\n      }, function (error) {handleError(error, id); });\\n  }\\n\\n  GdriveStorage.prototype.putAttachment = function (id, name, blob) {\\n    checkName(name);\\n    return sendData(id, blob, this._access_token);\\n  };\\n\\n  GdriveStorage.prototype.remove = function (id) {\\n    var that  = this;\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: that._trashing ? \\\"POST\\\" : \\\"DELETE\\\",\\n          url: remove_template.expand({\\n            id : id,\\n            access_token : that._access_token,\\n            trash : that._trashing ? \\\"trash\\\" : []\\n          })\\n        });\\n      })\\n      .push(undefined, function (error) {handleError(error, id); });\\n  };\\n\\n  function getData(id, attach, token) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          type: \\\"GET\\\",\\n          dataType: attach ? \\\"blob\\\" : \\\"json\\\",\\n          url: get_template.expand({\\n            id: id,\\n            alt: attach ? \\\"media\\\" : [],\\n            access_token: token\\n          }),\\n          headers: {\\n            \\\"Authorization\\\" : \\\"Bearer \\\" + token\\n          }\\n        });\\n      })\\n      .push(function (evt) {\\n        return evt.target.response ||\\n          (attach ? new Blob([evt.target.responseText],\\n                             {\\\"type\\\" :\\n                              evt.target.responseHeaders[\\\"Content-Type\\\"]}) :\\n              JSON.parse(evt.target.responseText));\\n      }, function (error) {handleError(error, id); });\\n  }\\n\\n  GdriveStorage.prototype.get = function (id) {\\n    return getData(id, false, this._access_token);\\n  };\\n\\n  GdriveStorage.prototype.getAttachment = function (id, name) {\\n    checkName(name);\\n    return getData(id, true, this._access_token);\\n  };\\n\\n  GdriveStorage.prototype.allAttachments = function (id) {\\n    var token = this._access_token;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return getData(id, false, token);\\n      })\\n      .push(function (data) {\\n        if (data.mimeType === \\\"application/vnd.google-apps.folder\\\") {\\n          return {};\\n        }\\n        return {\\\"enclosure\\\": {}};\\n      });\\n  };\\n\\n  jIO.addStorage('gdrive', GdriveStorage);\\n\\n}(jIO, Blob, RSVP, UriTemplate, JSON));\\n;/*jslint nomen: true */\\n/*global RSVP*/\\n\\n/**\\n * JIO Union Storage. Type = 'union'.\\n * This provide a unified access other multiple storage.\\n * New document are created in the first sub storage.\\n * Document are searched in each sub storage until it is found.\\n * \\n *\\n * Storage Description:\\n *\\n *     {\\n *       \\\"type\\\": \\\"union\\\",\\n *       \\\"storage_list\\\": [\\n *         sub_storage_description_1,\\n *         sub_storage_description_2,\\n *\\n *         sub_storage_description_X,\\n *       ]\\n *     }\\n *\\n * @class UnionStorage\\n */\\n\\n(function (jIO, RSVP) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The JIO UnionStorage extension\\n   *\\n   * @class UnionStorage\\n   * @constructor\\n   */\\n  function UnionStorage(spec) {\\n    if (!Array.isArray(spec.storage_list)) {\\n      throw new jIO.util.jIOError(\\\"storage_list is not an Array\\\", 400);\\n    }\\n    var i;\\n    this._storage_list = [];\\n    for (i = 0; i < spec.storage_list.length; i += 1) {\\n      this._storage_list.push(jIO.createJIO(spec.storage_list[i]));\\n    }\\n  }\\n\\n  UnionStorage.prototype._getWithStorageIndex = function () {\\n    var i,\\n      index = 0,\\n      context = this,\\n      arg = arguments,\\n      result = this._storage_list[0].get.apply(this._storage_list[0], arg);\\n\\n    function handle404(j) {\\n      result\\n        .push(undefined, function (error) {\\n          if ((error instanceof jIO.util.jIOError) &&\\n              (error.status_code === 404)) {\\n            return context._storage_list[j].get.apply(context._storage_list[j],\\n                                                      arg)\\n              .push(function (doc) {\\n                index = j;\\n                return doc;\\n              });\\n          }\\n          throw error;\\n        });\\n    }\\n\\n    for (i = 1; i < this._storage_list.length; i += 1) {\\n      handle404(i);\\n    }\\n    return result\\n      .push(function (doc) {\\n        return [index, doc];\\n      });\\n  };\\n\\n  /*\\n   * Get a document\\n   * Try on each substorage on after the other\\n   */\\n  UnionStorage.prototype.get = function () {\\n    return this._getWithStorageIndex.apply(this, arguments)\\n      .push(function (result) {\\n        return result[1];\\n      });\\n  };\\n\\n  /*\\n   * Get attachments list\\n   * Try on each substorage on after the other\\n   */\\n  UnionStorage.prototype.allAttachments = function () {\\n    var argument_list = arguments,\\n      context = this;\\n    return this._getWithStorageIndex.apply(this, arguments)\\n      .push(function (result) {\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.allAttachments.apply(sub_storage, argument_list);\\n      });\\n  };\\n\\n  /*\\n   * Post a document\\n   * Simply store on the first substorage\\n   */\\n  UnionStorage.prototype.post = function () {\\n    return this._storage_list[0].post.apply(this._storage_list[0], arguments);\\n  };\\n\\n  /*\\n   * Put a document\\n   * Search the document location, and modify it in its storage.\\n   */\\n  UnionStorage.prototype.put = function () {\\n    var arg = arguments,\\n      context = this;\\n    return this._getWithStorageIndex(arg[0])\\n      .push(undefined, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          // Document does not exist, create in first substorage\\n          return [0];\\n        }\\n        throw error;\\n      })\\n      .push(function (result) {\\n        // Storage found, modify in it directly\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.put.apply(sub_storage, arg);\\n      });\\n  };\\n\\n  /*\\n   * Remove a document\\n   * Search the document location, and remove it from its storage.\\n   */\\n  UnionStorage.prototype.remove = function () {\\n    var arg = arguments,\\n      context = this;\\n    return this._getWithStorageIndex(arg[0])\\n      .push(function (result) {\\n        // Storage found, remove from it directly\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.remove.apply(sub_storage, arg);\\n      });\\n  };\\n\\n  UnionStorage.prototype.buildQuery = function () {\\n    var promise_list = [],\\n      i,\\n      id_dict = {},\\n      len = this._storage_list.length,\\n      sub_storage;\\n    for (i = 0; i < len; i += 1) {\\n      sub_storage = this._storage_list[i];\\n      promise_list.push(sub_storage.buildQuery.apply(sub_storage, arguments));\\n    }\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return RSVP.all(promise_list);\\n      })\\n      .push(function (result_list) {\\n        var result = [],\\n          sub_result,\\n          sub_result_len,\\n          j;\\n        len = result_list.length;\\n        for (i = 0; i < len; i += 1) {\\n          sub_result = result_list[i];\\n          sub_result_len = sub_result.length;\\n          for (j = 0; j < sub_result_len; j += 1) {\\n            if (!id_dict.hasOwnProperty(sub_result[j].id)) {\\n              id_dict[sub_result[j].id] = null;\\n              result.push(sub_result[j]);\\n            }\\n          }\\n        }\\n        return result;\\n      });\\n  };\\n\\n  UnionStorage.prototype.hasCapacity = function (name) {\\n    var i,\\n      len,\\n      result,\\n      sub_storage;\\n    if ((name === \\\"list\\\") ||\\n            (name === \\\"query\\\") ||\\n            (name === \\\"select\\\")) {\\n      result = true;\\n      len = this._storage_list.length;\\n      for (i = 0; i < len; i += 1) {\\n        sub_storage = this._storage_list[i];\\n        result = result && sub_storage.hasCapacity(name);\\n      }\\n      return result;\\n    }\\n    return false;\\n  };\\n\\n  UnionStorage.prototype.repair = function () {\\n    var i,\\n      promise_list = [];\\n    for (i = 0; i < this._storage_list.length; i += 1) {\\n      promise_list.push(this._storage_list[i].repair.apply(\\n        this._storage_list[i],\\n        arguments\\n      ));\\n    }\\n    return RSVP.all(promise_list);\\n  };\\n\\n  UnionStorage.prototype.getAttachment = function () {\\n    var argument_list = arguments,\\n      context = this;\\n    return this._getWithStorageIndex.apply(this, arguments)\\n      .push(function (result) {\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.getAttachment.apply(sub_storage, argument_list);\\n      });\\n  };\\n\\n  UnionStorage.prototype.putAttachment = function () {\\n    var argument_list = arguments,\\n      context = this;\\n    return this._getWithStorageIndex.apply(this, arguments)\\n      .push(function (result) {\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.putAttachment.apply(sub_storage, argument_list);\\n      });\\n  };\\n\\n  UnionStorage.prototype.removeAttachment = function () {\\n    var argument_list = arguments,\\n      context = this;\\n    return this._getWithStorageIndex.apply(this, arguments)\\n      .push(function (result) {\\n        var sub_storage = context._storage_list[result[0]];\\n        return sub_storage.removeAttachment.apply(sub_storage, argument_list);\\n      });\\n  };\\n\\n  jIO.addStorage('union', UnionStorage);\\n\\n}(jIO, RSVP));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n// JIO ERP5 Storage Description :\\n// {\\n//   type: \\\"erp5\\\"\\n//   url: {string}\\n// }\\n\\n/*jslint nomen: true, unparam: true */\\n/*global jIO, UriTemplate, FormData, RSVP, URI, Blob,\\n         SimpleQuery, ComplexQuery*/\\n\\n(function (jIO, UriTemplate, FormData, RSVP, URI, Blob,\\n           SimpleQuery, ComplexQuery) {\\n  \\\"use strict\\\";\\n\\n  function getSiteDocument(storage) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"GET\\\",\\n          \\\"url\\\": storage._url,\\n          \\\"xhrFields\\\": {\\n            withCredentials: true\\n          }\\n        });\\n      })\\n      .push(function (event) {\\n        return JSON.parse(event.target.responseText);\\n      });\\n  }\\n\\n  function getDocumentAndHateoas(storage, id, options) {\\n    if (options === undefined) {\\n      options = {};\\n    }\\n    return getSiteDocument(storage)\\n      .push(function (site_hal) {\\n        // XXX need to get modified metadata\\n        return new RSVP.Queue()\\n          .push(function () {\\n            return jIO.util.ajax({\\n              \\\"type\\\": \\\"GET\\\",\\n              \\\"url\\\": UriTemplate.parse(site_hal._links.traverse.href)\\n                                .expand({\\n                  relative_url: id,\\n                  view: options._view\\n                }),\\n              \\\"xhrFields\\\": {\\n                withCredentials: true\\n              }\\n            });\\n          })\\n          .push(undefined, function (error) {\\n            if ((error.target !== undefined) &&\\n                (error.target.status === 404)) {\\n              throw new jIO.util.jIOError(\\\"Cannot find document: \\\" + id, 404);\\n            }\\n            throw error;\\n          });\\n      });\\n  }\\n\\n  var allowed_field_dict = {\\n    \\\"StringField\\\": null,\\n    \\\"EmailField\\\": null,\\n    \\\"IntegerField\\\": null,\\n    \\\"FloatField\\\": null,\\n    \\\"TextAreaField\\\": null\\n  };\\n\\n  function extractPropertyFromFormJSON(json) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        var form = json._embedded._view,\\n          converted_json = {\\n            portal_type: json._links.type.name\\n          },\\n          form_data_json = {},\\n          field,\\n          key,\\n          prefix_length,\\n          result;\\n\\n        if (json._links.hasOwnProperty('parent')) {\\n          converted_json.parent_relative_url =\\n            new URI(json._links.parent.href).segment(2);\\n        }\\n\\n        form_data_json.form_id = {\\n          \\\"key\\\": [form.form_id.key],\\n          \\\"default\\\": form.form_id[\\\"default\\\"]\\n        };\\n        // XXX How to store datetime\\n        for (key in form) {\\n          if (form.hasOwnProperty(key)) {\\n            field = form[key];\\n            prefix_length = 0;\\n            if (key.indexOf('my_') === 0 && field.editable) {\\n              prefix_length = 3;\\n            }\\n            if (key.indexOf('your_') === 0) {\\n              prefix_length = 5;\\n            }\\n            if ((prefix_length !== 0) &&\\n                (allowed_field_dict.hasOwnProperty(field.type))) {\\n              form_data_json[key.substring(prefix_length)] = {\\n                \\\"default\\\": field[\\\"default\\\"],\\n                \\\"key\\\": field.key\\n              };\\n              converted_json[key.substring(prefix_length)] = field[\\\"default\\\"];\\n            }\\n          }\\n        }\\n\\n        result = {\\n          data: converted_json,\\n          form_data: form_data_json\\n        };\\n        if (form.hasOwnProperty('_actions') &&\\n            form._actions.hasOwnProperty('put')) {\\n          result.action_href = form._actions.put.href;\\n        }\\n        return result;\\n      });\\n  }\\n\\n  function extractPropertyFromForm(context, id) {\\n    return context.getAttachment(id, \\\"view\\\")\\n      .push(function (blob) {\\n        return jIO.util.readBlobAsText(blob);\\n      })\\n      .push(function (evt) {\\n        return JSON.parse(evt.target.result);\\n      })\\n      .push(function (json) {\\n        return extractPropertyFromFormJSON(json);\\n      });\\n  }\\n\\n  // XXX docstring\\n  function ERP5Storage(spec) {\\n    if (typeof spec.url !== \\\"string\\\" || !spec.url) {\\n      throw new TypeError(\\\"ERP5 'url' must be a string \\\" +\\n                          \\\"which contains more than one character.\\\");\\n    }\\n    this._url = spec.url;\\n    this._default_view_reference = spec.default_view_reference;\\n  }\\n\\n  function convertJSONToGet(json) {\\n    var key,\\n      result = json.data;\\n    // Remove all ERP5 hateoas links / convert them into jIO ID\\n    for (key in result) {\\n      if (result.hasOwnProperty(key)) {\\n        if (!result[key]) {\\n          delete result[key];\\n        }\\n      }\\n    }\\n    return result;\\n  }\\n\\n  ERP5Storage.prototype.get = function (id) {\\n    return extractPropertyFromForm(this, id)\\n      .push(function (result) {\\n        return convertJSONToGet(result);\\n      });\\n  };\\n\\n  ERP5Storage.prototype.bulk = function (request_list) {\\n    var i,\\n      storage = this,\\n      bulk_list = [];\\n\\n\\n    for (i = 0; i < request_list.length; i += 1) {\\n      if (request_list[i].method !== \\\"get\\\") {\\n        throw new Error(\\\"ERP5Storage: not supported \\\" +\\n                        request_list[i].method + \\\" in bulk\\\");\\n      }\\n      bulk_list.push({\\n        relative_url: request_list[i].parameter_list[0],\\n        view: storage._default_view_reference\\n      });\\n    }\\n    return getSiteDocument(storage)\\n      .push(function (site_hal) {\\n        var form_data = new FormData();\\n        form_data.append(\\\"bulk_list\\\", JSON.stringify(bulk_list));\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"POST\\\",\\n          \\\"url\\\": site_hal._actions.bulk.href,\\n          \\\"data\\\": form_data,\\n//           \\\"headers\\\": {\\n//             \\\"Content-Type\\\": \\\"application/json\\\"\\n//           },\\n          \\\"xhrFields\\\": {\\n            withCredentials: true\\n          }\\n        });\\n      })\\n      .push(function (response) {\\n        var result_list = [],\\n          hateoas = JSON.parse(response.target.responseText);\\n\\n        function pushResult(json) {\\n          return extractPropertyFromFormJSON(json)\\n            .push(function (json2) {\\n              return convertJSONToGet(json2);\\n            });\\n        }\\n\\n        for (i = 0; i < hateoas.result_list.length; i += 1) {\\n          result_list.push(pushResult(hateoas.result_list[i]));\\n        }\\n        return RSVP.all(result_list);\\n      });\\n  };\\n\\n  ERP5Storage.prototype.post = function (data) {\\n    var context = this,\\n      new_id;\\n\\n    return getSiteDocument(this)\\n      .push(function (site_hal) {\\n        var form_data = new FormData();\\n        form_data.append(\\\"portal_type\\\", data.portal_type);\\n        form_data.append(\\\"parent_relative_url\\\", data.parent_relative_url);\\n        return jIO.util.ajax({\\n          type: \\\"POST\\\",\\n          url: site_hal._actions.add.href,\\n          data: form_data,\\n          xhrFields: {\\n            withCredentials: true\\n          }\\n        });\\n      })\\n      .push(function (evt) {\\n        var location = evt.target.getResponseHeader(\\\"X-Location\\\"),\\n          uri = new URI(location);\\n        new_id = uri.segment(2);\\n        return context.put(new_id, data);\\n      })\\n      .push(function () {\\n        return new_id;\\n      });\\n  };\\n\\n  ERP5Storage.prototype.put = function (id, data) {\\n    var context = this;\\n\\n    return extractPropertyFromForm(context, id)\\n      .push(function (result) {\\n        var key,\\n          json = result.form_data,\\n          form_data = {};\\n        form_data[json.form_id.key] = json.form_id[\\\"default\\\"];\\n\\n        // XXX How to store datetime:!!!!!\\n        for (key in data) {\\n          if (data.hasOwnProperty(key)) {\\n            if (key === \\\"form_id\\\") {\\n              throw new jIO.util.jIOError(\\n                \\\"ERP5: forbidden property: \\\" + key,\\n                400\\n              );\\n            }\\n            if ((key !== \\\"portal_type\\\") && (key !== \\\"parent_relative_url\\\")) {\\n              if (!json.hasOwnProperty(key)) {\\n                throw new jIO.util.jIOError(\\n                  \\\"ERP5: can not store property: \\\" + key,\\n                  400\\n                );\\n              }\\n              form_data[json[key].key] = data[key];\\n            }\\n          }\\n        }\\n        if (!result.hasOwnProperty('action_href')) {\\n          throw new jIO.util.jIOError(\\n            \\\"ERP5: can not modify document: \\\" + id,\\n            403\\n          );\\n        }\\n        return context.putAttachment(\\n          id,\\n          result.action_href,\\n          new Blob([JSON.stringify(form_data)], {type: \\\"application/json\\\"})\\n        );\\n      });\\n  };\\n\\n  ERP5Storage.prototype.allAttachments = function (id) {\\n    var context = this;\\n    return getDocumentAndHateoas(this, id)\\n      .push(function () {\\n        if (context._default_view_reference === undefined) {\\n          return {\\n            links: {}\\n          };\\n        }\\n        return {\\n          view: {},\\n          links: {}\\n        };\\n      });\\n  };\\n\\n  ERP5Storage.prototype.getAttachment = function (id, action, options) {\\n    if (options === undefined) {\\n      options = {};\\n    }\\n    if (action === \\\"view\\\") {\\n      if (this._default_view_reference === undefined) {\\n        throw new jIO.util.jIOError(\\n          \\\"Cannot find attachment view for: \\\" + id,\\n          404\\n        );\\n      }\\n      return getDocumentAndHateoas(this, id,\\n                                   {\\\"_view\\\": this._default_view_reference})\\n        .push(function (response) {\\n          var result = JSON.parse(response.target.responseText);\\n          // Remove all ERP5 hateoas links / convert them into jIO ID\\n\\n          // XXX Change default action to an jio urn with attachment name inside\\n          // if Base_edit, do put URN\\n          // if others, do post URN (ie, unique new attachment name)\\n          // XXX Except this attachment name should be generated when\\n          return new Blob(\\n            [JSON.stringify(result)],\\n            {\\\"type\\\": 'application/hal+json'}\\n          );\\n        });\\n    }\\n    if (action === \\\"links\\\") {\\n      return getDocumentAndHateoas(this, id)\\n        .push(function (response) {\\n          return new Blob(\\n            [JSON.stringify(JSON.parse(response.target.responseText))],\\n            {\\\"type\\\": 'application/hal+json'}\\n          );\\n        });\\n    }\\n    if (action.indexOf(this._url) === 0) {\\n      return new RSVP.Queue()\\n        .push(function () {\\n          var start,\\n            end,\\n            range,\\n            request_options = {\\n              \\\"type\\\": \\\"GET\\\",\\n              \\\"dataType\\\": \\\"blob\\\",\\n              \\\"url\\\": action,\\n              \\\"xhrFields\\\": {\\n                withCredentials: true\\n              }\\n            };\\n          if (options.start !== undefined ||  options.end !== undefined) {\\n            start = options.start || 0;\\n            end = options.end;\\n            if (end !== undefined && end < 0) {\\n              throw new jIO.util.jIOError(\\\"end must be positive\\\",\\n                                          400);\\n            }\\n            if (start < 0) {\\n              range = \\\"bytes=\\\" + start;\\n            } else if (end === undefined) {\\n              range = \\\"bytes=\\\" + start + \\\"-\\\";\\n            } else {\\n              if (start > end) {\\n                throw new jIO.util.jIOError(\\\"start is greater than end\\\",\\n                                            400);\\n              }\\n              range = \\\"bytes=\\\" + start + \\\"-\\\" + end;\\n            }\\n            request_options.headers = {Range: range};\\n          }\\n          return jIO.util.ajax(request_options);\\n        })\\n        .push(function (evt) {\\n          if (evt.target.response === undefined) {\\n            return new Blob(\\n              [evt.target.responseText],\\n              {\\\"type\\\": evt.target.getResponseHeader(\\\"Content-Type\\\")}\\n            );\\n          }\\n          return evt.target.response;\\n        });\\n    }\\n    throw new jIO.util.jIOError(\\\"ERP5: not support get attachment: \\\" + action,\\n                                400);\\n  };\\n\\n  ERP5Storage.prototype.putAttachment = function (id, name, blob) {\\n    // Assert we use a callable on a document from the ERP5 site\\n    if (name.indexOf(this._url) !== 0) {\\n      throw new jIO.util.jIOError(\\\"Can not store outside ERP5: \\\" +\\n                                  name, 400);\\n    }\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.readBlobAsText(blob);\\n      })\\n      .push(function (evt) {\\n        var form_data = JSON.parse(evt.target.result),\\n          data = new FormData(),\\n          array,\\n          i,\\n          key,\\n          value;\\n        for (key in form_data) {\\n          if (form_data.hasOwnProperty(key)) {\\n            if (Array.isArray(form_data[key])) {\\n              array = form_data[key];\\n            } else {\\n              array = [form_data[key]];\\n            }\\n            for (i = 0; i < array.length; i += 1) {\\n              value = array[i];\\n              if (typeof value === \\\"object\\\") {\\n                data.append(key, jIO.util.dataURItoBlob(value.url),\\n                            value.file_name);\\n              } else {\\n                data.append(key, value);\\n              }\\n            }\\n          }\\n        }\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"POST\\\",\\n          \\\"url\\\": name,\\n          \\\"data\\\": data,\\n          \\\"xhrFields\\\": {\\n            withCredentials: true\\n          }\\n        });\\n      });\\n  };\\n\\n  ERP5Storage.prototype.hasCapacity = function (name) {\\n    return ((name === \\\"list\\\") || (name === \\\"query\\\") ||\\n            (name === \\\"select\\\") || (name === \\\"limit\\\") ||\\n            (name === \\\"sort\\\"));\\n  };\\n\\n  function isSingleLocalRoles(parsed_query) {\\n    if ((parsed_query instanceof SimpleQuery) &&\\n        (parsed_query.key === 'local_roles')) {\\n      // local_roles:\\\"Assignee\\\"\\n      return parsed_query.value;\\n    }\\n  }\\n\\n  function isMultipleLocalRoles(parsed_query) {\\n    var i,\\n      sub_query,\\n      is_multiple = true,\\n      local_role_list = [];\\n    if ((parsed_query instanceof ComplexQuery) &&\\n        (parsed_query.operator === 'OR')) {\\n\\n      for (i = 0; i < parsed_query.query_list.length; i += 1) {\\n        sub_query = parsed_query.query_list[i];\\n        if ((sub_query instanceof SimpleQuery) &&\\n            (sub_query.key === 'local_roles')) {\\n          local_role_list.push(sub_query.value);\\n        } else {\\n          is_multiple = false;\\n        }\\n      }\\n      if (is_multiple) {\\n        // local_roles:\\\"Assignee\\\" OR local_roles:\\\"Assignor\\\"\\n        return local_role_list;\\n      }\\n    }\\n  }\\n\\n  ERP5Storage.prototype.buildQuery = function (options) {\\n//     if (typeof options.query !== \\\"string\\\") {\\n//       options.query = (options.query ?\\n//                        jIO.Query.objectToSearchText(options.query) :\\n//                        undefined);\\n//     }\\n    return getSiteDocument(this)\\n      .push(function (site_hal) {\\n        var query = options.query,\\n          i,\\n          parsed_query,\\n          sub_query,\\n          result_list,\\n          local_roles,\\n          sort_list = [];\\n        if (options.query) {\\n          parsed_query = jIO.QueryFactory.create(options.query);\\n\\n          result_list = isSingleLocalRoles(parsed_query);\\n          if (result_list) {\\n            query = undefined;\\n            local_roles = result_list;\\n          } else {\\n\\n            result_list = isMultipleLocalRoles(parsed_query);\\n            if (result_list) {\\n              query = undefined;\\n              local_roles = result_list;\\n            } else if ((parsed_query instanceof ComplexQuery) &&\\n                       (parsed_query.operator === 'AND')) {\\n\\n              // portal_type:\\\"Person\\\" AND local_roles:\\\"Assignee\\\"\\n              for (i = 0; i < parsed_query.query_list.length; i += 1) {\\n                sub_query = parsed_query.query_list[i];\\n\\n                result_list = isSingleLocalRoles(sub_query);\\n                if (result_list) {\\n                  local_roles = result_list;\\n                  parsed_query.query_list.splice(i, 1);\\n                  query = jIO.Query.objectToSearchText(parsed_query);\\n                  i = parsed_query.query_list.length;\\n                } else {\\n                  result_list = isMultipleLocalRoles(sub_query);\\n                  if (result_list) {\\n                    local_roles = result_list;\\n                    parsed_query.query_list.splice(i, 1);\\n                    query = jIO.Query.objectToSearchText(parsed_query);\\n                    i = parsed_query.query_list.length;\\n                  }\\n                }\\n              }\\n            }\\n\\n          }\\n        }\\n\\n        if (options.sort_on) {\\n          for (i = 0; i < options.sort_on.length; i += 1) {\\n            sort_list.push(JSON.stringify(options.sort_on[i]));\\n          }\\n        }\\n\\n        return jIO.util.ajax({\\n          \\\"type\\\": \\\"GET\\\",\\n          \\\"url\\\": UriTemplate.parse(site_hal._links.raw_search.href)\\n                            .expand({\\n              query: query,\\n              // XXX Force erp5 to return embedded document\\n              select_list: options.select_list || [\\\"title\\\", \\\"reference\\\"],\\n              limit: options.limit,\\n              sort_on: sort_list,\\n              local_roles: local_roles\\n            }),\\n          \\\"xhrFields\\\": {\\n            withCredentials: true\\n          }\\n        });\\n      })\\n      .push(function (response) {\\n        return JSON.parse(response.target.responseText);\\n      })\\n      .push(function (catalog_json) {\\n        var data = catalog_json._embedded.contents,\\n          count = data.length,\\n          i,\\n          uri,\\n          item,\\n          result = [];\\n        for (i = 0; i < count; i += 1) {\\n          item = data[i];\\n          uri = new URI(item._links.self.href);\\n          delete item._links;\\n          result.push({\\n            id: uri.segment(2),\\n            value: item\\n          });\\n        }\\n        return result;\\n      });\\n  };\\n\\n  jIO.addStorage(\\\"erp5\\\", ERP5Storage);\\n\\n}(jIO, UriTemplate, FormData, RSVP, URI, Blob,\\n  SimpleQuery, ComplexQuery));\\n;/*jslint nomen: true*/\\n/*global RSVP*/\\n(function (jIO, RSVP) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The jIO QueryStorage extension\\n   *\\n   * @class QueryStorage\\n   * @constructor\\n   */\\n  function QueryStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n    this._key_schema = spec.key_schema;\\n  }\\n\\n  QueryStorage.prototype.get = function () {\\n    return this._sub_storage.get.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.allAttachments = function () {\\n    return this._sub_storage.allAttachments.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.post = function () {\\n    return this._sub_storage.post.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.put = function () {\\n    return this._sub_storage.put.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.remove = function () {\\n    return this._sub_storage.remove.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.getAttachment = function () {\\n    return this._sub_storage.getAttachment.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.putAttachment = function () {\\n    return this._sub_storage.putAttachment.apply(this._sub_storage, arguments);\\n  };\\n  QueryStorage.prototype.removeAttachment = function () {\\n    return this._sub_storage.removeAttachment.apply(this._sub_storage,\\n                                                    arguments);\\n  };\\n  QueryStorage.prototype.repair = function () {\\n    return this._sub_storage.repair.apply(this._sub_storage, arguments);\\n  };\\n\\n  QueryStorage.prototype.hasCapacity = function (name) {\\n    var this_storage_capacity_list = [\\\"limit\\\",\\n                                      \\\"sort\\\",\\n                                      \\\"select\\\",\\n                                      \\\"query\\\"];\\n\\n    if (this_storage_capacity_list.indexOf(name) !== -1) {\\n      return true;\\n    }\\n    if (name === \\\"list\\\") {\\n      return this._sub_storage.hasCapacity(name);\\n    }\\n    return false;\\n  };\\n  QueryStorage.prototype.buildQuery = function (options) {\\n    var substorage = this._sub_storage,\\n      context = this,\\n      sub_options = {},\\n      is_manual_query_needed = false,\\n      is_manual_include_needed = false;\\n\\n    if (substorage.hasCapacity(\\\"list\\\")) {\\n\\n      // Can substorage handle the queries if needed?\\n      try {\\n        if (((options.query === undefined) ||\\n             (substorage.hasCapacity(\\\"query\\\"))) &&\\n            ((options.sort_on === undefined) ||\\n             (substorage.hasCapacity(\\\"sort\\\"))) &&\\n            ((options.select_list === undefined) ||\\n             (substorage.hasCapacity(\\\"select\\\"))) &&\\n            ((options.limit === undefined) ||\\n             (substorage.hasCapacity(\\\"limit\\\")))) {\\n          sub_options.query = options.query;\\n          sub_options.sort_on = options.sort_on;\\n          sub_options.select_list = options.select_list;\\n          sub_options.limit = options.limit;\\n        }\\n      } catch (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 501)) {\\n          is_manual_query_needed = true;\\n        } else {\\n          throw error;\\n        }\\n      }\\n\\n      // Can substorage include the docs if needed?\\n      try {\\n        if ((is_manual_query_needed ||\\n            (options.include_docs === true)) &&\\n            (substorage.hasCapacity(\\\"include\\\"))) {\\n          sub_options.include_docs = true;\\n        }\\n      } catch (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 501)) {\\n          is_manual_include_needed = true;\\n        } else {\\n          throw error;\\n        }\\n      }\\n\\n      return substorage.buildQuery(sub_options)\\n\\n        // Include docs if needed\\n        .push(function (result) {\\n          var include_query_list = [result],\\n            len,\\n            i;\\n\\n          function safeGet(j) {\\n            var id = result[j].id;\\n            return substorage.get(id)\\n              .push(function (doc) {\\n                // XXX Can delete user data!\\n                doc._id = id;\\n                return doc;\\n              }, function (error) {\\n                // Document may have been dropped after listing\\n                if ((error instanceof jIO.util.jIOError) &&\\n                    (error.status_code === 404)) {\\n                  return;\\n                }\\n                throw error;\\n              });\\n          }\\n\\n          if (is_manual_include_needed) {\\n            len = result.length;\\n            for (i = 0; i < len; i += 1) {\\n              include_query_list.push(safeGet(i));\\n            }\\n            result = RSVP.all(include_query_list);\\n          }\\n          return result;\\n        })\\n        .push(function (result) {\\n          var original_result,\\n            len,\\n            i;\\n          if (is_manual_include_needed) {\\n            original_result = result[0];\\n            len = original_result.length;\\n            for (i = 0; i < len; i += 1) {\\n              original_result[i].doc = result[i + 1];\\n            }\\n            result = original_result;\\n          }\\n          return result;\\n\\n        })\\n\\n        // Manual query if needed\\n        .push(function (result) {\\n          var data_rows = [],\\n            len,\\n            i;\\n          if (is_manual_query_needed) {\\n            len = result.length;\\n            for (i = 0; i < len; i += 1) {\\n              result[i].doc.__id = result[i].id;\\n              data_rows.push(result[i].doc);\\n            }\\n            if (options.select_list) {\\n              options.select_list.push(\\\"__id\\\");\\n            }\\n            result = jIO.QueryFactory.create(options.query || \\\"\\\",\\n                                             context._key_schema).\\n              exec(data_rows, options);\\n          }\\n          return result;\\n        })\\n\\n        // reconstruct filtered rows, preserving the order from docs\\n        .push(function (result) {\\n          var new_result = [],\\n            element,\\n            len,\\n            i;\\n          if (is_manual_query_needed) {\\n            len = result.length;\\n            for (i = 0; i < len; i += 1) {\\n              element = {\\n                id: result[i].__id,\\n                value: options.select_list ? result[i] : {},\\n                doc: {}\\n              };\\n              if (options.select_list) {\\n                // Does not work if user manually request __id\\n                delete element.value.__id;\\n              }\\n              if (options.include_docs) {\\n                // XXX To implement\\n                throw new Error(\\\"QueryStorage does not support include docs\\\");\\n              }\\n              new_result.push(element);\\n            }\\n            result = new_result;\\n          }\\n          return result;\\n        });\\n\\n    }\\n  };\\n\\n  jIO.addStorage('query', QueryStorage);\\n\\n}(jIO, RSVP));\\n;/*jslint nomen: true*/\\n/*global RSVP, Blob*/\\n(function (jIO, RSVP, Blob) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The jIO FileSystemBridgeStorage extension\\n   *\\n   * @class FileSystemBridgeStorage\\n   * @constructor\\n   */\\n  function FileSystemBridgeStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n  }\\n  var DOCUMENT_EXTENSION = \\\".json\\\",\\n    DOCUMENT_KEY = \\\"/.jio_documents/\\\",\\n    ROOT = \\\"/\\\";\\n\\n  function endsWith(str, suffix) {\\n    return str.indexOf(suffix, str.length - suffix.length) !== -1;\\n  }\\n\\n  FileSystemBridgeStorage.prototype.get = function (id) {\\n    var context = this;\\n    return new RSVP.Queue()\\n\\n      // First, try to get explicit reference to the document\\n\\n      .push(function () {\\n        // First get the document itself if it exists\\n        return context._sub_storage.getAttachment(\\n          DOCUMENT_KEY,\\n          id + DOCUMENT_EXTENSION,\\n          {format: \\\"json\\\"}\\n        );\\n      })\\n      .push(undefined, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n\\n          // Second, try to get default attachment\\n          return context._sub_storage.allAttachments(ROOT)\\n            .push(function (attachment_dict) {\\n              if (attachment_dict.hasOwnProperty(id)) {\\n                return {};\\n              }\\n              throw new jIO.util.jIOError(\\\"Cannot find document \\\" + id,\\n                                          404);\\n            });\\n        }\\n        throw error;\\n      });\\n  };\\n\\n  FileSystemBridgeStorage.prototype.allAttachments = function (id) {\\n    var context = this;\\n    return context._sub_storage.allAttachments(ROOT)\\n      .push(function (attachment_dict) {\\n        if (attachment_dict.hasOwnProperty(id)) {\\n          return {\\n            enclosure: {}\\n          };\\n        }\\n        // Second get the document itself if it exists\\n        return context._sub_storage.getAttachment(\\n          DOCUMENT_KEY,\\n          id + DOCUMENT_EXTENSION\\n        )\\n          .push(function () {\\n            return {};\\n          }, function (error) {\\n            if ((error instanceof jIO.util.jIOError) &&\\n                (error.status_code === 404)) {\\n              throw new jIO.util.jIOError(\\\"Cannot find document \\\" + id,\\n                                          404);\\n            }\\n            throw error;\\n          });\\n      });\\n\\n  };\\n\\n  FileSystemBridgeStorage.prototype.put = function (doc_id, param) {\\n    var context = this;\\n    // XXX Handle conflict!\\n\\n    return context._sub_storage.putAttachment(\\n      DOCUMENT_KEY,\\n      doc_id + DOCUMENT_EXTENSION,\\n      new Blob([JSON.stringify(param)], {type: \\\"application/json\\\"})\\n    )\\n      .push(undefined, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          return context._sub_storage.put(DOCUMENT_KEY, {})\\n            .push(function () {\\n              return context._sub_storage.putAttachment(\\n                DOCUMENT_KEY,\\n                doc_id + DOCUMENT_EXTENSION,\\n                new Blob([JSON.stringify(param)],\\n                         {type: \\\"application/json\\\"})\\n              );\\n            });\\n        }\\n        throw error;\\n      })\\n      .push(function () {\\n        return doc_id;\\n      });\\n\\n  };\\n\\n  FileSystemBridgeStorage.prototype.remove = function (doc_id) {\\n    var context = this,\\n      got_error = false;\\n    return new RSVP.Queue()\\n\\n      // First, try to remove enclosure\\n      .push(function () {\\n        return context._sub_storage.removeAttachment(\\n          ROOT,\\n          doc_id\\n        );\\n      })\\n\\n      .push(undefined, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          got_error = true;\\n          return;\\n        }\\n        throw error;\\n      })\\n\\n      // Second, try to remove explicit doc\\n      .push(function () {\\n        return context._sub_storage.removeAttachment(\\n          DOCUMENT_KEY,\\n          doc_id + DOCUMENT_EXTENSION\\n        );\\n      })\\n\\n      .push(undefined, function (error) {\\n        if ((!got_error) && (error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          return doc_id;\\n        }\\n        throw error;\\n      });\\n\\n  };\\n\\n  FileSystemBridgeStorage.prototype.hasCapacity = function (capacity) {\\n    return (capacity === \\\"list\\\");\\n  };\\n\\n  FileSystemBridgeStorage.prototype.buildQuery = function () {\\n    var result_dict = {},\\n      context = this;\\n    return new RSVP.Queue()\\n\\n      // First, get list of explicit documents\\n\\n      .push(function () {\\n        return context._sub_storage.allAttachments(DOCUMENT_KEY);\\n      })\\n      .push(function (result) {\\n        var key;\\n        for (key in result) {\\n          if (result.hasOwnProperty(key)) {\\n            if (endsWith(key, DOCUMENT_EXTENSION)) {\\n              result_dict[key.substring(\\n                0,\\n                key.length - DOCUMENT_EXTENSION.length\\n              )] = null;\\n            }\\n          }\\n        }\\n      }, function (error) {\\n        if ((error instanceof jIO.util.jIOError) &&\\n            (error.status_code === 404)) {\\n          return;\\n        }\\n        throw error;\\n      })\\n\\n      // Second, get list of enclosure\\n\\n      .push(function () {\\n        return context._sub_storage.allAttachments(ROOT);\\n      })\\n      .push(function (result) {\\n        var key;\\n        for (key in result) {\\n          if (result.hasOwnProperty(key)) {\\n            result_dict[key] = null;\\n          }\\n        }\\n      })\\n\\n      // Finally, build the result\\n\\n      .push(function () {\\n        var result = [],\\n          key;\\n        for (key in result_dict) {\\n          if (result_dict.hasOwnProperty(key)) {\\n            result.push({\\n              id: key,\\n              value: {}\\n            });\\n          }\\n        }\\n        return result;\\n      });\\n\\n  };\\n\\n  FileSystemBridgeStorage.prototype.getAttachment = function (id, name) {\\n    if (name !== \\\"enclosure\\\") {\\n      throw new jIO.util.jIOError(\\\"Only support 'enclosure' attachment\\\",\\n                                  400);\\n    }\\n\\n    return this._sub_storage.getAttachment(ROOT, id);\\n  };\\n\\n  FileSystemBridgeStorage.prototype.putAttachment = function (id, name, blob) {\\n    if (name !== \\\"enclosure\\\") {\\n      throw new jIO.util.jIOError(\\\"Only support 'enclosure' attachment\\\",\\n                                  400);\\n    }\\n\\n    return this._sub_storage.putAttachment(\\n      ROOT,\\n      id,\\n      blob\\n    );\\n  };\\n\\n  FileSystemBridgeStorage.prototype.removeAttachment = function (id, name) {\\n    if (name !== \\\"enclosure\\\") {\\n      throw new jIO.util.jIOError(\\\"Only support 'enclosure' attachment\\\",\\n                                  400);\\n    }\\n\\n    return this._sub_storage.removeAttachment(ROOT, id);\\n  };\\n\\n  FileSystemBridgeStorage.prototype.repair = function () {\\n    return this._sub_storage.repair.apply(this._sub_storage, arguments);\\n  };\\n\\n  jIO.addStorage('drivetojiomapping', FileSystemBridgeStorage);\\n\\n}(jIO, RSVP, Blob));\\n;/*jslint nomen: true*/\\n/*global Blob, atob, btoa, RSVP*/\\n(function (jIO, Blob, atob, btoa, RSVP) {\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The jIO DocumentStorage extension\\n   *\\n   * @class DocumentStorage\\n   * @constructor\\n   */\\n  function DocumentStorage(spec) {\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n    this._document_id = spec.document_id;\\n    this._repair_attachment = spec.repair_attachment || false;\\n  }\\n\\n  var DOCUMENT_EXTENSION = \\\".json\\\",\\n    DOCUMENT_REGEXP = new RegExp(\\\"^jio_document/([\\\\\\\\w=]+)\\\" +\\n                                 DOCUMENT_EXTENSION + \\\"$\\\"),\\n    ATTACHMENT_REGEXP = new RegExp(\\\"^jio_attachment/([\\\\\\\\w=]+)/([\\\\\\\\w=]+)$\\\");\\n\\n  function getSubAttachmentIdFromParam(id, name) {\\n    if (name === undefined) {\\n      return 'jio_document/' + btoa(id) + DOCUMENT_EXTENSION;\\n    }\\n    return 'jio_attachment/' + btoa(id) + \\\"/\\\" + btoa(name);\\n  }\\n\\n  DocumentStorage.prototype.get = function (id) {\\n    return this._sub_storage.getAttachment(\\n      this._document_id,\\n      getSubAttachmentIdFromParam(id),\\n      {format: \\\"json\\\"}\\n    );\\n  };\\n\\n  DocumentStorage.prototype.allAttachments = function (id) {\\n    return this._sub_storage.allAttachments(this._document_id)\\n      .push(function (result) {\\n        var attachments = {},\\n          exec,\\n          key;\\n        for (key in result) {\\n          if (result.hasOwnProperty(key)) {\\n            if (ATTACHMENT_REGEXP.test(key)) {\\n              exec = ATTACHMENT_REGEXP.exec(key);\\n              try {\\n                if (atob(exec[1]) === id) {\\n                  attachments[atob(exec[2])] = {};\\n                }\\n              } catch (error) {\\n                // Check if unable to decode base64 data\\n                if (!error instanceof ReferenceError) {\\n                  throw error;\\n                }\\n              }\\n            }\\n          }\\n        }\\n        return attachments;\\n      });\\n  };\\n\\n  DocumentStorage.prototype.put = function (doc_id, param) {\\n    return this._sub_storage.putAttachment(\\n      this._document_id,\\n      getSubAttachmentIdFromParam(doc_id),\\n      new Blob([JSON.stringify(param)], {type: \\\"application/json\\\"})\\n    )\\n      .push(function () {\\n        return doc_id;\\n      });\\n\\n  };\\n\\n  DocumentStorage.prototype.remove = function (id) {\\n    var context = this;\\n    return this.allAttachments(id)\\n      .push(function (result) {\\n        var key,\\n          promise_list = [];\\n        for (key in result) {\\n          if (result.hasOwnProperty(key)) {\\n            promise_list.push(context.removeAttachment(id, key));\\n          }\\n        }\\n        return RSVP.all(promise_list);\\n      })\\n      .push(function () {\\n        return context._sub_storage.removeAttachment(\\n          context._document_id,\\n          getSubAttachmentIdFromParam(id)\\n        );\\n      })\\n      .push(function () {\\n        return id;\\n      });\\n  };\\n\\n  DocumentStorage.prototype.repair = function () {\\n    var context = this;\\n    return this._sub_storage.repair.apply(this._sub_storage, arguments)\\n      .push(function (result) {\\n        if (context._repair_attachment) {\\n          return context._sub_storage.allAttachments(context._document_id)\\n            .push(function (result_dict) {\\n              var promise_list = [],\\n                id_dict = {},\\n                attachment_dict = {},\\n                id,\\n                attachment,\\n                exec,\\n                key;\\n              for (key in result_dict) {\\n                if (result_dict.hasOwnProperty(key)) {\\n                  id = undefined;\\n                  attachment = undefined;\\n                  if (DOCUMENT_REGEXP.test(key)) {\\n                    try {\\n                      id = atob(DOCUMENT_REGEXP.exec(key)[1]);\\n                    } catch (error) {\\n                      // Check if unable to decode base64 data\\n                      if (!error instanceof ReferenceError) {\\n                        throw error;\\n                      }\\n                    }\\n                    if (id !== undefined) {\\n                      id_dict[id] = null;\\n                    }\\n                  } else if (ATTACHMENT_REGEXP.test(key)) {\\n                    exec = ATTACHMENT_REGEXP.exec(key);\\n                    try {\\n                      id = atob(exec[1]);\\n                      attachment = atob(exec[2]);\\n                    } catch (error) {\\n                      // Check if unable to decode base64 data\\n                      if (!error instanceof ReferenceError) {\\n                        throw error;\\n                      }\\n                    }\\n                    if (attachment !== undefined) {\\n                      if (!id_dict.hasOwnProperty(id)) {\\n                        if (!attachment_dict.hasOwnProperty(id)) {\\n                          attachment_dict[id] = {};\\n                        }\\n                        attachment_dict[id][attachment] = null;\\n                      }\\n                    }\\n                  }\\n                }\\n              }\\n              for (id in attachment_dict) {\\n                if (attachment_dict.hasOwnProperty(id)) {\\n                  if (!id_dict.hasOwnProperty(id)) {\\n                    for (attachment in attachment_dict[id]) {\\n                      if (attachment_dict[id].hasOwnProperty(attachment)) {\\n                        promise_list.push(context.removeAttachment(\\n                          id,\\n                          attachment\\n                        ));\\n                      }\\n                    }\\n                  }\\n                }\\n              }\\n              return RSVP.all(promise_list);\\n            });\\n        }\\n        return result;\\n      });\\n  };\\n\\n  DocumentStorage.prototype.hasCapacity = function (capacity) {\\n    return (capacity === \\\"list\\\");\\n  };\\n\\n  DocumentStorage.prototype.buildQuery = function () {\\n    return this._sub_storage.allAttachments(this._document_id)\\n      .push(function (attachment_dict) {\\n        var result = [],\\n          key;\\n        for (key in attachment_dict) {\\n          if (attachment_dict.hasOwnProperty(key)) {\\n            if (DOCUMENT_REGEXP.test(key)) {\\n              try {\\n                result.push({\\n                  id: atob(DOCUMENT_REGEXP.exec(key)[1]),\\n                  value: {}\\n                });\\n              } catch (error) {\\n                // Check if unable to decode base64 data\\n                if (!error instanceof ReferenceError) {\\n                  throw error;\\n                }\\n              }\\n            }\\n          }\\n        }\\n        return result;\\n      });\\n  };\\n\\n  DocumentStorage.prototype.getAttachment = function (id, name) {\\n    return this._sub_storage.getAttachment(\\n      this._document_id,\\n      getSubAttachmentIdFromParam(id, name)\\n    );\\n  };\\n\\n  DocumentStorage.prototype.putAttachment = function (id, name, blob) {\\n    return this._sub_storage.putAttachment(\\n      this._document_id,\\n      getSubAttachmentIdFromParam(id, name),\\n      blob\\n    );\\n  };\\n\\n  DocumentStorage.prototype.removeAttachment = function (id, name) {\\n    return this._sub_storage.removeAttachment(\\n      this._document_id,\\n      getSubAttachmentIdFromParam(id, name)\\n    );\\n  };\\n\\n  jIO.addStorage('document', DocumentStorage);\\n\\n}(jIO, Blob, atob, btoa, RSVP));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/*jslint nomen: true*/\\n/*global jIO, sessionStorage, localStorage, RSVP */\\n\\n/**\\n * JIO Local Storage. Type = 'local'.\\n * Local browser \\\"database\\\" storage.\\n *\\n * Storage Description:\\n *\\n *     {\\n *       \\\"type\\\": \\\"local\\\",\\n *       \\\"sessiononly\\\": false\\n *     }\\n *\\n * @class LocalStorage\\n */\\n\\n(function (jIO, sessionStorage, localStorage, RSVP) {\\n  \\\"use strict\\\";\\n\\n  function LocalStorage(spec) {\\n    if (spec.sessiononly === true) {\\n      this._storage = sessionStorage;\\n    } else {\\n      this._storage = localStorage;\\n    }\\n  }\\n\\n  function restrictDocumentId(id) {\\n    if (id !== \\\"/\\\") {\\n      throw new jIO.util.jIOError(\\\"id \\\" + id + \\\" is forbidden (!== /)\\\",\\n                                  400);\\n    }\\n  }\\n\\n  LocalStorage.prototype.get = function (id) {\\n    restrictDocumentId(id);\\n    return {};\\n  };\\n\\n  LocalStorage.prototype.allAttachments = function (id) {\\n    restrictDocumentId(id);\\n\\n    var attachments = {},\\n      key;\\n\\n    for (key in this._storage) {\\n      if (this._storage.hasOwnProperty(key)) {\\n        attachments[key] = {};\\n      }\\n    }\\n    return attachments;\\n  };\\n\\n  LocalStorage.prototype.getAttachment = function (id, name) {\\n    restrictDocumentId(id);\\n\\n    var textstring = this._storage.getItem(name);\\n\\n    if (textstring === null) {\\n      throw new jIO.util.jIOError(\\n        \\\"Cannot find attachment \\\" + name,\\n        404\\n      );\\n    }\\n    return jIO.util.dataURItoBlob(textstring);\\n  };\\n\\n  LocalStorage.prototype.putAttachment = function (id, name, blob) {\\n    var context = this;\\n    restrictDocumentId(id);\\n\\n    // the document already exists\\n    // download data\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return jIO.util.readBlobAsDataURL(blob);\\n      })\\n      .push(function (e) {\\n        context._storage.setItem(name, e.target.result);\\n      });\\n  };\\n\\n  LocalStorage.prototype.removeAttachment = function (id, name) {\\n    restrictDocumentId(id);\\n    return this._storage.removeItem(name);\\n  };\\n\\n\\n  LocalStorage.prototype.hasCapacity = function (name) {\\n    return (name === \\\"list\\\");\\n  };\\n\\n  LocalStorage.prototype.buildQuery = function () {\\n    return [{\\n      id: \\\"/\\\",\\n      value: {}\\n    }];\\n  };\\n\\n  jIO.addStorage('local', LocalStorage);\\n\\n}(jIO, sessionStorage, localStorage, RSVP));\\n;/*\\n * Copyright 2014, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/**\\n * JIO Indexed Database Storage.\\n *\\n * A local browser \\\"database\\\" storage greatly more powerful than localStorage.\\n *\\n * Description:\\n *\\n *    {\\n *      \\\"type\\\": \\\"indexeddb\\\",\\n *      \\\"database\\\": <string>\\n *    }\\n *\\n * The database name will be prefixed by \\\"jio:\\\", so if the database property is\\n * \\\"hello\\\", then you can manually reach this database with\\n * `indexedDB.open(\\\"jio:hello\\\");`. (Or\\n * `indexedDB.deleteDatabase(\\\"jio:hello\\\");`.)\\n *\\n * For more informations:\\n *\\n * - http://www.w3.org/TR/IndexedDB/\\n * - https://developer.mozilla.org/en-US/docs/IndexedDB/Using_IndexedDB\\n */\\n\\n/*jslint nomen: true */\\n/*global indexedDB, jIO, RSVP, Blob, Math, IDBKeyRange, IDBOpenDBRequest,\\n        DOMError, Event*/\\n\\n(function (indexedDB, jIO, RSVP, Blob, Math, IDBKeyRange, IDBOpenDBRequest,\\n           DOMError) {\\n  \\\"use strict\\\";\\n\\n  // Read only as changing it can lead to data corruption\\n  var UNITE = 2000000;\\n\\n  function IndexedDBStorage(description) {\\n    if (typeof description.database !== \\\"string\\\" ||\\n        description.database === \\\"\\\") {\\n      throw new TypeError(\\\"IndexedDBStorage 'database' description property \\\" +\\n                          \\\"must be a non-empty string\\\");\\n    }\\n    this._database_name = \\\"jio:\\\" + description.database;\\n  }\\n\\n  IndexedDBStorage.prototype.hasCapacity = function (name) {\\n    return ((name === \\\"list\\\") || (name === \\\"include\\\"));\\n  };\\n\\n  function buildKeyPath(key_list) {\\n    return key_list.join(\\\"_\\\");\\n  }\\n\\n  function handleUpgradeNeeded(evt) {\\n    var db = evt.target.result,\\n      store;\\n\\n    store = db.createObjectStore(\\\"metadata\\\", {\\n      keyPath: \\\"_id\\\",\\n      autoIncrement: false\\n    });\\n    // It is not possible to use openKeyCursor on keypath directly\\n    // https://www.w3.org/Bugs/Public/show_bug.cgi?id=19955\\n    store.createIndex(\\\"_id\\\", \\\"_id\\\", {unique: true});\\n\\n    store = db.createObjectStore(\\\"attachment\\\", {\\n      keyPath: \\\"_key_path\\\",\\n      autoIncrement: false\\n    });\\n    store.createIndex(\\\"_id\\\", \\\"_id\\\", {unique: false});\\n\\n    store = db.createObjectStore(\\\"blob\\\", {\\n      keyPath: \\\"_key_path\\\",\\n      autoIncrement: false\\n    });\\n    store.createIndex(\\\"_id_attachment\\\",\\n                      [\\\"_id\\\", \\\"_attachment\\\"], {unique: false});\\n    store.createIndex(\\\"_id\\\", \\\"_id\\\", {unique: false});\\n  }\\n\\n  function openIndexedDB(jio_storage) {\\n    var db_name = jio_storage._database_name;\\n    function resolver(resolve, reject) {\\n      // Open DB //\\n      var request = indexedDB.open(db_name);\\n      request.onerror = function (error) {\\n        if (request.result) {\\n          request.result.close();\\n        }\\n        if ((error !== undefined) &&\\n            (error.target instanceof IDBOpenDBRequest) &&\\n            (error.target.error instanceof DOMError)) {\\n          reject(\\\"Connection to: \\\" + db_name + \\\" failed: \\\" +\\n                 error.target.error.message);\\n        } else {\\n          reject(error);\\n        }\\n      };\\n\\n      request.onabort = function () {\\n        request.result.close();\\n        reject(\\\"Aborting connection to: \\\" + db_name);\\n      };\\n\\n      request.ontimeout = function () {\\n        request.result.close();\\n        reject(\\\"Connection to: \\\" + db_name + \\\" timeout\\\");\\n      };\\n\\n      request.onblocked = function () {\\n        request.result.close();\\n        reject(\\\"Connection to: \\\" + db_name + \\\" was blocked\\\");\\n      };\\n\\n      // Create DB if necessary //\\n      request.onupgradeneeded = handleUpgradeNeeded;\\n\\n      request.onversionchange = function () {\\n        request.result.close();\\n        reject(db_name + \\\" was upgraded\\\");\\n      };\\n\\n      request.onsuccess = function () {\\n        resolve(request.result);\\n      };\\n    }\\n    // XXX Canceller???\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return new RSVP.Promise(resolver);\\n      });\\n  }\\n\\n  function openTransaction(db, stores, flag, autoclosedb) {\\n    var tx = db.transaction(stores, flag);\\n    if (autoclosedb !== false) {\\n      tx.oncomplete = function () {\\n        db.close();\\n      };\\n    }\\n    tx.onabort = function () {\\n      db.close();\\n    };\\n    return tx;\\n  }\\n\\n  function handleCursor(request, callback) {\\n    function resolver(resolve, reject) {\\n      // Open DB //\\n      request.onerror = function (error) {\\n        if (request.transaction) {\\n          request.transaction.abort();\\n        }\\n        reject(error);\\n      };\\n\\n      request.onsuccess = function (evt) {\\n        var cursor = evt.target.result;\\n        if (cursor) {\\n          // XXX Wait for result\\n          try {\\n            callback(cursor);\\n          } catch (error) {\\n            reject(error);\\n          }\\n\\n          // continue to next iteration\\n          cursor[\\\"continue\\\"]();\\n        } else {\\n          resolve();\\n        }\\n      };\\n    }\\n    // XXX Canceller???\\n    return new RSVP.Promise(resolver);\\n  }\\n\\n  IndexedDBStorage.prototype.buildQuery = function (options) {\\n    var result_list = [];\\n\\n    function pushIncludedMetadata(cursor) {\\n      result_list.push({\\n        \\\"id\\\": cursor.key,\\n        \\\"value\\\": {},\\n        \\\"doc\\\": cursor.value.doc\\n      });\\n    }\\n\\n    function pushMetadata(cursor) {\\n      result_list.push({\\n        \\\"id\\\": cursor.key,\\n        \\\"value\\\": {}\\n      });\\n    }\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var tx = openTransaction(db, [\\\"metadata\\\"], \\\"readonly\\\");\\n        if (options.include_docs === true) {\\n          return handleCursor(tx.objectStore(\\\"metadata\\\").index(\\\"_id\\\")\\n                              .openCursor(), pushIncludedMetadata);\\n        }\\n        return handleCursor(tx.objectStore(\\\"metadata\\\").index(\\\"_id\\\")\\n                            .openKeyCursor(), pushMetadata);\\n      })\\n      .push(function () {\\n        return result_list;\\n      });\\n\\n  };\\n\\n  function handleGet(request) {\\n    function resolver(resolve, reject) {\\n      request.onerror = reject;\\n      request.onsuccess = function () {\\n        if (request.result) {\\n          resolve(request.result);\\n        }\\n        // XXX How to get ID\\n        reject(new jIO.util.jIOError(\\\"Cannot find document\\\", 404));\\n      };\\n    }\\n    return new RSVP.Promise(resolver);\\n  }\\n\\n  IndexedDBStorage.prototype.get = function (id) {\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var transaction = openTransaction(db, [\\\"metadata\\\"],\\n                                          \\\"readonly\\\");\\n        return handleGet(transaction.objectStore(\\\"metadata\\\").get(id));\\n      })\\n      .push(function (result) {\\n        return result.doc;\\n      });\\n  };\\n\\n  IndexedDBStorage.prototype.allAttachments = function (id) {\\n    var attachment_dict = {};\\n\\n    function addEntry(cursor) {\\n      attachment_dict[cursor.value._attachment] = {};\\n    }\\n\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var transaction = openTransaction(db, [\\\"metadata\\\", \\\"attachment\\\"],\\n                                          \\\"readonly\\\");\\n        return RSVP.all([\\n          handleGet(transaction.objectStore(\\\"metadata\\\").get(id)),\\n          handleCursor(transaction.objectStore(\\\"attachment\\\").index(\\\"_id\\\")\\n                       .openCursor(IDBKeyRange.only(id)), addEntry)\\n        ]);\\n      })\\n      .push(function () {\\n        return attachment_dict;\\n      });\\n  };\\n\\n  function handleRequest(request) {\\n    function resolver(resolve, reject) {\\n      request.onerror = reject;\\n      request.onsuccess = function () {\\n        resolve(request.result);\\n      };\\n    }\\n    return new RSVP.Promise(resolver);\\n  }\\n\\n  IndexedDBStorage.prototype.put = function (id, metadata) {\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var transaction = openTransaction(db, [\\\"metadata\\\"], \\\"readwrite\\\");\\n        return handleRequest(transaction.objectStore(\\\"metadata\\\").put({\\n          \\\"_id\\\": id,\\n          \\\"doc\\\": metadata\\n        }));\\n      });\\n  };\\n\\n  function deleteEntry(cursor) {\\n    cursor[\\\"delete\\\"]();\\n  }\\n\\n  IndexedDBStorage.prototype.remove = function (id) {\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var transaction = openTransaction(db, [\\\"metadata\\\", \\\"attachment\\\",\\n                                          \\\"blob\\\"], \\\"readwrite\\\");\\n        return RSVP.all([\\n          handleRequest(transaction\\n                        .objectStore(\\\"metadata\\\")[\\\"delete\\\"](id)),\\n          // XXX Why not possible to delete with KeyCursor?\\n          handleCursor(transaction.objectStore(\\\"attachment\\\").index(\\\"_id\\\")\\n                       .openCursor(IDBKeyRange.only(id)), deleteEntry),\\n          handleCursor(transaction.objectStore(\\\"blob\\\").index(\\\"_id\\\")\\n                       .openCursor(IDBKeyRange.only(id)), deleteEntry)\\n        ]);\\n      });\\n  };\\n\\n  IndexedDBStorage.prototype.getAttachment = function (id, name, options) {\\n    var transaction,\\n      type,\\n      start,\\n      end;\\n    if (options === undefined) {\\n      options = {};\\n    }\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        transaction = openTransaction(db, [\\\"attachment\\\", \\\"blob\\\"], \\\"readonly\\\");\\n        // XXX Should raise if key is not good\\n        return handleGet(transaction.objectStore(\\\"attachment\\\")\\n                         .get(buildKeyPath([id, name])));\\n      })\\n      .push(function (attachment) {\\n        var total_length = attachment.info.length,\\n          i,\\n          promise_list = [],\\n          store = transaction.objectStore(\\\"blob\\\"),\\n          start_index,\\n          end_index;\\n\\n        type = attachment.info.content_type;\\n        start = options.start || 0;\\n        end = options.end || total_length;\\n        if (end > total_length) {\\n          end = total_length;\\n        }\\n\\n        if (start < 0 || end < 0) {\\n          throw new jIO.util.jIOError(\\\"_start and _end must be positive\\\",\\n                                      400);\\n        }\\n        if (start > end) {\\n          throw new jIO.util.jIOError(\\\"_start is greater than _end\\\",\\n                                      400);\\n        }\\n\\n        start_index = Math.floor(start / UNITE);\\n        end_index =  Math.floor(end / UNITE);\\n        if (end % UNITE === 0) {\\n          end_index -= 1;\\n        }\\n\\n        for (i = start_index; i <= end_index; i += 1) {\\n          promise_list.push(\\n            handleGet(store.get(buildKeyPath([id,\\n                                name, i])))\\n          );\\n        }\\n        return RSVP.all(promise_list);\\n      })\\n      .push(function (result_list) {\\n        var array_buffer_list = [],\\n          blob,\\n          i,\\n          index,\\n          len = result_list.length;\\n        for (i = 0; i < len; i += 1) {\\n          array_buffer_list.push(result_list[i].blob);\\n        }\\n        if ((options.start === undefined) && (options.end === undefined)) {\\n          return new Blob(array_buffer_list, {type: type});\\n        }\\n        index = Math.floor(start / UNITE) * UNITE;\\n        blob = new Blob(array_buffer_list, {type: \\\"application/octet-stream\\\"});\\n        return blob.slice(start - index, end - index,\\n                          \\\"application/octet-stream\\\");\\n      });\\n  };\\n\\n  function removeAttachment(transaction, id, name) {\\n    return RSVP.all([\\n      // XXX How to get the right attachment\\n      handleRequest(transaction.objectStore(\\\"attachment\\\")[\\\"delete\\\"](\\n        buildKeyPath([id, name])\\n      )),\\n      handleCursor(transaction.objectStore(\\\"blob\\\").index(\\\"_id_attachment\\\")\\n                   .openCursor(IDBKeyRange.only(\\n          [id, name]\\n        )),\\n          deleteEntry\\n        )\\n    ]);\\n  }\\n\\n  IndexedDBStorage.prototype.putAttachment = function (id, name, blob) {\\n    var blob_part = [],\\n      transaction,\\n      db;\\n\\n    return openIndexedDB(this)\\n      .push(function (database) {\\n        db = database;\\n\\n        // Split the blob first\\n        return jIO.util.readBlobAsArrayBuffer(blob);\\n      })\\n      .push(function (event) {\\n        var array_buffer = event.target.result,\\n          total_size = blob.size,\\n          handled_size = 0;\\n\\n        while (handled_size < total_size) {\\n          blob_part.push(array_buffer.slice(handled_size,\\n                                            handled_size + UNITE));\\n          handled_size += UNITE;\\n        }\\n\\n        // Remove previous attachment\\n        transaction = openTransaction(db, [\\\"attachment\\\", \\\"blob\\\"], \\\"readwrite\\\");\\n        return removeAttachment(transaction, id, name);\\n      })\\n      .push(function () {\\n\\n        var promise_list = [\\n            handleRequest(transaction.objectStore(\\\"attachment\\\").put({\\n              \\\"_key_path\\\": buildKeyPath([id, name]),\\n              \\\"_id\\\": id,\\n              \\\"_attachment\\\": name,\\n              \\\"info\\\": {\\n                \\\"content_type\\\": blob.type,\\n                \\\"length\\\": blob.size\\n              }\\n            }))\\n          ],\\n          len = blob_part.length,\\n          blob_store = transaction.objectStore(\\\"blob\\\"),\\n          i;\\n        for (i = 0; i < len; i += 1) {\\n          promise_list.push(\\n            handleRequest(blob_store.put({\\n              \\\"_key_path\\\": buildKeyPath([id, name,\\n                                         i]),\\n              \\\"_id\\\" : id,\\n              \\\"_attachment\\\" : name,\\n              \\\"_part\\\" : i,\\n              \\\"blob\\\": blob_part[i]\\n            }))\\n          );\\n        }\\n        // Store all new data\\n        return RSVP.all(promise_list);\\n      });\\n  };\\n\\n  IndexedDBStorage.prototype.removeAttachment = function (id, name) {\\n    return openIndexedDB(this)\\n      .push(function (db) {\\n        var transaction = openTransaction(db, [\\\"attachment\\\", \\\"blob\\\"],\\n                                          \\\"readwrite\\\");\\n        return removeAttachment(transaction, id, name);\\n      });\\n  };\\n\\n  jIO.addStorage(\\\"indexeddb\\\", IndexedDBStorage);\\n}(indexedDB, jIO, RSVP, Blob, Math, IDBKeyRange, IDBOpenDBRequest, DOMError));\\n;/*\\n * Copyright 2015, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n\\n/*jslint nomen: true*/\\n/*global jIO, RSVP, DOMException, Blob, crypto, Uint8Array, ArrayBuffer*/\\n\\n(function (jIO, RSVP, DOMException, Blob, crypto, Uint8Array, ArrayBuffer) {\\n  \\\"use strict\\\";\\n\\n\\n  // you the cryptography system used by this storage is AES-GCM.\\n  // here is an example of how to generate a key to the json format.\\n\\n  // var key,\\n  //     jsonKey;\\n  // crypto.subtle.generateKey({name: \\\"AES-GCM\\\",length: 256},\\n  //                           (true), [\\\"encrypt\\\", \\\"decrypt\\\"])\\n  // .then(function(res){key = res;});\\n  //\\n  // window.crypto.subtle.exportKey(\\\"jwk\\\", key)\\n  // .then(function(res){jsonKey = val})\\n  //\\n  //var storage = jIO.createJIO({type: \\\"crypt\\\", key: jsonKey,\\n  //                             sub_storage: {...}});\\n\\n  // find more informations about this cryptography system on\\n  // https://github.com/diafygi/webcrypto-examples#aes-gcm\\n\\n  /**\\n   * The JIO Cryptography Storage extension\\n   *\\n   * @class CryptStorage\\n   * @constructor\\n   */\\n\\n  var MIME_TYPE = \\\"application/x-jio-aes-gcm-encryption\\\";\\n\\n  function CryptStorage(spec) {\\n    this._key = spec.key;\\n    this._jsonKey = true;\\n    this._sub_storage = jIO.createJIO(spec.sub_storage);\\n  }\\n\\n  function convertKey(that) {\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return crypto.subtle.importKey(\\\"jwk\\\", that._key,\\n                                       \\\"AES-GCM\\\", false,\\n                                       [\\\"encrypt\\\", \\\"decrypt\\\"]);\\n      })\\n      .push(function (res) {\\n        that._key = res;\\n        that._jsonKey = false;\\n        return;\\n      });\\n  }\\n\\n  CryptStorage.prototype.get = function () {\\n    return this._sub_storage.get.apply(this._sub_storage,\\n                                       arguments);\\n  };\\n\\n  CryptStorage.prototype.post = function () {\\n    return this._sub_storage.post.apply(this._sub_storage,\\n                                        arguments);\\n  };\\n\\n  CryptStorage.prototype.put = function () {\\n    return this._sub_storage.put.apply(this._sub_storage,\\n                                       arguments);\\n  };\\n\\n  CryptStorage.prototype.remove = function () {\\n    return this._sub_storage.remove.apply(this._sub_storage,\\n                                          arguments);\\n  };\\n\\n  CryptStorage.prototype.hasCapacity = function () {\\n    return this._sub_storage.hasCapacity.apply(this._sub_storage,\\n                                               arguments);\\n  };\\n\\n  CryptStorage.prototype.buildQuery = function () {\\n    return this._sub_storage.buildQuery.apply(this._sub_storage,\\n                                              arguments);\\n  };\\n\\n\\n  CryptStorage.prototype.putAttachment = function (id, name, blob) {\\n    var initializaton_vector = crypto.getRandomValues(new Uint8Array(12)),\\n      that = this;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        if (that._jsonKey === true) {\\n          return convertKey(that);\\n        }\\n        return;\\n      })\\n      .push(function () {\\n        return jIO.util.readBlobAsDataURL(blob);\\n      })\\n      .push(function (dataURL) {\\n        //string->arraybuffer\\n        var strLen = dataURL.currentTarget.result.length,\\n          buf = new ArrayBuffer(strLen),\\n          bufView = new Uint8Array(buf),\\n          i;\\n\\n        dataURL = dataURL.currentTarget.result;\\n        for (i = 0; i < strLen; i += 1) {\\n          bufView[i] = dataURL.charCodeAt(i);\\n        }\\n        return crypto.subtle.encrypt({\\n          name : \\\"AES-GCM\\\",\\n          iv : initializaton_vector\\n        },\\n                                     that._key, buf);\\n      })\\n      .push(function (coded) {\\n        var blob = new Blob([initializaton_vector, coded], {type: MIME_TYPE});\\n        return that._sub_storage.putAttachment(id, name, blob);\\n      });\\n  };\\n\\n  CryptStorage.prototype.getAttachment = function (id, name) {\\n    var that = this;\\n\\n    return that._sub_storage.getAttachment(id, name)\\n      .push(function (blob) {\\n        if (blob.type !== MIME_TYPE) {\\n          return blob;\\n        }\\n        return new RSVP.Queue()\\n          .push(function () {\\n            if (that._jsonKey === true) {\\n              return convertKey(that);\\n            }\\n            return;\\n          })\\n          .push(function () {\\n            return jIO.util.readBlobAsArrayBuffer(blob);\\n          })\\n          .push(function (coded) {\\n            var initializaton_vector;\\n\\n            coded = coded.currentTarget.result;\\n            initializaton_vector = new Uint8Array(coded.slice(0, 12));\\n            return new RSVP.Queue()\\n              .push(function () {\\n                return crypto.subtle.decrypt({\\n                  name : \\\"AES-GCM\\\",\\n                  iv : initializaton_vector\\n                },\\n                                             that._key, coded.slice(12));\\n              })\\n              .push(function (arr) {\\n                //arraybuffer->string\\n                arr = String.fromCharCode.apply(null, new Uint8Array(arr));\\n                return jIO.util.dataURItoBlob(arr);\\n              })\\n              .push(undefined, function (error) {\\n                if (error instanceof DOMException) {\\n                  return blob;\\n                }\\n                throw error;\\n              });\\n          });\\n      });\\n  };\\n\\n  CryptStorage.prototype.removeAttachment = function () {\\n    return this._sub_storage.removeAttachment.apply(this._sub_storage,\\n                                                    arguments);\\n  };\\n\\n  CryptStorage.prototype.allAttachments = function () {\\n    return this._sub_storage.allAttachments.apply(this._sub_storage,\\n                                                  arguments);\\n  };\\n\\n  jIO.addStorage('crypt', CryptStorage);\\n\\n}(jIO, RSVP, DOMException, Blob, crypto, Uint8Array, ArrayBuffer));\\n;/*\\n * Copyright 2013, Nexedi SA\\n * Released under the LGPL license.\\n * http://www.gnu.org/licenses/lgpl.html\\n */\\n/**\\n * JIO Websql Storage. Type = \\\"websql\\\".\\n * websql \\\"database\\\" storage.\\n */\\n/*global Blob, jIO, RSVP, openDatabase*/\\n/*jslint nomen: true*/\\n\\n(function (jIO, RSVP, Blob, openDatabase) {\\n\\n  \\\"use strict\\\";\\n\\n  /**\\n   * The JIO Websql Storage extension\\n   *\\n   * @class WebSQLStorage\\n   * @constructor\\n   */\\n\\n  function queueSql(db, query_list, argument_list) {\\n    return new RSVP.Promise(function (resolve, reject) {\\n      /*jslint unparam: true*/\\n      db.transaction(function (tx) {\\n        var len = query_list.length,\\n          result_list = [],\\n          i;\\n\\n        function resolveTransaction(tx, result) {\\n          result_list.push(result);\\n          if (result_list.length === len) {\\n            resolve(result_list);\\n          }\\n        }\\n        function rejectTransaction(tx, error) {\\n          reject(error);\\n          return true;\\n        }\\n        for (i = 0; i < len; i += 1) {\\n          tx.executeSql(query_list[i], argument_list[i], resolveTransaction,\\n                        rejectTransaction);\\n        }\\n      }, function (tx, error) {\\n        reject(error);\\n      });\\n      /*jslint unparam: false*/\\n    });\\n  }\\n\\n  function initDatabase(db) {\\n    var query_list = [\\n      \\\"CREATE TABLE IF NOT EXISTS document\\\" +\\n        \\\"(id VARCHAR PRIMARY KEY NOT NULL, data TEXT)\\\",\\n      \\\"CREATE TABLE IF NOT EXISTS attachment\\\" +\\n        \\\"(id VARCHAR, attachment VARCHAR, part INT, blob TEXT)\\\",\\n      \\\"CREATE TRIGGER IF NOT EXISTS removeAttachment \\\" +\\n        \\\"BEFORE DELETE ON document FOR EACH ROW \\\" +\\n        \\\"BEGIN DELETE from attachment WHERE id = OLD.id;END;\\\",\\n      \\\"CREATE INDEX IF NOT EXISTS index_document ON document (id);\\\",\\n      \\\"CREATE INDEX IF NOT EXISTS index_attachment \\\" +\\n        \\\"ON attachment (id, attachment);\\\"\\n    ];\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return queueSql(db, query_list, []);\\n      });\\n  }\\n\\n  function WebSQLStorage(spec) {\\n    if (typeof spec.database !== 'string' || !spec.database) {\\n      throw new TypeError(\\\"database must be a string \\\" +\\n                          \\\"which contains more than one character.\\\");\\n    }\\n    this._database = openDatabase(\\\"jio:\\\" + spec.database,\\n                                  '1.0', '', 2 * 1024 * 1024);\\n    if (spec.blob_length &&\\n        (typeof spec.blob_length !== \\\"number\\\" ||\\n         spec.blob_length < 20)) {\\n      throw new TypeError(\\\"blob_len parameter must be a number >= 20\\\");\\n    }\\n    this._blob_length = spec.blob_length || 2000000;\\n    this._init_db_promise = initDatabase(this._database);\\n  }\\n\\n  WebSQLStorage.prototype.put = function (id, param) {\\n    var db = this._database,\\n      that = this,\\n      data_string = JSON.stringify(param);\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\\"INSERT OR REPLACE INTO \\\" +\\n                            \\\"document(id, data) VALUES(?,?)\\\"],\\n                       [[id, data_string]]);\\n      })\\n      .push(function () {\\n        return id;\\n      });\\n  };\\n\\n  WebSQLStorage.prototype.remove = function (id) {\\n    var db = this._database,\\n      that = this;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\\"DELETE FROM document WHERE id = ?\\\"], [[id]]);\\n      })\\n      .push(function (result_list) {\\n        if (result_list[0].rowsAffected === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        return id;\\n      });\\n\\n  };\\n\\n  WebSQLStorage.prototype.get = function (id) {\\n    var db = this._database,\\n      that = this;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\\"SELECT data FROM document WHERE id = ?\\\"],\\n                        [[id]]);\\n      })\\n      .push(function (result_list) {\\n        if (result_list[0].rows.length === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        return JSON.parse(result_list[0].rows[0].data);\\n      });\\n  };\\n\\n  WebSQLStorage.prototype.allAttachments = function (id) {\\n    var db = this._database,\\n      that = this;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\n          \\\"SELECT id FROM document WHERE id = ?\\\",\\n          \\\"SELECT DISTINCT attachment FROM attachment WHERE id = ?\\\"\\n        ], [[id], [id]]);\\n      })\\n      .push(function (result_list) {\\n        if (result_list[0].rows.length === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n\\n        var len = result_list[1].rows.length,\\n          obj = {},\\n          i;\\n\\n        for (i = 0; i < len; i += 1) {\\n          obj[result_list[1].rows[i].attachment] = {};\\n        }\\n        return obj;\\n      });\\n  };\\n\\n  function sendBlobPart(blob, argument_list, index, queue) {\\n    queue.push(function () {\\n      return jIO.util.readBlobAsDataURL(blob);\\n    })\\n      .push(function (strBlob) {\\n        argument_list[index + 2].push(strBlob.currentTarget.result);\\n        return;\\n      });\\n  }\\n\\n  WebSQLStorage.prototype.putAttachment = function (id, name, blob) {\\n    var db = this._database,\\n      that = this,\\n      part_size = this._blob_length;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\\"SELECT id FROM document WHERE id = ?\\\"], [[id]]);\\n      })\\n      .push(function (result) {\\n        var query_list = [],\\n          argument_list = [],\\n          blob_size = blob.size,\\n          queue = new RSVP.Queue(),\\n          i,\\n          index;\\n\\n        if (result[0].rows.length === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot access subdocument\\\", 404);\\n        }\\n        query_list.push(\\\"DELETE FROM attachment WHERE id = ? \\\" +\\n                        \\\"AND attachment = ?\\\");\\n        argument_list.push([id, name]);\\n        query_list.push(\\\"INSERT INTO attachment(id, attachment, part, blob)\\\" +\\n                     \\\"VALUES(?, ?, ?, ?)\\\");\\n        argument_list.push([id, name, -1,\\n                            blob.type || \\\"application/octet-stream\\\"]);\\n\\n        for (i = 0, index = 0; i < blob_size; i += part_size, index += 1) {\\n          query_list.push(\\\"INSERT INTO attachment(id, attachment, part, blob)\\\" +\\n                       \\\"VALUES(?, ?, ?, ?)\\\");\\n          argument_list.push([id, name, index]);\\n          sendBlobPart(blob.slice(i, i + part_size), argument_list, index,\\n                       queue);\\n        }\\n        queue.push(function () {\\n          return queueSql(db, query_list, argument_list);\\n        });\\n        return queue;\\n      });\\n  };\\n\\n  WebSQLStorage.prototype.getAttachment = function (id, name, options) {\\n    var db = this._database,\\n      that = this,\\n      part_size = this._blob_length,\\n      start,\\n      end,\\n      start_index,\\n      end_index;\\n\\n    if (options === undefined) { options = {}; }\\n    start = options.start || 0;\\n    end = options.end || -1;\\n\\n    if (start < 0 || (options.end !== undefined && options.end < 0)) {\\n      throw new jIO.util.jIOError(\\\"_start and _end must be positive\\\",\\n                                  400);\\n    }\\n    if (start > end && end !== -1) {\\n      throw new jIO.util.jIOError(\\\"_start is greater than _end\\\",\\n                                  400);\\n    }\\n\\n    start_index = Math.floor(start / part_size);\\n    if (start === 0) { start_index -= 1; }\\n    end_index =  Math.floor(end / part_size);\\n    if (end % part_size === 0) {\\n      end_index -= 1;\\n    }\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        var command = \\\"SELECT part, blob FROM attachment WHERE id = ? AND \\\" +\\n          \\\"attachment = ? AND part >= ?\\\",\\n          argument_list = [id, name, start_index];\\n\\n        if (end !== -1) {\\n          command += \\\" AND part <= ?\\\";\\n          argument_list.push(end_index);\\n        }\\n        return queueSql(db, [command], [argument_list]);\\n      })\\n      .push(function (response_list) {\\n        var i,\\n          response,\\n          blob_array = [],\\n          blob,\\n          type;\\n\\n        response = response_list[0].rows;\\n        if (response.length === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        for (i = 0; i < response.length; i += 1) {\\n          if (response[i].part === -1) {\\n            type = response[i].blob;\\n            start_index += 1;\\n          } else {\\n            blob_array.push(jIO.util.dataURItoBlob(response[i].blob));\\n          }\\n        }\\n        if ((start === 0) && (options.end === undefined)) {\\n          return new Blob(blob_array, {type: type});\\n        }\\n        blob = new Blob(blob_array, {});\\n        return blob.slice(start - (start_index * part_size),\\n                          end === -1 ? blob.size :\\n                          end - (start_index * part_size),\\n                          \\\"application/octet-stream\\\");\\n      });\\n  };\\n\\n  WebSQLStorage.prototype.removeAttachment = function (id, name) {\\n    var db = this._database,\\n      that = this;\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        return queueSql(db, [\\\"DELETE FROM attachment WHERE \\\" +\\n                            \\\"id = ? AND attachment = ?\\\"], [[id, name]]);\\n      })\\n      .push(function (result) {\\n        if (result[0].rowsAffected === 0) {\\n          throw new jIO.util.jIOError(\\\"Cannot find document\\\", 404);\\n        }\\n        return name;\\n      });\\n  };\\n\\n  WebSQLStorage.prototype.hasCapacity = function (name) {\\n    return (name === \\\"list\\\" || (name === \\\"include\\\"));\\n  };\\n\\n  WebSQLStorage.prototype.buildQuery = function (options) {\\n    var db = this._database,\\n      that = this,\\n      query =  \\\"SELECT id\\\";\\n\\n    return new RSVP.Queue()\\n      .push(function () {\\n        return that._init_db_promise;\\n      })\\n      .push(function () {\\n        if (options === undefined) { options = {}; }\\n        if (options.include_docs === true) {\\n          query += \\\", data AS doc\\\";\\n        }\\n        query += \\\" FROM document\\\";\\n        return queueSql(db, [query], [[]]);\\n      })\\n      .push(function (result) {\\n        var array = [],\\n          len = result[0].rows.length,\\n          i;\\n\\n        for (i = 0; i < len; i += 1) {\\n          array.push(result[0].rows[i]);\\n          array[i].value = {};\\n          if (array[i].doc !== undefined) {\\n            array[i].doc = JSON.parse(array[i].doc);\\n          }\\n        }\\n        return array;\\n      });\\n  };\\n\\n  jIO.addStorage('websql', WebSQLStorage);\\n\\n}(jIO, RSVP, Blob, openDatabase));\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/raw-loader!./~/jio/dist/jio-latest.js\n// module id = 723\n// module chunks = 2","module.exports = \"/*! loglevel - v1.4.1 - https://github.com/pimterry/loglevel - (c) 2016 Tim Perry - licensed MIT */\\n!function(a,b){\\\"use strict\\\";\\\"function\\\"==typeof define&&define.amd?define(b):\\\"object\\\"==typeof module&&module.exports?module.exports=b():a.log=b()}(this,function(){\\\"use strict\\\";function a(a){return typeof console===h?!1:void 0!==console[a]?b(console,a):void 0!==console.log?b(console,\\\"log\\\"):g}function b(a,b){var c=a[b];if(\\\"function\\\"==typeof c.bind)return c.bind(a);try{return Function.prototype.bind.call(c,a)}catch(d){return function(){return Function.prototype.apply.apply(c,[a,arguments])}}}function c(a,b,c){return function(){typeof console!==h&&(d.call(this,b,c),this[a].apply(this,arguments))}}function d(a,b){for(var c=0;c<i.length;c++){var d=i[c];this[d]=a>c?g:this.methodFactory(d,a,b)}}function e(b,d,e){return a(b)||c.apply(this,arguments)}function f(a,b,c){function f(a){var b=(i[a]||\\\"silent\\\").toUpperCase();try{return void(window.localStorage[l]=b)}catch(c){}try{window.document.cookie=encodeURIComponent(l)+\\\"=\\\"+b+\\\";\\\"}catch(c){}}function g(){var a;try{a=window.localStorage[l]}catch(b){}if(typeof a===h)try{var c=window.document.cookie,d=c.indexOf(encodeURIComponent(l)+\\\"=\\\");d&&(a=/^([^;]+)/.exec(c.slice(d))[1])}catch(b){}return void 0===k.levels[a]&&(a=void 0),a}var j,k=this,l=\\\"loglevel\\\";a&&(l+=\\\":\\\"+a),k.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},k.methodFactory=c||e,k.getLevel=function(){return j},k.setLevel=function(b,c){if(\\\"string\\\"==typeof b&&void 0!==k.levels[b.toUpperCase()]&&(b=k.levels[b.toUpperCase()]),!(\\\"number\\\"==typeof b&&b>=0&&b<=k.levels.SILENT))throw\\\"log.setLevel() called with invalid level: \\\"+b;return j=b,c!==!1&&f(b),d.call(k,b,a),typeof console===h&&b<k.levels.SILENT?\\\"No console available for logging\\\":void 0},k.setDefaultLevel=function(a){g()||k.setLevel(a,!1)},k.enableAll=function(a){k.setLevel(k.levels.TRACE,a)},k.disableAll=function(a){k.setLevel(k.levels.SILENT,a)};var m=g();null==m&&(m=null==b?\\\"WARN\\\":b),k.setLevel(m,!1)}var g=function(){},h=\\\"undefined\\\",i=[\\\"trace\\\",\\\"debug\\\",\\\"info\\\",\\\"warn\\\",\\\"error\\\"],j=new f,k={};j.getLogger=function(a){if(\\\"string\\\"!=typeof a||\\\"\\\"===a)throw new TypeError(\\\"You must supply a name when creating a logger.\\\");var b=k[a];return b||(b=k[a]=new f(a,j.getLevel(),j.methodFactory)),b};var l=typeof window!==h?window.log:void 0;return j.noConflict=function(){return typeof window!==h&&window.log===j&&(window.log=l),j},j});\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/raw-loader!./~/loglevel/dist/loglevel.min.js\n// module id = 724\n// module chunks = 2","module.exports = \"(function(globals) {\\nvar define, requireModule;\\n\\n(function() {\\n  var registry = {}, seen = {};\\n\\n  define = function(name, deps, callback) {\\n    registry[name] = { deps: deps, callback: callback };\\n  };\\n\\n  requireModule = function(name) {\\n    if (seen[name]) { return seen[name]; }\\n    seen[name] = {};\\n\\n    var mod = registry[name];\\n    if (!mod) {\\n      throw new Error(\\\"Module '\\\" + name + \\\"' not found.\\\");\\n    }\\n\\n    var deps = mod.deps,\\n        callback = mod.callback,\\n        reified = [],\\n        exports;\\n\\n    for (var i=0, l=deps.length; i<l; i++) {\\n      if (deps[i] === 'exports') {\\n        reified.push(exports = {});\\n      } else {\\n        reified.push(requireModule(deps[i]));\\n      }\\n    }\\n\\n    var value = callback.apply(this, reified);\\n    return seen[name] = exports || value;\\n  };\\n})();\\n\\ndefine(\\\"rsvp/all\\\",\\n  [\\\"rsvp/promise\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n    /* global toString */\\n\\n\\n    function promiseAtLeast(expected_count, promises) {\\n      if (Object.prototype.toString.call(promises) !== \\\"[object Array]\\\") {\\n        throw new TypeError('You must pass an array to all.');\\n      }\\n\\n      function canceller() {\\n        var promise;\\n        for (var i = 0; i < promises.length; i++) {\\n          promise = promises[i];\\n\\n          if (promise && typeof promise.then === 'function' &&\\n              typeof promise.cancel === 'function') {\\n            promise.cancel();\\n          }\\n        }\\n      }\\n\\n      return new Promise(function(resolve, reject, notify) {\\n        var results = [], remaining = promises.length,\\n        promise, remaining_count = promises.length - expected_count;\\n\\n        if (remaining === 0) {\\n          if (expected_count === 1) {\\n            resolve();\\n          } else {\\n            resolve([]);\\n          }\\n        }\\n\\n        function resolver(index) {\\n          return function(value) {\\n            resolveAll(index, value);\\n          };\\n        }\\n\\n        function resolveAll(index, value) {\\n          results[index] = value;\\n          if (--remaining === remaining_count) {\\n            if (remaining_count === 0) {\\n              resolve(results);\\n            } else {\\n              resolve(value);\\n              canceller();\\n            }\\n          }\\n        }\\n\\n        function notifier(index) {\\n          return function(value) {\\n            notify({\\\"index\\\": index, \\\"value\\\": value});\\n          };\\n        }\\n\\n        function cancelAll(rejectionValue) {\\n          reject(rejectionValue);\\n          canceller();\\n        }\\n\\n        for (var i = 0; i < promises.length; i++) {\\n          promise = promises[i];\\n\\n          if (promise && typeof promise.then === 'function') {\\n            promise.then(resolver(i), cancelAll, notifier(i));\\n          } else {\\n            resolveAll(i, promise);\\n          }\\n        }\\n      }, canceller\\n      );\\n    }\\n\\n    function all(promises) {\\n      return promiseAtLeast(promises.length, promises);\\n    }\\n\\n    function any(promises) {\\n      return promiseAtLeast(1, promises);\\n    }\\n\\n\\n    __exports__.all = all;\\n    __exports__.any = any;\\n  });\\ndefine(\\\"rsvp/async\\\",\\n  [\\\"exports\\\"],\\n  function(__exports__) {\\n    \\\"use strict\\\";\\n    var browserGlobal = (typeof window !== 'undefined') ? window : {};\\n    var BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;\\n    var async;\\n    var local = (typeof global !== 'undefined') ? global : this;\\n\\n    function checkNativePromise() {\\n      if (typeof Promise === \\\"function\\\" &&\\n          typeof Promise.resolve === \\\"function\\\") {\\n        try {\\n          /* global Promise */\\n          var promise = new Promise(function(){});\\n          if ({}.toString.call(promise) === \\\"[object Promise]\\\") {\\n            return true;\\n          }\\n        } catch (e) {}\\n      }\\n      return false;\\n    }\\n\\n    function useNativePromise() {\\n      var nativePromise = Promise.resolve();\\n      return function(callback, arg) {\\n        nativePromise.then(function () {\\n          callback(arg);\\n        });\\n      };\\n    }\\n\\n    // old node\\n    function useNextTick() {\\n      return function(callback, arg) {\\n        process.nextTick(function() {\\n          callback(arg);\\n        });\\n      };\\n    }\\n\\n    // node >= 0.10.x\\n    function useSetImmediate() {\\n      return function(callback, arg) {\\n        /* global  setImmediate */\\n        setImmediate(function(){\\n          callback(arg);\\n        });\\n      };\\n    }\\n\\n    function useMutationObserver() {\\n      var queue = [];\\n\\n      var observer = new BrowserMutationObserver(function() {\\n        var toProcess = queue.slice();\\n        queue = [];\\n\\n        toProcess.forEach(function(tuple) {\\n          var callback = tuple[0], arg= tuple[1];\\n          callback(arg);\\n        });\\n      });\\n\\n      var element = document.createElement('div');\\n      observer.observe(element, { attributes: true });\\n\\n      // Chrome Memory Leak: https://bugs.webkit.org/show_bug.cgi?id=93661\\n      window.addEventListener('unload', function(){\\n        observer.disconnect();\\n        observer = null;\\n      }, false);\\n\\n      return function(callback, arg) {\\n        queue.push([callback, arg]);\\n        element.setAttribute('drainQueue', 'drainQueue');\\n      };\\n    }\\n\\n    function useSetTimeout() {\\n      return function(callback, arg) {\\n        local.setTimeout(function() {\\n          callback(arg);\\n        }, 1);\\n      };\\n    }\\n\\n    if (typeof setImmediate === 'function') {\\n      async = useSetImmediate();\\n    } else if (typeof process !== 'undefined' && {}.toString.call(process) === '[object process]') {\\n      async = useNextTick();\\n    } else if (BrowserMutationObserver) {\\n      async = useMutationObserver();\\n    } else if (checkNativePromise()) {\\n      async = useNativePromise();\\n    } else {\\n      async = useSetTimeout();\\n    }\\n\\n\\n    __exports__.async = async;\\n  });\\ndefine(\\\"rsvp/cancellation_error\\\",\\n  [\\\"exports\\\"],\\n  function(__exports__) {\\n    \\\"use strict\\\";\\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error\\n    function CancellationError(message) {\\n      this.name = \\\"cancel\\\";\\n      if ((message !== undefined) && (typeof message !== \\\"string\\\")) {\\n        throw new TypeError('You must pass a string.');\\n      }\\n      this.message = message || \\\"Default Message\\\";\\n    }\\n    CancellationError.prototype = new Error();\\n    CancellationError.prototype.constructor = CancellationError;\\n\\n\\n    __exports__.CancellationError = CancellationError;\\n  });\\ndefine(\\\"rsvp/config\\\",\\n  [\\\"rsvp/async\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var async = __dependency1__.async;\\n\\n    var config = {};\\n    config.async = async;\\n\\n\\n    __exports__.config = config;\\n  });\\ndefine(\\\"rsvp/defer\\\",\\n  [\\\"rsvp/promise\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n\\n    function defer() {\\n      var deferred = {\\n        // pre-allocate shape\\n        resolve: undefined,\\n        reject:  undefined,\\n        promise: undefined\\n      };\\n\\n      deferred.promise = new Promise(function(resolve, reject) {\\n        deferred.resolve = resolve;\\n        deferred.reject = reject;\\n      });\\n\\n      return deferred;\\n    }\\n\\n\\n    __exports__.defer = defer;\\n  });\\ndefine(\\\"rsvp/events\\\",\\n  [\\\"exports\\\"],\\n  function(__exports__) {\\n    \\\"use strict\\\";\\n    var Event = function(type, options) {\\n      this.type = type;\\n\\n      for (var option in options) {\\n        if (!options.hasOwnProperty(option)) { continue; }\\n\\n        this[option] = options[option];\\n      }\\n    };\\n\\n    var indexOf = function(callbacks, callback) {\\n      for (var i=0, l=callbacks.length; i<l; i++) {\\n        if (callbacks[i][0] === callback) { return i; }\\n      }\\n\\n      return -1;\\n    };\\n\\n    var callbacksFor = function(object) {\\n      var callbacks = object._promiseCallbacks;\\n\\n      if (!callbacks) {\\n        callbacks = object._promiseCallbacks = {};\\n      }\\n\\n      return callbacks;\\n    };\\n\\n    var EventTarget = {\\n      mixin: function(object) {\\n        object.on = this.on;\\n        object.off = this.off;\\n        object.trigger = this.trigger;\\n        return object;\\n      },\\n\\n      on: function(eventNames, callback, binding) {\\n        var allCallbacks = callbacksFor(this), callbacks, eventName;\\n        eventNames = eventNames.split(/\\\\s+/);\\n        binding = binding || this;\\n\\n        while (eventName = eventNames.shift()) {\\n          callbacks = allCallbacks[eventName];\\n\\n          if (!callbacks) {\\n            callbacks = allCallbacks[eventName] = [];\\n          }\\n\\n          if (indexOf(callbacks, callback) === -1) {\\n            callbacks.push([callback, binding]);\\n          }\\n        }\\n      },\\n\\n      off: function(eventNames, callback) {\\n        var allCallbacks = callbacksFor(this), callbacks, eventName, index;\\n        eventNames = eventNames.split(/\\\\s+/);\\n\\n        while (eventName = eventNames.shift()) {\\n          if (!callback) {\\n            allCallbacks[eventName] = [];\\n            continue;\\n          }\\n\\n          callbacks = allCallbacks[eventName];\\n\\n          index = indexOf(callbacks, callback);\\n\\n          if (index !== -1) { callbacks.splice(index, 1); }\\n        }\\n      },\\n\\n      trigger: function(eventName, options) {\\n        var allCallbacks = callbacksFor(this),\\n            callbacks, callbackTuple, callback, binding, event;\\n\\n        if (callbacks = allCallbacks[eventName]) {\\n          // Don't cache the callbacks.length since it may grow\\n          for (var i=0; i<callbacks.length; i++) {\\n            callbackTuple = callbacks[i];\\n            callback = callbackTuple[0];\\n            binding = callbackTuple[1];\\n\\n            if (typeof options !== 'object') {\\n              options = { detail: options };\\n            }\\n\\n            event = new Event(eventName, options);\\n            callback.call(binding, event);\\n          }\\n        }\\n      }\\n    };\\n\\n\\n    __exports__.EventTarget = EventTarget;\\n  });\\ndefine(\\\"rsvp/hash\\\",\\n  [\\\"rsvp/defer\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var defer = __dependency1__.defer;\\n\\n    function size(object) {\\n      var s = 0;\\n\\n      for (var prop in object) {\\n        s++;\\n      }\\n\\n      return s;\\n    }\\n\\n    function hash(promises) {\\n      var results = {}, deferred = defer(), remaining = size(promises);\\n\\n      if (remaining === 0) {\\n        deferred.resolve({});\\n      }\\n\\n      var resolver = function(prop) {\\n        return function(value) {\\n          resolveAll(prop, value);\\n        };\\n      };\\n\\n      var resolveAll = function(prop, value) {\\n        results[prop] = value;\\n        if (--remaining === 0) {\\n          deferred.resolve(results);\\n        }\\n      };\\n\\n      var rejectAll = function(error) {\\n        deferred.reject(error);\\n      };\\n\\n      for (var prop in promises) {\\n        if (promises[prop] && typeof promises[prop].then === 'function') {\\n          promises[prop].then(resolver(prop), rejectAll);\\n        } else {\\n          resolveAll(prop, promises[prop]);\\n        }\\n      }\\n\\n      return deferred.promise;\\n    }\\n\\n\\n    __exports__.hash = hash;\\n  });\\ndefine(\\\"rsvp/node\\\",\\n  [\\\"rsvp/promise\\\",\\\"rsvp/all\\\",\\\"exports\\\"],\\n  function(__dependency1__, __dependency2__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n    var all = __dependency2__.all;\\n\\n    function makeNodeCallbackFor(resolve, reject) {\\n      return function (error, value) {\\n        if (error) {\\n          reject(error);\\n        } else if (arguments.length > 2) {\\n          resolve(Array.prototype.slice.call(arguments, 1));\\n        } else {\\n          resolve(value);\\n        }\\n      };\\n    }\\n\\n    function denodeify(nodeFunc) {\\n      return function()  {\\n        var nodeArgs = Array.prototype.slice.call(arguments), resolve, reject;\\n        var thisArg = this;\\n\\n        var promise = new Promise(function(nodeResolve, nodeReject) {\\n          resolve = nodeResolve;\\n          reject = nodeReject;\\n        });\\n\\n        all(nodeArgs).then(function(nodeArgs) {\\n          nodeArgs.push(makeNodeCallbackFor(resolve, reject));\\n\\n          try {\\n            nodeFunc.apply(thisArg, nodeArgs);\\n          } catch(e) {\\n            reject(e);\\n          }\\n        });\\n\\n        return promise;\\n      };\\n    }\\n\\n\\n    __exports__.denodeify = denodeify;\\n  });\\ndefine(\\\"rsvp/promise\\\",\\n  [\\\"rsvp/config\\\",\\\"rsvp/events\\\",\\\"rsvp/cancellation_error\\\",\\\"exports\\\"],\\n  function(__dependency1__, __dependency2__, __dependency3__, __exports__) {\\n    \\\"use strict\\\";\\n    var config = __dependency1__.config;\\n    var EventTarget = __dependency2__.EventTarget;\\n    var CancellationError = __dependency3__.CancellationError;\\n\\n    function objectOrFunction(x) {\\n      return isFunction(x) || (typeof x === \\\"object\\\" && x !== null);\\n    }\\n\\n    function isFunction(x){\\n      return typeof x === \\\"function\\\";\\n    }\\n\\n    var Promise = function(resolver, canceller) {\\n      var promise = this,\\n      resolved = false;\\n\\n      if (typeof resolver !== 'function') {\\n        throw new TypeError('You must pass a resolver function as the sole argument to the promise constructor');\\n      }\\n\\n      if ((canceller !== undefined) && (typeof canceller !== 'function')) {\\n        throw new TypeError('You can only pass a canceller function' +\\n          ' as the second argument to the promise constructor');\\n      }\\n\\n      if (!(promise instanceof Promise)) {\\n        return new Promise(resolver, canceller);\\n      }\\n\\n      var resolvePromise = function(value) {\\n        if (resolved) { return; }\\n        resolved = true;\\n        resolve(promise, value);\\n      };\\n\\n      var rejectPromise = function(value) {\\n        if (resolved) { return; }\\n        resolved = true;\\n        reject(promise, value);\\n      };\\n\\n      var notifyPromise = function(value) {\\n        if (resolved) { return; }\\n        notify(promise, value);\\n      };\\n\\n      this.on('promise:failed', function(event) {\\n        this.trigger('error', { detail: event.detail });\\n      }, this);\\n\\n      this.on('error', onerror);\\n\\n      this.cancel = function () {\\n        // For now, simply reject the promise and does not propagate the cancel\\n        // to parent or children\\n        if (resolved) { return; }\\n        if (canceller !== undefined) {\\n          try {\\n            canceller();\\n          } catch (e) {\\n            rejectPromise(e);\\n            return;\\n          }\\n        }\\n        // Trigger cancel?\\n        rejectPromise(new CancellationError());\\n      };\\n\\n      try {\\n        resolver(resolvePromise, rejectPromise, notifyPromise);\\n      } catch(e) {\\n        rejectPromise(e);\\n      }\\n    };\\n\\n    function onerror(event) {\\n      if (config.onerror) {\\n        config.onerror(event.detail);\\n      }\\n    }\\n\\n    var invokeCallback = function(type, promise, callback, event) {\\n      var hasCallback = isFunction(callback),\\n          value, error, succeeded, failed;\\n\\n      if (promise.isFulfilled) { return; }\\n      if (promise.isRejected) { return; }\\n\\n      if (hasCallback) {\\n        try {\\n          value = callback(event.detail);\\n          succeeded = true;\\n        } catch(e) {\\n          failed = true;\\n          error = e;\\n        }\\n      } else {\\n        value = event.detail;\\n        succeeded = true;\\n      }\\n\\n      if (handleThenable(promise, value)) {\\n        return;\\n      } else if (hasCallback && succeeded) {\\n        resolve(promise, value);\\n      } else if (failed) {\\n        reject(promise, error);\\n      } else if (type === 'resolve') {\\n        resolve(promise, value);\\n      } else if (type === 'reject') {\\n        reject(promise, value);\\n      }\\n    };\\n\\n\\n    var invokeNotifyCallback = function(promise, callback, event) {\\n      var value;\\n      if (typeof callback === 'function') {\\n        try {\\n          value = callback(event.detail);\\n        } catch (e) {\\n          // stop propagating\\n          return;\\n        }\\n        notify(promise, value);\\n      } else {\\n        notify(promise, event.detail);\\n      }\\n    };\\n\\n    Promise.prototype = {\\n      constructor: Promise,\\n\\n      isRejected: undefined,\\n      isFulfilled: undefined,\\n      rejectedReason: undefined,\\n      fulfillmentValue: undefined,\\n\\n      then: function(done, fail, progress) {\\n        this.off('error', onerror);\\n\\n        var thenPromise = new this.constructor(function() {},\\n            function () {\\n              thenPromise.trigger('promise:cancelled', {});\\n            });\\n\\n        if (this.isFulfilled) {\\n          config.async(function(promise) {\\n            invokeCallback('resolve', thenPromise, done, { detail: promise.fulfillmentValue });\\n          }, this);\\n        }\\n\\n        if (this.isRejected) {\\n          config.async(function(promise) {\\n            invokeCallback('reject', thenPromise, fail, { detail: promise.rejectedReason });\\n          }, this);\\n        }\\n\\n        this.on('promise:resolved', function(event) {\\n          invokeCallback('resolve', thenPromise, done, event);\\n        });\\n\\n        this.on('promise:failed', function(event) {\\n          invokeCallback('reject', thenPromise, fail, event);\\n        });\\n\\n        this.on('promise:notified', function (event) {\\n          invokeNotifyCallback(thenPromise, progress, event);\\n        });\\n\\n        return thenPromise;\\n      },\\n\\n      fail: function(fail) {\\n        return this.then(null, fail);\\n      },\\n\\n      always: function(fail) {\\n        return this.then(fail, fail);\\n      }\\n    };\\n\\n    EventTarget.mixin(Promise.prototype);\\n\\n    function resolve(promise, value) {\\n      if (promise === value) {\\n        fulfill(promise, value);\\n      } else if (!handleThenable(promise, value)) {\\n        fulfill(promise, value);\\n      }\\n    }\\n\\n    function handleThenable(promise, value) {\\n      var then = null,\\n      resolved;\\n\\n      try {\\n        if (promise === value) {\\n          throw new TypeError(\\\"A promises callback cannot return that same promise.\\\");\\n        }\\n\\n        if (objectOrFunction(value)) {\\n          then = value.then;\\n\\n          if (isFunction(then)) {\\n            if (isFunction(value.on)) {\\n              value.on('promise:notified', function (event) {\\n                notify(promise, event.detail);\\n              });\\n            }\\n            promise.on('promise:cancelled', function(event) {\\n              if (isFunction(value.cancel)) {\\n                value.cancel();\\n              }\\n            });\\n            then.call(value, function(val) {\\n              if (resolved) { return true; }\\n              resolved = true;\\n\\n              if (value !== val) {\\n                resolve(promise, val);\\n              } else {\\n                fulfill(promise, val);\\n              }\\n            }, function(val) {\\n              if (resolved) { return true; }\\n              resolved = true;\\n\\n              reject(promise, val);\\n            });\\n\\n            return true;\\n          }\\n        }\\n      } catch (error) {\\n        reject(promise, error);\\n        return true;\\n      }\\n\\n      return false;\\n    }\\n\\n    function fulfill(promise, value) {\\n      config.async(function() {\\n        if (promise.isFulfilled) { return; }\\n        if (promise.isRejected) { return; }\\n        promise.trigger('promise:resolved', { detail: value });\\n        promise.isFulfilled = true;\\n        promise.fulfillmentValue = value;\\n      });\\n    }\\n\\n    function reject(promise, value) {\\n      config.async(function() {\\n        if (promise.isFulfilled) { return; }\\n        if (promise.isRejected) { return; }\\n        promise.trigger('promise:failed', { detail: value });\\n        promise.isRejected = true;\\n        promise.rejectedReason = value;\\n      });\\n    }\\n\\n    function notify(promise, value) {\\n      config.async(function() {\\n        promise.trigger('promise:notified', { detail: value });\\n      });\\n    }\\n\\n\\n    __exports__.Promise = Promise;\\n  });\\ndefine(\\\"rsvp/queue\\\",\\n  [\\\"rsvp/promise\\\",\\\"rsvp/resolve\\\",\\\"exports\\\"],\\n  function(__dependency1__, __dependency2__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n    var resolve = __dependency2__.resolve;\\n\\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error\\n    function ResolvedQueueError(message) {\\n      this.name = \\\"resolved\\\";\\n      if ((message !== undefined) && (typeof message !== \\\"string\\\")) {\\n        throw new TypeError('You must pass a string.');\\n      }\\n      this.message = message || \\\"Default Message\\\";\\n    }\\n    ResolvedQueueError.prototype = new Error();\\n    ResolvedQueueError.prototype.constructor = ResolvedQueueError;\\n\\n    var Queue = function() {\\n      var queue = this,\\n        promise_list = [],\\n        promise,\\n        fulfill,\\n        reject,\\n        notify,\\n        resolved;\\n\\n      if (!(this instanceof Queue)) {\\n        return new Queue();\\n      }\\n\\n      function canceller() {\\n        for (var i = 0; i < 2; i++) {\\n          promise_list[i].cancel();\\n        }\\n      }\\n\\n      promise = new Promise(function(done, fail, progress) {\\n        fulfill = function (fulfillmentValue) {\\n          if (resolved) {return;}\\n          queue.isFulfilled = true;\\n          queue.fulfillmentValue = fulfillmentValue;\\n          resolved = true;\\n          return done(fulfillmentValue);\\n        };\\n        reject = function (rejectedReason) {\\n          if (resolved) {return;}\\n          queue.isRejected = true;\\n          queue.rejectedReason = rejectedReason ;\\n          resolved = true;\\n          return fail(rejectedReason);\\n        };\\n        notify = progress;\\n      }, canceller);\\n\\n      promise_list.push(resolve());\\n      promise_list.push(promise_list[0].then(function () {\\n        promise_list.splice(0, 2);\\n        if (promise_list.length === 0) {\\n          fulfill();\\n        }\\n      }));\\n\\n      queue.cancel = function () {\\n        if (resolved) {return;}\\n        resolved = true;\\n        promise.cancel();\\n        promise.fail(function (rejectedReason) {\\n          queue.isRejected = true;\\n          queue.rejectedReason = rejectedReason;\\n        });\\n      };\\n      queue.then = function () {\\n        return promise.then.apply(promise, arguments);\\n      };\\n\\n      queue.push = function(done, fail, progress) {\\n        var last_promise = promise_list[promise_list.length - 1],\\n          next_promise;\\n\\n        if (resolved) {\\n          throw new ResolvedQueueError();\\n        }\\n\\n        next_promise = last_promise.then(done, fail, progress);\\n        promise_list.push(next_promise);\\n\\n        // Handle pop\\n        last_promise = next_promise.then(function (fulfillmentValue) {\\n          promise_list.splice(0, 2);\\n          if (promise_list.length === 0) {\\n            fulfill(fulfillmentValue);\\n          } else {\\n            return fulfillmentValue;\\n          }\\n        }, function (rejectedReason) {\\n          promise_list.splice(0, 2);\\n          if (promise_list.length === 0) {\\n            reject(rejectedReason);\\n          } else {\\n            throw rejectedReason;\\n          }\\n        }, function (notificationValue) {\\n          if (promise_list[promise_list.length - 1] === last_promise) {\\n            notify(notificationValue);\\n          }\\n          return notificationValue;\\n        });\\n        promise_list.push(last_promise);\\n\\n        return this;\\n      };\\n    };\\n\\n    Queue.prototype = Object.create(Promise.prototype);\\n    Queue.prototype.constructor = Queue;\\n\\n\\n    __exports__.Queue = Queue;\\n    __exports__.ResolvedQueueError = ResolvedQueueError;\\n  });\\ndefine(\\\"rsvp/reject\\\",\\n  [\\\"rsvp/promise\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n\\n    function reject(reason) {\\n      return new Promise(function (resolve, reject) {\\n        reject(reason);\\n      });\\n    }\\n\\n\\n    __exports__.reject = reject;\\n  });\\ndefine(\\\"rsvp/resolve\\\",\\n  [\\\"rsvp/promise\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n\\n    function resolve(thenable) {\\n      return new Promise(function(resolve, reject) {\\n        if (typeof thenable === \\\"object\\\" && thenable !== null) {\\n          var then = thenable.then;\\n          if ((then !== undefined) && (typeof then === \\\"function\\\")) {\\n            return then.apply(thenable, [resolve, reject]);\\n          }\\n        }\\n        return resolve(thenable);\\n      }, function () {\\n        if ((thenable !== undefined) && (thenable.cancel !== undefined)) {\\n          thenable.cancel();\\n        }\\n      });\\n    }\\n\\n\\n    __exports__.resolve = resolve;\\n  });\\ndefine(\\\"rsvp/rethrow\\\",\\n  [\\\"exports\\\"],\\n  function(__exports__) {\\n    \\\"use strict\\\";\\n    var local = (typeof global === \\\"undefined\\\") ? this : global;\\n\\n    function rethrow(reason) {\\n      local.setTimeout(function() {\\n        throw reason;\\n      });\\n      throw reason;\\n    }\\n\\n\\n    __exports__.rethrow = rethrow;\\n  });\\ndefine(\\\"rsvp/timeout\\\",\\n  [\\\"rsvp/promise\\\",\\\"exports\\\"],\\n  function(__dependency1__, __exports__) {\\n    \\\"use strict\\\";\\n    var Promise = __dependency1__.Promise;\\n\\n    function promiseSetTimeout(millisecond, should_reject, message) {\\n      var timeout_id;\\n\\n      function resolver(resolve, reject) {\\n        timeout_id = setTimeout(function () {\\n          if (should_reject) {\\n            reject(message);\\n          } else {\\n            resolve(message);\\n          }\\n        }, millisecond);\\n      }\\n      function canceller() {\\n        clearTimeout(timeout_id);\\n      }\\n      return new Promise(resolver, canceller);\\n    }\\n\\n    function delay(millisecond, message) {\\n      return promiseSetTimeout(millisecond, false, message);\\n    }\\n\\n    function timeout(millisecond) {\\n      return promiseSetTimeout(millisecond, true,\\n                               \\\"Timed out after \\\" + millisecond + \\\" ms\\\");\\n    }\\n\\n    Promise.prototype.delay = function(millisecond) {\\n      return this.then(function (fulfillmentValue) {\\n        return delay(millisecond, fulfillmentValue);\\n      });\\n    };\\n\\n\\n    __exports__.delay = delay;\\n    __exports__.timeout = timeout;\\n  });\\ndefine(\\\"rsvp\\\",\\n  [\\\"rsvp/events\\\",\\\"rsvp/cancellation_error\\\",\\\"rsvp/promise\\\",\\\"rsvp/node\\\",\\\"rsvp/all\\\",\\\"rsvp/queue\\\",\\\"rsvp/timeout\\\",\\\"rsvp/hash\\\",\\\"rsvp/rethrow\\\",\\\"rsvp/defer\\\",\\\"rsvp/config\\\",\\\"rsvp/resolve\\\",\\\"rsvp/reject\\\",\\\"exports\\\"],\\n  function(__dependency1__, __dependency2__, __dependency3__, __dependency4__, __dependency5__, __dependency6__, __dependency7__, __dependency8__, __dependency9__, __dependency10__, __dependency11__, __dependency12__, __dependency13__, __exports__) {\\n    \\\"use strict\\\";\\n    var EventTarget = __dependency1__.EventTarget;\\n    var CancellationError = __dependency2__.CancellationError;\\n    var Promise = __dependency3__.Promise;\\n    var denodeify = __dependency4__.denodeify;\\n    var all = __dependency5__.all;\\n    var any = __dependency5__.any;\\n    var Queue = __dependency6__.Queue;\\n    var ResolvedQueueError = __dependency6__.ResolvedQueueError;\\n    var delay = __dependency7__.delay;\\n    var timeout = __dependency7__.timeout;\\n    var hash = __dependency8__.hash;\\n    var rethrow = __dependency9__.rethrow;\\n    var defer = __dependency10__.defer;\\n    var config = __dependency11__.config;\\n    var resolve = __dependency12__.resolve;\\n    var reject = __dependency13__.reject;\\n\\n    function configure(name, value) {\\n      config[name] = value;\\n    }\\n\\n\\n    __exports__.CancellationError = CancellationError;\\n    __exports__.Promise = Promise;\\n    __exports__.EventTarget = EventTarget;\\n    __exports__.all = all;\\n    __exports__.any = any;\\n    __exports__.Queue = Queue;\\n    __exports__.ResolvedQueueError = ResolvedQueueError;\\n    __exports__.delay = delay;\\n    __exports__.timeout = timeout;\\n    __exports__.hash = hash;\\n    __exports__.rethrow = rethrow;\\n    __exports__.defer = defer;\\n    __exports__.denodeify = denodeify;\\n    __exports__.configure = configure;\\n    __exports__.resolve = resolve;\\n    __exports__.reject = reject;\\n  });\\nwindow.RSVP = requireModule(\\\"rsvp\\\");\\n})(window);\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/raw-loader!./~/rsvp/dist/rsvp-2.0.4.js\n// module id = 725\n// module chunks = 2"],"sourceRoot":""}